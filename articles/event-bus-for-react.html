<!DOCTYPE html><html lang="en"><head><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/svg" sizes="32x32" href="/favicon.svg"/><link rel="icon" type="image/svg" sizes="16x16" href="/favicon.svg"/><link rel="mask-icon" href="/favicon.svg" color="#ffffff"/><link rel="manifest" href="/site.webmanifest"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><meta name="msapplication-TileColor" content="#007cf0"/><meta name="theme-color" content="#ffff"/><title>Event Bus for React</title><meta name="description" content="Event Bus is an interesting design pattern to build a lightweight event system. We will discover its use cases in React and build a type-safe Event Bus from scratch with TypeScript."/><meta name="robots" content="follow, index"/><link rel="canonical" href="https://dawchihliou.github.io/articles/event-bus-for-react"/><meta itemProp="name" content="Event Bus for React"/><meta itemProp="description" content="Event Bus is an interesting design pattern to build a lightweight event system. We will discover its use cases in React and build a type-safe Event Bus from scratch with TypeScript."/><meta itemProp="image" content="https://dawchihliou.github.io/optimized/articles/react-event-bus/hero.png"/><meta property="og:title" content="Event Bus for React"/><meta property="og:type" content="website"/><meta property="og:url" content="https://dawchihliou.github.io/articles/event-bus-for-react"/><meta property="og:description" content="Event Bus is an interesting design pattern to build a lightweight event system. We will discover its use cases in React and build a type-safe Event Bus from scratch with TypeScript."/><meta property="og:image" content="https://dawchihliou.github.io/optimized/articles/react-event-bus/hero.png"/><meta property="og:image:type" content="image/png"/><meta property="og:image:width" content="1400"/><meta property="og:image:height" content="600"/><meta property="og:image:alt" content="Event Bus is an interesting design pattern to build a lightweight event system. We will discover its use cases in React and build a type-safe Event Bus from scratch with TypeScript."/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@dawchihliou"/><meta name="twitter:creator" content="@dawchihliou"/><meta name="twitter:title" content="Event Bus for React"/><meta name="twitter:description" content="Event Bus is an interesting design pattern to build a lightweight event system. We will discover its use cases in React and build a type-safe Event Bus from scratch with TypeScript."/><meta name="twitter:image" content="https://dawchihliou.github.io/optimized/articles/react-event-bus/hero.webp"/><meta property="article:published_time" content="2022-08-02T00:00:00.000Z"/><meta property="article:section" content="Article Section"/><meta property="article:tag" content="Article Tag"/><meta name="next-head-count" content="34"/><link rel="preload" href="/_next/static/css/f4214c3b71874d65.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f4214c3b71874d65.css" data-n-g=""/><link rel="preload" href="/_next/static/css/54ba867c7255694d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/54ba867c7255694d.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-59c5c889f52620d6.js" defer=""></script><script src="/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/_next/static/chunks/main-010ff0b6bbe5ac8f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5784eb5f9f6cd23e.js" defer=""></script><script src="/_next/static/chunks/pages/articles/%5Bslug%5D-6aa06637217e2cb9.js" defer=""></script><script src="/_next/static/GtQPiDm2ep1nxGp2q3_Hd/_buildManifest.js" defer=""></script><script src="/_next/static/GtQPiDm2ep1nxGp2q3_Hd/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div id="outer-container"><header><div><div class="bm-overlay" style="position:fixed;z-index:1000;width:100%;height:100%;background:rgba(0, 0, 0, 0.3);opacity:0;-moz-transform:translate3d(100%, 0, 0);-ms-transform:translate3d(100%, 0, 0);-o-transform:translate3d(100%, 0, 0);-webkit-transform:translate3d(100%, 0, 0);transform:translate3d(100%, 0, 0);transition:opacity 0.3s, transform 0s 0.3s"></div><div><div class="bm-burger-button" style="z-index:1000"><button id="react-burger-menu-btn" style="position:absolute;left:0;top:0;z-index:1;width:100%;height:100%;margin:0;padding:0;border:none;font-size:0;background:transparent;cursor:pointer">Open Menu</button><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="bm-icon" style="width:100%;height:100%" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div></div><div id="" class="bm-menu-wrap" style="position:fixed;right:inherit;z-index:1100;width:300px;height:100%;-moz-transform:translate3d(-100%, 0, 0);-ms-transform:translate3d(-100%, 0, 0);-o-transform:translate3d(-100%, 0, 0);-webkit-transform:translate3d(-100%, 0, 0);transform:translate3d(-100%, 0, 0);transition:all 0.5s" aria-hidden="true"><div class="bm-menu" style="height:100%;box-sizing:border-box;overflow:auto"><nav class="bm-item-list" style="height:100%"><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/"><button class="Nav_button__YJwKE" tabindex="-1">Home</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/articles"><button class="Nav_button__YJwKE" tabindex="-1">Articles</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/work"><button class="Nav_button__YJwKE" tabindex="-1">Work</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/now"><button class="Nav_button__YJwKE" tabindex="-1">Now</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/expertise"><button class="Nav_button__YJwKE" tabindex="-1">Expertise</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/contact"><button class="Nav_button__YJwKE" tabindex="-1">Contact</button></a><span class="bm-item Nav_pusher__93Gc6" style="display:block" tabindex="-1"></span><span class="bm-item Nav_divider__QD8Pt" style="display:block" tabindex="-1"></span><div class="bm-item Nav_profile__Kf2nU" style="display:block" tabindex="-1"><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/dawchihliou" aria-label="Link to Daw-Chih&#x27;s Linkedin profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M20.45175,20.45025 L16.89225,20.45025 L16.89225,14.88075 C16.89225,13.5525 16.86975,11.844 15.04275,11.844 C13.191,11.844 12.90825,13.2915 12.90825,14.7855 L12.90825,20.45025 L9.3525,20.45025 L9.3525,8.997 L12.765,8.997 L12.765,10.563 L12.81375,10.563 C13.2885,9.66225 14.4495,8.71275 16.18125,8.71275 C19.78575,8.71275 20.45175,11.08425 20.45175,14.169 L20.45175,20.45025 Z M5.33925,7.4325 C4.1955,7.4325 3.27375,6.50775 3.27375,5.36775 C3.27375,4.2285 4.1955,3.30375 5.33925,3.30375 C6.47775,3.30375 7.4025,4.2285 7.4025,5.36775 C7.4025,6.50775 6.47775,7.4325 5.33925,7.4325 L5.33925,7.4325 Z M7.11975,20.45025 L3.5565,20.45025 L3.5565,8.997 L7.11975,8.997 L7.11975,20.45025 Z M23.00025,0 L1.0005,0 C0.44775,0 0,0.44775 0,0.99975 L0,22.9995 C0,23.55225 0.44775,24 1.0005,24 L23.00025,24 C23.55225,24 24,23.55225 24,22.9995 L24,0.99975 C24,0.44775 23.55225,0 23.00025,0 L23.00025,0 Z"></path></svg></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou" aria-label="Link to Daw-Chih&#x27;s GitHub profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M11.9989871,1 C5.92550416,1 1,5.92482888 1,12.0003376 C1,16.8603395 4.15153934,20.9829338 8.52263728,22.4374904 C9.0729918,22.5387827 9.27355045,22.199116 9.27355045,21.9073943 C9.27355045,21.6467356 9.2640965,20.954572 9.25869425,20.0368642 C6.19899322,20.7013414 5.55342398,18.5620492 5.55342398,18.5620492 C5.0530403,17.2911692 4.33183953,16.9528531 4.33183953,16.9528531 C3.33309801,16.2708186 4.40747107,16.2843243 4.40747107,16.2843243 C5.51155652,16.3619816 6.09229872,17.4181221 6.09229872,17.4181221 C7.07348292,19.0988981 8.66714755,18.6133706 9.2938089,18.3317781 C9.39375058,17.6213819 9.67804414,17.1365297 9.99205009,16.86169 C7.54955646,16.5841493 4.98146045,15.6401056 4.98146045,11.4249977 C4.98146045,10.224347 5.41026428,9.24181221 6.11390773,8.47334172 C6.00046042,8.19512569 5.62297799,7.07618404 6.22195279,5.56220265 C6.22195279,5.56220265 7.14506277,5.26642929 9.24653918,6.68992296 C10.12373,6.44547101 11.0650726,6.32392032 12.0003376,6.31919335 C12.9349274,6.32392032 13.8755947,6.44547101 14.7541361,6.68992296 C16.8542619,5.26642929 17.7760214,5.56220265 17.7760214,5.56220265 C18.3763467,7.07618404 17.9988643,8.19512569 17.8860923,8.47334172 C18.5910863,9.24181221 19.0165137,10.224347 19.0165137,11.4249977 C19.0165137,15.6509101 16.444366,16.5807729 13.9944443,16.8529114 C14.3888087,17.192578 14.7406305,17.863808 14.7406305,18.890236 C14.7406305,20.3603241 14.7271248,21.5467939 14.7271248,21.9073943 C14.7271248,22.2018171 14.9256576,22.5441849 15.4834403,22.4368151 C19.8511618,20.9788821 23,16.8589889 23,12.0003376 C23,5.92482888 18.0744958,1 11.9989871,1"></path></svg></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://medium.com/@dawchihliou" aria-label="Link to Daw-Chih&#x27;s Medium profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2.84593838,5.88685595 C2.87575654,5.59224254 2.76340763,5.30104995 2.54341737,5.10276397 L0.302521008,2.4032473 L0.302521008,2 L7.2605042,2 L12.6386555,13.7949836 L17.3669469,2 L24,2 L24,2.4032473 L22.0840336,4.2402628 C21.9188563,4.36617057 21.8369199,4.57310892 21.8711485,4.77792587 L21.8711485,18.2755093 C21.8369199,18.4803262 21.9188563,18.6872645 22.0840336,18.8131723 L23.9551821,20.6501878 L23.9551821,21.0534351 L14.5434174,21.0534351 L14.5434174,20.6501878 L16.4817928,18.7683671 C16.6722689,18.5779447 16.6722689,18.5219382 16.6722689,18.2307041 L16.6722689,7.32062416 L11.2829132,21.0086299 L10.5546219,21.0086299 L4.28011204,7.32062416 L4.28011204,16.4945003 C4.22779746,16.8801958 4.35589372,17.2685069 4.62745097,17.5474239 L7.14845938,20.6053826 L7.14845938,21.0086299 L0,21.0086299 L0,20.6053826 L2.5210084,17.5474239 C2.79058848,17.2680445 2.91121535,16.8771576 2.84593838,16.4945003 L2.84593838,5.88685595 Z"></path></svg></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://hackernoon.com/u/dawchihliou" aria-label="Link to Daw-Chih&#x27;s Hackernoon profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="1.5em" width="1.5em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M5.701 0v6.223H8.85V4.654h1.576v7.842H12V4.654h1.574v1.569h3.15V0zm11.024 6.223v3.136h1.574V6.223zm1.574 3.136v4.705h1.576v-1.568h1.574v-1.568h-1.574V9.359zm0 4.705h-1.574v3.137h1.574zm-1.574 3.137h-3.15v1.569H8.85V17.2H5.7V24h11.024zm-11.024 0v-3.137H4.125v3.137zm-1.576-3.137V9.36H2.551v4.705zm0-4.705h1.576V6.223H4.125Z"></path></svg><span hidden="">Link to Daw-Chih&#x27;s Hacker Noon profile</span></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://twitter.com/dawchihliou" aria-label="Link to Daw-Chih&#x27;s Twitter profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M24,4.3086 C23.117,4.7006 22.168,4.9646 21.172,5.0836 C22.188,4.4746 22.969,3.5096 23.337,2.3596 C22.386,2.9246 21.332,3.3336 20.21,3.5556 C19.312,2.5976 18.032,1.9996 16.616,1.9996 C13.897,1.9996 11.692,4.2046 11.692,6.9236 C11.692,7.3096 11.736,7.6856 11.82,8.0456 C7.728,7.8406 4.099,5.8806 1.671,2.9006 C1.247,3.6286 1.004,4.4736 1.004,5.3766 C1.004,7.0846 1.873,8.5926 3.195,9.4756 C2.388,9.4486 1.628,9.2276 0.964,8.8596 L0.964,8.9206 C0.964,11.3066 2.661,13.2966 4.914,13.7486 C4.501,13.8626 4.065,13.9216 3.617,13.9216 C3.299,13.9216 2.991,13.8906 2.69,13.8336 C3.317,15.7896 5.135,17.2136 7.29,17.2536 C5.604,18.5736 3.481,19.3606 1.175,19.3606 C0.777,19.3606 0.385,19.3376 0,19.2926 C2.179,20.6886 4.767,21.5046 7.548,21.5046 C16.605,21.5046 21.557,14.0016 21.557,7.4946 C21.557,7.2816 21.552,7.0696 21.543,6.8586 C22.505,6.1636 23.34,5.2966 24,4.3086"></path></svg></a></div><div class="DarkmodeSwitch_container__uFGHQ" tabindex="-1"><div class="DarkmodeSwitch_wrap__e71_4"></div></div></nav></div><div><div class="bm-cross-button" style="position:absolute;width:24px;height:24px;right:8px;top:8px"><button id="react-burger-cross-btn" style="position:absolute;left:0;top:0;z-index:1;width:100%;height:100%;margin:0;padding:0;border:none;font-size:0;background:transparent;cursor:pointer" tabindex="-1">Close Menu</button><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="bm-cross" style="width:100%;height:100%" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div></div></div></div></header><div class="Menubar_menubar__gvU4b"><a class="styles_anchor__g18qA Menubar_hireMe__zuAig" href="/contact"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1.5em" width="1.5em" xmlns="http://www.w3.org/2000/svg"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>Hire Me</a><div class="DarkmodeSwitch_container__uFGHQ" tabindex="0"><div class="DarkmodeSwitch_wrap__e71_4"></div></div><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou" aria-label="See more Daw-Chih&#x27;s work on GitHub"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1.5em" width="1.5em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M11.9989871,1 C5.92550416,1 1,5.92482888 1,12.0003376 C1,16.8603395 4.15153934,20.9829338 8.52263728,22.4374904 C9.0729918,22.5387827 9.27355045,22.199116 9.27355045,21.9073943 C9.27355045,21.6467356 9.2640965,20.954572 9.25869425,20.0368642 C6.19899322,20.7013414 5.55342398,18.5620492 5.55342398,18.5620492 C5.0530403,17.2911692 4.33183953,16.9528531 4.33183953,16.9528531 C3.33309801,16.2708186 4.40747107,16.2843243 4.40747107,16.2843243 C5.51155652,16.3619816 6.09229872,17.4181221 6.09229872,17.4181221 C7.07348292,19.0988981 8.66714755,18.6133706 9.2938089,18.3317781 C9.39375058,17.6213819 9.67804414,17.1365297 9.99205009,16.86169 C7.54955646,16.5841493 4.98146045,15.6401056 4.98146045,11.4249977 C4.98146045,10.224347 5.41026428,9.24181221 6.11390773,8.47334172 C6.00046042,8.19512569 5.62297799,7.07618404 6.22195279,5.56220265 C6.22195279,5.56220265 7.14506277,5.26642929 9.24653918,6.68992296 C10.12373,6.44547101 11.0650726,6.32392032 12.0003376,6.31919335 C12.9349274,6.32392032 13.8755947,6.44547101 14.7541361,6.68992296 C16.8542619,5.26642929 17.7760214,5.56220265 17.7760214,5.56220265 C18.3763467,7.07618404 17.9988643,8.19512569 17.8860923,8.47334172 C18.5910863,9.24181221 19.0165137,10.224347 19.0165137,11.4249977 C19.0165137,15.6509101 16.444366,16.5807729 13.9944443,16.8529114 C14.3888087,17.192578 14.7406305,17.863808 14.7406305,18.890236 C14.7406305,20.3603241 14.7271248,21.5467939 14.7271248,21.9073943 C14.7271248,22.2018171 14.9256576,22.5441849 15.4834403,22.4368151 C19.8511618,20.9788821 23,16.8589889 23,12.0003376 C23,5.92482888 18.0744958,1 11.9989871,1"></path></svg></a></div><div id="page-wrap"><article><div class="Article_container__q__L3"><div class="Article_wrap__LZypL"><h1>Event Bus for React</h1><div class="Article_info__bOKys"><div class="Article_author__grS8U"><img alt="Daw-Chih Liou" src="/optimized/raw/portrait-sm.webp" loading="lazy"/><p>Daw-Chih Liou</p></div><p>Aug 2, 2022<!-- --> · 9 min read</p></div><img alt="Event Bus for React" src="/optimized/articles/react-event-bus/hero.webp" width="100%" loading="lazy"/><div class="article-content"><h2 id="tldr"><a class="styles_anchor__g18qA anchor" href="/articles/event-bus-for-react#tldr"><span class="icon icon-link"></span></a>TL;DR</h2>
<ul>
<li><span role="img" aria-label="bus">🚌</span> We&#x27;ll write a lightweight Event Bus from scratch in just 60 lines!</li>
<li><span role="img" aria-label="seedling">🌱</span> We&#x27;ll learn the use case to best utilize Event Bus in React.</li>
<li><span role="img" aria-label="woman lifting weights">🏋️‍♀️</span> We&#x27;ll apply Event Bus in a demo with Google Maps API.</li>
</ul>
<hr/>
<p>This article is also available on</p>
<ul>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://betterprogramming.pub/how-to-use-event-bus-in-react-architecture-f90485477647">Better Programming</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://hackernoon.com/writing-an-event-bus-for-react">Hacker Noon</a></li>
</ul>
<p>Feel free to read it on your favorite platform<span role="img" aria-label="sparkles">✨</span></p>
<hr/>
<p>I recently came across an interesting use case of Event Bus at work. It&#x27;s a very lean module to organize logging for analytics in a global-scale web application. It creates great clarity in a large code base so I want to share with you my case study of this useful design pattern.</p>
<p>Let&#x27;s go.</p>
<h2 id="what-is-an-event-bus"><a class="styles_anchor__g18qA anchor" href="/articles/event-bus-for-react#what-is-an-event-bus"><span class="icon icon-link"></span></a>What Is An Event Bus?</h2>
<p>An Event Bus is a design pattern that allows PubSub-style communication between components while the components remain loosely coupled.</p>
<p>A component can send a message to an Event Bus without knowing where the message is sent to. On the other hand, a component can listen to a message on an Event Bus and decide what to do with the message without knowing where the message comes from. With this design, independent components can communicate without knowing each other.</p>
<p>The visualization looks like this:</p>
<img src="/optimized/articles/react-event-bus/bus.webp" alt="Event Bus illustration" width="100%" class="rounded centered" loading="lazy"/>
<ul>
<li>Event: The message being sent and received on an Event Bus.</li>
<li>Publisher: The sender that <strong>emits</strong> an event.</li>
<li>Subscriber: The receiver that <strong>listens</strong> to an event.</li>
</ul>
<p>Let&#x27;s take a closer look at Event Bus.</p>
<h2 id="building-an-event-bus-from-scratch"><a class="styles_anchor__g18qA anchor" href="/articles/event-bus-for-react#building-an-event-bus-from-scratch"><span class="icon icon-link"></span></a>Building An Event Bus from Scratch</h2>
<p>Inspired by <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://v3-migration.vuejs.org/breaking-changes/events-api.html">Vue&#x27;s legacy Events API</a>, we&#x27;ll implement the following APIs for our Event Bus:</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">type</span> <span class="token class-name">EventHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span>payload<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">interface</span> <span class="token class-name">EventBus</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token function">on</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> handler<span class="token operator">:</span> EventHandler<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
</span><span class="code-line">  <span class="token function">off</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> handler<span class="token operator">:</span> EventHandler<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
</span><span class="code-line">  <span class="token function">emit</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token operator">...</span>payload<span class="token operator">:</span> Parameters<span class="token operator">&lt;</span>EventHandler<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
</span><span class="code-line">  <span class="token function">once</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> handler<span class="token operator">:</span> EventHandler<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<ul>
<li><strong>on</strong>: for a subscriber to listen (subscribe) to an event and register its event handler.</li>
<li><strong>off</strong>: for a subscriber to remove (unsubscribe) an event and its event handler.</li>
<li><strong>once</strong>: for a subscriber to listen to an event only once.</li>
<li><strong>emit</strong>: for a publisher to send an event to the event bus.</li>
</ul>
<p>Now, the data structure for our Event Bus should be capable of two things:</p>
<ul>
<li>For publishers: to be able to fire the registered event handlers associated with the event key when <strong>emit</strong> is called.</li>
<li>For subscribers: to be able to add or remove event handlers when <strong>on</strong>, <strong>once</strong>, or <strong>off</strong> is called</li>
</ul>
<p>We can use a key-value structure for it:</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">type</span> <span class="token class-name">Bus</span> <span class="token operator">=</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> EventHandler<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>
</span></code></pre>
<p>To implement the <strong>on</strong> method, all we need to do is to add the event key to the bus and append the event handler to the handler array. We also want to return an unsubscribe function to remove the event handler.</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">eventbus</span><span class="token punctuation">(</span>config<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token comment">// error handler for later</span>
</span><span class="code-line">  <span class="token function-variable function">onError</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>params<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">:</span> EventBus <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> bus<span class="token operator">:</span> Bus <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> on<span class="token operator">:</span> EventBus<span class="token punctuation">[</span><span class="token string">&#x27;on&#x27;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> handler<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>bus<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      bus<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    bus<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">?.</span><span class="token function">push</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// unsubscribe function</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token function">off</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> handler<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token punctuation">{</span> on <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>To implement <strong>off</strong>, we can simply remove the event handler from the bus.</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">const</span> off<span class="token operator">:</span> EventBus<span class="token punctuation">[</span><span class="token string">&#x27;off&#x27;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> handler<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> index <span class="token operator">=</span> bus<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">?.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token operator">-</span><span class="token number">1</span>
</span><span class="code-line">  bus<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">?.</span><span class="token function">splice</span><span class="token punctuation">(</span>index <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>When <strong>emit</strong> is called, what we want to do is to fire all the event handlers that associate with the event. We&#x27;ll add error handling here to make sure all the event handlers will be fired despite errors.</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">const</span> emit<span class="token operator">:</span> EventBus<span class="token punctuation">[</span><span class="token string">&#x27;emit&#x27;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> payload<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  bus<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">?.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">try</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token function">fn</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      config<span class="token operator">?.</span><span class="token function">onError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>Since <strong>once</strong> will only listen to an event exactly once, we can think of it as a method that registers a handler that deregisters itself after firing. One way to do it is to create a higher order function <strong>handleOnce</strong>:</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">const</span> once<span class="token operator">:</span> EventBus<span class="token punctuation">[</span><span class="token string">&#x27;once&#x27;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> handler<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">handleOnce</span> <span class="token operator">=</span> <span class="token punctuation">(</span>payload<span class="token operator">:</span> Parameters<span class="token operator">&lt;</span><span class="token keyword">typeof</span> handler<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">handler</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token function">off</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> handleOnce <span class="token keyword">as</span> <span class="token keyword">typeof</span> handler<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token function">on</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> handleOnce <span class="token keyword">as</span> <span class="token keyword">typeof</span> handler<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>Now we have all the methods in our Event Bus!</p>
<h3 id="improve-typescript-typing"><a class="styles_anchor__g18qA anchor" href="/articles/event-bus-for-react#improve-typescript-typing"><span class="icon icon-link"></span></a>Improve TypeScript Typing</h3>
<p>The current typing for the Event Bus is quite open ended. The event key could be any string and the event handler could be any function. To make it safer to use, we can add type checking to add the event key and handler association to the <strong>EventBus</strong>.</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">type</span> <span class="token class-name">EventKey</span> <span class="token operator">=</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">symbol</span>
</span><span class="code-line"><span class="token keyword">type</span> <span class="token class-name">EventHandler<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>payload<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
</span><span class="code-line"><span class="token keyword">type</span> <span class="token class-name">EventMap</span> <span class="token operator">=</span> Record<span class="token operator">&lt;</span>EventKey<span class="token punctuation">,</span> EventHandler<span class="token operator">&gt;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">interface</span> <span class="token class-name">EventBus<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> EventMap<span class="token operator">&gt;</span></span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token generic-function"><span class="token function">on</span><span class="token generic class-name"><span class="token operator">&lt;</span>Key <span class="token keyword">extends</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>key<span class="token operator">:</span> Key<span class="token punctuation">,</span> handler<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span>Key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
</span><span class="code-line">  <span class="token generic-function"><span class="token function">off</span><span class="token generic class-name"><span class="token operator">&lt;</span>Key <span class="token keyword">extends</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>key<span class="token operator">:</span> Key<span class="token punctuation">,</span> handler<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span>Key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
</span><span class="code-line">  <span class="token generic-function"><span class="token function">emit</span><span class="token generic class-name"><span class="token operator">&lt;</span>Key <span class="token keyword">extends</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>key<span class="token operator">:</span> Key<span class="token punctuation">,</span> <span class="token operator">...</span>payload<span class="token operator">:</span> Parameters<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span>Key<span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
</span><span class="code-line">  <span class="token generic-function"><span class="token function">once</span><span class="token generic class-name"><span class="token operator">&lt;</span>Key <span class="token keyword">extends</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>key<span class="token operator">:</span> Key<span class="token punctuation">,</span> handler<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span>Key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<pre class="language-diff"><code class="language-diff code-highlight"><span class="code-line deleted"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> type Bus = Record&lt;string, EventHandler[]&gt;
</span></span></span><span class="code-line inserted"><span class="token deleted-sign deleted"><span class="token line"></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> type Bus&lt;E&gt; = Record&lt;keyof E, E[keyof E][]&gt;
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span>
</span><span class="code-line">
</span><span class="code-line deleted"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> export function eventbus(config?: {
</span></span></span><span class="code-line inserted"><span class="token deleted-sign deleted"><span class="token line"></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> export function eventbus&lt;E extends EventMap&gt;(config?: {
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> onError: (...params: any[]) =&gt; void
</span></span></span><span class="code-line deleted"><span class="token unchanged"><span class="token line"></span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> }): EventBus {
</span></span></span><span class="code-line inserted"><span class="token deleted-sign deleted"><span class="token line"></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> }): EventBus&lt;E&gt; {
</span></span></span><span class="code-line deleted"><span class="token inserted-sign inserted"><span class="token line"></span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> const bus: Bus = {}
</span></span></span><span class="code-line inserted"><span class="token deleted-sign deleted"><span class="token line"></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> const bus: Partial&lt;Bus&lt;E&gt;&gt; = {}
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span>
</span><span class="code-line deleted"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> const on: EventBus[&#x27;on&#x27;] = (key, handler) =&gt; {
</span></span></span><span class="code-line inserted"><span class="token deleted-sign deleted"><span class="token line"></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> const on: EventBus&lt;E&gt;[&#x27;on&#x27;] = (key, handler) =&gt; {
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span>
</span><span class="code-line deleted"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> const off: EventBus[&#x27;off&#x27;] = (key, handler) =&gt; {
</span></span></span><span class="code-line inserted"><span class="token deleted-sign deleted"><span class="token line"></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> const off: EventBus&lt;E&gt;[&#x27;off&#x27;] = (key, handler) =&gt; {
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span>
</span><span class="code-line deleted"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> const emit: EventBus[&#x27;emit&#x27;] = (key, payload) =&gt; {
</span></span></span><span class="code-line inserted"><span class="token deleted-sign deleted"><span class="token line"></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> const emit: EventBus&lt;E&gt;[&#x27;emit&#x27;] = (key, payload) =&gt; {
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span>
</span><span class="code-line deleted"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line"> const once: EventBus[&#x27;once&#x27;] = (key, handler) =&gt; {
</span></span></span><span class="code-line inserted"><span class="token deleted-sign deleted"><span class="token line"></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> const once: EventBus&lt;E&gt;[&#x27;once&#x27;] = (key, handler) =&gt; {
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span>
</span><span class="code-line"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> return { on, off, once, emit }
</span></span></span><span class="code-line"><span class="token unchanged"><span class="token line"></span></span>}
</span></code></pre>
<p>Now we are instructing TypeScript that the <strong>key</strong> has to be one of the <strong>keyof T</strong> and the handler should have the corresponding handler type. For example:</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">interface</span> <span class="token class-name">MyBus</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token string-property property">&#x27;on-event-1&#x27;</span><span class="token operator">:</span> <span class="token punctuation">(</span>payload<span class="token operator">:</span> <span class="token punctuation">{</span> data<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> myBus <span class="token operator">=</span> <span class="token generic-function"><span class="token function">eventbus</span><span class="token generic class-name"><span class="token operator">&lt;</span>MyBus<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></code></pre>
<p>You should be able to see a clear type definition when developing.</p>
<img src="/optimized/articles/react-event-bus/type-checking.webp" alt="Typing screenshot" width="100%" class="rounded centered" loading="lazy"/>
<h2 id="use-the-event-bus-in-react"><a class="styles_anchor__g18qA anchor" href="/articles/event-bus-for-react#use-the-event-bus-in-react"><span class="icon icon-link"></span></a>Use The Event Bus in React</h2>
<p>I created a <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://remix.run">Remix</a> application to demonstrate how to use the Event Bus we just built.</p>
<img src="/articles/react-event-bus/demo.gif" alt="Typing screenshot" width="100%" class="rounded centered" loading="lazy"/>
<blockquote>
<p>You can find the <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou/eventbus-demo">GitHub repository for the demo here</a>.</p>
</blockquote>
<p>The demo showcases how to organize logging with the Event Bus in an isomorphic React application. I picked three events to log:</p>
<ul>
<li><strong>onMapIdle</strong>: the event happens when the map finishes instantiating or a user finishes dragging or zooming the map.</li>
<li><strong>onMapClick</strong>: the event happens when a user clicks on the map.</li>
<li><strong>onMarkerClick</strong>: the event happens when a user clicks on a map marker.</li>
</ul>
<p>Let&#x27;s create two <strong>event channels</strong>. One for the map, and one for the marker.</p>
<div class="rehype-code-title">app/eventChannels/map.ts</div><pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> eventbus <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;eventbus&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">const</span> mapEventChannel <span class="token operator">=</span> eventbus<span class="token operator">&lt;</span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token function-variable function">onMapIdle</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
</span><span class="code-line">  <span class="token function-variable function">onMapClick</span><span class="token operator">:</span> <span class="token punctuation">(</span>payload<span class="token operator">:</span> google<span class="token punctuation">.</span>maps<span class="token punctuation">.</span>MapMouseEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></code></pre>
<div class="rehype-code-title">app/eventChannels/marker.ts</div><pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> eventbus <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;eventbus&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> MarkerData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;~/data/markers&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">const</span> markerEventChannel <span class="token operator">=</span> eventbus<span class="token operator">&lt;</span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token function-variable function">onMarkerClick</span><span class="token operator">:</span> <span class="token punctuation">(</span>payload<span class="token operator">:</span> MarkerData<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></code></pre>
<p>The reason to separate event channels is to create a clear separation of concerns. This pattern can grow horizontally when your application grows.</p>
<p>Now, let&#x27;s use the event channels in React components.</p>
<div class="rehype-code-title">app/routes/index.tsx</div><pre class="language-tsx"><code class="language-tsx code-highlight"><span class="code-line"><span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> markers <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">&#x27;~/data/marker&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> logUserInteraction <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">&#x27;~/utils/logger&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> mapEventChannel <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">&#x27;~/eventChannels/map&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> markerEventChannel <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">&#x27;~/eventChannels/marker&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token constant">GOOGLE_MAPS_API_KEY</span><span class="token operator">:</span> process<span class="token punctuation">.</span><span class="token property-access">env</span><span class="token punctuation">.</span><span class="token constant">GOOGLE_MAPS_API_KEY</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token function">useLoaderData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword">const</span> portal <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useRef</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLDivElement<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>selectedMarker<span class="token punctuation">,</span> setSelectedMarker<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>MarkerData<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// subscribe to events when mounting</span>
</span><span class="code-line">    <span class="token keyword">const</span> unsubscribeOnMapIdle <span class="token operator">=</span> mapEventChannel<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">&#x27;onMapIdle&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token function">logUserInteraction</span><span class="token punctuation">(</span><span class="token string">&#x27;on map idle.&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">const</span> unsubscribeOnMapClick <span class="token operator">=</span> mapEventChannel<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span>
</span><span class="code-line">      <span class="token string">&#x27;onMapClick&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token function">logUserInteraction</span><span class="token punctuation">(</span><span class="token string">&#x27;on map click.&#x27;</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">const</span> unsubscribeOnMarkerClick <span class="token operator">=</span> markerEventChannel<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span>
</span><span class="code-line">      <span class="token string">&#x27;onMarkerClick&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token function">logUserInteraction</span><span class="token punctuation">(</span><span class="token string">&#x27;on marker click.&#x27;</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// unsubscribe events when unmounting</span>
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token function">unsubscribeOnMapIdle</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token function">unsubscribeOnMapClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token function">unsubscribeOnMarkerClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">onMapIdle</span> <span class="token operator">=</span> <span class="token punctuation">(</span>map<span class="token operator">:</span> google<span class="token punctuation">.</span><span class="token property-access">maps</span><span class="token punctuation">.</span><span class="token known-class-name class-name">Map</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    mapEventChannel<span class="token punctuation">.</span><span class="token method function property-access">emit</span><span class="token punctuation">(</span><span class="token string">&#x27;onMapIdle&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token function">setZoom</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token method function property-access">getZoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">const</span> nextCenter <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token method function property-access">getCenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextCenter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token function">setCenter</span><span class="token punctuation">(</span>nextCenter<span class="token punctuation">.</span><span class="token method function property-access">toJSON</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">onMapClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> google<span class="token punctuation">.</span><span class="token property-access">maps</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">MapMouseEvent</span></span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    mapEventChannel<span class="token punctuation">.</span><span class="token method function property-access">emit</span><span class="token punctuation">(</span><span class="token string">&#x27;onMapClick&#x27;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">onMarkerClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span>marker<span class="token operator">:</span> <span class="token maybe-class-name">MarkerData</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    markerEventChannel<span class="token punctuation">.</span><span class="token method function property-access">emit</span><span class="token punctuation">(</span><span class="token string">&#x27;onMarkerClick&#x27;</span><span class="token punctuation">,</span> marker<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token function">setSelectedMarker</span><span class="token punctuation">(</span>marker<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">GoogleMap</span></span>
</span></span><span class="code-line"><span class="token tag">        <span class="token attr-name">apiKey</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>data<span class="token punctuation">.</span><span class="token constant">GOOGLE_MAPS_API_KEY</span><span class="token punctuation">}</span></span>
</span></span><span class="code-line"><span class="token tag">        <span class="token attr-name">markers</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>markers<span class="token punctuation">}</span></span>
</span></span><span class="code-line"><span class="token tag">        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onMapClick<span class="token punctuation">}</span></span>
</span></span><span class="code-line"><span class="token tag">        <span class="token attr-name">onIdle</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onMapIdle<span class="token punctuation">}</span></span>
</span></span><span class="code-line"><span class="token tag">        <span class="token attr-name">onMarkerClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onMarkerClick<span class="token punctuation">}</span></span>
</span></span><span class="code-line"><span class="token tag">      <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Portal</span></span> <span class="token attr-name">container</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>portal<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">        </span><span class="token punctuation">{</span>selectedMarker <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Card</span></span> <span class="token spread"><span class="token punctuation">{</span><span class="token spread operator">...</span>selectedMarker<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Portal</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>portal<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>What we did was to subscribe to the events in the <strong>Index</strong> component and emit the events when the map and markers are interacted. Moreover, By subscribing and unsubscribing with the component&#x27;s lifecycle, we are able to register only the necessary event handlers at the given moment of the user journey.</p>
<h2 id="final-thoughts"><a class="styles_anchor__g18qA anchor" href="/articles/event-bus-for-react#final-thoughts"><span class="icon icon-link"></span></a>Final Thoughts</h2>
<p>If you are looking for an Event Bus library, there are a <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://v3-migration.vuejs.org/breaking-changes/events-api.html#event-bus">couple of choices recommended by Vue.js</a>:</p>
<ul>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/developit/mitt">Mitt</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/scottcorgan/tiny-emitter">tiny-emitter</a></li>
</ul>
<p>There&#x27;s also an interesting <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.reddit.com/r/javascript/comments/qrpvsq/askjs_thoughts_on_using_redux_actions_as_an_event/">discussion on Reddit about using Redux as an Event Bus</a>. One of the Redux maintainers suggested a few Redux based tools to handle events:</p>
<ul>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/reduxjs/redux-toolkit/releases/tag/v1.8.0">redux-toolkit&#x27;s new Listener Middleware</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/redux-observable/redux-observable/">redux-observable</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/redux-saga/redux-saga">Redux-Saga</a></li>
</ul>
<h2 id="references"><a class="styles_anchor__g18qA anchor" href="/articles/event-bus-for-react#references"><span class="icon icon-link"></span></a>References</h2>
<ul>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/developit/mitt">GitHub: Mitt</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/scottcorgan/tiny-emitter">GitHub: tiny-emitter</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/redux-observable/redux-observable/">GitHub: redux-observable</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/redux-saga/redux-saga">GitHub: Redux-Saga</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou/eventbus-demo">GitHub: eventbus-demo</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://v3-migration.vuejs.org/breaking-changes/events-api.html">Documentation: Vue 3 Migration Guide - Events API</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/reduxjs/redux-toolkit/releases/tag/v1.8.0">Documentation: redux-toolkit&#x27;s new Listener Middleware</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://remix.run">Documentation: Remix</a></li>
</ul>
<hr/>
<p><span role="img" aria-label="speech balloon">💬</span> Comments on <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.reddit.com/r/javascript/comments/wed4qc/event_bus_for_react/">Reddit</a>.</p>
<hr/>
<p>Here you have it! Thanks for reading through<span role="img" aria-label="raising hands">🙌</span>
If you find this article useful, please share it to help more people in their engineering journey.</p>
<p><span role="img" aria-label="bird">🐦</span> Feel free to connect with me on <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://twitter.com/dawchihliou">twitter</a>!</p>
<p>⏭ Ready for the next article? <span role="img" aria-label="backhand index pointing right">👉</span> <a class="styles_anchor__g18qA undefined" href="/articles/stress-testing-concurrent-features-in-react-18"><strong>Stress Testing Concurrent Features in React 18: A Case Study of startTransition &amp; 3D Rendering</strong></a></p>
<p>Happy coding!</p></div><article class="Author_wrap__s8DeE"><img src="/optimized/raw/portrait-sm.webp" alt="Daw-Chih Liou" class="Author_avatar__j6KIn" loading="lazy"/><div><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://dawchihliou.github.io">Daw-Chih Liou</a><p>Daw-Chih is a software engineer, UX advocate, and creator who is dedicated to Web engineering. His background in Human Centered Computing has led him to work with startups and public companies across North America, Asia, and Europe. He is passionate about meeting business trajectory with user journey and utilizing engineering architecture and performance monitoring to provide optimal user experience.</p></div></article></div></div></article><footer class="Footer_footer__1IwEk"><div class="Footer_wrap__FVCTX"><div class="Footer_resources__fG_vu"><p><span role="img" aria-label="build with love" class="Footer_emoji__u15jg">💚</span>This site is built with</p><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://nextjs.org">Next.js</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://react-icons.github.io/react-icons">React Icons</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://mdxjs.com">MDX</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://unifiedjs.com">unified</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/contentlayerdev/contentlayer">Contentlayer</a></div><div class="Footer_contact__9GJn6"><p><span role="img" aria-label="build with love" class="Footer_emoji__u15jg">🦄</span>Where to find me</p><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/dawchihliou">Linkedin</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou">GitHub</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://twitter.com/dawchihliou">Twitter</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://medium.com/@dawchihliou">Medium</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://hackernoon.com/u/dawchihliou">Hacker Noon</a><a class="styles_anchor__g18qA undefined" href="/rss.xml">RSS Feed <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></div><div class="Footer_sitemap__92ono"><p><span role="img" aria-label="build with love" class="Footer_emoji__u15jg">🗺</span>Sitemap</p><a class="styles_anchor__g18qA undefined" href="/">Home</a><a class="styles_anchor__g18qA undefined" href="/articles">Articles</a><a class="styles_anchor__g18qA undefined" href="/work">Work</a><a class="styles_anchor__g18qA undefined" href="/now">Now</a><a class="styles_anchor__g18qA undefined" href="/expertise">Expertise</a><a class="styles_anchor__g18qA undefined" href="/contact">Contact</a></div></div><div class="Footer_copyright__vZZRL">© <!-- -->2023<!-- --> <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/dawchihliou">Daw-Chih Liou</a></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Event Bus for React","publishedAt":"Aug 2, 2022","description":"Event Bus is an interesting design pattern to build a lightweight event system. We will discover its use cases in React and build a type-safe Event Bus from scratch with TypeScript.","cover":"/optimized/articles/react-event-bus/hero.webp","category":"React","coverWidth":"1400","coverHeight":"600","body":{"raw":"\n## TL;DR\n\n- 🚌 We'll write a lightweight Event Bus from scratch in just 60 lines!\n- 🌱 We'll learn the use case to best utilize Event Bus in React.\n- 🏋️‍♀️ We'll apply Event Bus in a demo with Google Maps API.\n\n---\n\nThis article is also available on\n\n- [Better Programming](https://betterprogramming.pub/how-to-use-event-bus-in-react-architecture-f90485477647)\n- [Hacker Noon](https://hackernoon.com/writing-an-event-bus-for-react)\n\nFeel free to read it on your favorite platform✨\n\n---\n\nI recently came across an interesting use case of Event Bus at work. It's a very lean module to organize logging for analytics in a global-scale web application. It creates great clarity in a large code base so I want to share with you my case study of this useful design pattern.\n\nLet's go.\n\n## What Is An Event Bus?\n\nAn Event Bus is a design pattern that allows PubSub-style communication between components while the components remain loosely coupled.\n\nA component can send a message to an Event Bus without knowing where the message is sent to. On the other hand, a component can listen to a message on an Event Bus and decide what to do with the message without knowing where the message comes from. With this design, independent components can communicate without knowing each other.\n\nThe visualization looks like this:\n\n\u003cimg\n  src=\"/optimized/articles/react-event-bus/bus.webp\"\n  alt=\"Event Bus illustration\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/\u003e\n\n- Event: The message being sent and received on an Event Bus.\n- Publisher: The sender that **emits** an event.\n- Subscriber: The receiver that **listens** to an event.\n\nLet's take a closer look at Event Bus.\n\n## Building An Event Bus from Scratch\n\nInspired by [Vue's legacy Events API](https://v3-migration.vuejs.org/breaking-changes/events-api.html), we'll implement the following APIs for our Event Bus:\n\n```ts\ntype EventHandler = (payload: any) =\u003e void\n\ninterface EventBus {\n  on(key: string, handler: EventHandler): () =\u003e void\n  off(key: string, handler: EventHandler): void\n  emit(key: string, ...payload: Parameters\u003cEventHandler\u003e): void\n  once(key: string, handler: EventHandler): void\n}\n```\n\n- **on**: for a subscriber to listen (subscribe) to an event and register its event handler.\n- **off**: for a subscriber to remove (unsubscribe) an event and its event handler.\n- **once**: for a subscriber to listen to an event only once.\n- **emit**: for a publisher to send an event to the event bus.\n\nNow, the data structure for our Event Bus should be capable of two things:\n\n- For publishers: to be able to fire the registered event handlers associated with the event key when **emit** is called.\n- For subscribers: to be able to add or remove event handlers when **on**, **once**, or **off** is called\n\nWe can use a key-value structure for it:\n\n```ts\ntype Bus = Record\u003cstring, EventHandler[]\u003e\n```\n\nTo implement the **on** method, all we need to do is to add the event key to the bus and append the event handler to the handler array. We also want to return an unsubscribe function to remove the event handler.\n\n```ts\nexport function eventbus(config?: {\n  // error handler for later\n  onError: (...params: any[]) =\u003e void\n}): EventBus {\n  const bus: Bus = {}\n\n  const on: EventBus['on'] = (key, handler) =\u003e {\n    if (bus[key] === undefined) {\n      bus[key] = []\n    }\n    bus[key]?.push(handler)\n\n    // unsubscribe function\n    return () =\u003e {\n      off(key, handler)\n    }\n  }\n\n  return { on }\n}\n```\n\nTo implement **off**, we can simply remove the event handler from the bus.\n\n```ts\nconst off: EventBus['off'] = (key, handler) =\u003e {\n  const index = bus[key]?.indexOf(handler) ?? -1\n  bus[key]?.splice(index \u003e\u003e\u003e 0, 1)\n}\n```\n\nWhen **emit** is called, what we want to do is to fire all the event handlers that associate with the event. We'll add error handling here to make sure all the event handlers will be fired despite errors.\n\n```ts\nconst emit: EventBus['emit'] = (key, payload) =\u003e {\n  bus[key]?.forEach((fn) =\u003e {\n    try {\n      fn(payload)\n    } catch (e) {\n      config?.onError(e)\n    }\n  })\n}\n```\n\nSince **once** will only listen to an event exactly once, we can think of it as a method that registers a handler that deregisters itself after firing. One way to do it is to create a higher order function **handleOnce**:\n\n```ts\nconst once: EventBus['once'] = (key, handler) =\u003e {\n  const handleOnce = (payload: Parameters\u003ctypeof handler\u003e) =\u003e {\n    handler(payload)\n    off(key, handleOnce as typeof handler)\n  }\n\n  on(key, handleOnce as typeof handler)\n}\n```\n\nNow we have all the methods in our Event Bus!\n\n### Improve TypeScript Typing\n\nThe current typing for the Event Bus is quite open ended. The event key could be any string and the event handler could be any function. To make it safer to use, we can add type checking to add the event key and handler association to the **EventBus**.\n\n```ts\ntype EventKey = string | symbol\ntype EventHandler\u003cT = any\u003e = (payload: T) =\u003e void\ntype EventMap = Record\u003cEventKey, EventHandler\u003e\n\ninterface EventBus\u003cT extends EventMap\u003e {\n  on\u003cKey extends keyof T\u003e(key: Key, handler: T[Key]): () =\u003e void\n  off\u003cKey extends keyof T\u003e(key: Key, handler: T[Key]): void\n  emit\u003cKey extends keyof T\u003e(key: Key, ...payload: Parameters\u003cT[Key]\u003e): void\n  once\u003cKey extends keyof T\u003e(key: Key, handler: T[Key]): void\n}\n```\n\n```diff\n- type Bus = Record\u003cstring, EventHandler[]\u003e\n+ type Bus\u003cE\u003e = Record\u003ckeyof E, E[keyof E][]\u003e\n\n\n- export function eventbus(config?: {\n+ export function eventbus\u003cE extends EventMap\u003e(config?: {\n  onError: (...params: any[]) =\u003e void\n- }): EventBus {\n+ }): EventBus\u003cE\u003e {\n- const bus: Bus = {}\n+ const bus: Partial\u003cBus\u003cE\u003e\u003e = {}\n\n- const on: EventBus['on'] = (key, handler) =\u003e {\n+ const on: EventBus\u003cE\u003e['on'] = (key, handler) =\u003e {\n\n- const off: EventBus['off'] = (key, handler) =\u003e {\n+ const off: EventBus\u003cE\u003e['off'] = (key, handler) =\u003e {\n\n- const emit: EventBus['emit'] = (key, payload) =\u003e {\n+ const emit: EventBus\u003cE\u003e['emit'] = (key, payload) =\u003e {\n\n- const once: EventBus['once'] = (key, handler) =\u003e {\n+ const once: EventBus\u003cE\u003e['once'] = (key, handler) =\u003e {\n\n  return { on, off, once, emit }\n}\n```\n\nNow we are instructing TypeScript that the **key** has to be one of the **keyof T** and the handler should have the corresponding handler type. For example:\n\n```ts\ninterface MyBus {\n  'on-event-1': (payload: { data: string }) =\u003e void\n}\n\nconst myBus = eventbus\u003cMyBus\u003e()\n```\n\nYou should be able to see a clear type definition when developing.\n\n\u003cimg\n  src=\"/optimized/articles/react-event-bus/type-checking.webp\"\n  alt=\"Typing screenshot\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/\u003e\n\n## Use The Event Bus in React\n\nI created a [Remix](https://remix.run) application to demonstrate how to use the Event Bus we just built.\n\n\u003cimg\n  src=\"/articles/react-event-bus/demo.gif\"\n  alt=\"Typing screenshot\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/\u003e\n\n\u003e You can find the [GitHub repository for the demo here](https://github.com/DawChihLiou/eventbus-demo).\n\nThe demo showcases how to organize logging with the Event Bus in an isomorphic React application. I picked three events to log:\n\n- **onMapIdle**: the event happens when the map finishes instantiating or a user finishes dragging or zooming the map.\n- **onMapClick**: the event happens when a user clicks on the map.\n- **onMarkerClick**: the event happens when a user clicks on a map marker.\n\nLet's create two **event channels**. One for the map, and one for the marker.\n\n```ts:app/eventChannels/map.ts\nimport { eventbus } from 'eventbus'\n\nexport const mapEventChannel = eventbus\u003c{\n  onMapIdle: () =\u003e void\n  onMapClick: (payload: google.maps.MapMouseEvent) =\u003e void\n}\u003e()\n```\n\n```ts:app/eventChannels/marker.ts\nimport { eventbus } from 'eventbus'\nimport type { MarkerData } from '~/data/markers'\n\nexport const markerEventChannel = eventbus\u003c{\n  onMarkerClick: (payload: MarkerData) =\u003e void\n}\u003e()\n```\n\nThe reason to separate event channels is to create a clear separation of concerns. This pattern can grow horizontally when your application grows.\n\nNow, let's use the event channels in React components.\n\n```tsx:app/routes/index.tsx\nimport { markers } from '~/data/marker'\nimport { logUserInteraction } from '~/utils/logger'\nimport { mapEventChannel } from '~/eventChannels/map'\nimport { markerEventChannel } from '~/eventChannels/marker'\n\nexport async function loader() {\n  return json({\n    GOOGLE_MAPS_API_KEY: process.env.GOOGLE_MAPS_API_KEY,\n  })\n}\n\nexport default function Index() {\n  const data = useLoaderData()\n  const portal = useRef\u003cHTMLDivElement\u003e(null)\n  const [selectedMarker, setSelectedMarker] = useState\u003cMarkerData\u003e()\n\n  useEffect(() =\u003e {\n    // subscribe to events when mounting\n    const unsubscribeOnMapIdle = mapEventChannel.on('onMapIdle', () =\u003e {\n      logUserInteraction('on map idle.')\n    })\n    const unsubscribeOnMapClick = mapEventChannel.on(\n      'onMapClick',\n      (payload) =\u003e {\n        logUserInteraction('on map click.', payload)\n      }\n    )\n    const unsubscribeOnMarkerClick = markerEventChannel.on(\n      'onMarkerClick',\n      (payload) =\u003e {\n        logUserInteraction('on marker click.', payload)\n      }\n    )\n\n    // unsubscribe events when unmounting\n    return () =\u003e {\n      unsubscribeOnMapIdle()\n      unsubscribeOnMapClick()\n      unsubscribeOnMarkerClick()\n    }\n  }, [])\n\n  const onMapIdle = (map: google.maps.Map) =\u003e {\n    mapEventChannel.emit('onMapIdle')\n\n    setZoom(map.getZoom()!)\n    const nextCenter = map.getCenter()\n    if (nextCenter) {\n      setCenter(nextCenter.toJSON())\n    }\n  }\n\n  const onMapClick = (e: google.maps.MapMouseEvent) =\u003e {\n    mapEventChannel.emit('onMapClick', e)\n  }\n\n  const onMarkerClick = (marker: MarkerData) =\u003e {\n    markerEventChannel.emit('onMarkerClick', marker)\n    setSelectedMarker(marker)\n  }\n\n  return (\n    \u003c\u003e\n      \u003cGoogleMap\n        apiKey={data.GOOGLE_MAPS_API_KEY}\n        markers={markers}\n        onClick={onMapClick}\n        onIdle={onMapIdle}\n        onMarkerClick={onMarkerClick}\n      /\u003e\n\n      \u003cPortal container={portal.current}\u003e\n        {selectedMarker \u0026\u0026 \u003cCard {...selectedMarker} /\u003e}\n      \u003c/Portal\u003e\n\n      \u003cdiv ref={portal} /\u003e\n    \u003c/\u003e\n  )\n}\n```\n\nWhat we did was to subscribe to the events in the **Index** component and emit the events when the map and markers are interacted. Moreover, By subscribing and unsubscribing with the component's lifecycle, we are able to register only the necessary event handlers at the given moment of the user journey.\n\n## Final Thoughts\n\nIf you are looking for an Event Bus library, there are a [couple of choices recommended by Vue.js](https://v3-migration.vuejs.org/breaking-changes/events-api.html#event-bus):\n\n- [Mitt](https://github.com/developit/mitt)\n- [tiny-emitter](https://github.com/scottcorgan/tiny-emitter)\n\nThere's also an interesting [discussion on Reddit about using Redux as an Event Bus](https://www.reddit.com/r/javascript/comments/qrpvsq/askjs_thoughts_on_using_redux_actions_as_an_event/). One of the Redux maintainers suggested a few Redux based tools to handle events:\n\n- [redux-toolkit's new Listener Middleware](https://github.com/reduxjs/redux-toolkit/releases/tag/v1.8.0)\n- [redux-observable](https://github.com/redux-observable/redux-observable/)\n- [Redux-Saga](https://github.com/redux-saga/redux-saga)\n\n## References\n\n- [GitHub: Mitt](https://github.com/developit/mitt)\n- [GitHub: tiny-emitter](https://github.com/scottcorgan/tiny-emitter)\n- [GitHub: redux-observable](https://github.com/redux-observable/redux-observable/)\n- [GitHub: Redux-Saga](https://github.com/redux-saga/redux-saga)\n- [GitHub: eventbus-demo](https://github.com/DawChihLiou/eventbus-demo)\n- [Documentation: Vue 3 Migration Guide - Events API](https://v3-migration.vuejs.org/breaking-changes/events-api.html)\n- [Documentation: redux-toolkit's new Listener Middleware](https://github.com/reduxjs/redux-toolkit/releases/tag/v1.8.0)\n- [Documentation: Remix](https://remix.run)\n\n---\n\n💬 Comments on [Reddit](https://www.reddit.com/r/javascript/comments/wed4qc/event_bus_for_react/).\n\n---\n\nHere you have it! Thanks for reading through🙌\nIf you find this article useful, please share it to help more people in their engineering journey.\n\n🐦 Feel free to connect with me on [twitter](https://twitter.com/dawchihliou)!\n\n⏭ Ready for the next article? 👉 [**Stress Testing Concurrent Features in React 18: A Case Study of startTransition \u0026 3D Rendering**](/articles/stress-testing-concurrent-features-in-react-18)\n\nHappy coding!\n","code":"var Component=(()=\u003e{var p=Object.create;var l=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var N=(a,n)=\u003e()=\u003e(n||a((n={exports:{}}).exports,n),n.exports),g=(a,n)=\u003e{for(var s in n)l(a,s,{get:n[s],enumerable:!0})},i=(a,n,s,t)=\u003e{if(n\u0026\u0026typeof n==\"object\"||typeof n==\"function\")for(let c of m(n))!k.call(a,c)\u0026\u0026c!==s\u0026\u0026l(a,c,{get:()=\u003en[c],enumerable:!(t=h(n,c))||t.enumerable});return a};var y=(a,n,s)=\u003e(s=a!=null?p(u(a)):{},i(n||!a||!a.__esModule?l(s,\"default\",{value:a,enumerable:!0}):s,a)),f=a=\u003ei(l({},\"__esModule\",{value:!0}),a);var r=N((M,o)=\u003e{o.exports=_jsx_runtime});var x={};g(x,{default:()=\u003eb,frontmatter:()=\u003ev});var e=y(r()),v={title:\"Event Bus for React\",publishedAt:\"Aug 2, 2022\",description:\"Event Bus is an interesting design pattern to build a lightweight event system. We will discover its use cases in React and build a type-safe Event Bus from scratch with TypeScript.\",cover:\"/optimized/articles/react-event-bus/hero.webp\",category:\"React\",coverWidth:\"1400\",coverHeight:\"600\"};function d(a){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",ul:\"ul\",li:\"li\",hr:\"hr\",p:\"p\",strong:\"strong\",pre:\"pre\",code:\"code\",h3:\"h3\",blockquote:\"blockquote\",div:\"div\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"tldr\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#tldr\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"TL;DR\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"bus\",children:\"\\u{1F68C}\"}),\" We'll write a lightweight Event Bus from scratch in just 60 lines!\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"seedling\",children:\"\\u{1F331}\"}),\" We'll learn the use case to best utilize Event Bus in React.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"woman lifting weights\",children:\"\\u{1F3CB}\\uFE0F\\u200D\\u2640\\uFE0F\"}),\" We'll apply Event Bus in a demo with Google Maps API.\"]}),`\n`]}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsx)(n.p,{children:\"This article is also available on\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://betterprogramming.pub/how-to-use-event-bus-in-react-architecture-f90485477647\",children:\"Better Programming\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://hackernoon.com/writing-an-event-bus-for-react\",children:\"Hacker Noon\"})}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Feel free to read it on your favorite platform\",(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"sparkles\",children:\"\\u2728\"})]}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsx)(n.p,{children:\"I recently came across an interesting use case of Event Bus at work. It's a very lean module to organize logging for analytics in a global-scale web application. It creates great clarity in a large code base so I want to share with you my case study of this useful design pattern.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Let's go.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"what-is-an-event-bus\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#what-is-an-event-bus\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"What Is An Event Bus?\"]}),`\n`,(0,e.jsx)(n.p,{children:\"An Event Bus is a design pattern that allows PubSub-style communication between components while the components remain loosely coupled.\"}),`\n`,(0,e.jsx)(n.p,{children:\"A component can send a message to an Event Bus without knowing where the message is sent to. On the other hand, a component can listen to a message on an Event Bus and decide what to do with the message without knowing where the message comes from. With this design, independent components can communicate without knowing each other.\"}),`\n`,(0,e.jsx)(n.p,{children:\"The visualization looks like this:\"}),`\n`,(0,e.jsx)(\"img\",{src:\"/optimized/articles/react-event-bus/bus.webp\",alt:\"Event Bus illustration\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Event: The message being sent and received on an Event Bus.\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"Publisher: The sender that \",(0,e.jsx)(n.strong,{children:\"emits\"}),\" an event.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[\"Subscriber: The receiver that \",(0,e.jsx)(n.strong,{children:\"listens\"}),\" to an event.\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"Let's take a closer look at Event Bus.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"building-an-event-bus-from-scratch\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#building-an-event-bus-from-scratch\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Building An Event Bus from Scratch\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Inspired by \",(0,e.jsx)(n.a,{href:\"https://v3-migration.vuejs.org/breaking-changes/events-api.html\",children:\"Vue's legacy Events API\"}),\", we'll implement the following APIs for our Event Bus:\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-ts\",children:(0,e.jsxs)(n.code,{className:\"language-ts code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"EventHandler\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"any\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"interface\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"EventBus\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token function\",children:\"on\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" handler\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" EventHandler\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token function\",children:\"off\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" handler\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" EventHandler\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token function\",children:\"emit\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"...\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" Parameters\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"EventHandler\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token function\",children:\"once\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" handler\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" EventHandler\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"on\"}),\": for a subscriber to listen (subscribe) to an event and register its event handler.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"off\"}),\": for a subscriber to remove (unsubscribe) an event and its event handler.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"once\"}),\": for a subscriber to listen to an event only once.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"emit\"}),\": for a publisher to send an event to the event bus.\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"Now, the data structure for our Event Bus should be capable of two things:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[\"For publishers: to be able to fire the registered event handlers associated with the event key when \",(0,e.jsx)(n.strong,{children:\"emit\"}),\" is called.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[\"For subscribers: to be able to add or remove event handlers when \",(0,e.jsx)(n.strong,{children:\"on\"}),\", \",(0,e.jsx)(n.strong,{children:\"once\"}),\", or \",(0,e.jsx)(n.strong,{children:\"off\"}),\" is called\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"We can use a key-value structure for it:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-ts\",children:(0,e.jsx)(n.code,{className:\"language-ts code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Bus\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" Record\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" EventHandler\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]})})}),`\n`,(0,e.jsxs)(n.p,{children:[\"To implement the \",(0,e.jsx)(n.strong,{children:\"on\"}),\" method, all we need to do is to add the event key to the bus and append the event handler to the handler array. We also want to return an unsubscribe function to remove the event handler.\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-ts\",children:(0,e.jsxs)(n.code,{className:\"language-ts code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"eventbus\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"config\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"?\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// error handler for later\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"onError\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"...\"}),\"params\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"any\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" EventBus \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" bus\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" Bus \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" on\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" EventBus\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'on'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" handler\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"bus\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"===\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"undefined\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      bus\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    bus\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"?.\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"push\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"handler\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// unsubscribe function\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token function\",children:\"off\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" handler\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" on \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"To implement \",(0,e.jsx)(n.strong,{children:\"off\"}),\", we can simply remove the event handler from the bus.\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-ts\",children:(0,e.jsxs)(n.code,{className:\"language-ts code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" off\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" EventBus\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'off'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" handler\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" index \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" bus\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"?.\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"indexOf\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"handler\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"??\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  bus\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"?.\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"splice\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"index \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\u003e\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"When \",(0,e.jsx)(n.strong,{children:\"emit\"}),\" is called, what we want to do is to fire all the event handlers that associate with the event. We'll add error handling here to make sure all the event handlers will be fired despite errors.\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-ts\",children:(0,e.jsxs)(n.code,{className:\"language-ts code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" emit\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" EventBus\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'emit'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  bus\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"?.\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"forEach\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"fn\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"try\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token function\",children:\"fn\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"catch\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      config\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"?.\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"onError\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Since \",(0,e.jsx)(n.strong,{children:\"once\"}),\" will only listen to an event exactly once, we can think of it as a method that registers a handler that deregisters itself after firing. One way to do it is to create a higher order function \",(0,e.jsx)(n.strong,{children:\"handleOnce\"}),\":\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-ts\",children:(0,e.jsxs)(n.code,{className:\"language-ts code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" once\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" EventBus\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'once'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" handler\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"handleOnce\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" Parameters\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"typeof\"}),\" handler\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"handler\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"off\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" handleOnce \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"typeof\"}),\" handler\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token function\",children:\"on\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" handleOnce \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"typeof\"}),\" handler\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Now we have all the methods in our Event Bus!\"}),`\n`,(0,e.jsxs)(n.h3,{id:\"improve-typescript-typing\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#improve-typescript-typing\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Improve TypeScript Typing\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"The current typing for the Event Bus is quite open ended. The event key could be any string and the event handler could be any function. To make it safer to use, we can add type checking to add the event key and handler association to the \",(0,e.jsx)(n.strong,{children:\"EventBus\"}),\".\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-ts\",children:(0,e.jsxs)(n.code,{className:\"language-ts code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"EventKey\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"|\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"symbol\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,e.jsxs)(n.span,{className:\"token class-name\",children:[\"EventHandler\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"T\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"any\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"T\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"EventMap\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" Record\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"EventKey\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" EventHandler\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"interface\"}),\" \",(0,e.jsxs)(n.span,{className:\"token class-name\",children:[\"EventBus\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"T\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"extends\"}),\" EventMap\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsxs)(n.span,{className:\"token generic-function\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"on\"}),(0,e.jsxs)(n.span,{className:\"token generic class-name\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"Key \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"extends\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"keyof\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"T\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"})]})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" Key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" handler\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"T\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"Key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsxs)(n.span,{className:\"token generic-function\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"off\"}),(0,e.jsxs)(n.span,{className:\"token generic class-name\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"Key \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"extends\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"keyof\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"T\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"})]})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" Key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" handler\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"T\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"Key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsxs)(n.span,{className:\"token generic-function\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"emit\"}),(0,e.jsxs)(n.span,{className:\"token generic class-name\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"Key \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"extends\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"keyof\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"T\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"})]})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" Key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"...\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" Parameters\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"T\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"Key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsxs)(n.span,{className:\"token generic-function\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"once\"}),(0,e.jsxs)(n.span,{className:\"token generic class-name\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"Key \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"extends\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"keyof\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"T\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"})]})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" Key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" handler\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"T\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"Key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.pre,{className:\"language-diff\",children:(0,e.jsxs)(n.code,{className:\"language-diff code-highlight\",children:[(0,e.jsx)(n.span,{className:\"code-line deleted\",children:(0,e.jsxs)(n.span,{className:\"token deleted-sign deleted\",children:[(0,e.jsx)(n.span,{className:\"token prefix deleted\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token line\",children:` type Bus = Record\u003cstring, EventHandler[]\u003e\n`})]})}),(0,e.jsxs)(n.span,{className:\"code-line inserted\",children:[(0,e.jsx)(n.span,{className:\"token deleted-sign deleted\",children:(0,e.jsx)(n.span,{className:\"token line\"})}),(0,e.jsxs)(n.span,{className:\"token inserted-sign inserted\",children:[(0,e.jsx)(n.span,{className:\"token prefix inserted\",children:\"+\"}),(0,e.jsx)(n.span,{className:\"token line\",children:` type Bus\u003cE\u003e = Record\u003ckeyof E, E[keyof E][]\u003e\n`})]})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token inserted-sign inserted\",children:(0,e.jsx)(n.span,{className:\"token line\"})}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line deleted\",children:(0,e.jsxs)(n.span,{className:\"token deleted-sign deleted\",children:[(0,e.jsx)(n.span,{className:\"token prefix deleted\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token line\",children:` export function eventbus(config?: {\n`})]})}),(0,e.jsxs)(n.span,{className:\"code-line inserted\",children:[(0,e.jsx)(n.span,{className:\"token deleted-sign deleted\",children:(0,e.jsx)(n.span,{className:\"token line\"})}),(0,e.jsxs)(n.span,{className:\"token inserted-sign inserted\",children:[(0,e.jsx)(n.span,{className:\"token prefix inserted\",children:\"+\"}),(0,e.jsx)(n.span,{className:\"token line\",children:` export function eventbus\u003cE extends EventMap\u003e(config?: {\n`})]})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token inserted-sign inserted\",children:(0,e.jsx)(n.span,{className:\"token line\"})}),(0,e.jsxs)(n.span,{className:\"token unchanged\",children:[(0,e.jsx)(n.span,{className:\"token prefix unchanged\",children:\" \"}),(0,e.jsx)(n.span,{className:\"token line\",children:` onError: (...params: any[]) =\u003e void\n`})]})]}),(0,e.jsxs)(n.span,{className:\"code-line deleted\",children:[(0,e.jsx)(n.span,{className:\"token unchanged\",children:(0,e.jsx)(n.span,{className:\"token line\"})}),(0,e.jsxs)(n.span,{className:\"token deleted-sign deleted\",children:[(0,e.jsx)(n.span,{className:\"token prefix deleted\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token line\",children:` }): EventBus {\n`})]})]}),(0,e.jsxs)(n.span,{className:\"code-line inserted\",children:[(0,e.jsx)(n.span,{className:\"token deleted-sign deleted\",children:(0,e.jsx)(n.span,{className:\"token line\"})}),(0,e.jsxs)(n.span,{className:\"token inserted-sign inserted\",children:[(0,e.jsx)(n.span,{className:\"token prefix inserted\",children:\"+\"}),(0,e.jsx)(n.span,{className:\"token line\",children:` }): EventBus\u003cE\u003e {\n`})]})]}),(0,e.jsxs)(n.span,{className:\"code-line deleted\",children:[(0,e.jsx)(n.span,{className:\"token inserted-sign inserted\",children:(0,e.jsx)(n.span,{className:\"token line\"})}),(0,e.jsxs)(n.span,{className:\"token deleted-sign deleted\",children:[(0,e.jsx)(n.span,{className:\"token prefix deleted\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token line\",children:` const bus: Bus = {}\n`})]})]}),(0,e.jsxs)(n.span,{className:\"code-line inserted\",children:[(0,e.jsx)(n.span,{className:\"token deleted-sign deleted\",children:(0,e.jsx)(n.span,{className:\"token line\"})}),(0,e.jsxs)(n.span,{className:\"token inserted-sign inserted\",children:[(0,e.jsx)(n.span,{className:\"token prefix inserted\",children:\"+\"}),(0,e.jsx)(n.span,{className:\"token line\",children:` const bus: Partial\u003cBus\u003cE\u003e\u003e = {}\n`})]})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token inserted-sign inserted\",children:(0,e.jsx)(n.span,{className:\"token line\"})}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line deleted\",children:(0,e.jsxs)(n.span,{className:\"token deleted-sign deleted\",children:[(0,e.jsx)(n.span,{className:\"token prefix deleted\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token line\",children:` const on: EventBus['on'] = (key, handler) =\u003e {\n`})]})}),(0,e.jsxs)(n.span,{className:\"code-line inserted\",children:[(0,e.jsx)(n.span,{className:\"token deleted-sign deleted\",children:(0,e.jsx)(n.span,{className:\"token line\"})}),(0,e.jsxs)(n.span,{className:\"token inserted-sign inserted\",children:[(0,e.jsx)(n.span,{className:\"token prefix inserted\",children:\"+\"}),(0,e.jsx)(n.span,{className:\"token line\",children:` const on: EventBus\u003cE\u003e['on'] = (key, handler) =\u003e {\n`})]})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token inserted-sign inserted\",children:(0,e.jsx)(n.span,{className:\"token line\"})}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line deleted\",children:(0,e.jsxs)(n.span,{className:\"token deleted-sign deleted\",children:[(0,e.jsx)(n.span,{className:\"token prefix deleted\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token line\",children:` const off: EventBus['off'] = (key, handler) =\u003e {\n`})]})}),(0,e.jsxs)(n.span,{className:\"code-line inserted\",children:[(0,e.jsx)(n.span,{className:\"token deleted-sign deleted\",children:(0,e.jsx)(n.span,{className:\"token line\"})}),(0,e.jsxs)(n.span,{className:\"token inserted-sign inserted\",children:[(0,e.jsx)(n.span,{className:\"token prefix inserted\",children:\"+\"}),(0,e.jsx)(n.span,{className:\"token line\",children:` const off: EventBus\u003cE\u003e['off'] = (key, handler) =\u003e {\n`})]})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token inserted-sign inserted\",children:(0,e.jsx)(n.span,{className:\"token line\"})}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line deleted\",children:(0,e.jsxs)(n.span,{className:\"token deleted-sign deleted\",children:[(0,e.jsx)(n.span,{className:\"token prefix deleted\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token line\",children:` const emit: EventBus['emit'] = (key, payload) =\u003e {\n`})]})}),(0,e.jsxs)(n.span,{className:\"code-line inserted\",children:[(0,e.jsx)(n.span,{className:\"token deleted-sign deleted\",children:(0,e.jsx)(n.span,{className:\"token line\"})}),(0,e.jsxs)(n.span,{className:\"token inserted-sign inserted\",children:[(0,e.jsx)(n.span,{className:\"token prefix inserted\",children:\"+\"}),(0,e.jsx)(n.span,{className:\"token line\",children:` const emit: EventBus\u003cE\u003e['emit'] = (key, payload) =\u003e {\n`})]})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token inserted-sign inserted\",children:(0,e.jsx)(n.span,{className:\"token line\"})}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line deleted\",children:(0,e.jsxs)(n.span,{className:\"token deleted-sign deleted\",children:[(0,e.jsx)(n.span,{className:\"token prefix deleted\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token line\",children:` const once: EventBus['once'] = (key, handler) =\u003e {\n`})]})}),(0,e.jsxs)(n.span,{className:\"code-line inserted\",children:[(0,e.jsx)(n.span,{className:\"token deleted-sign deleted\",children:(0,e.jsx)(n.span,{className:\"token line\"})}),(0,e.jsxs)(n.span,{className:\"token inserted-sign inserted\",children:[(0,e.jsx)(n.span,{className:\"token prefix inserted\",children:\"+\"}),(0,e.jsx)(n.span,{className:\"token line\",children:` const once: EventBus\u003cE\u003e['once'] = (key, handler) =\u003e {\n`})]})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token inserted-sign inserted\",children:(0,e.jsx)(n.span,{className:\"token line\"})}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsxs)(n.span,{className:\"token unchanged\",children:[(0,e.jsx)(n.span,{className:\"token prefix unchanged\",children:\" \"}),(0,e.jsx)(n.span,{className:\"token line\",children:` return { on, off, once, emit }\n`})]})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token unchanged\",children:(0,e.jsx)(n.span,{className:\"token line\"})}),`}\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Now we are instructing TypeScript that the \",(0,e.jsx)(n.strong,{children:\"key\"}),\" has to be one of the \",(0,e.jsx)(n.strong,{children:\"keyof T\"}),\" and the handler should have the corresponding handler type. For example:\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-ts\",children:(0,e.jsxs)(n.code,{className:\"language-ts code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"interface\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"MyBus\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string-property property\",children:\"'on-event-1'\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" data\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" myBus \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token generic-function\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"eventbus\"}),(0,e.jsxs)(n.span,{className:\"token generic class-name\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"MyBus\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"})]})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"You should be able to see a clear type definition when developing.\"}),`\n`,(0,e.jsx)(\"img\",{src:\"/optimized/articles/react-event-bus/type-checking.webp\",alt:\"Typing screenshot\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"use-the-event-bus-in-react\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#use-the-event-bus-in-react\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Use The Event Bus in React\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"I created a \",(0,e.jsx)(n.a,{href:\"https://remix.run\",children:\"Remix\"}),\" application to demonstrate how to use the Event Bus we just built.\"]}),`\n`,(0,e.jsx)(\"img\",{src:\"/articles/react-event-bus/demo.gif\",alt:\"Typing screenshot\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsxs)(n.p,{children:[\"You can find the \",(0,e.jsx)(n.a,{href:\"https://github.com/DawChihLiou/eventbus-demo\",children:\"GitHub repository for the demo here\"}),\".\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"The demo showcases how to organize logging with the Event Bus in an isomorphic React application. I picked three events to log:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"onMapIdle\"}),\": the event happens when the map finishes instantiating or a user finishes dragging or zooming the map.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"onMapClick\"}),\": the event happens when a user clicks on the map.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"onMarkerClick\"}),\": the event happens when a user clicks on a map marker.\"]}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Let's create two \",(0,e.jsx)(n.strong,{children:\"event channels\"}),\". One for the map, and one for the marker.\"]}),`\n`,(0,e.jsx)(n.div,{className:\"rehype-code-title\",children:\"app/eventChannels/map.ts\"}),(0,e.jsx)(n.pre,{className:\"language-ts\",children:(0,e.jsxs)(n.code,{className:\"language-ts code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" eventbus \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'eventbus'\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" mapEventChannel \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" eventbus\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"onMapIdle\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"onMapClick\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" google\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"maps\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"MapMouseEvent\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.div,{className:\"rehype-code-title\",children:\"app/eventChannels/marker.ts\"}),(0,e.jsx)(n.pre,{className:\"language-ts\",children:(0,e.jsxs)(n.code,{className:\"language-ts code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" eventbus \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'eventbus'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" MarkerData \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'~/data/markers'\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" markerEventChannel \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" eventbus\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"onMarkerClick\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" MarkerData\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"The reason to separate event channels is to create a clear separation of concerns. This pattern can grow horizontally when your application grows.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Now, let's use the event channels in React components.\"}),`\n`,(0,e.jsx)(n.div,{className:\"rehype-code-title\",children:\"app/routes/index.tsx\"}),(0,e.jsx)(n.pre,{className:\"language-tsx\",children:(0,e.jsxs)(n.code,{className:\"language-tsx code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,e.jsxs)(n.span,{className:\"token imports\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" markers \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'~/data/marker'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,e.jsxs)(n.span,{className:\"token imports\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" logUserInteraction \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'~/utils/logger'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,e.jsxs)(n.span,{className:\"token imports\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" mapEventChannel \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'~/eventChannels/map'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,e.jsxs)(n.span,{className:\"token imports\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" markerEventChannel \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'~/eventChannels/marker'\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"loader\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"json\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"GOOGLE_MAPS_API_KEY\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"GOOGLE_MAPS_API_KEY\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"default\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"Index\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" data \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"useLoaderData\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" portal \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token generic-function\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"useRef\"}),(0,e.jsxs)(n.span,{className:\"token generic class-name\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"HTMLDivElement\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"})]})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"null\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"selectedMarker\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" setSelectedMarker\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token generic-function\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"useState\"}),(0,e.jsxs)(n.span,{className:\"token generic class-name\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"MarkerData\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"})]})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token function\",children:\"useEffect\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// subscribe to events when mounting\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" unsubscribeOnMapIdle \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" mapEventChannel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"on\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'onMapIdle'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token function\",children:\"logUserInteraction\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'on map idle.'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" unsubscribeOnMapClick \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" mapEventChannel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"on\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'onMapClick'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token function\",children:\"logUserInteraction\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'on map click.'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" unsubscribeOnMarkerClick \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" markerEventChannel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"on\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'onMarkerClick'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token function\",children:\"logUserInteraction\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'on marker click.'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// unsubscribe events when unmounting\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token function\",children:\"unsubscribeOnMapIdle\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token function\",children:\"unsubscribeOnMapClick\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token function\",children:\"unsubscribeOnMarkerClick\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"onMapIdle\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"map\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" google\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"maps\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token known-class-name class-name\",children:\"Map\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    mapEventChannel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"emit\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'onMapIdle'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setZoom\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"map\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"getZoom\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" nextCenter \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" map\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"getCenter\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"nextCenter\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setCenter\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"nextCenter\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"toJSON\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"onMapClick\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"e\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" google\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"maps\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"MapMouseEvent\"})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    mapEventChannel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"emit\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'onMapClick'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"onMarkerClick\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"marker\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"MarkerData\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    markerEventChannel\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token method function property-access\",children:\"emit\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'onMarkerClick'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" marker\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setSelectedMarker\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"marker\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token tag\",children:(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"      \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"GoogleMap\"})]}),`\n`]})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsxs)(n.span,{className:\"token tag\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"apiKey\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"GOOGLE_MAPS_API_KEY\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),`\n`]})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsxs)(n.span,{className:\"token tag\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"markers\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"markers\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),`\n`]})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsxs)(n.span,{className:\"token tag\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"onClick\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"onMapClick\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),`\n`]})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsxs)(n.span,{className:\"token tag\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"onIdle\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"onMapIdle\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),`\n`]})}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsxs)(n.span,{className:\"token tag\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"onMarkerClick\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"onMarkerClick\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),`\n`]})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/\u003e\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"      \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Portal\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"container\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"portal\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"current\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"        \"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"selectedMarker \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Card\"})]}),\" \",(0,e.jsxs)(n.span,{className:\"token spread\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token spread operator\",children:\"...\"}),\"selectedMarker\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/\u003e\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"      \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c/\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Portal\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsx)(n.span,{className:\"code-line\",children:(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"      \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),\"div\"]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"ref\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"portal\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/\u003e\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"    \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token tag\",children:(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c/\"})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"What we did was to subscribe to the events in the \",(0,e.jsx)(n.strong,{children:\"Index\"}),\" component and emit the events when the map and markers are interacted. Moreover, By subscribing and unsubscribing with the component's lifecycle, we are able to register only the necessary event handlers at the given moment of the user journey.\"]}),`\n`,(0,e.jsxs)(n.h2,{id:\"final-thoughts\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#final-thoughts\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Final Thoughts\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"If you are looking for an Event Bus library, there are a \",(0,e.jsx)(n.a,{href:\"https://v3-migration.vuejs.org/breaking-changes/events-api.html#event-bus\",children:\"couple of choices recommended by Vue.js\"}),\":\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/developit/mitt\",children:\"Mitt\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/scottcorgan/tiny-emitter\",children:\"tiny-emitter\"})}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"There's also an interesting \",(0,e.jsx)(n.a,{href:\"https://www.reddit.com/r/javascript/comments/qrpvsq/askjs_thoughts_on_using_redux_actions_as_an_event/\",children:\"discussion on Reddit about using Redux as an Event Bus\"}),\". One of the Redux maintainers suggested a few Redux based tools to handle events:\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/reduxjs/redux-toolkit/releases/tag/v1.8.0\",children:\"redux-toolkit's new Listener Middleware\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/redux-observable/redux-observable/\",children:\"redux-observable\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/redux-saga/redux-saga\",children:\"Redux-Saga\"})}),`\n`]}),`\n`,(0,e.jsxs)(n.h2,{id:\"references\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#references\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"References\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/developit/mitt\",children:\"GitHub: Mitt\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/scottcorgan/tiny-emitter\",children:\"GitHub: tiny-emitter\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/redux-observable/redux-observable/\",children:\"GitHub: redux-observable\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/redux-saga/redux-saga\",children:\"GitHub: Redux-Saga\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/DawChihLiou/eventbus-demo\",children:\"GitHub: eventbus-demo\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://v3-migration.vuejs.org/breaking-changes/events-api.html\",children:\"Documentation: Vue 3 Migration Guide - Events API\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/reduxjs/redux-toolkit/releases/tag/v1.8.0\",children:\"Documentation: redux-toolkit's new Listener Middleware\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://remix.run\",children:\"Documentation: Remix\"})}),`\n`]}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"speech balloon\",children:\"\\u{1F4AC}\"}),\" Comments on \",(0,e.jsx)(n.a,{href:\"https://www.reddit.com/r/javascript/comments/wed4qc/event_bus_for_react/\",children:\"Reddit\"}),\".\"]}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsxs)(n.p,{children:[\"Here you have it! Thanks for reading through\",(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"raising hands\",children:\"\\u{1F64C}\"}),`\nIf you find this article useful, please share it to help more people in their engineering journey.`]}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"bird\",children:\"\\u{1F426}\"}),\" Feel free to connect with me on \",(0,e.jsx)(n.a,{href:\"https://twitter.com/dawchihliou\",children:\"twitter\"}),\"!\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u23ED Ready for the next article? \",(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"backhand index pointing right\",children:\"\\u{1F449}\"}),\" \",(0,e.jsx)(n.a,{href:\"/articles/stress-testing-concurrent-features-in-react-18\",children:(0,e.jsx)(n.strong,{children:\"Stress Testing Concurrent Features in React 18: A Case Study of startTransition \u0026 3D Rendering\"})})]}),`\n`,(0,e.jsx)(n.p,{children:\"Happy coding!\"})]})}function w(a={}){let{wrapper:n}=a.components||{};return n?(0,e.jsx)(n,Object.assign({},a,{children:(0,e.jsx)(d,a)})):d(a)}var b=w;return f(x);})();\n;return Component;"},"_id":"articles/event-bus-for-react.mdx","_raw":{"sourceFilePath":"articles/event-bus-for-react.mdx","sourceFileName":"event-bus-for-react.mdx","sourceFileDir":"articles","contentType":"mdx","flattenedPath":"articles/event-bus-for-react"},"type":"Article","readingTime":{"text":"9 min read","minutes":8.12,"time":487200,"words":1624},"wordCount":1626,"slug":"event-bus-for-react"}},"__N_SSG":true},"page":"/articles/[slug]","query":{"slug":"event-bus-for-react"},"buildId":"GtQPiDm2ep1nxGp2q3_Hd","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>