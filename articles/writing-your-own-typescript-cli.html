<!DOCTYPE html><html lang="en"><head><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/svg" sizes="32x32" href="/favicon.svg"/><link rel="icon" type="image/svg" sizes="16x16" href="/favicon.svg"/><link rel="mask-icon" href="/favicon.svg" color="#ffffff"/><link rel="manifest" href="/site.webmanifest"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><meta name="msapplication-TileColor" content="#007cf0"/><meta name="theme-color" content="#ffff"/><title>Writing Your Own TypeScript CLI</title><meta name="description" content="Writing CLIs feels like a super powerğŸ’¯ You can write one too! I&#x27;ll show you how to develop a CLI with TypeScript step by step and demonstrate how you can apply your CLI in CD/CI pipelines. We&#x27;re going to uncover the power of Google Lighthouse and many more amazing npm packages!"/><meta name="robots" content="follow, index"/><link rel="canonical" href="https://dawchihliou.github.io/articles/writing-your-own-typescript-cli"/><meta itemProp="name" content="Writing Your Own TypeScript CLI"/><meta itemProp="description" content="Writing CLIs feels like a super powerğŸ’¯ You can write one too! I&#x27;ll show you how to develop a CLI with TypeScript step by step and demonstrate how you can apply your CLI in CD/CI pipelines. We&#x27;re going to uncover the power of Google Lighthouse and many more amazing npm packages!"/><meta itemProp="image" content="https://dawchihliou.github.io/optimized/articles/writing-your-own-typescript-cli/hero.png"/><meta property="og:title" content="Writing Your Own TypeScript CLI"/><meta property="og:type" content="website"/><meta property="og:url" content="https://dawchihliou.github.io/articles/writing-your-own-typescript-cli"/><meta property="og:description" content="Writing CLIs feels like a super powerğŸ’¯ You can write one too! I&#x27;ll show you how to develop a CLI with TypeScript step by step and demonstrate how you can apply your CLI in CD/CI pipelines. We&#x27;re going to uncover the power of Google Lighthouse and many more amazing npm packages!"/><meta property="og:image" content="https://dawchihliou.github.io/optimized/articles/writing-your-own-typescript-cli/hero.png"/><meta property="og:image:type" content="image/png"/><meta property="og:image:width" content="1411"/><meta property="og:image:height" content="682"/><meta property="og:image:alt" content="Writing CLIs feels like a super powerğŸ’¯ You can write one too! I&#x27;ll show you how to develop a CLI with TypeScript step by step and demonstrate how you can apply your CLI in CD/CI pipelines. We&#x27;re going to uncover the power of Google Lighthouse and many more amazing npm packages!"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@dawchihliou"/><meta name="twitter:creator" content="@dawchihliou"/><meta name="twitter:title" content="Writing Your Own TypeScript CLI"/><meta name="twitter:description" content="Writing CLIs feels like a super powerğŸ’¯ You can write one too! I&#x27;ll show you how to develop a CLI with TypeScript step by step and demonstrate how you can apply your CLI in CD/CI pipelines. We&#x27;re going to uncover the power of Google Lighthouse and many more amazing npm packages!"/><meta name="twitter:image" content="https://dawchihliou.github.io/optimized/articles/writing-your-own-typescript-cli/hero.webp"/><meta property="article:published_time" content="2021-12-06T00:00:00.000Z"/><meta property="article:section" content="Article Section"/><meta property="article:tag" content="Article Tag"/><meta name="next-head-count" content="34"/><link rel="preload" href="/_next/static/css/495e118c856e10cb.css" as="style"/><link rel="stylesheet" href="/_next/static/css/495e118c856e10cb.css" data-n-g=""/><link rel="preload" href="/_next/static/css/54ba867c7255694d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/54ba867c7255694d.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-d626e1e36bdab8a2.js" defer=""></script><script src="/_next/static/chunks/framework-01395af778c6fb71.js" defer=""></script><script src="/_next/static/chunks/main-e8c39d39ad5622e4.js" defer=""></script><script src="/_next/static/chunks/pages/_app-1408069a686cc5df.js" defer=""></script><script src="/_next/static/chunks/pages/articles/%5Bslug%5D-f62544c600d1388a.js" defer=""></script><script src="/_next/static/wAbJRElSnzz9Ta5bSlIBr/_buildManifest.js" defer=""></script><script src="/_next/static/wAbJRElSnzz9Ta5bSlIBr/_ssgManifest.js" defer=""></script><script src="/_next/static/wAbJRElSnzz9Ta5bSlIBr/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div id="outer-container"><header><div><div class="bm-overlay" style="position:fixed;z-index:1000;width:100%;height:100%;background:rgba(0, 0, 0, 0.3);opacity:0;-moz-transform:translate3d(100%, 0, 0);-ms-transform:translate3d(100%, 0, 0);-o-transform:translate3d(100%, 0, 0);-webkit-transform:translate3d(100%, 0, 0);transform:translate3d(100%, 0, 0);transition:opacity 0.3s, transform 0s 0.3s"></div><div><div class="bm-burger-button" style="z-index:1000"><button id="react-burger-menu-btn" style="position:absolute;left:0;top:0;z-index:1;width:100%;height:100%;margin:0;padding:0;border:none;font-size:0;background:transparent;cursor:pointer">Open Menu</button><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="bm-icon" style="width:100%;height:100%" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div></div><div id="" class="bm-menu-wrap" style="position:fixed;right:inherit;z-index:1100;width:300px;height:100%;-moz-transform:translate3d(-100%, 0, 0);-ms-transform:translate3d(-100%, 0, 0);-o-transform:translate3d(-100%, 0, 0);-webkit-transform:translate3d(-100%, 0, 0);transform:translate3d(-100%, 0, 0);transition:all 0.5s" aria-hidden="true"><div class="bm-menu" style="height:100%;box-sizing:border-box;overflow:auto"><nav class="bm-item-list" style="height:100%"><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/"><button class="Nav_button__YJwKE" tabindex="-1">Home</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/articles"><button class="Nav_button__YJwKE" tabindex="-1">Articles</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/work"><button class="Nav_button__YJwKE" tabindex="-1">Work</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/now"><button class="Nav_button__YJwKE" tabindex="-1">Now</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/expertise"><button class="Nav_button__YJwKE" tabindex="-1">Expertise</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/contact"><button class="Nav_button__YJwKE" tabindex="-1">Contact</button></a><span class="bm-item Nav_pusher__93Gc6" style="display:block" tabindex="-1"></span><span class="bm-item Nav_divider__QD8Pt" style="display:block" tabindex="-1"></span><div class="bm-item Nav_profile__Kf2nU" style="display:block" tabindex="-1"><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/dawchihliou" aria-label="Link to Daw-Chih&#x27;s Linkedin profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M20.45175,20.45025 L16.89225,20.45025 L16.89225,14.88075 C16.89225,13.5525 16.86975,11.844 15.04275,11.844 C13.191,11.844 12.90825,13.2915 12.90825,14.7855 L12.90825,20.45025 L9.3525,20.45025 L9.3525,8.997 L12.765,8.997 L12.765,10.563 L12.81375,10.563 C13.2885,9.66225 14.4495,8.71275 16.18125,8.71275 C19.78575,8.71275 20.45175,11.08425 20.45175,14.169 L20.45175,20.45025 Z M5.33925,7.4325 C4.1955,7.4325 3.27375,6.50775 3.27375,5.36775 C3.27375,4.2285 4.1955,3.30375 5.33925,3.30375 C6.47775,3.30375 7.4025,4.2285 7.4025,5.36775 C7.4025,6.50775 6.47775,7.4325 5.33925,7.4325 L5.33925,7.4325 Z M7.11975,20.45025 L3.5565,20.45025 L3.5565,8.997 L7.11975,8.997 L7.11975,20.45025 Z M23.00025,0 L1.0005,0 C0.44775,0 0,0.44775 0,0.99975 L0,22.9995 C0,23.55225 0.44775,24 1.0005,24 L23.00025,24 C23.55225,24 24,23.55225 24,22.9995 L24,0.99975 C24,0.44775 23.55225,0 23.00025,0 L23.00025,0 Z"></path></svg></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou" aria-label="Link to Daw-Chih&#x27;s GitHub profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M11.9989871,1 C5.92550416,1 1,5.92482888 1,12.0003376 C1,16.8603395 4.15153934,20.9829338 8.52263728,22.4374904 C9.0729918,22.5387827 9.27355045,22.199116 9.27355045,21.9073943 C9.27355045,21.6467356 9.2640965,20.954572 9.25869425,20.0368642 C6.19899322,20.7013414 5.55342398,18.5620492 5.55342398,18.5620492 C5.0530403,17.2911692 4.33183953,16.9528531 4.33183953,16.9528531 C3.33309801,16.2708186 4.40747107,16.2843243 4.40747107,16.2843243 C5.51155652,16.3619816 6.09229872,17.4181221 6.09229872,17.4181221 C7.07348292,19.0988981 8.66714755,18.6133706 9.2938089,18.3317781 C9.39375058,17.6213819 9.67804414,17.1365297 9.99205009,16.86169 C7.54955646,16.5841493 4.98146045,15.6401056 4.98146045,11.4249977 C4.98146045,10.224347 5.41026428,9.24181221 6.11390773,8.47334172 C6.00046042,8.19512569 5.62297799,7.07618404 6.22195279,5.56220265 C6.22195279,5.56220265 7.14506277,5.26642929 9.24653918,6.68992296 C10.12373,6.44547101 11.0650726,6.32392032 12.0003376,6.31919335 C12.9349274,6.32392032 13.8755947,6.44547101 14.7541361,6.68992296 C16.8542619,5.26642929 17.7760214,5.56220265 17.7760214,5.56220265 C18.3763467,7.07618404 17.9988643,8.19512569 17.8860923,8.47334172 C18.5910863,9.24181221 19.0165137,10.224347 19.0165137,11.4249977 C19.0165137,15.6509101 16.444366,16.5807729 13.9944443,16.8529114 C14.3888087,17.192578 14.7406305,17.863808 14.7406305,18.890236 C14.7406305,20.3603241 14.7271248,21.5467939 14.7271248,21.9073943 C14.7271248,22.2018171 14.9256576,22.5441849 15.4834403,22.4368151 C19.8511618,20.9788821 23,16.8589889 23,12.0003376 C23,5.92482888 18.0744958,1 11.9989871,1"></path></svg></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://medium.com/@dawchihliou" aria-label="Link to Daw-Chih&#x27;s Medium profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2.84593838,5.88685595 C2.87575654,5.59224254 2.76340763,5.30104995 2.54341737,5.10276397 L0.302521008,2.4032473 L0.302521008,2 L7.2605042,2 L12.6386555,13.7949836 L17.3669469,2 L24,2 L24,2.4032473 L22.0840336,4.2402628 C21.9188563,4.36617057 21.8369199,4.57310892 21.8711485,4.77792587 L21.8711485,18.2755093 C21.8369199,18.4803262 21.9188563,18.6872645 22.0840336,18.8131723 L23.9551821,20.6501878 L23.9551821,21.0534351 L14.5434174,21.0534351 L14.5434174,20.6501878 L16.4817928,18.7683671 C16.6722689,18.5779447 16.6722689,18.5219382 16.6722689,18.2307041 L16.6722689,7.32062416 L11.2829132,21.0086299 L10.5546219,21.0086299 L4.28011204,7.32062416 L4.28011204,16.4945003 C4.22779746,16.8801958 4.35589372,17.2685069 4.62745097,17.5474239 L7.14845938,20.6053826 L7.14845938,21.0086299 L0,21.0086299 L0,20.6053826 L2.5210084,17.5474239 C2.79058848,17.2680445 2.91121535,16.8771576 2.84593838,16.4945003 L2.84593838,5.88685595 Z"></path></svg></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://hackernoon.com/u/dawchihliou" aria-label="Link to Daw-Chih&#x27;s Hackernoon profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="1.5em" width="1.5em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M5.701 0v6.223H8.85V4.654h1.576v7.842H12V4.654h1.574v1.569h3.15V0zm11.024 6.223v3.136h1.574V6.223zm1.574 3.136v4.705h1.576v-1.568h1.574v-1.568h-1.574V9.359zm0 4.705h-1.574v3.137h1.574zm-1.574 3.137h-3.15v1.569H8.85V17.2H5.7V24h11.024zm-11.024 0v-3.137H4.125v3.137zm-1.576-3.137V9.36H2.551v4.705zm0-4.705h1.576V6.223H4.125Z"></path></svg><span hidden="">Link to Daw-Chih&#x27;s Hacker Noon profile</span></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://twitter.com/dawchihliou" aria-label="Link to Daw-Chih&#x27;s Twitter profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M24,4.3086 C23.117,4.7006 22.168,4.9646 21.172,5.0836 C22.188,4.4746 22.969,3.5096 23.337,2.3596 C22.386,2.9246 21.332,3.3336 20.21,3.5556 C19.312,2.5976 18.032,1.9996 16.616,1.9996 C13.897,1.9996 11.692,4.2046 11.692,6.9236 C11.692,7.3096 11.736,7.6856 11.82,8.0456 C7.728,7.8406 4.099,5.8806 1.671,2.9006 C1.247,3.6286 1.004,4.4736 1.004,5.3766 C1.004,7.0846 1.873,8.5926 3.195,9.4756 C2.388,9.4486 1.628,9.2276 0.964,8.8596 L0.964,8.9206 C0.964,11.3066 2.661,13.2966 4.914,13.7486 C4.501,13.8626 4.065,13.9216 3.617,13.9216 C3.299,13.9216 2.991,13.8906 2.69,13.8336 C3.317,15.7896 5.135,17.2136 7.29,17.2536 C5.604,18.5736 3.481,19.3606 1.175,19.3606 C0.777,19.3606 0.385,19.3376 0,19.2926 C2.179,20.6886 4.767,21.5046 7.548,21.5046 C16.605,21.5046 21.557,14.0016 21.557,7.4946 C21.557,7.2816 21.552,7.0696 21.543,6.8586 C22.505,6.1636 23.34,5.2966 24,4.3086"></path></svg></a></div><div class="DarkmodeSwitch_container__uFGHQ" tabindex="-1"><div class="DarkmodeSwitch_wrap__e71_4"></div></div></nav></div><div><div class="bm-cross-button" style="position:absolute;width:24px;height:24px;right:8px;top:8px"><button id="react-burger-cross-btn" style="position:absolute;left:0;top:0;z-index:1;width:100%;height:100%;margin:0;padding:0;border:none;font-size:0;background:transparent;cursor:pointer" tabindex="-1">Close Menu</button><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="bm-cross" style="width:100%;height:100%" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div></div></div></div></header><div class="Menubar_menubar__gvU4b"><a class="styles_anchor__g18qA Menubar_hireMe__zuAig" href="/contact"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1.5em" width="1.5em" xmlns="http://www.w3.org/2000/svg"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>Hire Me</a><div class="DarkmodeSwitch_container__uFGHQ" tabindex="0"><div class="DarkmodeSwitch_wrap__e71_4"></div></div><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou" aria-label="See more Daw-Chih&#x27;s work on GitHub"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1.5em" width="1.5em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M11.9989871,1 C5.92550416,1 1,5.92482888 1,12.0003376 C1,16.8603395 4.15153934,20.9829338 8.52263728,22.4374904 C9.0729918,22.5387827 9.27355045,22.199116 9.27355045,21.9073943 C9.27355045,21.6467356 9.2640965,20.954572 9.25869425,20.0368642 C6.19899322,20.7013414 5.55342398,18.5620492 5.55342398,18.5620492 C5.0530403,17.2911692 4.33183953,16.9528531 4.33183953,16.9528531 C3.33309801,16.2708186 4.40747107,16.2843243 4.40747107,16.2843243 C5.51155652,16.3619816 6.09229872,17.4181221 6.09229872,17.4181221 C7.07348292,19.0988981 8.66714755,18.6133706 9.2938089,18.3317781 C9.39375058,17.6213819 9.67804414,17.1365297 9.99205009,16.86169 C7.54955646,16.5841493 4.98146045,15.6401056 4.98146045,11.4249977 C4.98146045,10.224347 5.41026428,9.24181221 6.11390773,8.47334172 C6.00046042,8.19512569 5.62297799,7.07618404 6.22195279,5.56220265 C6.22195279,5.56220265 7.14506277,5.26642929 9.24653918,6.68992296 C10.12373,6.44547101 11.0650726,6.32392032 12.0003376,6.31919335 C12.9349274,6.32392032 13.8755947,6.44547101 14.7541361,6.68992296 C16.8542619,5.26642929 17.7760214,5.56220265 17.7760214,5.56220265 C18.3763467,7.07618404 17.9988643,8.19512569 17.8860923,8.47334172 C18.5910863,9.24181221 19.0165137,10.224347 19.0165137,11.4249977 C19.0165137,15.6509101 16.444366,16.5807729 13.9944443,16.8529114 C14.3888087,17.192578 14.7406305,17.863808 14.7406305,18.890236 C14.7406305,20.3603241 14.7271248,21.5467939 14.7271248,21.9073943 C14.7271248,22.2018171 14.9256576,22.5441849 15.4834403,22.4368151 C19.8511618,20.9788821 23,16.8589889 23,12.0003376 C23,5.92482888 18.0744958,1 11.9989871,1"></path></svg></a></div><div id="page-wrap"><article><div class="Article_container__q__L3"><div class="Article_wrap__LZypL"><h1>Writing Your Own TypeScript CLI</h1><div class="Article_info__bOKys"><div class="Article_author__grS8U"><img alt="Daw-Chih Liou" src="/optimized/raw/portrait-sm.webp" loading="lazy"/><p>Daw-Chih Liou</p></div><p>December 6, 2021<!-- --> Â· 16 min read</p></div><img alt="Writing Your Own TypeScript CLI" src="/optimized/articles/writing-your-own-typescript-cli/hero.webp" width="100%" loading="lazy"/><div class="article-content"><h2 id="tldr"><a class="styles_anchor__g18qA anchor" href="/articles/writing-your-own-typescript-cli#tldr"><span class="icon icon-link"></span></a>TL;DR</h2>
<ul>
<li><span role="img" aria-label="cooking">ğŸ³</span> You can write a CLI with ease. It&#x27;s simpler than you might think:)</li>
<li><span role="img" aria-label="Tokyo tower">ğŸ—¼</span> We&#x27;ll write a CLI together to generate a Lighthouse performance report.</li>
<li><span role="img" aria-label="flashlight">ğŸ”¦</span> You&#x27;ll see how to configure TypeScript, ESLint, and Prettier.</li>
<li><span role="img" aria-label="books">ğŸ“š</span> You&#x27;ll see how to use some awesome libraries like <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/chalk/chalk"><code>chalk</code></a> and <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/tj/commander.js"><code>commander</code></a>.</li>
<li><span role="img" aria-label="" aria-hidden="true">ğŸ§‘</span>â€<span role="img" aria-label="microscope">ğŸ”¬</span> You&#x27;ll see how to spawn multiple processes.</li>
<li><span role="img" aria-label="rocket">ğŸš€</span> You&#x27;ll see how to use your CLI in GitHub Actions.</li>
</ul>
<hr/>
<p>Writing CLIs feels like a super power, and you can write one too<span role="img" aria-label="hundred points">ğŸ’¯</span></p>
<p>I&#x27;ll show you how to develop a CLI with TypeScript step by step and demonstrate how you can apply your CLI in CD/CI pipelines.</p>
<p>This article covers three major topics:</p>
<ul>
<li><a class="styles_anchor__g18qA undefined" href="/articles/writing-your-own-typescript-cli#configuring-tooling">Setting up A TypeScript Project with ESLint and Prettier</a></li>
<li><a class="styles_anchor__g18qA undefined" href="/articles/writing-your-own-typescript-cli#writing-a-cli-to-run-lighthouse">Writing a CLI to Run Lighthouse in Multiple Process</a></li>
<li><a class="styles_anchor__g18qA undefined" href="/articles/writing-your-own-typescript-cli#using-the-cli-in-github-actions">Using the CLI in Action with GitHub Actions</a></li>
</ul>
<p>Feel free to jump to the parts that you&#x27;re interested in.</p>
<h2 id="real-world-use-case"><a class="styles_anchor__g18qA anchor" href="/articles/writing-your-own-typescript-cli#real-world-use-case"><span class="icon icon-link"></span></a>Real-world Use Case</h2>
<p><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://developers.google.com/web/tools/lighthouse/">Lighthouse</a> is one of the most popular dev tools to gain insight to webpage performances.
It offers a CLI and node module so we can run it programmatically.
However, you&#x27;ll notice the Lighthouse scores vary if you run it multiple times on the same webpage.
That&#x27;s because there&#x27;s a known <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://developers.google.com/web/tools/lighthouse/variability">variability</a>.
There&#x27;re many factors that plays into the Lighthouse variability.
One of the recommended strategies to deal with variance is to run Lighthouse multiple times.</p>
<p>We&#x27;ll be working on a CLI to implement this strategy in this article. The implementation will cover:</p>
<ul>
<li>Running multiple Lighthouse analyses</li>
<li>Aggregating data and calculating the median scores</li>
</ul>
<p>I hope you&#x27;re excited!</p>
<hr/>
<p>This article will discuss one of the scripts in <span role="img" aria-label="rainbow">ğŸŒˆ</span><span role="img" aria-label="rainbow">ğŸŒˆ</span><span role="img" aria-label="rainbow">ğŸŒˆ</span> **<a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou/dx-scripts"><code>dx-scripts</code></a>**<span role="img" aria-label="rainbow">ğŸŒˆ</span><span role="img" aria-label="rainbow">ğŸŒˆ</span><span role="img" aria-label="rainbow">ğŸŒˆ</span></p>
<p>It&#x27;s available on <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.npmjs.com/package/dx-scripts">npm</a>.
I recently wrote the first script in the library and there are more to come!
Feel free to install it and try it in your development workflow. Please give it a <span role="img" aria-label="" aria-hidden="true">â­</span>ï¸ on <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou/dx-scripts">GitHub</a> if the scripts are useful:)</p>
<hr/>
<h2 id="peaking-the-projects-file-structure"><a class="styles_anchor__g18qA anchor" href="/articles/writing-your-own-typescript-cli#peaking-the-projects-file-structure"><span class="icon icon-link"></span></a>Peaking The Project&#x27;s File Structure</h2>
<p>This is how the file structure will look like after configuring the tooling.</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">my-script
</span><span class="code-line">â”œâ”€â”€ .eslintrc.js
</span><span class="code-line">â”œâ”€â”€ .prettierrc.json
</span><span class="code-line">â”œâ”€â”€ package.json
</span><span class="code-line">â”œâ”€â”€ tsconfig.json
</span><span class="code-line">â”œâ”€â”€ bin
</span><span class="code-line">â””â”€â”€ src
</span><span class="code-line">    â”œâ”€â”€ utils.ts
</span><span class="code-line">    â””â”€â”€ index.ts
</span></code></pre>
<p>The source files are located in the <code>/src</code> directory.
We&#x27;ll compile them and output <code>.js</code> files in <code>/bin</code> directory.</p>
<p>The <code>/bin</code> directory will be the entry point of the command when your users are using the CLI.
You&#x27;ll learn how to configure it in a bit.</p>
<h2 id="configuring-tooling"><a class="styles_anchor__g18qA anchor" href="/articles/writing-your-own-typescript-cli#configuring-tooling"><span class="icon icon-link"></span></a>Configuring Tooling</h2>
<p>We&#x27;ll be using <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://yarnpkg.com/">Yarn</a> as our package manager for this project.
Feel free to use <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.npmjs.com/">npm</a> if you prefer.</p>
<p>Let&#x27;s initiate the project. We&#x27;ll create a directory called <code>my-script</code>:</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">mkdir</span> my-script <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> my-script
</span></code></pre>
<p>At the project root, let&#x27;s create a <code>package.json</code> with Yarn:</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">yarn</span> init
</span></code></pre>
<h3 id="configuring-typescript"><a class="styles_anchor__g18qA anchor" href="/articles/writing-your-own-typescript-cli#configuring-typescript"><span class="icon icon-link"></span></a>Configuring TypeScript</h3>
<p>To install <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.typescriptlang.org/">TypeScript</a> and the types for <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://nodejs.org/en/">NodeJS</a>, run:</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">yarn</span> <span class="token function">add</span> --dev typescript @types/node
</span></code></pre>
<p>Now we are ready to configure TypeScript in the project.
We can initiate a <code>tsconfig.json</code> with <code>tsc</code>:</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ npx tsc --init
</span></code></pre>
<p>In order to compile the TypeScript code and output the result to the <code>/bin</code> directory, we need to specify it in the <code>compilerOptions</code> in <code>tsconfig.json</code>.</p>
<pre class="language-diff"><code class="language-diff code-highlight"><span class="code-line">// tsconfig.json
</span><span class="code-line">
</span><span class="code-line">{
</span><span class="code-line"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> &quot;compilerOptions&quot;: {
</span></span></span><span class="code-line inserted"><span class="token unchanged"><span class="token line"></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &quot;outDir&quot;: &quot;./bin&quot;
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   /* rest of the default options */
</span></span></span><span class="code-line"><span class="token unchanged"><span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span></span><span class="code-line"><span class="token unchanged"><span class="token line"></span></span>}
</span></code></pre>
<p>That&#x27;s it! Let&#x27;s test it.</p>
<p>At the project root, run the following command to create an <code>index.ts</code> file in <code>/src</code>.</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">mkdir</span> src <span class="token operator">&amp;&amp;</span> <span class="token function">touch</span> src/index.ts
</span></code></pre>
<p>In <code>index.ts</code>, we&#x27;ll put a simple <code>console.log</code> and run the TypeScript compiler to see if the compiled files are in the <code>/bin</code> directory.</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token comment">// src/index.ts</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;Hello from my-script<span role="img" aria-label="waving hand">ğŸ‘‹</span>&#x27;</span><span class="token punctuation">)</span>
</span></code></pre>
<p>Add a script to compile TypeScript with <code>tsc</code>.</p>
<pre class="language-diff"><code class="language-diff code-highlight"><span class="code-line">// package.json
</span><span class="code-line">
</span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> &quot;scripts&quot;: {
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">   &quot;tsc&quot;: &quot;tsc&quot;
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line"> }
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span>
</span></code></pre>
<p>Then run:</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token comment"># compile `/src`</span>
</span><span class="code-line">$ <span class="token function">yarn</span> tsc
</span></code></pre>
<p>You should see an <code>index.js</code> file in the <code>/bin</code> directory.</p>
<p>Let&#x27;s execute the <code>/bin</code> directory from the project root,</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">node</span> bin
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Hello from my-script <span role="img" aria-label="waving hand">ğŸ‘‹</span></span>
</span></code></pre>
<h3 id="configuring-eslint"><a class="styles_anchor__g18qA anchor" href="/articles/writing-your-own-typescript-cli#configuring-eslint"><span class="icon icon-link"></span></a>Configuring ESLint</h3>
<p>Now we ready for <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://eslint.org/">ESLint</a>. We can go ahead and install it:</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">yarn</span> <span class="token function">add</span> --dev eslint
</span></code></pre>
<p>ESLint is a very powerful linter.
It doesn&#x27;t come with TypeScript support so we&#x27;ll install a <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/typescript-eslint/typescript-eslint/tree/6e159ee7cf8ef2028792cb8ee636cf6143fa967f/packages/parser">TypeScript parser</a>:</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">yarn</span> <span class="token function">add</span> --dev @typescript-eslint/parser @typescript-eslint/eslint-plugin
</span></code></pre>
<p>We also installed the <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/typescript-eslint/typescript-eslint/tree/6e159ee7cf8ef2028792cb8ee636cf6143fa967f/packages/eslint-plugin"><code>@typescript-eslint/eslint-plugin</code></a>.
This is because we&#x27;ll need it to extend the ESLint rules for TypeScript-specific features.</p>
<p>Let&#x27;s configure eslint in the project. We&#x27;ll create a <code>.eslintrc.js</code> at the project root:</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token function">touch</span> .eslintrc.js
</span></code></pre>
<p>Inside <code>.eslintrc.js</code>, we can configure eslint as following:</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token comment">// .eslintrc.js</span>
</span><span class="code-line">
</span><span class="code-line">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">&#x27;@typescript-eslint/parser&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;@typescript-eslint&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;plugin:@typescript-eslint/recommended&#x27;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>To understand the configuration a little more, we first used <code>@typescript-eslint/parser</code> to enable ESLint&#x27;s ability to understand TypeScript syntax.
Then we applied <code>@typescript-eslint/eslint-plugin</code> plugin to extend the rules.
Finally we enabled all the recommended rules form <code>@typescript-eslint/eslint-plugin</code>.</p>
<p>If you&#x27;re interested in learning more about the configuration, you can checkout the <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/typescript-eslint/typescript-eslint/tree/main/packages/eslint-plugin#usage">official doc</a> for more details.</p>
<p>We can now add a linting script to <code>package.json</code>:</p>
<pre class="language-diff"><code class="language-diff code-highlight"><span class="code-line">// package.json
</span><span class="code-line">
</span><span class="code-line">{
</span><span class="code-line"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> &quot;scripts&quot;: {
</span></span></span><span class="code-line inserted"><span class="token unchanged"><span class="token line"></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &quot;lint&quot;: &quot;eslint &#x27;**/*.{js,ts}&#x27; --fix&quot;,
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span></span><span class="code-line"><span class="token unchanged"><span class="token line"></span></span>}
</span></code></pre>
<p>To run the script:</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">yarn</span> lint
</span></code></pre>
<h3 id="configuring-prettier"><a class="styles_anchor__g18qA anchor" href="/articles/writing-your-own-typescript-cli#configuring-prettier"><span class="icon icon-link"></span></a>Configuring Prettier</h3>
<p><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://prettier.io/">Prettier</a> is a very powerful formatter.
It comes with a set of rules to format our code.
Sometimes the rules can conflict with ESLint rules so I&#x27;ll show you how to configure them.</p>
<p>First install Prettier and create a <code>.prettierrc.json</code> file at the project root to hold the configuration,</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">yarn</span> <span class="token function">add</span> --dev --exact prettier <span class="token operator">&amp;&amp;</span> <span class="token function">touch</span> .prettierrc.json
</span></code></pre>
<p>You can edit <code>.prettierrc.json</code> and add your custom rules.
You can find <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://prettier.io/docs/en/options.html">the options in the official doc</a>.</p>
<p>Here&#x27;s an example:</p>
<pre class="language-json"><code class="language-json code-highlight"><span class="code-line"><span class="token comment">// .prettierrc.json</span>
</span><span class="code-line"><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token property">&quot;trailingComma&quot;</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token property">&quot;singleQuote&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>Prettier provides handy integration with ESLint.
We&#x27;ll follow the <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/prettier/eslint-plugin-prettier#recommended-configuration">recommended configuration</a> from the official doc.</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">yarn</span> <span class="token function">add</span> --dev eslint-config-prettier eslint-plugin-prettier
</span></code></pre>
<p>We&#x27;ll add the plugin at the last position in the <code>extensions</code> array.</p>
<pre class="language-diff"><code class="language-diff code-highlight"><span class="code-line">// .eslintrc.js
</span><span class="code-line">
</span><span class="code-line">module.exports = {
</span><span class="code-line"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> extends: [
</span></span></span><span class="code-line"><span class="token unchanged"><span class="token line"></span><span class="token prefix unchanged"> </span><span class="token line">   &#x27;plugin:@typescript-eslint/recommended&#x27;,
</span></span></span><span class="code-line inserted"><span class="token unchanged"><span class="token line"></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &#x27;plugin:prettier/recommended&#x27;,
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> ],
</span></span></span><span class="code-line"><span class="token unchanged"><span class="token line"></span></span>}
</span></code></pre>
<p>It&#x27;s very important that Prettier is the last extension.
By applying last, it disables all formatting-related ESLint rules so the conflicts will fall back to Prettier.</p>
<p>We can now add a <code>prettier</code> script to <code>package.json</code>:</p>
<pre class="language-diff"><code class="language-diff code-highlight"><span class="code-line">// package.json
</span><span class="code-line">
</span><span class="code-line">{
</span><span class="code-line"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> &quot;scripts&quot;: {
</span></span></span><span class="code-line inserted"><span class="token unchanged"><span class="token line"></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &quot;prettier&quot;: &quot;prettier --write .&quot;
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span></span><span class="code-line"><span class="token unchanged"><span class="token line"></span></span>}
</span></code></pre>
<p>To run the script:</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">yarn</span> prettier
</span></code></pre>
<h3 id="configuring-packagejson"><a class="styles_anchor__g18qA anchor" href="/articles/writing-your-own-typescript-cli#configuring-packagejson"><span class="icon icon-link"></span></a>Configuring <code>package.json</code></h3>
<p>We are almost ready with our configuration.
The only thing missing is a way to execute the project the way you would execute a command.
Instead of executing the <code>/bin</code> with <code>node</code>, we want to be able to call the command directly:</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token comment"># instead of &quot;node bin&quot;, we want to call the command by its name like this:</span>
</span><span class="code-line">$ my-script
</span></code></pre>
<p>How do we do that? First we need to add a <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Shebang_(Unix)">Shebang</a> on the top of our <code>src/index.ts</code>.</p>
<pre class="language-diff"><code class="language-diff code-highlight"><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> #!/usr/bin/env node
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span>
</span><span class="code-line">console.log(&#x27;Hello from my-script<span role="img" aria-label="waving hand">ğŸ‘‹</span>&#x27;)
</span></code></pre>
<p>The Shebang is to inform Unix-like operating systems that this is NodeJS executable.
So we can call the script directly without specifying <code>node</code>.</p>
<p>Let&#x27;s compile again,</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">yarn</span> tsc
</span></code></pre>
<p>There&#x27;s another thing we need before it all works. We need to assign the executable right to the <code>bin/index.js</code>:</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">chmod</span> u+x ./bin/index.js
</span></code></pre>
<p>Let&#x27;s give it a go:</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token comment"># execute directly</span>
</span><span class="code-line">$ ./bin/index.js
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Hello from my-script<span role="img" aria-label="waving hand">ğŸ‘‹</span></span>
</span></code></pre>
<p>Nice, we are almost there.
The last thing is to create a symlink between the command and the executable.
First, we need to specify the <code>bin</code> property in <code>package.json</code> and point the command to the <code>bin/index.js</code>.</p>
<pre class="language-diff"><code class="language-diff code-highlight"><span class="code-line">// package.json
</span><span class="code-line">
</span><span class="code-line">{
</span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  &quot;bin&quot;: {
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">    &quot;my-script&quot;: &quot;./bin/index.js&quot;
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">  }
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span>}
</span></code></pre>
<p>Second, create a symlink with Yarn at the project root:</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">yarn</span> <span class="token function">link</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># You can always unlink: &quot;yarn unlink my-script&quot;</span>
</span></code></pre>
<p>Let&#x27;s see if it works<span role="img" aria-label="" aria-hidden="true">ğŸ¤©</span></p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ my-script
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Hello from my-script<span role="img" aria-label="waving hand">ğŸ‘‹</span></span>
</span></code></pre>
<p>It works<span role="img" aria-label="party popper">ğŸ‰</span><span role="img" aria-label="party popper">ğŸ‰</span><span role="img" aria-label="party popper">ğŸ‰</span></p>
<p>Just to make the development easier, we&#x27;ll add a couple of scripts in <code>package.json</code>:</p>
<pre class="language-diff"><code class="language-diff code-highlight"><span class="code-line">// package.json
</span><span class="code-line">
</span><span class="code-line">{
</span><span class="code-line"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> &quot;scripts&quot;: {
</span></span></span><span class="code-line inserted"><span class="token unchanged"><span class="token line"></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    &quot;build&quot;: &quot;yarn tsc &amp;&amp; yarn chmod&quot;,
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">    &quot;chmod&quot;: &quot;chmod u+x ./bin/index.js&quot;,
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> }
</span></span></span><span class="code-line"><span class="token unchanged"><span class="token line"></span></span>}
</span></code></pre>
<p>Now we can run <code>yarn build</code> to compile and automatically assign the executable right to the entry file.</p>
<h2 id="writing-a-cli-to-run-lighthouse"><a class="styles_anchor__g18qA anchor" href="/articles/writing-your-own-typescript-cli#writing-a-cli-to-run-lighthouse"><span class="icon icon-link"></span></a>Writing a CLI to Run Lighthouse</h2>
<p>It&#x27;s time to implement our core logic.
We&#x27;ll explore a few handy npm packages to help us write the CLI and we&#x27;ll dive into the magic of Lighthouse.</p>
<h3 id="coloring-consolelog-with-chalk"><a class="styles_anchor__g18qA anchor" href="/articles/writing-your-own-typescript-cli#coloring-consolelog-with-chalk"><span class="icon icon-link"></span></a>Coloring <code>console.log</code> with <code>chalk</code></h3>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">yarn</span> <span class="token function">add</span> chalk@4.1.2
</span></code></pre>
<p>Make sure you are installing <code>chalk 4</code>. <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/chalk/chalk/releases/tag/v5.0.0"><code>chalk 5</code> is pure ESM</a> and we won&#x27;t be able to use it with TypeScript <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/microsoft/TypeScript/issues/46452">until TypeScript 4.6 is released</a>.</p>
<p><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/chalk/chalk"><code>chalk</code></a> gives colors to your <code>console.log</code>. For example:</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token comment">// src/index.ts</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">import</span> chalk <span class="token keyword">from</span> <span class="token string">&#x27;chalk&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">green</span><span class="token punctuation">(</span><span class="token string">&#x27;Hello from my-script<span role="img" aria-label="waving hand">ğŸ‘‹</span>&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span></code></pre>
<p>Now run <code>yarn build &amp;&amp; my-script</code> at your project root and see the log.</p>
<p>Let&#x27;s use <code>chalk</code> in a more meaningful way.
<a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://web.dev/performance-scoring/#color-coding">Lighthouse performane scores are color coded</a>.
We can write a utility function that shows the display value with a color based on the performance score.</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token comment">// src/utils.ts</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">import</span> chalk <span class="token keyword">from</span> <span class="token string">&#x27;chalk&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">/**
</span></span><span class="code-line"><span class="token comment"> * Coloring display value based on Lighthouse score.
</span></span><span class="code-line"><span class="token comment"> *
</span></span><span class="code-line"><span class="token comment"> * - 0 to 0.49 (red): Poor
</span></span><span class="code-line"><span class="token comment"> * - 0.5 to 0.89 (orange): Needs Improvement
</span></span><span class="code-line"><span class="token comment"> * - 0.9 to 1 (green): Good
</span></span><span class="code-line"><span class="token comment"> */</span>
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">draw</span><span class="token punctuation">(</span>score<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>score <span class="token operator">&gt;=</span> <span class="token number">0.9</span> <span class="token operator">&amp;&amp;</span> score <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">return</span> chalk<span class="token punctuation">.</span><span class="token function">green</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (Good)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>score <span class="token operator">&gt;=</span> <span class="token number">0.5</span> <span class="token operator">&amp;&amp;</span> score <span class="token operator">&lt;</span> <span class="token number">0.9</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">return</span> chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (Needs Improvement)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">return</span> chalk<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (Poor)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>Use it in <code>src/index.ts</code> and try log something with <code>draw()</code> to see the result.</p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token comment">// src/index.ts</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> draw <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;./utils&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Perf score is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token number">0.64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</span></code></pre>
<h3 id="designing-a-command-with-commander"><a class="styles_anchor__g18qA anchor" href="/articles/writing-your-own-typescript-cli#designing-a-command-with-commander"><span class="icon icon-link"></span></a>Designing A Command with <code>commander</code></h3>
<p>To make our CLI interactive, we need to be able to read user inputs and parse them.
<a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/tj/commander.js"><code>commander</code></a> is a descriptive way of defining a interface.
We can implement our interface in a very clean and documentary fashion.</p>
<p>How do we want the users to interact with the CLI is to simply pass a URL for Lighthouse to run.
We also want to pass in an option to specify how many times Lighthouse should run on the URL.
Like this:</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token comment"># without an option</span>
</span><span class="code-line">$ my-script https://dawchihliou.github.io/
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># with an option</span>
</span><span class="code-line">$ my-script https://dawchihliou.github.io/ --iteration<span class="token operator">=</span><span class="token number">3</span>
</span></code></pre>
<p>Let&#x27;s see how quickly we can implement our design with <code>commander</code>.</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">yarn</span> <span class="token function">add</span> commander
</span></code></pre>
<p>Let&#x27;s clear the <code>src/index.ts</code> and start fresh:</p>
<p><code>src/index.ts</code></p>
<pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token hashbang comment">#!/usr/bin/env node</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Command <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;commander&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> program <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Command</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  program
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token function">argument</span><span class="token punctuation">(</span><span class="token string">&#x27;&lt;url&gt;&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;Lighthouse will run the analysis on the URL.&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span>
</span><span class="code-line">      <span class="token string">&#x27;-i, --iteration &lt;type&gt;&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token string">&#x27;How many times Lighthouse should run the analysis per URL&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token string">&#x27;5&#x27;</span>
</span><span class="code-line">    <span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>url<span class="token punctuation">]</span> <span class="token operator">=</span> program<span class="token punctuation">.</span>args
</span><span class="code-line">  <span class="token keyword">const</span> options <span class="token operator">=</span> program<span class="token punctuation">.</span><span class="token function">opts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">url: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, iteration: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token punctuation">.</span>iteration<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></code></pre>
<p>We first instantiated a <code>Command</code> and we used the instance <code>program</code> to define:</p>
<ul>
<li>an <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/tj/commander.js#command-arguments"><code>required argument</code></a>: we gave it a name <code>url</code> and a description</li>
<li>an <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/tj/commander.js#options"><code>option</code></a>: we gave it a short flag and a long flag, a description, and a default value</li>
</ul>
<p>To consume the argument and option, we first parse the command and log the variables.</p>
<p>Now we can run the command and observe the log.</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">yarn</span> build
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># without an option</span>
</span><span class="code-line">$ my-script https://dawchihliou.github.io/
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># url: https://dawchihliou.github.io/, iteration: 5</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># with an option</span>
</span><span class="code-line">$ my-script https://dawchihliou.github.io/ --iteration<span class="token operator">=</span><span class="token number">3</span>
</span><span class="code-line"><span class="token comment"># or</span>
</span><span class="code-line">$ my-script https://dawchihliou.github.io/ -i <span class="token number">3</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># url: https://dawchihliou.github.io/, iteration: 3</span>
</span></code></pre>
<p>Very cool right?!
Another cool feature is that <code>commander</code> automatically generates a <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/tj/commander.js#automated-help"><code>help</code></a> to print the help information.</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ my-script --help
</span></code></pre>
<h3 id="running-multiple-lighthouse-analyses-in-separate-os-processes"><a class="styles_anchor__g18qA anchor" href="/articles/writing-your-own-typescript-cli#running-multiple-lighthouse-analyses-in-separate-os-processes"><span class="icon icon-link"></span></a>Running Multiple Lighthouse Analyses in Separate OS Processes</h3>
<p>We learned how to parse user inputs in the previous section. It&#x27;s time to dive into the core of the CLI.</p>
<p>The recommendation for running multiple Lighthouse is to run them in <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/GoogleChrome/lighthouse/issues/7187">separate processes</a> to remove the risk of interference.
<a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/moxystudio/node-cross-spawn"><code>cross-spawn</code></a> is a cross platform solution for spawning processes.
We will use it to synchronously spawn new processes to run Lighthouse.</p>
<p>To install <code>cross-spawn</code>:</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">yarn</span> <span class="token function">add</span> cross-spawn
</span><span class="code-line">$ <span class="token function">yarn</span> <span class="token function">add</span> --dev @types/cross-spawn
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># Let&#x27;s install lighthouse too<span role="img" aria-label="sparkles">âœ¨</span></span>
</span><span class="code-line"><span class="token function">yarn</span> <span class="token function">add</span> lighthouse
</span></code></pre>
<p>Let&#x27;s edit <code>src/index.ts</code>:</p>
<pre class="language-diff"><code class="language-diff code-highlight"><span class="code-line">import { Command } from &#x27;commander&#x27;
</span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> import spawn from &#x27;cross-spawn&#x27;
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span>
</span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> const lighthouse = require.resolve(&#x27;lighthouse/lighthouse-cli&#x27;)
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span>
</span><span class="code-line">async function run() {
</span><span class="code-line"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> // ...
</span></span></span><span class="code-line deleted"><span class="token unchanged"><span class="token line"></span></span><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span><span class="token line">  console.log(`url: ${url}, iteration: ${options.iteration}`)
</span></span></span><span class="code-line inserted"><span class="token deleted-sign deleted"><span class="token line"></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  console.log(
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">    `<span role="img" aria-label="Tokyo tower">ğŸ—¼</span> Running Lighthouse for ${url}. It will take a while, please wait...`
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">  )
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">  const results = []
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">  for (let i = 0; i &lt; options.iteration; i++) {
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">    const { status, stdout } = spawn.sync(
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">      process.execPath, [
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">      lighthouse,
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">      url,
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">      &#x27;--output=json&#x27;,
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">      &#x27;--chromeFlags=--headless&#x27;,
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">      &#x27;--only-categories=performance&#x27;,
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">    ])
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">    if (status !== 0) {
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">      continue
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">    }
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">    results.push(JSON.parse(stdout.toString()))
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">  }
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span>}
</span></code></pre>
<p>In the code, we spawn new processes multiple times based on user input.
In each process, we ran Lighthouse performance analysis with headless Chrome and collect the the JSON data.
The <code>result</code> variable will hold an array of independent performance data in string.
The next step is to aggregate the data and calculate the most reliable performance scores.</p>
<p>If you implement the code above, you&#x27;ll see a linting error about <code>require</code>.
<code>require.resolve</code> resolves the path to a module instead of the module itself.
In this article, we&#x27;ll allow the <code>@typescript-eslint/no-var-requires</code> rule in <code>.eslintrc.js</code> to compile.</p>
<pre class="language-diff"><code class="language-diff code-highlight"><span class="code-line">// .eslintrc.js
</span><span class="code-line">
</span><span class="code-line">module.exports = {
</span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  rules: {
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">    // allow require
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">    &#x27;@typescript-eslint/no-var-requires&#x27;: 0,
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">  },
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span>}
</span></code></pre>
<h3 id="calculating-reliable-lighthouse-scores"><a class="styles_anchor__g18qA anchor" href="/articles/writing-your-own-typescript-cli#calculating-reliable-lighthouse-scores"><span class="icon icon-link"></span></a>Calculating Reliable Lighthouse Scores</h3>
<p>One strategy is to aggregate the reports by calculating the median.
Lighthouse provide a internal functionality <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/GoogleChrome/lighthouse/blob/master/lighthouse-core/lib/median-run.js"><code>computeMedianRun</code></a>.
Let&#x27;s use it</p>
<pre class="language-diff"><code class="language-diff code-highlight"><span class="code-line">// src/index.ts
</span><span class="code-line">
</span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> // For simplicity, we use require here because lighthouse doesn&#x27;t provide type declaration.
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line"> const {
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">   computeMedianRun,
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line"> } = require(&#x27;lighthouse/lighthouse-core/lib/median-run.js&#x27;)
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span>
</span><span class="code-line">async function run() {
</span><span class="code-line"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> // ...
</span></span></span><span class="code-line inserted"><span class="token unchanged"><span class="token line"></span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   const median = computeMedianRun(results)
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span>
</span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   console.log(`\n${chalk.green(&#x27;âœ”&#x27;)} Report is ready for ${median.finalUrl}`)
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">   console.log(
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">     `<span role="img" aria-label="Tokyo tower">ğŸ—¼</span> Median performance score: ${draw(
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">       median.categories.performance.score,
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">       median.categories.performance.score * 100
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">     )}`
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">   )
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span>
</span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   const primaryMatrices = [
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">     &#x27;first-contentful-paint&#x27;,
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">     &#x27;interactive&#x27;,
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">     &#x27;speed-index&#x27;,
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">     &#x27;total-blocking-time&#x27;,
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">     &#x27;largest-contentful-paint&#x27;,
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">     &#x27;cumulative-layout-shift&#x27;,
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">   ]
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">   primaryMatrices.map((matrix) =&gt; {
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">     const { title, displayValue, score } = median.audits[matrix]
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">     console.log(`<span role="img" aria-label="Tokyo tower">ğŸ—¼</span> Median ${title}: ${draw(score, displayValue)}`)
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line">   })
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span>}
</span></code></pre>
<p>Under the hood, <code>computeMedianRun</code> returns the score that&#x27;s closest to the median of the First Contentful Paint and the median of the Time to Interactive.
It&#x27;s because they represent the earliest and the latest moments in the page initialization lifecycle.
It&#x27;s a more reliable way to determine the median than the naive approach by finding the median from a single measurement.</p>
<p>Now try the command again and see the result!</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">yarn</span> build <span class="token operator">&amp;&amp;</span> my-script https://dawchihliou.github.io --iteration<span class="token operator">=</span><span class="token number">3</span>
</span></code></pre>
<img src="/optimized/articles/writing-your-own-typescript-cli/command-line.webp" alt="Screenshot of my-script final output" width="100%" loading="lazy"/>
<p>Walla<span role="img" aria-label="party popper">ğŸ‰</span></p>
<h2 id="using-the-cli-in-github-actions"><a class="styles_anchor__g18qA anchor" href="/articles/writing-your-own-typescript-cli#using-the-cli-in-github-actions"><span class="icon icon-link"></span></a>Using the CLI in GitHub Actions</h2>
<p>Our implementation is done.
Let&#x27;s use the CLI in an automated workflow so we can benchmark the performance in a CD/CI pipeline.</p>
<p>First, let&#x27;s publish the package on npm (hypothetically).</p>
<p>I published a npm package <strong><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou/dx-scripts/"><code>dx-scripts</code></a></strong> that includes the production-ready version of <code>my-script</code>.
We will write the GitHub Actions workflow with <code>dx-scripts</code> to illustrate.</p>
<h3 id="publishing-on-npm-an-example"><a class="styles_anchor__g18qA anchor" href="/articles/writing-your-own-typescript-cli#publishing-on-npm-an-example"><span class="icon icon-link"></span></a>Publishing on npm (an example)</h3>
<p>We&#x27;ll add a <code>files</code> property in <code>package.json</code> to publish the <code>/bin</code> directory.</p>
<pre class="language-diff"><code class="language-diff code-highlight"><span class="code-line">// package.json
</span><span class="code-line">
</span><span class="code-line">{
</span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  &quot;files&quot;: [&quot;bin&quot;],
</span></span></span><span class="code-line"><span class="token inserted-sign inserted"><span class="token line"></span></span>}
</span></code></pre>
<p>Then simply run:</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">yarn</span> publish
</span></code></pre>
<p>Now the package is on npm (hypothetically)!</p>
<h3 id="writing-a-workflow"><a class="styles_anchor__g18qA anchor" href="/articles/writing-your-own-typescript-cli#writing-a-workflow"><span class="icon icon-link"></span></a>Writing A Workflow</h3>
<p>Let&#x27;s discuss the workflow. We want the workflow to:</p>
<ul>
<li>run on a pull request when there&#x27;s an update</li>
<li>run the Lighthouse performance analysis against a feature branch preview URL</li>
<li>notify the pull request with the analysis report</li>
</ul>
<p>So after the workflow is successfully completed, you&#x27;ll see a comment from GitHub Action Bot with your Lighthouse scores.</p>
<p>To focus on the application of our CLI, I&#x27;ll hard-code the feature branch preview URL in the workflow.</p>
<p>In your application repository, install <code>dx-scripts</code>:</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">$ <span class="token function">yarn</span> <span class="token function">add</span> --dev dx-scripts
</span></code></pre>
<p>Add a <code>lighthouse-dev-ci.yaml</code> to your GitHub workflows directory:</p>
<pre class="language-yaml"><code class="language-yaml code-highlight"><span class="code-line"><span class="token comment"># .github/workflows/lighthouse-dev-ci.yaml</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token key atrule">name</span><span class="token punctuation">:</span> Lighthouse CI
</span><span class="code-line">
</span><span class="code-line"><span class="token key atrule">on</span><span class="token punctuation">:</span> pull_request
</span><span class="code-line">
</span><span class="code-line"><span class="token key atrule">jobs</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token key atrule">lighthouse</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest
</span><span class="code-line">    <span class="token key atrule">env</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token comment"># You can substitute the hardcoded preview url with your preview url</span>
</span><span class="code-line">      <span class="token key atrule">preview_url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//dawchihliou.github.io/
</span><span class="code-line">    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v2
</span><span class="code-line">
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v1
</span><span class="code-line">        <span class="token key atrule">with</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token key atrule">node-version</span><span class="token punctuation">:</span> <span class="token string">&#x27;16.x&#x27;</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install dependencies
</span><span class="code-line">        <span class="token key atrule">run</span><span class="token punctuation">:</span> yarn
</span><span class="code-line">
</span><span class="code-line">      <span class="token comment"># You can add your steps here to create a preview</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Run Lighthouse
</span><span class="code-line">        <span class="token key atrule">id</span><span class="token punctuation">:</span> lighthouse
</span><span class="code-line">        <span class="token key atrule">shell</span><span class="token punctuation">:</span> bash
</span><span class="code-line">        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line"><span class="token scalar string">          lighthouse=$(npx dx-scripts lighthouse $preview_url)
</span></span><span class="code-line"><span class="token scalar string">          lighthouse=&quot;${lighthouse//&#x27;%&#x27;/&#x27;%25&#x27;}&quot;
</span></span><span class="code-line"><span class="token scalar string">          lighthouse=&quot;${lighthouse//$&#x27;\n&#x27;/&#x27;%0A&#x27;}&quot;
</span></span><span class="code-line"><span class="token scalar string">          lighthouse=&quot;${lighthouse//$&#x27;\r&#x27;/&#x27;%0D&#x27;}&quot;
</span></span><span class="code-line"><span class="token scalar string">          echo &quot;::set-output name=lighthouse_report::$lighthouse&quot;</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Notify PR
</span><span class="code-line">        <span class="token key atrule">uses</span><span class="token punctuation">:</span> wow<span class="token punctuation">-</span>actions/auto<span class="token punctuation">-</span>comment@v1
</span><span class="code-line">        <span class="token key atrule">with</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token key atrule">GITHUB_TOKEN</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.GITHUB_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span>
</span><span class="code-line">          <span class="token key atrule">pullRequestSynchronize</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line"><span class="token scalar string">            <span role="img" aria-label="waving hand">ğŸ‘‹</span> @{{ author }},</span>
</span><span class="code-line">
</span><span class="code-line">            Here is your Lighthouse performance overview<span role="img" aria-label="party popper">ğŸ‰</span>
</span><span class="code-line">
</span><span class="code-line">            ```
</span><span class="code-line">            $<span class="token punctuation">{</span><span class="token punctuation">{</span> steps.lighthouse.outputs.lighthouse_report <span class="token punctuation">}</span><span class="token punctuation">}</span>
</span><span class="code-line">            ```
</span></code></pre>
<p>In the &quot;Run Lighthouse&quot; step, we ran the <code>dx-script lighthouse</code> CLI, substitute the special characters in order to print multi-line output, and we set the output in a variable <code>lighthouse_report</code>.
In the &quot;Notify PR&quot; step, we wrote a comment with the output from the &quot;Run Lighthouse&quot; step and use the <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/marketplace/actions/auto-comment"><code>wow-actions/auto-comment</code> </a> action to post the comment.</p>
<img src="/optimized/articles/writing-your-own-typescript-cli/pr-comment.webp" alt="Screenshot of a PR comment posted from the Lighthouse CI" width="100%" loading="lazy"/>
<p>That&#x27;s it! What a journeyâ€.
It&#x27;s amazing that you followed all the way through.</p>
<h2 id="to-sum-up"><a class="styles_anchor__g18qA anchor" href="/articles/writing-your-own-typescript-cli#to-sum-up"><span class="icon icon-link"></span></a>To Sum up</h2>
<p>Writing a CLI is not too hard, right?<span role="img" aria-label="smiling face with sunglasses">ğŸ˜</span>
Let&#x27;s have a look at all the things we&#x27;ve covered:</p>
<ul>
<li>configuring TypeScript</li>
<li>configuring ESLint</li>
<li>configuring Prettier</li>
<li>executing your command locally</li>
<li>coloring logs with <code>chalk</code></li>
<li>defining your command with <code>commander</code></li>
<li>spawning processes</li>
<li>executing Lighthouse CLI</li>
<li>using Lighthouse&#x27;s internal library to calculate median performance scores</li>
<li>publish your command as a npm package</li>
<li>applying your command to a GitHub Action workflow</li>
</ul>
<p>Now the super power is yours too<span role="img" aria-label="rocket">ğŸš€</span></p>
<hr/>
<p>Here you have it! I hope you find it useful. Thanks for reading through<span role="img" aria-label="raising hands">ğŸ™Œ</span></p>
<p>Please share this article so that more people who&#x27;re looking for inspirations can see it.</p>
<p>Feel free to connect with me on <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://twitter.com/dawchihliou">twitter</a>!</p>
<p>If you&#x27;re interested in reading more about image optimization to boost your performance score, take a look at my previous article <a class="styles_anchor__g18qA undefined" href="/articles/use-webp-for-better-ux">&quot;Using WebP for Better User Experience&quot;</a>.
There we discussed one of the modern image formats that greatly reduces the size of your images without sacrificing quality.</p>
<p>If you&#x27;re wondering how to test Redux Observable, I wrote an article <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://itnext.io/better-marble-test-70c7676a1e2">&quot;Writing Better Marble Tests for Redux Observable and TypeScript&quot;</a> just for you.
It&#x27;s a comprehensive guide to walk you through the thought process.</p>
<p>If youâ€™re a fan of functional programming, check out <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://medium.com/@dawchihliou/intuitive-transducer-in-javascript-f358d3fe53d">this article that I wrote about Transducers</a>.
Itâ€™s a step by step reasoning on writing a transducer and it touches on key ideas about functional programming.</p>
<p>Happy coding!</p></div><article class="Author_wrap__s8DeE"><img src="/optimized/raw/portrait-sm.webp" alt="Daw-Chih Liou" class="Author_avatar__j6KIn" loading="lazy"/><div><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://dawchihliou.github.io">Daw-Chih Liou</a><p>Daw-Chih is a software engineer, UX advocate, and creator who is dedicated to Web engineering. His background in Human Centered Computing has led him to work with startups and public companies across North America, Asia, and Europe. He is passionate about meeting business trajectory with user journey and utilizing engineering architecture and performance monitoring to provide optimal user experience.</p></div></article></div></div></article><footer class="Footer_footer__1IwEk"><div class="Footer_wrap__FVCTX"><div class="Footer_resources__fG_vu"><p><span role="img" aria-label="build with love" class="Footer_emoji__u15jg">ğŸ’š</span>This site is built with</p><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://nextjs.org">Next.js</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://react-icons.github.io/react-icons">React Icons</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://mdxjs.com">MDX</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://unifiedjs.com">unified</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/contentlayerdev/contentlayer">Contentlayer</a></div><div class="Footer_contact__9GJn6"><p><span role="img" aria-label="build with love" class="Footer_emoji__u15jg">ğŸ¦„</span>Where to find me</p><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/dawchihliou">Linkedin</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou">GitHub</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://twitter.com/dawchihliou">Twitter</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://medium.com/@dawchihliou">Medium</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://hackernoon.com/u/dawchihliou">Hacker Noon</a><a class="styles_anchor__g18qA undefined" href="/rss.xml">RSS Feed <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></div><div class="Footer_sitemap__92ono"><p><span role="img" aria-label="build with love" class="Footer_emoji__u15jg">ğŸ—º</span>Sitemap</p><a class="styles_anchor__g18qA undefined" href="/">Home</a><a class="styles_anchor__g18qA undefined" href="/articles">Articles</a><a class="styles_anchor__g18qA undefined" href="/work">Work</a><a class="styles_anchor__g18qA undefined" href="/now">Now</a><a class="styles_anchor__g18qA undefined" href="/expertise">Expertise</a><a class="styles_anchor__g18qA undefined" href="/contact">Contact</a></div></div><div class="Footer_copyright__vZZRL">Â© <!-- -->2022<!-- --> <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/dawchihliou">Daw-Chih Liou</a></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Writing Your Own TypeScript CLI","publishedAt":"December 6, 2021","description":"Writing CLIs feels like a super powerğŸ’¯ You can write one too! I'll show you how to develop a CLI with TypeScript step by step and demonstrate how you can apply your CLI in CD/CI pipelines. We're going to uncover the power of Google Lighthouse and many more amazing npm packages!","cover":"/optimized/articles/writing-your-own-typescript-cli/hero.webp","category":"TypeScript","coverWidth":"1411","coverHeight":"682","body":{"raw":"\n## TL;DR\n\n- ğŸ³ You can write a CLI with ease. It's simpler than you might think:)\n- ğŸ—¼ We'll write a CLI together to generate a Lighthouse performance report.\n- ğŸ”¦ You'll see how to configure TypeScript, ESLint, and Prettier.\n- ğŸ“š You'll see how to use some awesome libraries like [`chalk`](https://github.com/chalk/chalk) and [`commander`](https://github.com/tj/commander.js).\n- ğŸ§‘â€ğŸ”¬ You'll see how to spawn multiple processes.\n- ğŸš€ You'll see how to use your CLI in GitHub Actions.\n\n---\n\nWriting CLIs feels like a super power, and you can write one tooğŸ’¯\n\nI'll show you how to develop a CLI with TypeScript step by step and demonstrate how you can apply your CLI in CD/CI pipelines.\n\nThis article covers three major topics:\n\n- [Setting up A TypeScript Project with ESLint and Prettier](#configuring-tooling)\n- [Writing a CLI to Run Lighthouse in Multiple Process](#writing-a-cli-to-run-lighthouse)\n- [Using the CLI in Action with GitHub Actions](#using-the-cli-in-github-actions)\n\nFeel free to jump to the parts that you're interested in.\n\n## Real-world Use Case\n\n[Lighthouse](https://developers.google.com/web/tools/lighthouse/) is one of the most popular dev tools to gain insight to webpage performances.\nIt offers a CLI and node module so we can run it programmatically.\nHowever, you'll notice the Lighthouse scores vary if you run it multiple times on the same webpage.\nThat's because there's a known [variability](https://developers.google.com/web/tools/lighthouse/variability).\nThere're many factors that plays into the Lighthouse variability.\nOne of the recommended strategies to deal with variance is to run Lighthouse multiple times.\n\nWe'll be working on a CLI to implement this strategy in this article. The implementation will cover:\n\n- Running multiple Lighthouse analyses\n- Aggregating data and calculating the median scores\n\nI hope you're excited!\n\n---\n\nThis article will discuss one of the scripts in ğŸŒˆğŸŒˆğŸŒˆ **[`dx-scripts`](https://github.com/DawChihLiou/dx-scripts)**ğŸŒˆğŸŒˆğŸŒˆ\n\nIt's available on [npm](https://www.npmjs.com/package/dx-scripts).\nI recently wrote the first script in the library and there are more to come!\nFeel free to install it and try it in your development workflow. Please give it a â­ï¸ on [GitHub](https://github.com/DawChihLiou/dx-scripts) if the scripts are useful:)\n\n---\n\n## Peaking The Project's File Structure\n\nThis is how the file structure will look like after configuring the tooling.\n\n```bash\nmy-script\nâ”œâ”€â”€ .eslintrc.js\nâ”œâ”€â”€ .prettierrc.json\nâ”œâ”€â”€ package.json\nâ”œâ”€â”€ tsconfig.json\nâ”œâ”€â”€ bin\nâ””â”€â”€ src\n    â”œâ”€â”€ utils.ts\n    â””â”€â”€ index.ts\n```\n\nThe source files are located in the `/src` directory.\nWe'll compile them and output `.js` files in `/bin` directory.\n\nThe `/bin` directory will be the entry point of the command when your users are using the CLI.\nYou'll learn how to configure it in a bit.\n\n## Configuring Tooling\n\nWe'll be using [Yarn](https://yarnpkg.com/) as our package manager for this project.\nFeel free to use [npm](https://www.npmjs.com/) if you prefer.\n\nLet's initiate the project. We'll create a directory called `my-script`:\n\n```bash\n$ mkdir my-script \u0026\u0026 cd my-script\n```\n\nAt the project root, let's create a `package.json` with Yarn:\n\n```bash\n$ yarn init\n```\n\n### Configuring TypeScript\n\nTo install [TypeScript](https://www.typescriptlang.org/) and the types for [NodeJS](https://nodejs.org/en/), run:\n\n```bash\n$ yarn add --dev typescript @types/node\n```\n\nNow we are ready to configure TypeScript in the project.\nWe can initiate a `tsconfig.json` with `tsc`:\n\n```bash\n$ npx tsc --init\n```\n\nIn order to compile the TypeScript code and output the result to the `/bin` directory, we need to specify it in the `compilerOptions` in `tsconfig.json`.\n\n```diff\n// tsconfig.json\n\n{\n  \"compilerOptions\": {\n+    \"outDir\": \"./bin\"\n    /* rest of the default options */\n  }\n}\n```\n\nThat's it! Let's test it.\n\nAt the project root, run the following command to create an `index.ts` file in `/src`.\n\n```bash\n$ mkdir src \u0026\u0026 touch src/index.ts\n```\n\nIn `index.ts`, we'll put a simple `console.log` and run the TypeScript compiler to see if the compiled files are in the `/bin` directory.\n\n```ts\n// src/index.ts\n\nconsole.log('Hello from my-scriptğŸ‘‹')\n```\n\nAdd a script to compile TypeScript with `tsc`.\n\n```diff\n// package.json\n\n+ \"scripts\": {\n+   \"tsc\": \"tsc\"\n+ }\n\n```\n\nThen run:\n\n```bash\n# compile `/src`\n$ yarn tsc\n```\n\nYou should see an `index.js` file in the `/bin` directory.\n\nLet's execute the `/bin` directory from the project root,\n\n```bash\n$ node bin\n\n# Hello from my-script ğŸ‘‹\n```\n\n### Configuring ESLint\n\nNow we ready for [ESLint](https://eslint.org/). We can go ahead and install it:\n\n```bash\n$ yarn add --dev eslint\n```\n\nESLint is a very powerful linter.\nIt doesn't come with TypeScript support so we'll install a [TypeScript parser](https://github.com/typescript-eslint/typescript-eslint/tree/6e159ee7cf8ef2028792cb8ee636cf6143fa967f/packages/parser):\n\n```bash\n$ yarn add --dev @typescript-eslint/parser @typescript-eslint/eslint-plugin\n```\n\nWe also installed the [`@typescript-eslint/eslint-plugin`](https://github.com/typescript-eslint/typescript-eslint/tree/6e159ee7cf8ef2028792cb8ee636cf6143fa967f/packages/eslint-plugin).\nThis is because we'll need it to extend the ESLint rules for TypeScript-specific features.\n\nLet's configure eslint in the project. We'll create a `.eslintrc.js` at the project root:\n\n```bash\ntouch .eslintrc.js\n```\n\nInside `.eslintrc.js`, we can configure eslint as following:\n\n```js\n// .eslintrc.js\n\nmodule.exports = {\n  parser: '@typescript-eslint/parser',\n  plugins: ['@typescript-eslint'],\n  extends: ['plugin:@typescript-eslint/recommended'],\n}\n```\n\nTo understand the configuration a little more, we first used `@typescript-eslint/parser` to enable ESLint's ability to understand TypeScript syntax.\nThen we applied `@typescript-eslint/eslint-plugin` plugin to extend the rules.\nFinally we enabled all the recommended rules form `@typescript-eslint/eslint-plugin`.\n\nIf you're interested in learning more about the configuration, you can checkout the [official doc](https://github.com/typescript-eslint/typescript-eslint/tree/main/packages/eslint-plugin#usage) for more details.\n\nWe can now add a linting script to `package.json`:\n\n```diff\n// package.json\n\n{\n  \"scripts\": {\n+    \"lint\": \"eslint '**/*.{js,ts}' --fix\",\n  }\n}\n```\n\nTo run the script:\n\n```bash\n$ yarn lint\n```\n\n### Configuring Prettier\n\n[Prettier](https://prettier.io/) is a very powerful formatter.\nIt comes with a set of rules to format our code.\nSometimes the rules can conflict with ESLint rules so I'll show you how to configure them.\n\nFirst install Prettier and create a `.prettierrc.json` file at the project root to hold the configuration,\n\n```bash\n$ yarn add --dev --exact prettier \u0026\u0026 touch .prettierrc.json\n```\n\nYou can edit `.prettierrc.json` and add your custom rules.\nYou can find [the options in the official doc](https://prettier.io/docs/en/options.html).\n\nHere's an example:\n\n```json\n// .prettierrc.json\n{\n  \"trailingComma\": \"all\",\n  \"singleQuote\": true\n}\n```\n\nPrettier provides handy integration with ESLint.\nWe'll follow the [recommended configuration](https://github.com/prettier/eslint-plugin-prettier#recommended-configuration) from the official doc.\n\n```bash\n$ yarn add --dev eslint-config-prettier eslint-plugin-prettier\n```\n\nWe'll add the plugin at the last position in the `extensions` array.\n\n```diff\n// .eslintrc.js\n\nmodule.exports = {\n  extends: [\n    'plugin:@typescript-eslint/recommended',\n+    'plugin:prettier/recommended',\n  ],\n}\n```\n\nIt's very important that Prettier is the last extension.\nBy applying last, it disables all formatting-related ESLint rules so the conflicts will fall back to Prettier.\n\nWe can now add a `prettier` script to `package.json`:\n\n```diff\n// package.json\n\n{\n  \"scripts\": {\n+    \"prettier\": \"prettier --write .\"\n  }\n}\n```\n\nTo run the script:\n\n```bash\n$ yarn prettier\n```\n\n### Configuring `package.json`\n\nWe are almost ready with our configuration.\nThe only thing missing is a way to execute the project the way you would execute a command.\nInstead of executing the `/bin` with `node`, we want to be able to call the command directly:\n\n```bash\n# instead of \"node bin\", we want to call the command by its name like this:\n$ my-script\n```\n\nHow do we do that? First we need to add a [Shebang](\u003chttps://en.wikipedia.org/wiki/Shebang_(Unix)\u003e) on the top of our `src/index.ts`.\n\n```diff\n+ #!/usr/bin/env node\n\nconsole.log('Hello from my-scriptğŸ‘‹')\n```\n\nThe Shebang is to inform Unix-like operating systems that this is NodeJS executable.\nSo we can call the script directly without specifying `node`.\n\nLet's compile again,\n\n```bash\n$ yarn tsc\n```\n\nThere's another thing we need before it all works. We need to assign the executable right to the `bin/index.js`:\n\n```bash\n$ chmod u+x ./bin/index.js\n```\n\nLet's give it a go:\n\n```bash\n# execute directly\n$ ./bin/index.js\n\n# Hello from my-scriptğŸ‘‹\n```\n\nNice, we are almost there.\nThe last thing is to create a symlink between the command and the executable.\nFirst, we need to specify the `bin` property in `package.json` and point the command to the `bin/index.js`.\n\n```diff\n// package.json\n\n{\n+  \"bin\": {\n+    \"my-script\": \"./bin/index.js\"\n+  }\n}\n```\n\nSecond, create a symlink with Yarn at the project root:\n\n```bash\n$ yarn link\n\n# You can always unlink: \"yarn unlink my-script\"\n```\n\nLet's see if it worksğŸ¤©\n\n```bash\n$ my-script\n\n# Hello from my-scriptğŸ‘‹\n```\n\nIt worksğŸ‰ğŸ‰ğŸ‰\n\nJust to make the development easier, we'll add a couple of scripts in `package.json`:\n\n```diff\n// package.json\n\n{\n  \"scripts\": {\n+    \"build\": \"yarn tsc \u0026\u0026 yarn chmod\",\n+    \"chmod\": \"chmod u+x ./bin/index.js\",\n  }\n}\n```\n\nNow we can run `yarn build` to compile and automatically assign the executable right to the entry file.\n\n## Writing a CLI to Run Lighthouse\n\nIt's time to implement our core logic.\nWe'll explore a few handy npm packages to help us write the CLI and we'll dive into the magic of Lighthouse.\n\n### Coloring `console.log` with `chalk`\n\n```bash\n$ yarn add chalk@4.1.2\n```\n\nMake sure you are installing `chalk 4`. [`chalk 5` is pure ESM](https://github.com/chalk/chalk/releases/tag/v5.0.0) and we won't be able to use it with TypeScript [until TypeScript 4.6 is released](https://github.com/microsoft/TypeScript/issues/46452).\n\n[`chalk`](https://github.com/chalk/chalk) gives colors to your `console.log`. For example:\n\n```ts\n// src/index.ts\n\nimport chalk from 'chalk'\n\nconsole.log(chalk.green('Hello from my-scriptğŸ‘‹'))\n```\n\nNow run `yarn build \u0026\u0026 my-script` at your project root and see the log.\n\nLet's use `chalk` in a more meaningful way.\n[Lighthouse performane scores are color coded](https://web.dev/performance-scoring/#color-coding).\nWe can write a utility function that shows the display value with a color based on the performance score.\n\n```ts\n// src/utils.ts\n\nimport chalk from 'chalk'\n\n/**\n * Coloring display value based on Lighthouse score.\n *\n * - 0 to 0.49 (red): Poor\n * - 0.5 to 0.89 (orange): Needs Improvement\n * - 0.9 to 1 (green): Good\n */\nexport function draw(score: number, value: number) {\n  if (score \u003e= 0.9 \u0026\u0026 score \u003c= 1) {\n    return chalk.green(`${value} (Good)`)\n  }\n\n  if (score \u003e= 0.5 \u0026\u0026 score \u003c 0.9) {\n    return chalk.yellow(`${value} (Needs Improvement)`)\n  }\n\n  return chalk.red(`${value} (Poor)`)\n}\n```\n\nUse it in `src/index.ts` and try log something with `draw()` to see the result.\n\n```ts\n// src/index.ts\n\nimport { draw } from './utils'\n\nconsole.log(`Perf score is ${draw(0.64, 64)}`)\n```\n\n### Designing A Command with `commander`\n\nTo make our CLI interactive, we need to be able to read user inputs and parse them.\n[`commander`](https://github.com/tj/commander.js) is a descriptive way of defining a interface.\nWe can implement our interface in a very clean and documentary fashion.\n\nHow do we want the users to interact with the CLI is to simply pass a URL for Lighthouse to run.\nWe also want to pass in an option to specify how many times Lighthouse should run on the URL.\nLike this:\n\n```bash\n# without an option\n$ my-script https://dawchihliou.github.io/\n\n# with an option\n$ my-script https://dawchihliou.github.io/ --iteration=3\n```\n\nLet's see how quickly we can implement our design with `commander`.\n\n```bash\n$ yarn add commander\n```\n\nLet's clear the `src/index.ts` and start fresh:\n\n`src/index.ts`\n\n```ts\n#!/usr/bin/env node\n\nimport { Command } from 'commander'\n\nasync function run() {\n  const program = new Command()\n\n  program\n    .argument('\u003curl\u003e', 'Lighthouse will run the analysis on the URL.')\n    .option(\n      '-i, --iteration \u003ctype\u003e',\n      'How many times Lighthouse should run the analysis per URL',\n      '5'\n    )\n    .parse()\n\n  const [url] = program.args\n  const options = program.opts()\n\n  console.log(`url: ${url}, iteration: ${options.iteration}`)\n}\n\nrun()\n```\n\nWe first instantiated a `Command` and we used the instance `program` to define:\n\n- an [`required argument`](https://github.com/tj/commander.js#command-arguments): we gave it a name `url` and a description\n- an [`option`](https://github.com/tj/commander.js#options): we gave it a short flag and a long flag, a description, and a default value\n\nTo consume the argument and option, we first parse the command and log the variables.\n\nNow we can run the command and observe the log.\n\n```bash\n$ yarn build\n\n# without an option\n$ my-script https://dawchihliou.github.io/\n\n# url: https://dawchihliou.github.io/, iteration: 5\n\n# with an option\n$ my-script https://dawchihliou.github.io/ --iteration=3\n# or\n$ my-script https://dawchihliou.github.io/ -i 3\n\n# url: https://dawchihliou.github.io/, iteration: 3\n```\n\nVery cool right?!\nAnother cool feature is that `commander` automatically generates a [`help`](https://github.com/tj/commander.js#automated-help) to print the help information.\n\n```bash\n$ my-script --help\n```\n\n### Running Multiple Lighthouse Analyses in Separate OS Processes\n\nWe learned how to parse user inputs in the previous section. It's time to dive into the core of the CLI.\n\nThe recommendation for running multiple Lighthouse is to run them in [separate processes](https://github.com/GoogleChrome/lighthouse/issues/7187) to remove the risk of interference.\n[`cross-spawn`](https://github.com/moxystudio/node-cross-spawn) is a cross platform solution for spawning processes.\nWe will use it to synchronously spawn new processes to run Lighthouse.\n\nTo install `cross-spawn`:\n\n```bash\n$ yarn add cross-spawn\n$ yarn add --dev @types/cross-spawn\n\n# Let's install lighthouse tooâœ¨\nyarn add lighthouse\n```\n\nLet's edit `src/index.ts`:\n\n```diff\nimport { Command } from 'commander'\n+ import spawn from 'cross-spawn'\n\n+ const lighthouse = require.resolve('lighthouse/lighthouse-cli')\n\nasync function run() {\n  // ...\n-  console.log(`url: ${url}, iteration: ${options.iteration}`)\n+  console.log(\n+    `ğŸ—¼ Running Lighthouse for ${url}. It will take a while, please wait...`\n+  )\n+  const results = []\n+\n+  for (let i = 0; i \u003c options.iteration; i++) {\n+    const { status, stdout } = spawn.sync(\n+      process.execPath, [\n+      lighthouse,\n+      url,\n+      '--output=json',\n+      '--chromeFlags=--headless',\n+      '--only-categories=performance',\n+    ])\n+\n+    if (status !== 0) {\n+      continue\n+    }\n+\n+    results.push(JSON.parse(stdout.toString()))\n+  }\n}\n```\n\nIn the code, we spawn new processes multiple times based on user input.\nIn each process, we ran Lighthouse performance analysis with headless Chrome and collect the the JSON data.\nThe `result` variable will hold an array of independent performance data in string.\nThe next step is to aggregate the data and calculate the most reliable performance scores.\n\nIf you implement the code above, you'll see a linting error about `require`.\n`require.resolve` resolves the path to a module instead of the module itself.\nIn this article, we'll allow the `@typescript-eslint/no-var-requires` rule in `.eslintrc.js` to compile.\n\n```diff\n// .eslintrc.js\n\nmodule.exports = {\n+  rules: {\n+    // allow require\n+    '@typescript-eslint/no-var-requires': 0,\n+  },\n}\n```\n\n### Calculating Reliable Lighthouse Scores\n\nOne strategy is to aggregate the reports by calculating the median.\nLighthouse provide a internal functionality [`computeMedianRun`](https://github.com/GoogleChrome/lighthouse/blob/master/lighthouse-core/lib/median-run.js).\nLet's use it\n\n```diff\n// src/index.ts\n\n+ // For simplicity, we use require here because lighthouse doesn't provide type declaration.\n+ const {\n+   computeMedianRun,\n+ } = require('lighthouse/lighthouse-core/lib/median-run.js')\n\nasync function run() {\n  // ...\n+   const median = computeMedianRun(results)\n\n+   console.log(`\\n${chalk.green('âœ”')} Report is ready for ${median.finalUrl}`)\n+   console.log(\n+     `ğŸ—¼ Median performance score: ${draw(\n+       median.categories.performance.score,\n+       median.categories.performance.score * 100\n+     )}`\n+   )\n\n+   const primaryMatrices = [\n+     'first-contentful-paint',\n+     'interactive',\n+     'speed-index',\n+     'total-blocking-time',\n+     'largest-contentful-paint',\n+     'cumulative-layout-shift',\n+   ]\n+\n+   primaryMatrices.map((matrix) =\u003e {\n+     const { title, displayValue, score } = median.audits[matrix]\n+     console.log(`ğŸ—¼ Median ${title}: ${draw(score, displayValue)}`)\n+   })\n}\n```\n\nUnder the hood, `computeMedianRun` returns the score that's closest to the median of the First Contentful Paint and the median of the Time to Interactive.\nIt's because they represent the earliest and the latest moments in the page initialization lifecycle.\nIt's a more reliable way to determine the median than the naive approach by finding the median from a single measurement.\n\nNow try the command again and see the result!\n\n```bash\n$ yarn build \u0026\u0026 my-script https://dawchihliou.github.io --iteration=3\n```\n\n\u003cimg\n  src=\"/optimized/articles/writing-your-own-typescript-cli/command-line.webp\"\n  alt=\"Screenshot of my-script final output\"\n  width=\"100%\"\n  loading=\"lazy\"\n/\u003e\n\nWallağŸ‰\n\n## Using the CLI in GitHub Actions\n\nOur implementation is done.\nLet's use the CLI in an automated workflow so we can benchmark the performance in a CD/CI pipeline.\n\nFirst, let's publish the package on npm (hypothetically).\n\nI published a npm package **[`dx-scripts`](https://github.com/DawChihLiou/dx-scripts/)** that includes the production-ready version of `my-script`.\nWe will write the GitHub Actions workflow with `dx-scripts` to illustrate.\n\n### Publishing on npm (an example)\n\nWe'll add a `files` property in `package.json` to publish the `/bin` directory.\n\n```diff\n// package.json\n\n{\n+  \"files\": [\"bin\"],\n}\n```\n\nThen simply run:\n\n```bash\n$ yarn publish\n```\n\nNow the package is on npm (hypothetically)!\n\n### Writing A Workflow\n\nLet's discuss the workflow. We want the workflow to:\n\n- run on a pull request when there's an update\n- run the Lighthouse performance analysis against a feature branch preview URL\n- notify the pull request with the analysis report\n\nSo after the workflow is successfully completed, you'll see a comment from GitHub Action Bot with your Lighthouse scores.\n\nTo focus on the application of our CLI, I'll hard-code the feature branch preview URL in the workflow.\n\nIn your application repository, install `dx-scripts`:\n\n```bash\n$ yarn add --dev dx-scripts\n```\n\nAdd a `lighthouse-dev-ci.yaml` to your GitHub workflows directory:\n\n````yaml\n# .github/workflows/lighthouse-dev-ci.yaml\n\nname: Lighthouse CI\n\non: pull_request\n\njobs:\n  lighthouse:\n    runs-on: ubuntu-latest\n    env:\n      # You can substitute the hardcoded preview url with your preview url\n      preview_url: https://dawchihliou.github.io/\n    steps:\n      - uses: actions/checkout@v2\n\n      - uses: actions/setup-node@v1\n        with:\n          node-version: '16.x'\n\n      - name: Install dependencies\n        run: yarn\n\n      # You can add your steps here to create a preview\n\n      - name: Run Lighthouse\n        id: lighthouse\n        shell: bash\n        run: |\n          lighthouse=$(npx dx-scripts lighthouse $preview_url)\n          lighthouse=\"${lighthouse//'%'/'%25'}\"\n          lighthouse=\"${lighthouse//$'\\n'/'%0A'}\"\n          lighthouse=\"${lighthouse//$'\\r'/'%0D'}\"\n          echo \"::set-output name=lighthouse_report::$lighthouse\"\n\n      - name: Notify PR\n        uses: wow-actions/auto-comment@v1\n        with:\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n          pullRequestSynchronize: |\n            ğŸ‘‹ @{{ author }},\n\n            Here is your Lighthouse performance overviewğŸ‰\n\n            ```\n            ${{ steps.lighthouse.outputs.lighthouse_report }}\n            ```\n````\n\nIn the \"Run Lighthouse\" step, we ran the `dx-script lighthouse` CLI, substitute the special characters in order to print multi-line output, and we set the output in a variable `lighthouse_report`.\nIn the \"Notify PR\" step, we wrote a comment with the output from the \"Run Lighthouse\" step and use the [`wow-actions/auto-comment` ](https://github.com/marketplace/actions/auto-comment) action to post the comment.\n\n\u003cimg\n  src=\"/optimized/articles/writing-your-own-typescript-cli/pr-comment.webp\"\n  alt=\"Screenshot of a PR comment posted from the Lighthouse CI\"\n  width=\"100%\"\n  loading=\"lazy\"\n/\u003e\n\nThat's it! What a journeyâ€.\nIt's amazing that you followed all the way through.\n\n## To Sum up\n\nWriting a CLI is not too hard, right?ğŸ˜\nLet's have a look at all the things we've covered:\n\n- configuring TypeScript\n- configuring ESLint\n- configuring Prettier\n- executing your command locally\n- coloring logs with `chalk`\n- defining your command with `commander`\n- spawning processes\n- executing Lighthouse CLI\n- using Lighthouse's internal library to calculate median performance scores\n- publish your command as a npm package\n- applying your command to a GitHub Action workflow\n\nNow the super power is yours tooğŸš€\n\n---\n\nHere you have it! I hope you find it useful. Thanks for reading throughğŸ™Œ\n\nPlease share this article so that more people who're looking for inspirations can see it.\n\nFeel free to connect with me on [twitter](https://twitter.com/dawchihliou)!\n\nIf you're interested in reading more about image optimization to boost your performance score, take a look at my previous article [\"Using WebP for Better User Experience\"](/articles/use-webp-for-better-ux).\nThere we discussed one of the modern image formats that greatly reduces the size of your images without sacrificing quality.\n\nIf you're wondering how to test Redux Observable, I wrote an article [\"Writing Better Marble Tests for Redux Observable and TypeScript\"](https://itnext.io/better-marble-test-70c7676a1e2) just for you.\nIt's a comprehensive guide to walk you through the thought process.\n\nIf youâ€™re a fan of functional programming, check out [this article that I wrote about Transducers](https://medium.com/@dawchihliou/intuitive-transducer-in-javascript-f358d3fe53d).\nItâ€™s a step by step reasoning on writing a transducer and it touches on key ideas about functional programming.\n\nHappy coding!\n","code":"var Component=(()=\u003e{var o=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var c=a=\u003el(a,\"__esModule\",{value:!0});var u=(a,e)=\u003e()=\u003e(e||a((e={exports:{}}).exports,e),e.exports),N=(a,e)=\u003e{c(a);for(var s in e)l(a,s,{get:e[s],enumerable:!0})},g=(a,e,s)=\u003e{if(e\u0026\u0026typeof e==\"object\"||typeof e==\"function\")for(let i of h(e))!m.call(a,i)\u0026\u0026i!==\"default\"\u0026\u0026l(a,i,{get:()=\u003ee[i],enumerable:!(s=d(e,i))||s.enumerable});return a},k=a=\u003eg(c(l(a!=null?o(p(a)):{},\"default\",a\u0026\u0026a.__esModule\u0026\u0026\"default\"in a?{get:()=\u003ea.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=u((x,t)=\u003e{t.exports=_jsx_runtime});var w={};N(w,{default:()=\u003ey});var n=k(r());function f(a={}){let e=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",ul:\"ul\",li:\"li\",code:\"code\",hr:\"hr\",p:\"p\",pre:\"pre\",h3:\"h3\",strong:\"strong\"},a.components),{wrapper:s}=e,i=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.h2,{id:\"tldr\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#tldr\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"TL;DR\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"cooking\",children:\"\\u{1F373}\"}),\" You can write a CLI with ease. It's simpler than you might think:)\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"Tokyo tower\",children:\"\\u{1F5FC}\"}),\" We'll write a CLI together to generate a Lighthouse performance report.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"flashlight\",children:\"\\u{1F526}\"}),\" You'll see how to configure TypeScript, ESLint, and Prettier.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"books\",children:\"\\u{1F4DA}\"}),\" You'll see how to use some awesome libraries like \",(0,n.jsx)(e.a,{href:\"https://github.com/chalk/chalk\",children:(0,n.jsx)(e.code,{children:\"chalk\"})}),\" and \",(0,n.jsx)(e.a,{href:\"https://github.com/tj/commander.js\",children:(0,n.jsx)(e.code,{children:\"commander\"})}),\".\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"\",\"aria-hidden\":!0,children:\"\\u{1F9D1}\"}),\"\\u200D\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"microscope\",children:\"\\u{1F52C}\"}),\" You'll see how to spawn multiple processes.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"rocket\",children:\"\\u{1F680}\"}),\" You'll see how to use your CLI in GitHub Actions.\"]}),`\n`]}),`\n`,(0,n.jsx)(e.hr,{}),`\n`,(0,n.jsxs)(e.p,{children:[\"Writing CLIs feels like a super power, and you can write one too\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"hundred points\",children:\"\\u{1F4AF}\"})]}),`\n`,(0,n.jsx)(e.p,{children:\"I'll show you how to develop a CLI with TypeScript step by step and demonstrate how you can apply your CLI in CD/CI pipelines.\"}),`\n`,(0,n.jsx)(e.p,{children:\"This article covers three major topics:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"#configuring-tooling\",children:\"Setting up A TypeScript Project with ESLint and Prettier\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"#writing-a-cli-to-run-lighthouse\",children:\"Writing a CLI to Run Lighthouse in Multiple Process\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"#using-the-cli-in-github-actions\",children:\"Using the CLI in Action with GitHub Actions\"})}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Feel free to jump to the parts that you're interested in.\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"real-world-use-case\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#real-world-use-case\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Real-world Use Case\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://developers.google.com/web/tools/lighthouse/\",children:\"Lighthouse\"}),` is one of the most popular dev tools to gain insight to webpage performances.\nIt offers a CLI and node module so we can run it programmatically.\nHowever, you'll notice the Lighthouse scores vary if you run it multiple times on the same webpage.\nThat's because there's a known `,(0,n.jsx)(e.a,{href:\"https://developers.google.com/web/tools/lighthouse/variability\",children:\"variability\"}),`.\nThere're many factors that plays into the Lighthouse variability.\nOne of the recommended strategies to deal with variance is to run Lighthouse multiple times.`]}),`\n`,(0,n.jsx)(e.p,{children:\"We'll be working on a CLI to implement this strategy in this article. The implementation will cover:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Running multiple Lighthouse analyses\"}),`\n`,(0,n.jsx)(e.li,{children:\"Aggregating data and calculating the median scores\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"I hope you're excited!\"}),`\n`,(0,n.jsx)(e.hr,{}),`\n`,(0,n.jsxs)(e.p,{children:[\"This article will discuss one of the scripts in \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"rainbow\",children:\"\\u{1F308}\"}),(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"rainbow\",children:\"\\u{1F308}\"}),(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"rainbow\",children:\"\\u{1F308}\"}),\" **\",(0,n.jsx)(e.a,{href:\"https://github.com/DawChihLiou/dx-scripts\",children:(0,n.jsx)(e.code,{children:\"dx-scripts\"})}),\"**\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"rainbow\",children:\"\\u{1F308}\"}),(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"rainbow\",children:\"\\u{1F308}\"}),(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"rainbow\",children:\"\\u{1F308}\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"It's available on \",(0,n.jsx)(e.a,{href:\"https://www.npmjs.com/package/dx-scripts\",children:\"npm\"}),`.\nI recently wrote the first script in the library and there are more to come!\nFeel free to install it and try it in your development workflow. Please give it a `,(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"\",\"aria-hidden\":!0,children:\"\\u2B50\"}),\"\\uFE0F on \",(0,n.jsx)(e.a,{href:\"https://github.com/DawChihLiou/dx-scripts\",children:\"GitHub\"}),\" if the scripts are useful:)\"]}),`\n`,(0,n.jsx)(e.hr,{}),`\n`,(0,n.jsxs)(e.h2,{id:\"peaking-the-projects-file-structure\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#peaking-the-projects-file-structure\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Peaking The Project's File Structure\"]}),`\n`,(0,n.jsx)(e.p,{children:\"This is how the file structure will look like after configuring the tooling.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`my-script\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 .eslintrc.js\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 .prettierrc.json\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 package.json\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 tsconfig.json\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 bin\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2514\\u2500\\u2500 src\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \\u251C\\u2500\\u2500 utils.ts\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \\u2514\\u2500\\u2500 index.ts\n`})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"The source files are located in the \",(0,n.jsx)(e.code,{children:\"/src\"}),` directory.\nWe'll compile them and output `,(0,n.jsx)(e.code,{children:\".js\"}),\" files in \",(0,n.jsx)(e.code,{children:\"/bin\"}),\" directory.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"The \",(0,n.jsx)(e.code,{children:\"/bin\"}),` directory will be the entry point of the command when your users are using the CLI.\nYou'll learn how to configure it in a bit.`]}),`\n`,(0,n.jsxs)(e.h2,{id:\"configuring-tooling\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#configuring-tooling\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Configuring Tooling\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"We'll be using \",(0,n.jsx)(e.a,{href:\"https://yarnpkg.com/\",children:\"Yarn\"}),` as our package manager for this project.\nFeel free to use `,(0,n.jsx)(e.a,{href:\"https://www.npmjs.com/\",children:\"npm\"}),\" if you prefer.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Let's initiate the project. We'll create a directory called \",(0,n.jsx)(e.code,{children:\"my-script\"}),\":\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"mkdir\"}),\" my-script \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin class-name\",children:\"cd\"}),` my-script\n`]})})}),`\n`,(0,n.jsxs)(e.p,{children:[\"At the project root, let's create a \",(0,n.jsx)(e.code,{children:\"package.json\"}),\" with Yarn:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),` init\n`]})})}),`\n`,(0,n.jsxs)(e.h3,{id:\"configuring-typescript\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#configuring-typescript\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Configuring TypeScript\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"To install \",(0,n.jsx)(e.a,{href:\"https://www.typescriptlang.org/\",children:\"TypeScript\"}),\" and the types for \",(0,n.jsx)(e.a,{href:\"https://nodejs.org/en/\",children:\"NodeJS\"}),\", run:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),` --dev typescript @types/node\n`]})})}),`\n`,(0,n.jsxs)(e.p,{children:[`Now we are ready to configure TypeScript in the project.\nWe can initiate a `,(0,n.jsx)(e.code,{children:\"tsconfig.json\"}),\" with \",(0,n.jsx)(e.code,{children:\"tsc\"}),\":\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`$ npx tsc --init\n`})})}),`\n`,(0,n.jsxs)(e.p,{children:[\"In order to compile the TypeScript code and output the result to the \",(0,n.jsx)(e.code,{children:\"/bin\"}),\" directory, we need to specify it in the \",(0,n.jsx)(e.code,{children:\"compilerOptions\"}),\" in \",(0,n.jsx)(e.code,{children:\"tsconfig.json\"}),\".\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-diff\",children:(0,n.jsxs)(e.code,{className:\"language-diff code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`// tsconfig.json\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`{\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token unchanged\",children:[(0,n.jsx)(e.span,{className:\"token prefix unchanged\",children:\" \"}),(0,n.jsx)(e.span,{className:\"token line\",children:` \"compilerOptions\": {\n`})]})}),(0,n.jsxs)(e.span,{className:\"code-line inserted\",children:[(0,n.jsx)(e.span,{className:\"token unchanged\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`    \"outDir\": \"./bin\"\n`})]})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token inserted-sign inserted\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),(0,n.jsxs)(e.span,{className:\"token unchanged\",children:[(0,n.jsx)(e.span,{className:\"token prefix unchanged\",children:\" \"}),(0,n.jsx)(e.span,{className:\"token line\",children:`   /* rest of the default options */\n`})]})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token unchanged\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix unchanged\",children:\" \"}),(0,n.jsx)(e.span,{className:\"token line\",children:` }\n`})]})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token unchanged\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),`}\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"That's it! Let's test it.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"At the project root, run the following command to create an \",(0,n.jsx)(e.code,{children:\"index.ts\"}),\" file in \",(0,n.jsx)(e.code,{children:\"/src\"}),\".\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"mkdir\"}),\" src \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"touch\"}),` src/index.ts\n`]})})}),`\n`,(0,n.jsxs)(e.p,{children:[\"In \",(0,n.jsx)(e.code,{children:\"index.ts\"}),\", we'll put a simple \",(0,n.jsx)(e.code,{children:\"console.log\"}),\" and run the TypeScript compiler to see if the compiled files are in the \",(0,n.jsx)(e.code,{children:\"/bin\"}),\" directory.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"language-ts code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// src/index.ts\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token builtin\",children:\"console\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"log\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string\",children:[\"'Hello from my-script\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"waving hand\",children:\"\\u{1F44B}\"}),\"'\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Add a script to compile TypeScript with \",(0,n.jsx)(e.code,{children:\"tsc\"}),\".\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-diff\",children:(0,n.jsxs)(e.code,{className:\"language-diff code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`// package.json\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:` \"scripts\": {\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`   \"tsc\": \"tsc\"\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:` }\n`})]})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token inserted-sign inserted\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Then run:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# compile `/src`\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),` tsc\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"You should see an \",(0,n.jsx)(e.code,{children:\"index.js\"}),\" file in the \",(0,n.jsx)(e.code,{children:\"/bin\"}),\" directory.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Let's execute the \",(0,n.jsx)(e.code,{children:\"/bin\"}),\" directory from the project root,\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"node\"}),` bin\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token comment\",children:[\"# Hello from my-script \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"waving hand\",children:\"\\u{1F44B}\"})]}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h3,{id:\"configuring-eslint\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#configuring-eslint\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Configuring ESLint\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Now we ready for \",(0,n.jsx)(e.a,{href:\"https://eslint.org/\",children:\"ESLint\"}),\". We can go ahead and install it:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),` --dev eslint\n`]})})}),`\n`,(0,n.jsxs)(e.p,{children:[`ESLint is a very powerful linter.\nIt doesn't come with TypeScript support so we'll install a `,(0,n.jsx)(e.a,{href:\"https://github.com/typescript-eslint/typescript-eslint/tree/6e159ee7cf8ef2028792cb8ee636cf6143fa967f/packages/parser\",children:\"TypeScript parser\"}),\":\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),` --dev @typescript-eslint/parser @typescript-eslint/eslint-plugin\n`]})})}),`\n`,(0,n.jsxs)(e.p,{children:[\"We also installed the \",(0,n.jsx)(e.a,{href:\"https://github.com/typescript-eslint/typescript-eslint/tree/6e159ee7cf8ef2028792cb8ee636cf6143fa967f/packages/eslint-plugin\",children:(0,n.jsx)(e.code,{children:\"@typescript-eslint/eslint-plugin\"})}),`.\nThis is because we'll need it to extend the ESLint rules for TypeScript-specific features.`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Let's configure eslint in the project. We'll create a \",(0,n.jsx)(e.code,{children:\".eslintrc.js\"}),\" at the project root:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"touch\"}),` .eslintrc.js\n`]})})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Inside \",(0,n.jsx)(e.code,{children:\".eslintrc.js\"}),\", we can configure eslint as following:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"language-js code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// .eslintrc.js\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"module\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"exports\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"parser\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'@typescript-eslint/parser'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"plugins\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'@typescript-eslint'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"extends\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'plugin:@typescript-eslint/recommended'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"To understand the configuration a little more, we first used \",(0,n.jsx)(e.code,{children:\"@typescript-eslint/parser\"}),` to enable ESLint's ability to understand TypeScript syntax.\nThen we applied `,(0,n.jsx)(e.code,{children:\"@typescript-eslint/eslint-plugin\"}),` plugin to extend the rules.\nFinally we enabled all the recommended rules form `,(0,n.jsx)(e.code,{children:\"@typescript-eslint/eslint-plugin\"}),\".\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"If you're interested in learning more about the configuration, you can checkout the \",(0,n.jsx)(e.a,{href:\"https://github.com/typescript-eslint/typescript-eslint/tree/main/packages/eslint-plugin#usage\",children:\"official doc\"}),\" for more details.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"We can now add a linting script to \",(0,n.jsx)(e.code,{children:\"package.json\"}),\":\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-diff\",children:(0,n.jsxs)(e.code,{className:\"language-diff code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`// package.json\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`{\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token unchanged\",children:[(0,n.jsx)(e.span,{className:\"token prefix unchanged\",children:\" \"}),(0,n.jsx)(e.span,{className:\"token line\",children:` \"scripts\": {\n`})]})}),(0,n.jsxs)(e.span,{className:\"code-line inserted\",children:[(0,n.jsx)(e.span,{className:\"token unchanged\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`    \"lint\": \"eslint '**/*.{js,ts}' --fix\",\n`})]})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token inserted-sign inserted\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),(0,n.jsxs)(e.span,{className:\"token unchanged\",children:[(0,n.jsx)(e.span,{className:\"token prefix unchanged\",children:\" \"}),(0,n.jsx)(e.span,{className:\"token line\",children:` }\n`})]})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token unchanged\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),`}\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"To run the script:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),` lint\n`]})})}),`\n`,(0,n.jsxs)(e.h3,{id:\"configuring-prettier\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#configuring-prettier\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Configuring Prettier\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://prettier.io/\",children:\"Prettier\"}),` is a very powerful formatter.\nIt comes with a set of rules to format our code.\nSometimes the rules can conflict with ESLint rules so I'll show you how to configure them.`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"First install Prettier and create a \",(0,n.jsx)(e.code,{children:\".prettierrc.json\"}),\" file at the project root to hold the configuration,\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),\" --dev --exact prettier \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"touch\"}),` .prettierrc.json\n`]})})}),`\n`,(0,n.jsxs)(e.p,{children:[\"You can edit \",(0,n.jsx)(e.code,{children:\".prettierrc.json\"}),` and add your custom rules.\nYou can find `,(0,n.jsx)(e.a,{href:\"https://prettier.io/docs/en/options.html\",children:\"the options in the official doc\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Here's an example:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-json\",children:(0,n.jsxs)(e.code,{className:\"language-json code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// .prettierrc.json\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"trailingComma\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"all\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token property\",children:'\"singleQuote\"'}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"true\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[`Prettier provides handy integration with ESLint.\nWe'll follow the `,(0,n.jsx)(e.a,{href:\"https://github.com/prettier/eslint-plugin-prettier#recommended-configuration\",children:\"recommended configuration\"}),\" from the official doc.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),` --dev eslint-config-prettier eslint-plugin-prettier\n`]})})}),`\n`,(0,n.jsxs)(e.p,{children:[\"We'll add the plugin at the last position in the \",(0,n.jsx)(e.code,{children:\"extensions\"}),\" array.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-diff\",children:(0,n.jsxs)(e.code,{className:\"language-diff code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`// .eslintrc.js\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`module.exports = {\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token unchanged\",children:[(0,n.jsx)(e.span,{className:\"token prefix unchanged\",children:\" \"}),(0,n.jsx)(e.span,{className:\"token line\",children:` extends: [\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token unchanged\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix unchanged\",children:\" \"}),(0,n.jsx)(e.span,{className:\"token line\",children:`   'plugin:@typescript-eslint/recommended',\n`})]})}),(0,n.jsxs)(e.span,{className:\"code-line inserted\",children:[(0,n.jsx)(e.span,{className:\"token unchanged\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`    'plugin:prettier/recommended',\n`})]})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token inserted-sign inserted\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),(0,n.jsxs)(e.span,{className:\"token unchanged\",children:[(0,n.jsx)(e.span,{className:\"token prefix unchanged\",children:\" \"}),(0,n.jsx)(e.span,{className:\"token line\",children:` ],\n`})]})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token unchanged\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),`}\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:`It's very important that Prettier is the last extension.\nBy applying last, it disables all formatting-related ESLint rules so the conflicts will fall back to Prettier.`}),`\n`,(0,n.jsxs)(e.p,{children:[\"We can now add a \",(0,n.jsx)(e.code,{children:\"prettier\"}),\" script to \",(0,n.jsx)(e.code,{children:\"package.json\"}),\":\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-diff\",children:(0,n.jsxs)(e.code,{className:\"language-diff code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`// package.json\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`{\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token unchanged\",children:[(0,n.jsx)(e.span,{className:\"token prefix unchanged\",children:\" \"}),(0,n.jsx)(e.span,{className:\"token line\",children:` \"scripts\": {\n`})]})}),(0,n.jsxs)(e.span,{className:\"code-line inserted\",children:[(0,n.jsx)(e.span,{className:\"token unchanged\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`    \"prettier\": \"prettier --write .\"\n`})]})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token inserted-sign inserted\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),(0,n.jsxs)(e.span,{className:\"token unchanged\",children:[(0,n.jsx)(e.span,{className:\"token prefix unchanged\",children:\" \"}),(0,n.jsx)(e.span,{className:\"token line\",children:` }\n`})]})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token unchanged\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),`}\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"To run the script:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),` prettier\n`]})})}),`\n`,(0,n.jsxs)(e.h3,{id:\"configuring-packagejson\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#configuring-packagejson\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Configuring \",(0,n.jsx)(e.code,{children:\"package.json\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[`We are almost ready with our configuration.\nThe only thing missing is a way to execute the project the way you would execute a command.\nInstead of executing the `,(0,n.jsx)(e.code,{children:\"/bin\"}),\" with \",(0,n.jsx)(e.code,{children:\"node\"}),\", we want to be able to call the command directly:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:'# instead of \"node bin\", we want to call the command by its name like this:'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`$ my-script\n`})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"How do we do that? First we need to add a \",(0,n.jsx)(e.a,{href:\"https://en.wikipedia.org/wiki/Shebang_(Unix)\",children:\"Shebang\"}),\" on the top of our \",(0,n.jsx)(e.code,{children:\"src/index.ts\"}),\".\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-diff\",children:(0,n.jsxs)(e.code,{className:\"language-diff code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:` #!/usr/bin/env node\n`})]})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token inserted-sign inserted\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"console.log('Hello from my-script\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"waving hand\",children:\"\\u{1F44B}\"}),`')\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[`The Shebang is to inform Unix-like operating systems that this is NodeJS executable.\nSo we can call the script directly without specifying `,(0,n.jsx)(e.code,{children:\"node\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Let's compile again,\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),` tsc\n`]})})}),`\n`,(0,n.jsxs)(e.p,{children:[\"There's another thing we need before it all works. We need to assign the executable right to the \",(0,n.jsx)(e.code,{children:\"bin/index.js\"}),\":\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"chmod\"}),` u+x ./bin/index.js\n`]})})}),`\n`,(0,n.jsx)(e.p,{children:\"Let's give it a go:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# execute directly\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`$ ./bin/index.js\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token comment\",children:[\"# Hello from my-script\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"waving hand\",children:\"\\u{1F44B}\"})]}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[`Nice, we are almost there.\nThe last thing is to create a symlink between the command and the executable.\nFirst, we need to specify the `,(0,n.jsx)(e.code,{children:\"bin\"}),\" property in \",(0,n.jsx)(e.code,{children:\"package.json\"}),\" and point the command to the \",(0,n.jsx)(e.code,{children:\"bin/index.js\"}),\".\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-diff\",children:(0,n.jsxs)(e.code,{className:\"language-diff code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`// package.json\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`{\n`}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`  \"bin\": {\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`    \"my-script\": \"./bin/index.js\"\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`  }\n`})]})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token inserted-sign inserted\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),`}\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Second, create a symlink with Yarn at the project root:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"link\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:'# You can always unlink: \"yarn unlink my-script\"'}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Let's see if it works\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"\",\"aria-hidden\":!0,children:\"\\u{1F929}\"})]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`$ my-script\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token comment\",children:[\"# Hello from my-script\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"waving hand\",children:\"\\u{1F44B}\"})]}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"It works\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"party popper\",children:\"\\u{1F389}\"}),(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"party popper\",children:\"\\u{1F389}\"}),(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"party popper\",children:\"\\u{1F389}\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Just to make the development easier, we'll add a couple of scripts in \",(0,n.jsx)(e.code,{children:\"package.json\"}),\":\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-diff\",children:(0,n.jsxs)(e.code,{className:\"language-diff code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`// package.json\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`{\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token unchanged\",children:[(0,n.jsx)(e.span,{className:\"token prefix unchanged\",children:\" \"}),(0,n.jsx)(e.span,{className:\"token line\",children:` \"scripts\": {\n`})]})}),(0,n.jsxs)(e.span,{className:\"code-line inserted\",children:[(0,n.jsx)(e.span,{className:\"token unchanged\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`    \"build\": \"yarn tsc \u0026\u0026 yarn chmod\",\n`})]})]}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`    \"chmod\": \"chmod u+x ./bin/index.js\",\n`})]})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token inserted-sign inserted\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),(0,n.jsxs)(e.span,{className:\"token unchanged\",children:[(0,n.jsx)(e.span,{className:\"token prefix unchanged\",children:\" \"}),(0,n.jsx)(e.span,{className:\"token line\",children:` }\n`})]})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token unchanged\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),`}\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Now we can run \",(0,n.jsx)(e.code,{children:\"yarn build\"}),\" to compile and automatically assign the executable right to the entry file.\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"writing-a-cli-to-run-lighthouse\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#writing-a-cli-to-run-lighthouse\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Writing a CLI to Run Lighthouse\"]}),`\n`,(0,n.jsx)(e.p,{children:`It's time to implement our core logic.\nWe'll explore a few handy npm packages to help us write the CLI and we'll dive into the magic of Lighthouse.`}),`\n`,(0,n.jsxs)(e.h3,{id:\"coloring-consolelog-with-chalk\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#coloring-consolelog-with-chalk\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Coloring \",(0,n.jsx)(e.code,{children:\"console.log\"}),\" with \",(0,n.jsx)(e.code,{children:\"chalk\"})]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),` chalk@4.1.2\n`]})})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Make sure you are installing \",(0,n.jsx)(e.code,{children:\"chalk 4\"}),\". \",(0,n.jsxs)(e.a,{href:\"https://github.com/chalk/chalk/releases/tag/v5.0.0\",children:[(0,n.jsx)(e.code,{children:\"chalk 5\"}),\" is pure ESM\"]}),\" and we won't be able to use it with TypeScript \",(0,n.jsx)(e.a,{href:\"https://github.com/microsoft/TypeScript/issues/46452\",children:\"until TypeScript 4.6 is released\"}),\".\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/chalk/chalk\",children:(0,n.jsx)(e.code,{children:\"chalk\"})}),\" gives colors to your \",(0,n.jsx)(e.code,{children:\"console.log\"}),\". For example:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"language-ts code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// src/index.ts\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" chalk \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'chalk'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token builtin\",children:\"console\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"log\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"chalk\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"green\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string\",children:[\"'Hello from my-script\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"waving hand\",children:\"\\u{1F44B}\"}),\"'\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Now run \",(0,n.jsx)(e.code,{children:\"yarn build \u0026\u0026 my-script\"}),\" at your project root and see the log.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Let's use \",(0,n.jsx)(e.code,{children:\"chalk\"}),` in a more meaningful way.\n`,(0,n.jsx)(e.a,{href:\"https://web.dev/performance-scoring/#color-coding\",children:\"Lighthouse performane scores are color coded\"}),`.\nWe can write a utility function that shows the display value with a color based on the performance score.`]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"language-ts code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// src/utils.ts\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" chalk \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'chalk'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:`/**\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:` * Coloring display value based on Lighthouse score.\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:` *\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:` * - 0 to 0.49 (red): Poor\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:` * - 0.5 to 0.89 (orange): Needs Improvement\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token comment\",children:` * - 0.9 to 1 (green): Good\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\" */\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"draw\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"score\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"number\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" value\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"number\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"score \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0.9\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" score \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"1\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" chalk\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"green\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"${\"}),\"value\",(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\" (Good)\"}),(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"score \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e=\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0.5\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" score \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"0.9\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" chalk\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"yellow\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"${\"}),\"value\",(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\" (Needs Improvement)\"}),(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" chalk\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"red\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"${\"}),\"value\",(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\" (Poor)\"}),(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Use it in \",(0,n.jsx)(e.code,{children:\"src/index.ts\"}),\" and try log something with \",(0,n.jsx)(e.code,{children:\"draw()\"}),\" to see the result.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"language-ts code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// src/index.ts\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" draw \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'./utils'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token builtin\",children:\"console\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"log\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"Perf score is \"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"${\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"draw\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"0.64\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"64\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h3,{id:\"designing-a-command-with-commander\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#designing-a-command-with-commander\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Designing A Command with \",(0,n.jsx)(e.code,{children:\"commander\"})]}),`\n`,(0,n.jsxs)(e.p,{children:[`To make our CLI interactive, we need to be able to read user inputs and parse them.\n`,(0,n.jsx)(e.a,{href:\"https://github.com/tj/commander.js\",children:(0,n.jsx)(e.code,{children:\"commander\"})}),` is a descriptive way of defining a interface.\nWe can implement our interface in a very clean and documentary fashion.`]}),`\n`,(0,n.jsx)(e.p,{children:`How do we want the users to interact with the CLI is to simply pass a URL for Lighthouse to run.\nWe also want to pass in an option to specify how many times Lighthouse should run on the URL.\nLike this:`}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# without an option\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`$ my-script https://dawchihliou.github.io/\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# with an option\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ my-script https://dawchihliou.github.io/ --iteration\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Let's see how quickly we can implement our design with \",(0,n.jsx)(e.code,{children:\"commander\"}),\".\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),` commander\n`]})})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Let's clear the \",(0,n.jsx)(e.code,{children:\"src/index.ts\"}),\" and start fresh:\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.code,{children:\"src/index.ts\"})}),`\n`,(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"language-ts code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token hashbang comment\",children:\"#!/usr/bin/env node\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" Command \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'commander'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" program \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Command\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`  program\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"argument\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'\u003curl\u003e'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'Lighthouse will run the analysis on the URL.'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"option\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'-i, --iteration \u003ctype\u003e'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'How many times Lighthouse should run the analysis per URL'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'5'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"parse\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" program\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),`args\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" options \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" program\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"opts\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"console\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"log\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token template-string\",children:[(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"url: \"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"${\"}),\"url\",(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\", iteration: \"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"${\"}),\"options\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"iteration\",(0,n.jsx)(e.span,{className:\"token interpolation-punctuation punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token template-punctuation string\",children:\"`\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"We first instantiated a \",(0,n.jsx)(e.code,{children:\"Command\"}),\" and we used the instance \",(0,n.jsx)(e.code,{children:\"program\"}),\" to define:\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"an \",(0,n.jsx)(e.a,{href:\"https://github.com/tj/commander.js#command-arguments\",children:(0,n.jsx)(e.code,{children:\"required argument\"})}),\": we gave it a name \",(0,n.jsx)(e.code,{children:\"url\"}),\" and a description\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"an \",(0,n.jsx)(e.a,{href:\"https://github.com/tj/commander.js#options\",children:(0,n.jsx)(e.code,{children:\"option\"})}),\": we gave it a short flag and a long flag, a description, and a default value\"]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"To consume the argument and option, we first parse the command and log the variables.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Now we can run the command and observe the log.\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),` build\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# without an option\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`$ my-script https://dawchihliou.github.io/\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# url: https://dawchihliou.github.io/, iteration: 5\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# with an option\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ my-script https://dawchihliou.github.io/ --iteration\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# or\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ my-script https://dawchihliou.github.io/ -i \",(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# url: https://dawchihliou.github.io/, iteration: 3\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[`Very cool right?!\nAnother cool feature is that `,(0,n.jsx)(e.code,{children:\"commander\"}),\" automatically generates a \",(0,n.jsx)(e.a,{href:\"https://github.com/tj/commander.js#automated-help\",children:(0,n.jsx)(e.code,{children:\"help\"})}),\" to print the help information.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`$ my-script --help\n`})})}),`\n`,(0,n.jsxs)(e.h3,{id:\"running-multiple-lighthouse-analyses-in-separate-os-processes\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#running-multiple-lighthouse-analyses-in-separate-os-processes\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Running Multiple Lighthouse Analyses in Separate OS Processes\"]}),`\n`,(0,n.jsx)(e.p,{children:\"We learned how to parse user inputs in the previous section. It's time to dive into the core of the CLI.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"The recommendation for running multiple Lighthouse is to run them in \",(0,n.jsx)(e.a,{href:\"https://github.com/GoogleChrome/lighthouse/issues/7187\",children:\"separate processes\"}),` to remove the risk of interference.\n`,(0,n.jsx)(e.a,{href:\"https://github.com/moxystudio/node-cross-spawn\",children:(0,n.jsx)(e.code,{children:\"cross-spawn\"})}),` is a cross platform solution for spawning processes.\nWe will use it to synchronously spawn new processes to run Lighthouse.`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"To install \",(0,n.jsx)(e.code,{children:\"cross-spawn\"}),\":\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),` cross-spawn\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),` --dev @types/cross-spawn\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token comment\",children:[\"# Let's install lighthouse too\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"sparkles\",children:\"\\u2728\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),` lighthouse\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Let's edit \",(0,n.jsx)(e.code,{children:\"src/index.ts\"}),\":\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-diff\",children:(0,n.jsxs)(e.code,{className:\"language-diff code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`import { Command } from 'commander'\n`}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:` import spawn from 'cross-spawn'\n`})]})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token inserted-sign inserted\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:` const lighthouse = require.resolve('lighthouse/lighthouse-cli')\n`})]})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token inserted-sign inserted\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`async function run() {\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token unchanged\",children:[(0,n.jsx)(e.span,{className:\"token prefix unchanged\",children:\" \"}),(0,n.jsx)(e.span,{className:\"token line\",children:` // ...\n`})]})}),(0,n.jsxs)(e.span,{className:\"code-line deleted\",children:[(0,n.jsx)(e.span,{className:\"token unchanged\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),(0,n.jsxs)(e.span,{className:\"token deleted-sign deleted\",children:[(0,n.jsx)(e.span,{className:\"token prefix deleted\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token line\",children:\"  console.log(`url: ${url}, iteration: ${options.iteration}`)\\n\"})]})]}),(0,n.jsxs)(e.span,{className:\"code-line inserted\",children:[(0,n.jsx)(e.span,{className:\"token deleted-sign deleted\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`  console.log(\n`})]})]}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsxs)(e.span,{className:\"token line\",children:[\"    `\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"Tokyo tower\",children:\"\\u{1F5FC}\"}),\" Running Lighthouse for ${url}. It will take a while, please wait...`\\n\"]})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`  )\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`  const results = []\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`  for (let i = 0; i \u003c options.iteration; i++) {\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`    const { status, stdout } = spawn.sync(\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`      process.execPath, [\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`      lighthouse,\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`      url,\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`      '--output=json',\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`      '--chromeFlags=--headless',\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`      '--only-categories=performance',\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`    ])\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`    if (status !== 0) {\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`      continue\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`    }\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`    results.push(JSON.parse(stdout.toString()))\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`  }\n`})]})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token inserted-sign inserted\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),`}\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[`In the code, we spawn new processes multiple times based on user input.\nIn each process, we ran Lighthouse performance analysis with headless Chrome and collect the the JSON data.\nThe `,(0,n.jsx)(e.code,{children:\"result\"}),` variable will hold an array of independent performance data in string.\nThe next step is to aggregate the data and calculate the most reliable performance scores.`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"If you implement the code above, you'll see a linting error about \",(0,n.jsx)(e.code,{children:\"require\"}),`.\n`,(0,n.jsx)(e.code,{children:\"require.resolve\"}),` resolves the path to a module instead of the module itself.\nIn this article, we'll allow the `,(0,n.jsx)(e.code,{children:\"@typescript-eslint/no-var-requires\"}),\" rule in \",(0,n.jsx)(e.code,{children:\".eslintrc.js\"}),\" to compile.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-diff\",children:(0,n.jsxs)(e.code,{className:\"language-diff code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`// .eslintrc.js\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`module.exports = {\n`}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`  rules: {\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`    // allow require\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`    '@typescript-eslint/no-var-requires': 0,\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`  },\n`})]})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token inserted-sign inserted\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),`}\n`]})]})}),`\n`,(0,n.jsxs)(e.h3,{id:\"calculating-reliable-lighthouse-scores\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#calculating-reliable-lighthouse-scores\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Calculating Reliable Lighthouse Scores\"]}),`\n`,(0,n.jsxs)(e.p,{children:[`One strategy is to aggregate the reports by calculating the median.\nLighthouse provide a internal functionality `,(0,n.jsx)(e.a,{href:\"https://github.com/GoogleChrome/lighthouse/blob/master/lighthouse-core/lib/median-run.js\",children:(0,n.jsx)(e.code,{children:\"computeMedianRun\"})}),`.\nLet's use it`]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-diff\",children:(0,n.jsxs)(e.code,{className:\"language-diff code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`// src/index.ts\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:` // For simplicity, we use require here because lighthouse doesn't provide type declaration.\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:` const {\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`   computeMedianRun,\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:` } = require('lighthouse/lighthouse-core/lib/median-run.js')\n`})]})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token inserted-sign inserted\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`async function run() {\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token unchanged\",children:[(0,n.jsx)(e.span,{className:\"token prefix unchanged\",children:\" \"}),(0,n.jsx)(e.span,{className:\"token line\",children:` // ...\n`})]})}),(0,n.jsxs)(e.span,{className:\"code-line inserted\",children:[(0,n.jsx)(e.span,{className:\"token unchanged\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`   const median = computeMedianRun(results)\n`})]})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token inserted-sign inserted\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:\"   console.log(`\\\\n${chalk.green('\\u2714')} Report is ready for ${median.finalUrl}`)\\n\"})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`   console.log(\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsxs)(e.span,{className:\"token line\",children:[\"     `\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"Tokyo tower\",children:\"\\u{1F5FC}\"}),\" Median performance score: ${draw(\\n\"]})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`       median.categories.performance.score,\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`       median.categories.performance.score * 100\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:\"     )}`\\n\"})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`   )\n`})]})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token inserted-sign inserted\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`   const primaryMatrices = [\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`     'first-contentful-paint',\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`     'interactive',\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`     'speed-index',\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`     'total-blocking-time',\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`     'largest-contentful-paint',\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`     'cumulative-layout-shift',\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`   ]\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`   primaryMatrices.map((matrix) =\u003e {\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`     const { title, displayValue, score } = median.audits[matrix]\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsxs)(e.span,{className:\"token line\",children:[\"     console.log(`\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"Tokyo tower\",children:\"\\u{1F5FC}\"}),\" Median ${title}: ${draw(score, displayValue)}`)\\n\"]})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`   })\n`})]})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token inserted-sign inserted\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),`}\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Under the hood, \",(0,n.jsx)(e.code,{children:\"computeMedianRun\"}),` returns the score that's closest to the median of the First Contentful Paint and the median of the Time to Interactive.\nIt's because they represent the earliest and the latest moments in the page initialization lifecycle.\nIt's a more reliable way to determine the median than the naive approach by finding the median from a single measurement.`]}),`\n`,(0,n.jsx)(e.p,{children:\"Now try the command again and see the result!\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),\" build \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\u0026\"}),\" my-script https://dawchihliou.github.io --iteration\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"3\"}),`\n`]})})}),`\n`,(0,n.jsx)(\"img\",{src:\"/optimized/articles/writing-your-own-typescript-cli/command-line.webp\",alt:\"Screenshot of my-script final output\",width:\"100%\",loading:\"lazy\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Walla\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"party popper\",children:\"\\u{1F389}\"})]}),`\n`,(0,n.jsxs)(e.h2,{id:\"using-the-cli-in-github-actions\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#using-the-cli-in-github-actions\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Using the CLI in GitHub Actions\"]}),`\n`,(0,n.jsx)(e.p,{children:`Our implementation is done.\nLet's use the CLI in an automated workflow so we can benchmark the performance in a CD/CI pipeline.`}),`\n`,(0,n.jsx)(e.p,{children:\"First, let's publish the package on npm (hypothetically).\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"I published a npm package \",(0,n.jsx)(e.strong,{children:(0,n.jsx)(e.a,{href:\"https://github.com/DawChihLiou/dx-scripts/\",children:(0,n.jsx)(e.code,{children:\"dx-scripts\"})})}),\" that includes the production-ready version of \",(0,n.jsx)(e.code,{children:\"my-script\"}),`.\nWe will write the GitHub Actions workflow with `,(0,n.jsx)(e.code,{children:\"dx-scripts\"}),\" to illustrate.\"]}),`\n`,(0,n.jsxs)(e.h3,{id:\"publishing-on-npm-an-example\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#publishing-on-npm-an-example\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Publishing on npm (an example)\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"We'll add a \",(0,n.jsx)(e.code,{children:\"files\"}),\" property in \",(0,n.jsx)(e.code,{children:\"package.json\"}),\" to publish the \",(0,n.jsx)(e.code,{children:\"/bin\"}),\" directory.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-diff\",children:(0,n.jsxs)(e.code,{className:\"language-diff code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`// package.json\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`{\n`}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:`  \"files\": [\"bin\"],\n`})]})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token inserted-sign inserted\",children:(0,n.jsx)(e.span,{className:\"token line\"})}),`}\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Then simply run:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),` publish\n`]})})}),`\n`,(0,n.jsx)(e.p,{children:\"Now the package is on npm (hypothetically)!\"}),`\n`,(0,n.jsxs)(e.h3,{id:\"writing-a-workflow\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#writing-a-workflow\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Writing A Workflow\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Let's discuss the workflow. We want the workflow to:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"run on a pull request when there's an update\"}),`\n`,(0,n.jsx)(e.li,{children:\"run the Lighthouse performance analysis against a feature branch preview URL\"}),`\n`,(0,n.jsx)(e.li,{children:\"notify the pull request with the analysis report\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"So after the workflow is successfully completed, you'll see a comment from GitHub Action Bot with your Lighthouse scores.\"}),`\n`,(0,n.jsx)(e.p,{children:\"To focus on the application of our CLI, I'll hard-code the feature branch preview URL in the workflow.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"In your application repository, install \",(0,n.jsx)(e.code,{children:\"dx-scripts\"}),\":\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"$ \",(0,n.jsx)(e.span,{className:\"token function\",children:\"yarn\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"add\"}),` --dev dx-scripts\n`]})})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Add a \",(0,n.jsx)(e.code,{children:\"lighthouse-dev-ci.yaml\"}),\" to your GitHub workflows directory:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# .github/workflows/lighthouse-dev-ci.yaml\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Lighthouse CI\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"on\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` pull_request\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"jobs\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"lighthouse\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"runs-on\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" ubuntu\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`latest\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"env\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# You can substitute the hardcoded preview url with your preview url\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"preview_url\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" https\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`//dawchihliou.github.io/\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"steps\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"uses\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` actions/checkout@v2\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"uses\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" actions/setup\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`node@v1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"with\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"node-version\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'16.x'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Install dependencies\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` yarn\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# You can add your steps here to create a preview\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Run Lighthouse\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` lighthouse\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"shell\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` bash\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token scalar string\",children:`\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:`          lighthouse=$(npx dx-scripts lighthouse $preview_url)\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:`          lighthouse=\"\\${lighthouse//'%'/'%25'}\"\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:`          lighthouse=\"\\${lighthouse//$'\\\\n'/'%0A'}\"\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:`          lighthouse=\"\\${lighthouse//$'\\\\r'/'%0D'}\"\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token scalar string\",children:'          echo \"::set-output name=lighthouse_report::$lighthouse\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Notify PR\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"uses\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" wow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"actions/auto\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`comment@v1\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"with\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"GITHUB_TOKEN\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" $\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" secrets.GITHUB_TOKEN \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"pullRequestSynchronize\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token scalar string\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token scalar string\",children:[\"            \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"waving hand\",children:\"\\u{1F44B}\"}),\" @{{ author }},\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            Here is your Lighthouse performance overview\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"party popper\",children:\"\\u{1F389}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:\"            ```\\n\"}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            $\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" steps.lighthouse.outputs.lighthouse_report \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:\"            ```\\n\"})]})}),`\n`,(0,n.jsxs)(e.p,{children:['In the \"Run Lighthouse\" step, we ran the ',(0,n.jsx)(e.code,{children:\"dx-script lighthouse\"}),\" CLI, substitute the special characters in order to print multi-line output, and we set the output in a variable \",(0,n.jsx)(e.code,{children:\"lighthouse_report\"}),`.\nIn the \"Notify PR\" step, we wrote a comment with the output from the \"Run Lighthouse\" step and use the `,(0,n.jsxs)(e.a,{href:\"https://github.com/marketplace/actions/auto-comment\",children:[(0,n.jsx)(e.code,{children:\"wow-actions/auto-comment\"}),\" \"]}),\" action to post the comment.\"]}),`\n`,(0,n.jsx)(\"img\",{src:\"/optimized/articles/writing-your-own-typescript-cli/pr-comment.webp\",alt:\"Screenshot of a PR comment posted from the Lighthouse CI\",width:\"100%\",loading:\"lazy\"}),`\n`,(0,n.jsx)(e.p,{children:`That's it! What a journey\\u200D.\nIt's amazing that you followed all the way through.`}),`\n`,(0,n.jsxs)(e.h2,{id:\"to-sum-up\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#to-sum-up\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"To Sum up\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Writing a CLI is not too hard, right?\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"smiling face with sunglasses\",children:\"\\u{1F60E}\"}),`\nLet's have a look at all the things we've covered:`]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"configuring TypeScript\"}),`\n`,(0,n.jsx)(e.li,{children:\"configuring ESLint\"}),`\n`,(0,n.jsx)(e.li,{children:\"configuring Prettier\"}),`\n`,(0,n.jsx)(e.li,{children:\"executing your command locally\"}),`\n`,(0,n.jsxs)(e.li,{children:[\"coloring logs with \",(0,n.jsx)(e.code,{children:\"chalk\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"defining your command with \",(0,n.jsx)(e.code,{children:\"commander\"})]}),`\n`,(0,n.jsx)(e.li,{children:\"spawning processes\"}),`\n`,(0,n.jsx)(e.li,{children:\"executing Lighthouse CLI\"}),`\n`,(0,n.jsx)(e.li,{children:\"using Lighthouse's internal library to calculate median performance scores\"}),`\n`,(0,n.jsx)(e.li,{children:\"publish your command as a npm package\"}),`\n`,(0,n.jsx)(e.li,{children:\"applying your command to a GitHub Action workflow\"}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Now the super power is yours too\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"rocket\",children:\"\\u{1F680}\"})]}),`\n`,(0,n.jsx)(e.hr,{}),`\n`,(0,n.jsxs)(e.p,{children:[\"Here you have it! I hope you find it useful. Thanks for reading through\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"raising hands\",children:\"\\u{1F64C}\"})]}),`\n`,(0,n.jsx)(e.p,{children:\"Please share this article so that more people who're looking for inspirations can see it.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Feel free to connect with me on \",(0,n.jsx)(e.a,{href:\"https://twitter.com/dawchihliou\",children:\"twitter\"}),\"!\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"If you're interested in reading more about image optimization to boost your performance score, take a look at my previous article \",(0,n.jsx)(e.a,{href:\"/articles/use-webp-for-better-ux\",children:'\"Using WebP for Better User Experience\"'}),`.\nThere we discussed one of the modern image formats that greatly reduces the size of your images without sacrificing quality.`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"If you're wondering how to test Redux Observable, I wrote an article \",(0,n.jsx)(e.a,{href:\"https://itnext.io/better-marble-test-70c7676a1e2\",children:'\"Writing Better Marble Tests for Redux Observable and TypeScript\"'}),` just for you.\nIt's a comprehensive guide to walk you through the thought process.`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"If you\\u2019re a fan of functional programming, check out \",(0,n.jsx)(e.a,{href:\"https://medium.com/@dawchihliou/intuitive-transducer-in-javascript-f358d3fe53d\",children:\"this article that I wrote about Transducers\"}),`.\nIt\\u2019s a step by step reasoning on writing a transducer and it touches on key ideas about functional programming.`]}),`\n`,(0,n.jsx)(e.p,{children:\"Happy coding!\"})]});return s?(0,n.jsx)(s,Object.assign({},a,{children:i})):i}var y=f;return w;})();\n;return Component.default;"},"_id":"articles/writing-your-own-typescript-cli.mdx","_raw":{"sourceFilePath":"articles/writing-your-own-typescript-cli.mdx","sourceFileName":"writing-your-own-typescript-cli.mdx","sourceFileDir":"articles","bodyType":"mdx","flattenedPath":"articles/writing-your-own-typescript-cli"},"type":"Article","readingTime":{"text":"16 min read","minutes":15.54,"time":932400,"words":3108},"wordCount":3110,"slug":"writing-your-own-typescript-cli"}},"__N_SSG":true},"page":"/articles/[slug]","query":{"slug":"writing-your-own-typescript-cli"},"buildId":"wAbJRElSnzz9Ta5bSlIBr","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>