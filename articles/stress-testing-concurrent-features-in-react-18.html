<!DOCTYPE html><html lang="en"><head><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/svg" sizes="32x32" href="/favicon.svg"/><link rel="icon" type="image/svg" sizes="16x16" href="/favicon.svg"/><link rel="mask-icon" href="/favicon.svg" color="#ffffff"/><link rel="manifest" href="/site.webmanifest"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><meta name="msapplication-TileColor" content="#007cf0"/><meta name="theme-color" content="#ffff"/><title>Stress Testing Concurrent Features in React 18: A Case Study of startTransition &amp; 3D Rendering</title><meta name="description" content="React 18 released the highly anticipated concurrent features. In this article, we are diving into a 3D visualization and discuss how to optimize its performance step by step with React 18&#x27;s concurrent rendering."/><meta name="robots" content="follow, index"/><link rel="canonical" href="https://dawchihliou.github.io/articles/stress-testing-concurrent-features-in-react-18"/><meta itemProp="name" content="Stress Testing Concurrent Features in React 18: A Case Study of startTransition &amp; 3D Rendering"/><meta itemProp="description" content="React 18 released the highly anticipated concurrent features. In this article, we are diving into a 3D visualization and discuss how to optimize its performance step by step with React 18&#x27;s concurrent rendering."/><meta itemProp="image" content="https://dawchihliou.github.io/optimized/articles/concurrent-react-18/hero.png"/><meta property="og:title" content="Stress Testing Concurrent Features in React 18: A Case Study of startTransition &amp; 3D Rendering"/><meta property="og:type" content="website"/><meta property="og:url" content="https://dawchihliou.github.io/articles/stress-testing-concurrent-features-in-react-18"/><meta property="og:description" content="React 18 released the highly anticipated concurrent features. In this article, we are diving into a 3D visualization and discuss how to optimize its performance step by step with React 18&#x27;s concurrent rendering."/><meta property="og:image" content="https://dawchihliou.github.io/optimized/articles/concurrent-react-18/hero.png"/><meta property="og:image:type" content="image/png"/><meta property="og:image:width" content="1400"/><meta property="og:image:height" content="600"/><meta property="og:image:alt" content="React 18 released the highly anticipated concurrent features. In this article, we are diving into a 3D visualization and discuss how to optimize its performance step by step with React 18&#x27;s concurrent rendering."/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@dawchihliou"/><meta name="twitter:creator" content="@dawchihliou"/><meta name="twitter:title" content="Stress Testing Concurrent Features in React 18: A Case Study of startTransition &amp; 3D Rendering"/><meta name="twitter:description" content="React 18 released the highly anticipated concurrent features. In this article, we are diving into a 3D visualization and discuss how to optimize its performance step by step with React 18&#x27;s concurrent rendering."/><meta name="twitter:image" content="https://dawchihliou.github.io/optimized/articles/concurrent-react-18/hero.webp"/><meta property="article:published_time" content="2022-05-30T00:00:00.000Z"/><meta property="article:section" content="Article Section"/><meta property="article:tag" content="Article Tag"/><meta name="next-head-count" content="34"/><link rel="preload" href="/_next/static/css/f4214c3b71874d65.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f4214c3b71874d65.css" data-n-g=""/><link rel="preload" href="/_next/static/css/54ba867c7255694d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/54ba867c7255694d.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-59c5c889f52620d6.js" defer=""></script><script src="/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/_next/static/chunks/main-010ff0b6bbe5ac8f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5784eb5f9f6cd23e.js" defer=""></script><script src="/_next/static/chunks/pages/articles/%5Bslug%5D-9a8f919cad4c24e6.js" defer=""></script><script src="/_next/static/tFhmm6xD3rE0bddb1eR6E/_buildManifest.js" defer=""></script><script src="/_next/static/tFhmm6xD3rE0bddb1eR6E/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div id="outer-container"><header><div><div class="bm-overlay" style="position:fixed;z-index:1000;width:100%;height:100%;background:rgba(0, 0, 0, 0.3);opacity:0;-moz-transform:translate3d(100%, 0, 0);-ms-transform:translate3d(100%, 0, 0);-o-transform:translate3d(100%, 0, 0);-webkit-transform:translate3d(100%, 0, 0);transform:translate3d(100%, 0, 0);transition:opacity 0.3s, transform 0s 0.3s"></div><div><div class="bm-burger-button" style="z-index:1000"><button id="react-burger-menu-btn" style="position:absolute;left:0;top:0;z-index:1;width:100%;height:100%;margin:0;padding:0;border:none;font-size:0;background:transparent;cursor:pointer">Open Menu</button><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="bm-icon" style="width:100%;height:100%" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div></div><div id="" class="bm-menu-wrap" style="position:fixed;right:inherit;z-index:1100;width:300px;height:100%;-moz-transform:translate3d(-100%, 0, 0);-ms-transform:translate3d(-100%, 0, 0);-o-transform:translate3d(-100%, 0, 0);-webkit-transform:translate3d(-100%, 0, 0);transform:translate3d(-100%, 0, 0);transition:all 0.5s" aria-hidden="true"><div class="bm-menu" style="height:100%;box-sizing:border-box;overflow:auto"><nav class="bm-item-list" style="height:100%"><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/"><button class="Nav_button__YJwKE" tabindex="-1">Home</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/articles"><button class="Nav_button__YJwKE" tabindex="-1">Articles</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/work"><button class="Nav_button__YJwKE" tabindex="-1">Work</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/now"><button class="Nav_button__YJwKE" tabindex="-1">Now</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/expertise"><button class="Nav_button__YJwKE" tabindex="-1">Expertise</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/contact"><button class="Nav_button__YJwKE" tabindex="-1">Contact</button></a><span class="bm-item Nav_pusher__93Gc6" style="display:block" tabindex="-1"></span><span class="bm-item Nav_divider__QD8Pt" style="display:block" tabindex="-1"></span><div class="bm-item Nav_profile__Kf2nU" style="display:block" tabindex="-1"><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/dawchihliou" aria-label="Link to Daw-Chih&#x27;s Linkedin profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M20.45175,20.45025 L16.89225,20.45025 L16.89225,14.88075 C16.89225,13.5525 16.86975,11.844 15.04275,11.844 C13.191,11.844 12.90825,13.2915 12.90825,14.7855 L12.90825,20.45025 L9.3525,20.45025 L9.3525,8.997 L12.765,8.997 L12.765,10.563 L12.81375,10.563 C13.2885,9.66225 14.4495,8.71275 16.18125,8.71275 C19.78575,8.71275 20.45175,11.08425 20.45175,14.169 L20.45175,20.45025 Z M5.33925,7.4325 C4.1955,7.4325 3.27375,6.50775 3.27375,5.36775 C3.27375,4.2285 4.1955,3.30375 5.33925,3.30375 C6.47775,3.30375 7.4025,4.2285 7.4025,5.36775 C7.4025,6.50775 6.47775,7.4325 5.33925,7.4325 L5.33925,7.4325 Z M7.11975,20.45025 L3.5565,20.45025 L3.5565,8.997 L7.11975,8.997 L7.11975,20.45025 Z M23.00025,0 L1.0005,0 C0.44775,0 0,0.44775 0,0.99975 L0,22.9995 C0,23.55225 0.44775,24 1.0005,24 L23.00025,24 C23.55225,24 24,23.55225 24,22.9995 L24,0.99975 C24,0.44775 23.55225,0 23.00025,0 L23.00025,0 Z"></path></svg></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou" aria-label="Link to Daw-Chih&#x27;s GitHub profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M11.9989871,1 C5.92550416,1 1,5.92482888 1,12.0003376 C1,16.8603395 4.15153934,20.9829338 8.52263728,22.4374904 C9.0729918,22.5387827 9.27355045,22.199116 9.27355045,21.9073943 C9.27355045,21.6467356 9.2640965,20.954572 9.25869425,20.0368642 C6.19899322,20.7013414 5.55342398,18.5620492 5.55342398,18.5620492 C5.0530403,17.2911692 4.33183953,16.9528531 4.33183953,16.9528531 C3.33309801,16.2708186 4.40747107,16.2843243 4.40747107,16.2843243 C5.51155652,16.3619816 6.09229872,17.4181221 6.09229872,17.4181221 C7.07348292,19.0988981 8.66714755,18.6133706 9.2938089,18.3317781 C9.39375058,17.6213819 9.67804414,17.1365297 9.99205009,16.86169 C7.54955646,16.5841493 4.98146045,15.6401056 4.98146045,11.4249977 C4.98146045,10.224347 5.41026428,9.24181221 6.11390773,8.47334172 C6.00046042,8.19512569 5.62297799,7.07618404 6.22195279,5.56220265 C6.22195279,5.56220265 7.14506277,5.26642929 9.24653918,6.68992296 C10.12373,6.44547101 11.0650726,6.32392032 12.0003376,6.31919335 C12.9349274,6.32392032 13.8755947,6.44547101 14.7541361,6.68992296 C16.8542619,5.26642929 17.7760214,5.56220265 17.7760214,5.56220265 C18.3763467,7.07618404 17.9988643,8.19512569 17.8860923,8.47334172 C18.5910863,9.24181221 19.0165137,10.224347 19.0165137,11.4249977 C19.0165137,15.6509101 16.444366,16.5807729 13.9944443,16.8529114 C14.3888087,17.192578 14.7406305,17.863808 14.7406305,18.890236 C14.7406305,20.3603241 14.7271248,21.5467939 14.7271248,21.9073943 C14.7271248,22.2018171 14.9256576,22.5441849 15.4834403,22.4368151 C19.8511618,20.9788821 23,16.8589889 23,12.0003376 C23,5.92482888 18.0744958,1 11.9989871,1"></path></svg></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://medium.com/@dawchihliou" aria-label="Link to Daw-Chih&#x27;s Medium profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2.84593838,5.88685595 C2.87575654,5.59224254 2.76340763,5.30104995 2.54341737,5.10276397 L0.302521008,2.4032473 L0.302521008,2 L7.2605042,2 L12.6386555,13.7949836 L17.3669469,2 L24,2 L24,2.4032473 L22.0840336,4.2402628 C21.9188563,4.36617057 21.8369199,4.57310892 21.8711485,4.77792587 L21.8711485,18.2755093 C21.8369199,18.4803262 21.9188563,18.6872645 22.0840336,18.8131723 L23.9551821,20.6501878 L23.9551821,21.0534351 L14.5434174,21.0534351 L14.5434174,20.6501878 L16.4817928,18.7683671 C16.6722689,18.5779447 16.6722689,18.5219382 16.6722689,18.2307041 L16.6722689,7.32062416 L11.2829132,21.0086299 L10.5546219,21.0086299 L4.28011204,7.32062416 L4.28011204,16.4945003 C4.22779746,16.8801958 4.35589372,17.2685069 4.62745097,17.5474239 L7.14845938,20.6053826 L7.14845938,21.0086299 L0,21.0086299 L0,20.6053826 L2.5210084,17.5474239 C2.79058848,17.2680445 2.91121535,16.8771576 2.84593838,16.4945003 L2.84593838,5.88685595 Z"></path></svg></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://hackernoon.com/u/dawchihliou" aria-label="Link to Daw-Chih&#x27;s Hackernoon profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="1.5em" width="1.5em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M5.701 0v6.223H8.85V4.654h1.576v7.842H12V4.654h1.574v1.569h3.15V0zm11.024 6.223v3.136h1.574V6.223zm1.574 3.136v4.705h1.576v-1.568h1.574v-1.568h-1.574V9.359zm0 4.705h-1.574v3.137h1.574zm-1.574 3.137h-3.15v1.569H8.85V17.2H5.7V24h11.024zm-11.024 0v-3.137H4.125v3.137zm-1.576-3.137V9.36H2.551v4.705zm0-4.705h1.576V6.223H4.125Z"></path></svg><span hidden="">Link to Daw-Chih&#x27;s Hacker Noon profile</span></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://twitter.com/dawchihliou" aria-label="Link to Daw-Chih&#x27;s Twitter profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M24,4.3086 C23.117,4.7006 22.168,4.9646 21.172,5.0836 C22.188,4.4746 22.969,3.5096 23.337,2.3596 C22.386,2.9246 21.332,3.3336 20.21,3.5556 C19.312,2.5976 18.032,1.9996 16.616,1.9996 C13.897,1.9996 11.692,4.2046 11.692,6.9236 C11.692,7.3096 11.736,7.6856 11.82,8.0456 C7.728,7.8406 4.099,5.8806 1.671,2.9006 C1.247,3.6286 1.004,4.4736 1.004,5.3766 C1.004,7.0846 1.873,8.5926 3.195,9.4756 C2.388,9.4486 1.628,9.2276 0.964,8.8596 L0.964,8.9206 C0.964,11.3066 2.661,13.2966 4.914,13.7486 C4.501,13.8626 4.065,13.9216 3.617,13.9216 C3.299,13.9216 2.991,13.8906 2.69,13.8336 C3.317,15.7896 5.135,17.2136 7.29,17.2536 C5.604,18.5736 3.481,19.3606 1.175,19.3606 C0.777,19.3606 0.385,19.3376 0,19.2926 C2.179,20.6886 4.767,21.5046 7.548,21.5046 C16.605,21.5046 21.557,14.0016 21.557,7.4946 C21.557,7.2816 21.552,7.0696 21.543,6.8586 C22.505,6.1636 23.34,5.2966 24,4.3086"></path></svg></a></div><div class="DarkmodeSwitch_container__uFGHQ" tabindex="-1"><div class="DarkmodeSwitch_wrap__e71_4"></div></div></nav></div><div><div class="bm-cross-button" style="position:absolute;width:24px;height:24px;right:8px;top:8px"><button id="react-burger-cross-btn" style="position:absolute;left:0;top:0;z-index:1;width:100%;height:100%;margin:0;padding:0;border:none;font-size:0;background:transparent;cursor:pointer" tabindex="-1">Close Menu</button><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="bm-cross" style="width:100%;height:100%" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div></div></div></div></header><div class="Menubar_menubar__gvU4b"><a class="styles_anchor__g18qA Menubar_hireMe__zuAig" href="/contact"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1.5em" width="1.5em" xmlns="http://www.w3.org/2000/svg"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>Hire Me</a><div class="DarkmodeSwitch_container__uFGHQ" tabindex="0"><div class="DarkmodeSwitch_wrap__e71_4"></div></div><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou" aria-label="See more Daw-Chih&#x27;s work on GitHub"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1.5em" width="1.5em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M11.9989871,1 C5.92550416,1 1,5.92482888 1,12.0003376 C1,16.8603395 4.15153934,20.9829338 8.52263728,22.4374904 C9.0729918,22.5387827 9.27355045,22.199116 9.27355045,21.9073943 C9.27355045,21.6467356 9.2640965,20.954572 9.25869425,20.0368642 C6.19899322,20.7013414 5.55342398,18.5620492 5.55342398,18.5620492 C5.0530403,17.2911692 4.33183953,16.9528531 4.33183953,16.9528531 C3.33309801,16.2708186 4.40747107,16.2843243 4.40747107,16.2843243 C5.51155652,16.3619816 6.09229872,17.4181221 6.09229872,17.4181221 C7.07348292,19.0988981 8.66714755,18.6133706 9.2938089,18.3317781 C9.39375058,17.6213819 9.67804414,17.1365297 9.99205009,16.86169 C7.54955646,16.5841493 4.98146045,15.6401056 4.98146045,11.4249977 C4.98146045,10.224347 5.41026428,9.24181221 6.11390773,8.47334172 C6.00046042,8.19512569 5.62297799,7.07618404 6.22195279,5.56220265 C6.22195279,5.56220265 7.14506277,5.26642929 9.24653918,6.68992296 C10.12373,6.44547101 11.0650726,6.32392032 12.0003376,6.31919335 C12.9349274,6.32392032 13.8755947,6.44547101 14.7541361,6.68992296 C16.8542619,5.26642929 17.7760214,5.56220265 17.7760214,5.56220265 C18.3763467,7.07618404 17.9988643,8.19512569 17.8860923,8.47334172 C18.5910863,9.24181221 19.0165137,10.224347 19.0165137,11.4249977 C19.0165137,15.6509101 16.444366,16.5807729 13.9944443,16.8529114 C14.3888087,17.192578 14.7406305,17.863808 14.7406305,18.890236 C14.7406305,20.3603241 14.7271248,21.5467939 14.7271248,21.9073943 C14.7271248,22.2018171 14.9256576,22.5441849 15.4834403,22.4368151 C19.8511618,20.9788821 23,16.8589889 23,12.0003376 C23,5.92482888 18.0744958,1 11.9989871,1"></path></svg></a></div><div id="page-wrap"><article><div class="Article_container__q__L3"><div class="Article_wrap__LZypL"><h1>Stress Testing Concurrent Features in React 18: A Case Study of startTransition &amp; 3D Rendering</h1><div class="Article_info__bOKys"><div class="Article_author__grS8U"><img alt="Daw-Chih Liou" src="/optimized/raw/portrait-sm.webp" loading="lazy"/><p>Daw-Chih Liou</p></div><p>May 30, 2022<!-- --> ¬∑ 10 min read</p></div><img alt="Stress Testing Concurrent Features in React 18: A Case Study of startTransition &amp; 3D Rendering" src="/optimized/articles/concurrent-react-18/hero.webp" width="100%" class="rounded centered" loading="lazy"/><div class="article-content"><h2 id="tldr"><a class="styles_anchor__g18qA anchor" href="/articles/stress-testing-concurrent-features-in-react-18#tldr"><span class="icon icon-link"></span></a>TL;DR</h2>
<ul>
<li><span role="img" aria-label="rocket">üöÄ</span> Concurrent rendering addresses the performance problem with rendering large UI updates while keeping the UI responsive.</li>
<li><span role="img" aria-label="" aria-hidden="true">üßë</span>‚Äç<span role="img" aria-label="microscope">üî¨</span> We&#x27;ll use 3D rendering in the browser to stress test React 18.</li>
<li><span role="img" aria-label="balance scale">‚öñÔ∏è</span> We&#x27;ll look at the typical approaches alongside concurrent rendering and discuss their pros and cons.</li>
</ul>
<hr/>
<p>This article is also available on</p>
<ul>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://betterprogramming.pub/stress-testing-concurrent-features-in-react-18-a-case-study-of-starttransition-and-3d-rendering-9aecb4a479f8">Better Programming</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://hackernoon.com/react-18s-concurrent-rendering-for-stress-testing-a-3d-rendering-case-study">Hacker Noon</a></li>
</ul>
<p>Feel free to read it on your favorite platform<span role="img" aria-label="sparkles">‚ú®</span></p>
<hr/>
<p>In this article, we are diving into a 3D visualization and discuss how to optimize its performance step by step with React 18&#x27;s concurrent rendering. Here&#x27;s the sneak peek.</p>
<video controls=""><source src="/articles/concurrent-react-18/demo.mp4" type="video/mp4"/><p>Your browser doesn&#x27;t support HTML5 video.</p></video>
<h2 id="concurrent-rendering-with-usetransition"><a class="styles_anchor__g18qA anchor" href="/articles/stress-testing-concurrent-features-in-react-18#concurrent-rendering-with-usetransition"><span class="icon icon-link"></span></a>Concurrent Rendering with useTransition</h2>
<p><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://reactjs.org/blog/2022/03/29/react-v18.html">React 18 introduces the concurrent features</a>. The core idea is to classify state updates into two categories:</p>
<ul>
<li><strong>Urgent updates</strong>: they provide responsive feedback to user interactions, like typing and clicking.</li>
<li><strong>Transition updates</strong>: they provide non-urgent UI transitions, like displaying dataset.</li>
</ul>
<p>The purpose is to create a snappier and more responsive experience for the users.</p>
<p>Before React 18, all updates are considered urgent and a simple click or typing can cause the screen to freeze when there&#x27;s a larger rending. So in React 18, by deferring non-urgent updates to urgent updates, users are able to receive immediate feedback from their interaction while React is working on the non-urgent updates in the background and reflect the result when ready.</p>
<p>React Working Group published a couple great articles about transition updates:</p>
<ul>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/reactwg/react-18/discussions/41">New feature: startTransition</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/reactwg/react-18/discussions/65">Real world example: adding startTransition for slow renders</a></li>
</ul>
<p>According to the working group, the concurrent rendering is able to perform the following things:</p>
<ul>
<li><strong>Yielding</strong>: React will periodically stop working and let the browser fire one or more side effects.</li>
<li><strong>Interrupting</strong>: When React detects new urgent updates, it will interrupt and pause non-urgent updates and start working on incoming urgent updates so the page can stay responsive.</li>
<li><strong>Skipping old results</strong>: React will discard outdated transition updates and only render with the newest state.</li>
</ul>
<p>We&#x27;ll use the format and methods from the articles to test the 3D rendering demo and observe the impact on the performance and user experience.</p>
<h2 id="3d-rendering-demo-overview"><a class="styles_anchor__g18qA anchor" href="/articles/stress-testing-concurrent-features-in-react-18#3d-rendering-demo-overview"><span class="icon icon-link"></span></a>3D Rendering Demo Overview</h2>
<p>In order to create heavy computations for rendering, I built a 3D visualization to show the connections between a GitHub user and the users she&#x27;s connected with on GitHub.</p>
<p>The technology includes:</p>
<ul>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/mrdoob/three.js/">three.js</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/pmndrs/react-three-fiber">react-three-fiber</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://reactjs.org/blog/2022/03/29/react-v18.html">React 18</a></li>
</ul>
<p>The UI looks like this:</p>
<img src="/optimized/articles/concurrent-react-18/screenshot.webp" alt="Demo screen shot" width="100%" class="rounded centered" loading="lazy"/>
<p>The components we will be discussing today includes:</p>
<ul>
<li><strong>Search Bar</strong>: to search for a GitHub username and fetch the user info from the GitHub GraphQL API.</li>
<li><strong>Scene</strong>: to visualize the connections between the user and her connections in on a 3D globe.</li>
</ul>
<blockquote>
<p><strong>You can find <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou/concurrent-react-stress-testing">the repository on GitHub</a> and <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://sweaty-concurrent-react.netlify.app">the demo on Netlify</a>.</strong></p>
<p><em>Please note that the demo might crash due to a task timeout. The timeout is caused by the slow experimental API call to fetch the coordinates of the cities. If you&#x27;d like to interact with the demo, it&#x27;s recommended to fork the repository and run the development server locally.</em></p>
</blockquote>
<p>As we type into the search bar, you&#x27;ll see an increasing amount of stars in the scene to simulate the high rendering demand on the UI. The amount of stars is <code>100,000 * inputValue.length</code>. We&#x27;ll use it to stress test concurrent rendering.</p>
<h2 id="the-problem"><a class="styles_anchor__g18qA anchor" href="/articles/stress-testing-concurrent-features-in-react-18#the-problem"><span class="icon icon-link"></span></a>The Problem</h2>
<p>Let&#x27;s start with our base case with the most basic implementation. The outcome looks like this:</p>
<video controls=""><source src="/articles/concurrent-react-18/perf-sync.mp4" type="video/mp4"/><p>Your browser doesn&#x27;t support HTML5 video.</p></video>
<p><em>You can see my typing on the bottom left corner of the video.</em></p>
<p>As I was typing, the search bar was frozen. It didn&#x27;t display the input value until the very end. Not just the search bar, the scene was frozen too. The stars didn&#x27;t get rendered until I finished typing. Ideally, we want to be able to observe immediate feedback from our typing.</p>
<p>Let&#x27;s look into the performance together. We&#x27;ll slow down the CPU by 4x and run a performance profiling.</p>
<img src="/optimized/articles/concurrent-react-18/perf-sync.webp" alt="Performance profile for unoptimized rendering" width="100%" class="rounded centered" loading="lazy"/>
<p>You can see the big chunks of tasks with keypress event in the flame chart. With each keypress, React computes the next rendering for the SearchBar and the Scene. As we see in the chart, the longest task takes almost 0.8 seconds to complete. That&#x27;s why the page feels so slow.</p>
<h3 id="so-whats-happening"><a class="styles_anchor__g18qA anchor" href="/articles/stress-testing-concurrent-features-in-react-18#so-whats-happening"><span class="icon icon-link"></span></a>So, what&#x27;s happening?</h3>
<p>In the Home page component, the SearchBar listens to the keypress event and update the <code>username</code> when changes happens.</p>
<pre class="language-tsx"><code class="language-tsx code-highlight"><span class="code-line"><span class="token keyword">const</span> <span class="token maybe-class-name">Home</span><span class="token operator">:</span> <span class="token function-variable function">NextPage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>username<span class="token punctuation">,</span> setUsername<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">computeVertices</span><span class="token punctuation">(</span>username<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>username<span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>username<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">setUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SearchBar</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>username<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Scene</span></span> <span class="token attr-name">vertices</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>vertices<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>Whenever there&#x27;s a <code>username</code> update, React recomputes <code>vertices</code> by calling <code>computeVertices()</code> and pass the result in to the Scene component to render the stars. Since the number of vertices is <code>100,000 * username.length</code>, coupling the two state updates together is a very expensive rendering cycle.</p>
<h2 id="how-did-we-fix-it-before-react-18"><a class="styles_anchor__g18qA anchor" href="/articles/stress-testing-concurrent-features-in-react-18#how-did-we-fix-it-before-react-18"><span class="icon icon-link"></span></a>How did We Fix It Before React 18?</h2>
<p>Ideally, we want to see what we typed in the search bar immediately. Knowing that updating both states in the same rendering cycle takes too long, we can simply split the two updates so that SearchBar and Scene gets rendered separately.</p>
<p>Let&#x27;s first add a new state for the SearchBar:</p>
<pre class="language-tsx"><code class="language-tsx code-highlight"><span class="code-line"><span class="token keyword">type</span> <span class="token class-name">FastSearchBarProps</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">  defaultValue<span class="token operator">:</span> <span class="token builtin">string</span>
</span><span class="code-line">  <span class="token function-variable function">onChange</span><span class="token operator">:</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token keyword">void</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">function</span> <span class="token function">FastSearchBar</span><span class="token punctuation">(</span><span class="token punctuation">{</span> defaultValue<span class="token punctuation">,</span> onChange <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token maybe-class-name">FastSearchBarProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token comment">// new state designated to SearchBar</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>defaultValue<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// update input value</span>
</span><span class="code-line">    <span class="token function">setValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// update vertices</span>
</span><span class="code-line">    <span class="token function">onChange</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SearchBar</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> <span class="token maybe-class-name">Home</span><span class="token operator">:</span> <span class="token function-variable function">NextPage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>username<span class="token punctuation">,</span> setUsername<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">computeVertices</span><span class="token punctuation">(</span>username<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>username<span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>username<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">setUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">FastSearchBar</span></span> <span class="token attr-name">defaultValue</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>username<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Scene</span></span> <span class="token attr-name">vertices</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>vertices<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>Now we have a <code>value</code> state for SearchBar and a <code>username</code> state for computing <code>vertices</code>. We&#x27;ll need additional work to separate the renderings because React will batch the state updates together in the same event to avoid additional rendering. Let&#x27;s take a look at some of the typical approaches.</p>
<h3 id="approach-1-settimeout"><a class="styles_anchor__g18qA anchor" href="/articles/stress-testing-concurrent-features-in-react-18#approach-1-settimeout"><span class="icon icon-link"></span></a>Approach #1: setTimeout</h3>
<p>We can simply defer the slower update by adding setTimeout to put the it in the event loop.</p>
<pre class="language-tsx"><code class="language-tsx code-highlight"><span class="code-line"><span class="token keyword">function</span> <span class="token function">FastSearchBar</span><span class="token punctuation">(</span><span class="token punctuation">{</span> defaultValue<span class="token punctuation">,</span> onChange <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token maybe-class-name">FastSearchBarProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>defaultValue<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">setValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token function">onChange</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SearchBar</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>Now even with the 4x slowdown, the SearchBar looks more responsive. We also observed that the stars are getting rendered while we were typing.</p>
<video controls=""><source src="/articles/concurrent-react-18/perf-timeout-throttle-x4.mp4" type="video/mp4"/><p>Your browser doesn&#x27;t support HTML5 video.</p></video>
<p>If you take a look at the performance profile, you can see that we were able to separate the keypress events from the expensive tasks.</p>
<img src="/optimized/articles/concurrent-react-18/perf-timeout.webp" alt="Performance profile for rendering with timeout" width="100%" class="rounded centered" loading="lazy"/>
<p>However, we noticed that the Scene was rendered twice after the last keypress event. That&#x27;s because the renderings were still scheduled with outdated state when the <code>setTimeout</code>s were fired.</p>
<h3 id="approach-2-debouncing"><a class="styles_anchor__g18qA anchor" href="/articles/stress-testing-concurrent-features-in-react-18#approach-2-debouncing"><span class="icon icon-link"></span></a>Approach #2: Debouncing</h3>
<p>We can actually cancel the rendering schedule by implementing debouncing.</p>
<pre class="language-tsx"><code class="language-tsx code-highlight"><span class="code-line"><span class="token keyword">function</span> <span class="token function">FastSearchBar</span><span class="token punctuation">(</span><span class="token punctuation">{</span> defaultValue<span class="token punctuation">,</span> onChange <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token maybe-class-name">FastSearchBarProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>defaultValue<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token keyword">const</span> timeout <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useRef</span><span class="token generic class-name"><span class="token operator">&lt;</span>NodeJS<span class="token punctuation">.</span>Timeout<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// cancel the schedule if `value` changed within 100ms.</span>
</span><span class="code-line">    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token function">setValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">// schedule a new update if input value hasn&#x27;t changed for 100ms.</span>
</span><span class="code-line">    timeout<span class="token punctuation">.</span><span class="token property-access">current</span> <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token function">onChange</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SearchBar</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<video controls=""><source src="/articles/concurrent-react-18/perf-debounce-throttle-x4.mp4" type="video/mp4"/><p>Your browser doesn&#x27;t support HTML5 video.</p></video>
<p>The user experience looks better now. The SearchBar stays fairly responsive with 4x slowdown and the redundant update on the Scene after the last keypress event was gone.</p>
<p>However, the shortcoming of debouncing in this case is that the Scene update will always be delayed by 100ms. With faster CPU, the delay is most likely redundant and it makes the page feel slow.</p>
<img src="/optimized/articles/concurrent-react-18/perf-debounce.webp" alt="Performance profile for rendering with debouncing" width="100%" class="rounded centered" loading="lazy"/>
<h2 id="react-18s-concurrent-rendering-starttransition"><a class="styles_anchor__g18qA anchor" href="/articles/stress-testing-concurrent-features-in-react-18#react-18s-concurrent-rendering-starttransition"><span class="icon icon-link"></span></a>React 18&#x27;s Concurrent Rendering: startTransition</h2>
<p>The page feel more responsive with either adding setTimeout or debouncing, but they introduces different problems:</p>
<ul>
<li>setTimeout: results in additional UI updates with outdated states</li>
<li>debouncing: results in artificial delay in UI updates</li>
</ul>
<p>Let&#x27;s take a look at how React 18 solves the problems with concurrent rendering:</p>
<pre class="language-tsx"><code class="language-tsx code-highlight"><span class="code-line"><span class="token keyword">import</span> <span class="token imports"><span class="token punctuation">{</span> startTransition <span class="token punctuation">}</span></span> <span class="token keyword">from</span> <span class="token string">&#x27;react&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">type</span> <span class="token class-name">FastSearchBarProps</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">  defaultValue<span class="token operator">:</span> <span class="token builtin">string</span>
</span><span class="code-line">  <span class="token function-variable function">onChange</span><span class="token operator">:</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token keyword">void</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">function</span> <span class="token function">FastSearchBar</span><span class="token punctuation">(</span><span class="token punctuation">{</span> defaultValue<span class="token punctuation">,</span> onChange <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token maybe-class-name">FastSearchBarProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>value<span class="token punctuation">,</span> setValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>defaultValue<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">setValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token function">onChange</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SearchBar</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> <span class="token maybe-class-name">Home</span><span class="token operator">:</span> <span class="token function-variable function">NextPage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>username<span class="token punctuation">,</span> setUsername<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> vertices <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">computeCoordinates</span><span class="token punctuation">(</span>username<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token punctuation">[</span>username<span class="token punctuation">]</span>
</span><span class="code-line">  <span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">const</span> <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span>username<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token comment">// defer username update in a less urgent UI transition</span>
</span><span class="code-line">    <span class="token function">startTransition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token function">setUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword">return</span> <span class="token punctuation">(</span>
</span><span class="code-line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Container</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">FastSearchBar</span></span> <span class="token attr-name">defaultValue</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>username<span class="token punctuation">}</span></span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleChange<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Scene</span></span> <span class="token attr-name">vertices</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>vertices<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Container</span></span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">  <span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>We call <code>setUsername</code> inside of <code>startTransition</code> function. It tells React to defer <code>setUsername</code> to the other urgent updates.</p>
<video controls=""><source src="/articles/concurrent-react-18/perf-transition-throttle-x4.mp4" type="video/mp4"/><p>Your browser doesn&#x27;t support HTML5 video.</p></video>
<p>As you can see, we are able to separate the rendering of SearchBar and Scene without any asynchronous functions. If we take a look at the performance profile, we can observe a few things:</p>
<ul>
<li>The keypress events are separated from the long rendering function calls.</li>
<li>The keypress events are grouped. It aligns with the <strong>yielding</strong> behavior in concurrent rendering.</li>
<li>There&#x27;s only one rendering call after the last group of keypress events. It aligns with the <strong>skipping old results</strong> behavior in concurrent rendering.</li>
</ul>
<p>The <strong>interrupting</strong> behavior is not very straight forward to observe. If you know how to analyze it from the performance profile, please feel free to <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://twitter.com/dawchihliou">reach out to me on Twitter</a>!</p>
<img src="/optimized/articles/concurrent-react-18/perf-transition.webp" alt="Performance profile for rendering with startTransition" width="100%" class="rounded centered" loading="lazy"/>
<p>Let&#x27;s remove the slowdown and see the final result:</p>
<video controls=""><source src="/articles/concurrent-react-18/perf-transition.mp4" type="video/mp4"/><p>Your browser doesn&#x27;t support HTML5 video.</p></video>
<p>As you can see, the SearchBar is always responsive while the Scene updates quickly. The user experience feels so much smoother.</p>
<h2 id="final-thoughts"><a class="styles_anchor__g18qA anchor" href="/articles/stress-testing-concurrent-features-in-react-18#final-thoughts"><span class="icon icon-link"></span></a>Final Thoughts</h2>
<p>In the past, adding debouncing was the go-to solution for rendering large UI updates while keeping pages responsive. Based on this experiment, concurrent rendering makes the UI more responsive without the shortcoming of debouncing. Even for the heavy computation with at least 100,000 3D objects, concurrent rendering still helped the page to be snappy.</p>
<p>Here&#x27;s the side-by-side comparisons:</p>
<p><strong>UI Comparison with 4x CPU Throttling</strong></p>
<p>Basic implementation without concurrent rendering:</p>
<video controls=""><source src="/articles/concurrent-react-18/perf-sync-throttle-x4.mp4" type="video/mp4"/><p>Your browser doesn&#x27;t support HTML5 video.</p></video>
<p>Optimized implementation with concurrent rendering:</p>
<video controls=""><source src="/articles/concurrent-react-18/perf-transition-throttle-x4.mp4" type="video/mp4"/><p>Your browser doesn&#x27;t support HTML5 video.</p></video>
<p><strong>UI Comparison with No CPU Throttling</strong></p>
<p>Basic implementation without concurrent rendering:</p>
<video controls=""><source src="/articles/concurrent-react-18/perf-sync.mp4" type="video/mp4"/><p>Your browser doesn&#x27;t support HTML5 video.</p></video>
<p>Optimized implementation with concurrent rendering:</p>
<video controls=""><source src="/articles/concurrent-react-18/perf-transition.mp4" type="video/mp4"/><p>Your browser doesn&#x27;t support HTML5 video.</p></video>
<h2 id="references"><a class="styles_anchor__g18qA anchor" href="/articles/stress-testing-concurrent-features-in-react-18#references"><span class="icon icon-link"></span></a>References</h2>
<ul>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou/concurrent-react-stress-testing">GitHub: Demo repository</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://sweaty-concurrent-react.netlify.app">Website: Demo Site</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://reactjs.org/blog/2022/03/29/react-v18.html">Website: React v18.0</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/reactwg/react-18/discussions/41">GitHub: New feature: startTransition</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/reactwg/react-18/discussions/65">GitHub: Real world example: adding startTransition for slow renders</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/mrdoob/three.js/">GitHub: three.js</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/pmndrs/react-three-fiber">GitHub: react-three-fiber</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://webgl-globe-solutions.stackblitz.io">Website: WebGL Globe Solution</a></li>
</ul>
<hr/>
<p>Here you have it! Thanks for reading through<span role="img" aria-label="raising hands">üôå</span>
If you find this article useful, please share it to help more people in their engineering journey.</p>
<p><span role="img" aria-label="bird">üê¶</span> Feel free to connect with me on <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://twitter.com/dawchihliou">twitter</a>!</p>
<p>‚è≠ Ready for the next article? <span role="img" aria-label="backhand index pointing right">üëâ</span> <a class="styles_anchor__g18qA undefined" href="/articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters"><strong>I Built A Snappy Static Full-text Search with WebAssembly, Rust, Next.js, and Xor Filters</strong></a></p>
<p>Happy coding!</p></div><article class="Author_wrap__s8DeE"><img src="/optimized/raw/portrait-sm.webp" alt="Daw-Chih Liou" class="Author_avatar__j6KIn" loading="lazy"/><div><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://dawchihliou.github.io">Daw-Chih Liou</a><p>Daw-Chih is a software engineer, UX advocate, and creator who is dedicated to Web engineering. His background in Human Centered Computing has led him to work with startups and public companies across North America, Asia, and Europe. He is passionate about meeting business trajectory with user journey and utilizing engineering architecture and performance monitoring to provide optimal user experience.</p></div></article></div></div></article><footer class="Footer_footer__1IwEk"><div class="Footer_wrap__FVCTX"><div class="Footer_resources__fG_vu"><p><span role="img" aria-label="build with love" class="Footer_emoji__u15jg">üíö</span>This site is built with</p><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://nextjs.org">Next.js</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://react-icons.github.io/react-icons">React Icons</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://mdxjs.com">MDX</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://unifiedjs.com">unified</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/contentlayerdev/contentlayer">Contentlayer</a></div><div class="Footer_contact__9GJn6"><p><span role="img" aria-label="build with love" class="Footer_emoji__u15jg">ü¶Ñ</span>Where to find me</p><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/dawchihliou">Linkedin</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou">GitHub</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://twitter.com/dawchihliou">Twitter</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://medium.com/@dawchihliou">Medium</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://hackernoon.com/u/dawchihliou">Hacker Noon</a><a class="styles_anchor__g18qA undefined" href="/rss.xml">RSS Feed <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></div><div class="Footer_sitemap__92ono"><p><span role="img" aria-label="build with love" class="Footer_emoji__u15jg">üó∫</span>Sitemap</p><a class="styles_anchor__g18qA undefined" href="/">Home</a><a class="styles_anchor__g18qA undefined" href="/articles">Articles</a><a class="styles_anchor__g18qA undefined" href="/work">Work</a><a class="styles_anchor__g18qA undefined" href="/now">Now</a><a class="styles_anchor__g18qA undefined" href="/expertise">Expertise</a><a class="styles_anchor__g18qA undefined" href="/contact">Contact</a></div></div><div class="Footer_copyright__vZZRL">¬© <!-- -->2023<!-- --> <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/dawchihliou">Daw-Chih Liou</a></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Stress Testing Concurrent Features in React 18: A Case Study of startTransition \u0026 3D Rendering","publishedAt":"May 30, 2022","description":"React 18 released the highly anticipated concurrent features. In this article, we are diving into a 3D visualization and discuss how to optimize its performance step by step with React 18's concurrent rendering.","cover":"/optimized/articles/concurrent-react-18/hero.webp","category":"Frontend","coverWidth":"1400","coverHeight":"600","body":{"raw":"\n## TL;DR\n\n- üöÄ Concurrent rendering addresses the performance problem with rendering large UI updates while keeping the UI responsive.\n- üßë‚Äçüî¨ We'll use 3D rendering in the browser to stress test React 18.\n- ‚öñÔ∏è We'll look at the typical approaches alongside concurrent rendering and discuss their pros and cons.\n\n---\n\nThis article is also available on\n\n- [Better Programming](https://betterprogramming.pub/stress-testing-concurrent-features-in-react-18-a-case-study-of-starttransition-and-3d-rendering-9aecb4a479f8)\n- [Hacker Noon](https://hackernoon.com/react-18s-concurrent-rendering-for-stress-testing-a-3d-rendering-case-study)\n\nFeel free to read it on your favorite platform‚ú®\n\n---\n\nIn this article, we are diving into a 3D visualization and discuss how to optimize its performance step by step with React 18's concurrent rendering. Here's the sneak peek.\n\n\u003cvideo controls\u003e\n  \u003csource src=\"/articles/concurrent-react-18/demo.mp4\" type=\"video/mp4\" /\u003e\n  \u003cp\u003eYour browser doesn't support HTML5 video.\u003c/p\u003e\n\u003c/video\u003e\n\n## Concurrent Rendering with useTransition\n\n[React 18 introduces the concurrent features](https://reactjs.org/blog/2022/03/29/react-v18.html). The core idea is to classify state updates into two categories:\n\n- **Urgent updates**: they provide responsive feedback to user interactions, like typing and clicking.\n- **Transition updates**: they provide non-urgent UI transitions, like displaying dataset.\n\nThe purpose is to create a snappier and more responsive experience for the users.\n\nBefore React 18, all updates are considered urgent and a simple click or typing can cause the screen to freeze when there's a larger rending. So in React 18, by deferring non-urgent updates to urgent updates, users are able to receive immediate feedback from their interaction while React is working on the non-urgent updates in the background and reflect the result when ready.\n\nReact Working Group published a couple great articles about transition updates:\n\n- [New feature: startTransition](https://github.com/reactwg/react-18/discussions/41)\n- [Real world example: adding startTransition for slow renders](https://github.com/reactwg/react-18/discussions/65)\n\nAccording to the working group, the concurrent rendering is able to perform the following things:\n\n- **Yielding**: React will periodically stop working and let the browser fire one or more side effects.\n- **Interrupting**: When React detects new urgent updates, it will interrupt and pause non-urgent updates and start working on incoming urgent updates so the page can stay responsive.\n- **Skipping old results**: React will discard outdated transition updates and only render with the newest state.\n\nWe'll use the format and methods from the articles to test the 3D rendering demo and observe the impact on the performance and user experience.\n\n## 3D Rendering Demo Overview\n\nIn order to create heavy computations for rendering, I built a 3D visualization to show the connections between a GitHub user and the users she's connected with on GitHub.\n\nThe technology includes:\n\n- [three.js](https://github.com/mrdoob/three.js/)\n- [react-three-fiber](https://github.com/pmndrs/react-three-fiber)\n- [React 18](https://reactjs.org/blog/2022/03/29/react-v18.html)\n\nThe UI looks like this:\n\n\u003cimg\n  src=\"/optimized/articles/concurrent-react-18/screenshot.webp\"\n  alt=\"Demo screen shot\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/\u003e\n\nThe components we will be discussing today includes:\n\n- **Search Bar**: to search for a GitHub username and fetch the user info from the GitHub GraphQL API.\n- **Scene**: to visualize the connections between the user and her connections in on a 3D globe.\n\n\u003e **You can find [the repository on GitHub](https://github.com/DawChihLiou/concurrent-react-stress-testing) and [the demo on Netlify](https://sweaty-concurrent-react.netlify.app).**\n\u003e\n\u003e _Please note that the demo might crash due to a task timeout. The timeout is caused by the slow experimental API call to fetch the coordinates of the cities. If you'd like to interact with the demo, it's recommended to fork the repository and run the development server locally._\n\nAs we type into the search bar, you'll see an increasing amount of stars in the scene to simulate the high rendering demand on the UI. The amount of stars is `100,000 * inputValue.length`. We'll use it to stress test concurrent rendering.\n\n## The Problem\n\nLet's start with our base case with the most basic implementation. The outcome looks like this:\n\n\u003cvideo controls\u003e\n  \u003csource src=\"/articles/concurrent-react-18/perf-sync.mp4\" type=\"video/mp4\" /\u003e\n  \u003cp\u003eYour browser doesn't support HTML5 video.\u003c/p\u003e\n\u003c/video\u003e\n\n_You can see my typing on the bottom left corner of the video._\n\nAs I was typing, the search bar was frozen. It didn't display the input value until the very end. Not just the search bar, the scene was frozen too. The stars didn't get rendered until I finished typing. Ideally, we want to be able to observe immediate feedback from our typing.\n\nLet's look into the performance together. We'll slow down the CPU by 4x and run a performance profiling.\n\n\u003cimg\n  src=\"/optimized/articles/concurrent-react-18/perf-sync.webp\"\n  alt=\"Performance profile for unoptimized rendering\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/\u003e\n\nYou can see the big chunks of tasks with keypress event in the flame chart. With each keypress, React computes the next rendering for the SearchBar and the Scene. As we see in the chart, the longest task takes almost 0.8 seconds to complete. That's why the page feels so slow.\n\n### So, what's happening?\n\nIn the Home page component, the SearchBar listens to the keypress event and update the `username` when changes happens.\n\n```tsx\nconst Home: NextPage = () =\u003e {\n  const [username, setUsername] = useState\u003cstring\u003e('')\n\n  const vertices = useMemo(() =\u003e computeVertices(username.length), [username])\n\n  const handleChange = (username: string) =\u003e {\n    setUsername(username)\n  }\n\n  return (\n    \u003c\u003e\n      \u003cSearchBar value={username} onChange={handleChange} /\u003e\n      \u003cScene vertices={vertices} /\u003e\n    \u003c/\u003e\n  )\n}\n```\n\nWhenever there's a `username` update, React recomputes `vertices` by calling `computeVertices()` and pass the result in to the Scene component to render the stars. Since the number of vertices is `100,000 * username.length`, coupling the two state updates together is a very expensive rendering cycle.\n\n## How did We Fix It Before React 18?\n\nIdeally, we want to see what we typed in the search bar immediately. Knowing that updating both states in the same rendering cycle takes too long, we can simply split the two updates so that SearchBar and Scene gets rendered separately.\n\nLet's first add a new state for the SearchBar:\n\n```tsx\ntype FastSearchBarProps = {\n  defaultValue: string\n  onChange: (value: string) =\u003e void\n}\n\nfunction FastSearchBar({ defaultValue, onChange }: FastSearchBarProps) {\n  // new state designated to SearchBar\n  const [value, setValue] = useState(defaultValue)\n\n  const handleChange = (value: string) =\u003e {\n    // update input value\n    setValue(value)\n\n    // update vertices\n    onChange(value)\n  }\n\n  return \u003cSearchBar value={value} onChange={handleChange} /\u003e\n}\n\nconst Home: NextPage = () =\u003e {\n  const [username, setUsername] = useState\u003cstring\u003e('')\n\n  const vertices = useMemo(() =\u003e computeVertices(username.length), [username])\n\n  const handleChange = (username: string) =\u003e {\n    setUsername(username)\n  }\n\n  return (\n    \u003c\u003e\n      \u003cFastSearchBar defaultValue={username} onChange={handleChange} /\u003e\n      \u003cScene vertices={vertices} /\u003e\n    \u003c/\u003e\n  )\n}\n```\n\nNow we have a `value` state for SearchBar and a `username` state for computing `vertices`. We'll need additional work to separate the renderings because React will batch the state updates together in the same event to avoid additional rendering. Let's take a look at some of the typical approaches.\n\n### Approach #1: setTimeout\n\nWe can simply defer the slower update by adding setTimeout to put the it in the event loop.\n\n```tsx\nfunction FastSearchBar({ defaultValue, onChange }: FastSearchBarProps) {\n  const [value, setValue] = useState(defaultValue)\n\n  const handleChange = (value: string) =\u003e {\n    setValue(value)\n\n    setTimeout(() =\u003e {\n      onChange(value)\n    }, 0)\n  }\n\n  return \u003cSearchBar value={value} onChange={handleChange} /\u003e\n}\n```\n\nNow even with the 4x slowdown, the SearchBar looks more responsive. We also observed that the stars are getting rendered while we were typing.\n\n\u003cvideo controls\u003e\n  \u003csource\n    src=\"/articles/concurrent-react-18/perf-timeout-throttle-x4.mp4\"\n    type=\"video/mp4\"\n  /\u003e\n  \u003cp\u003eYour browser doesn't support HTML5 video.\u003c/p\u003e\n\u003c/video\u003e\n\nIf you take a look at the performance profile, you can see that we were able to separate the keypress events from the expensive tasks.\n\n\u003cimg\n  src=\"/optimized/articles/concurrent-react-18/perf-timeout.webp\"\n  alt=\"Performance profile for rendering with timeout\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/\u003e\n\nHowever, we noticed that the Scene was rendered twice after the last keypress event. That's because the renderings were still scheduled with outdated state when the `setTimeout`s were fired.\n\n### Approach #2: Debouncing\n\nWe can actually cancel the rendering schedule by implementing debouncing.\n\n```tsx\nfunction FastSearchBar({ defaultValue, onChange }: FastSearchBarProps) {\n  const [value, setValue] = useState(defaultValue)\n  const timeout = useRef\u003cNodeJS.Timeout\u003e()\n\n  const handleChange = (value: string) =\u003e {\n    // cancel the schedule if `value` changed within 100ms.\n    clearTimeout(timeout.current)\n\n    setValue(value)\n\n    // schedule a new update if input value hasn't changed for 100ms.\n    timeout.current = setTimeout(() =\u003e {\n      onChange(value)\n    }, 100)\n  }\n\n  return \u003cSearchBar value={value} onChange={handleChange} /\u003e\n}\n```\n\n\u003cvideo controls\u003e\n  \u003csource\n    src=\"/articles/concurrent-react-18/perf-debounce-throttle-x4.mp4\"\n    type=\"video/mp4\"\n  /\u003e\n  \u003cp\u003eYour browser doesn't support HTML5 video.\u003c/p\u003e\n\u003c/video\u003e\n\nThe user experience looks better now. The SearchBar stays fairly responsive with 4x slowdown and the redundant update on the Scene after the last keypress event was gone.\n\nHowever, the shortcoming of debouncing in this case is that the Scene update will always be delayed by 100ms. With faster CPU, the delay is most likely redundant and it makes the page feel slow.\n\n\u003cimg\n  src=\"/optimized/articles/concurrent-react-18/perf-debounce.webp\"\n  alt=\"Performance profile for rendering with debouncing\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/\u003e\n\n## React 18's Concurrent Rendering: startTransition\n\nThe page feel more responsive with either adding setTimeout or debouncing, but they introduces different problems:\n\n- setTimeout: results in additional UI updates with outdated states\n- debouncing: results in artificial delay in UI updates\n\nLet's take a look at how React 18 solves the problems with concurrent rendering:\n\n```tsx\nimport { startTransition } from 'react'\n\ntype FastSearchBarProps = {\n  defaultValue: string\n  onChange: (value: string) =\u003e void\n}\n\nfunction FastSearchBar({ defaultValue, onChange }: FastSearchBarProps) {\n  const [value, setValue] = useState(defaultValue)\n\n  const handleChange = (value: string) =\u003e {\n    setValue(value)\n    onChange(value)\n  }\n\n  return \u003cSearchBar value={value} onChange={handleChange} /\u003e\n}\n\nconst Home: NextPage = () =\u003e {\n  const [username, setUsername] = useState\u003cstring\u003e('')\n\n  const vertices = useMemo(\n    () =\u003e computeCoordinates(username.length),\n    [username]\n  )\n\n  const handleChange = (username: string) =\u003e {\n    // defer username update in a less urgent UI transition\n    startTransition(() =\u003e {\n      setUsername(username)\n    })\n  }\n\n  return (\n    \u003cContainer\u003e\n      \u003cFastSearchBar defaultValue={username} onChange={handleChange} /\u003e\n      \u003cScene vertices={vertices} /\u003e\n    \u003c/Container\u003e\n  )\n}\n```\n\nWe call `setUsername` inside of `startTransition` function. It tells React to defer `setUsername` to the other urgent updates.\n\n\u003cvideo controls\u003e\n  \u003csource\n    src=\"/articles/concurrent-react-18/perf-transition-throttle-x4.mp4\"\n    type=\"video/mp4\"\n  /\u003e\n  \u003cp\u003eYour browser doesn't support HTML5 video.\u003c/p\u003e\n\u003c/video\u003e\n\nAs you can see, we are able to separate the rendering of SearchBar and Scene without any asynchronous functions. If we take a look at the performance profile, we can observe a few things:\n\n- The keypress events are separated from the long rendering function calls.\n- The keypress events are grouped. It aligns with the **yielding** behavior in concurrent rendering.\n- There's only one rendering call after the last group of keypress events. It aligns with the **skipping old results** behavior in concurrent rendering.\n\nThe **interrupting** behavior is not very straight forward to observe. If you know how to analyze it from the performance profile, please feel free to [reach out to me on Twitter](https://twitter.com/dawchihliou)!\n\n\u003cimg\n  src=\"/optimized/articles/concurrent-react-18/perf-transition.webp\"\n  alt=\"Performance profile for rendering with startTransition\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/\u003e\n\nLet's remove the slowdown and see the final result:\n\n\u003cvideo controls\u003e\n  \u003csource\n    src=\"/articles/concurrent-react-18/perf-transition.mp4\"\n    type=\"video/mp4\"\n  /\u003e\n  \u003cp\u003eYour browser doesn't support HTML5 video.\u003c/p\u003e\n\u003c/video\u003e\n\nAs you can see, the SearchBar is always responsive while the Scene updates quickly. The user experience feels so much smoother.\n\n## Final Thoughts\n\nIn the past, adding debouncing was the go-to solution for rendering large UI updates while keeping pages responsive. Based on this experiment, concurrent rendering makes the UI more responsive without the shortcoming of debouncing. Even for the heavy computation with at least 100,000 3D objects, concurrent rendering still helped the page to be snappy.\n\nHere's the side-by-side comparisons:\n\n**UI Comparison with 4x CPU Throttling**\n\nBasic implementation without concurrent rendering:\n\n\u003cvideo controls\u003e\n  \u003csource\n    src=\"/articles/concurrent-react-18/perf-sync-throttle-x4.mp4\"\n    type=\"video/mp4\"\n  /\u003e\n  \u003cp\u003eYour browser doesn't support HTML5 video.\u003c/p\u003e\n\u003c/video\u003e\n\nOptimized implementation with concurrent rendering:\n\n\u003cvideo controls\u003e\n  \u003csource\n    src=\"/articles/concurrent-react-18/perf-transition-throttle-x4.mp4\"\n    type=\"video/mp4\"\n  /\u003e\n  \u003cp\u003eYour browser doesn't support HTML5 video.\u003c/p\u003e\n\u003c/video\u003e\n\n**UI Comparison with No CPU Throttling**\n\nBasic implementation without concurrent rendering:\n\n\u003cvideo controls\u003e\n  \u003csource src=\"/articles/concurrent-react-18/perf-sync.mp4\" type=\"video/mp4\" /\u003e\n  \u003cp\u003eYour browser doesn't support HTML5 video.\u003c/p\u003e\n\u003c/video\u003e\n\nOptimized implementation with concurrent rendering:\n\n\u003cvideo controls\u003e\n  \u003csource\n    src=\"/articles/concurrent-react-18/perf-transition.mp4\"\n    type=\"video/mp4\"\n  /\u003e\n  \u003cp\u003eYour browser doesn't support HTML5 video.\u003c/p\u003e\n\u003c/video\u003e\n\n## References\n\n- [GitHub: Demo repository](https://github.com/DawChihLiou/concurrent-react-stress-testing)\n- [Website: Demo Site](https://sweaty-concurrent-react.netlify.app)\n- [Website: React v18.0](https://reactjs.org/blog/2022/03/29/react-v18.html)\n- [GitHub: New feature: startTransition](https://github.com/reactwg/react-18/discussions/41)\n- [GitHub: Real world example: adding startTransition for slow renders](https://github.com/reactwg/react-18/discussions/65)\n- [GitHub: three.js](https://github.com/mrdoob/three.js/)\n- [GitHub: react-three-fiber](https://github.com/pmndrs/react-three-fiber)\n- [Website: WebGL Globe Solution](https://webgl-globe-solutions.stackblitz.io)\n\n---\n\nHere you have it! Thanks for reading throughüôå\nIf you find this article useful, please share it to help more people in their engineering journey.\n\nüê¶ Feel free to connect with me on [twitter](https://twitter.com/dawchihliou)!\n\n‚è≠ Ready for the next article? üëâ [**I Built A Snappy Static Full-text Search with WebAssembly, Rust, Next.js, and Xor Filters**](/articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters)\n\nHappy coding!\n","code":"var Component=(()=\u003e{var d=Object.create;var t=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var k=(a,n)=\u003e()=\u003e(n||a((n={exports:{}}).exports,n),n.exports),g=(a,n)=\u003e{for(var s in n)t(a,s,{get:n[s],enumerable:!0})},i=(a,n,s,l)=\u003e{if(n\u0026\u0026typeof n==\"object\"||typeof n==\"function\")for(let c of u(n))!N.call(a,c)\u0026\u0026c!==s\u0026\u0026t(a,c,{get:()=\u003en[c],enumerable:!(l=h(n,c))||l.enumerable});return a};var f=(a,n,s)=\u003e(s=a!=null?d(m(a)):{},i(n||!a||!a.__esModule?t(s,\"default\",{value:a,enumerable:!0}):s,a)),w=a=\u003ei(t({},\"__esModule\",{value:!0}),a);var o=k((T,r)=\u003e{r.exports=_jsx_runtime});var x={};g(x,{default:()=\u003ey,frontmatter:()=\u003eb});var e=f(o()),b={title:\"Stress Testing Concurrent Features in React 18: A Case Study of startTransition \u0026 3D Rendering\",publishedAt:\"May 30, 2022\",description:\"React 18 released the highly anticipated concurrent features. In this article, we are diving into a 3D visualization and discuss how to optimize its performance step by step with React 18's concurrent rendering.\",cover:\"/optimized/articles/concurrent-react-18/hero.webp\",category:\"Frontend\",coverWidth:\"1400\",coverHeight:\"600\"};function p(a){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",ul:\"ul\",li:\"li\",hr:\"hr\",p:\"p\",strong:\"strong\",blockquote:\"blockquote\",em:\"em\",code:\"code\",h3:\"h3\",pre:\"pre\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"tldr\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#tldr\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"TL;DR\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"rocket\",children:\"\\u{1F680}\"}),\" Concurrent rendering addresses the performance problem with rendering large UI updates while keeping the UI responsive.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"\",\"aria-hidden\":!0,children:\"\\u{1F9D1}\"}),\"\\u200D\",(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"microscope\",children:\"\\u{1F52C}\"}),\" We'll use 3D rendering in the browser to stress test React 18.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"balance scale\",children:\"\\u2696\\uFE0F\"}),\" We'll look at the typical approaches alongside concurrent rendering and discuss their pros and cons.\"]}),`\n`]}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsx)(n.p,{children:\"This article is also available on\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://betterprogramming.pub/stress-testing-concurrent-features-in-react-18-a-case-study-of-starttransition-and-3d-rendering-9aecb4a479f8\",children:\"Better Programming\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://hackernoon.com/react-18s-concurrent-rendering-for-stress-testing-a-3d-rendering-case-study\",children:\"Hacker Noon\"})}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"Feel free to read it on your favorite platform\",(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"sparkles\",children:\"\\u2728\"})]}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsx)(n.p,{children:\"In this article, we are diving into a 3D visualization and discuss how to optimize its performance step by step with React 18's concurrent rendering. Here's the sneak peek.\"}),`\n`,(0,e.jsxs)(\"video\",{controls:!0,children:[(0,e.jsx)(\"source\",{src:\"/articles/concurrent-react-18/demo.mp4\",type:\"video/mp4\"}),(0,e.jsx)(\"p\",{children:\"Your browser doesn't support HTML5 video.\"})]}),`\n`,(0,e.jsxs)(n.h2,{id:\"concurrent-rendering-with-usetransition\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#concurrent-rendering-with-usetransition\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Concurrent Rendering with useTransition\"]}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.a,{href:\"https://reactjs.org/blog/2022/03/29/react-v18.html\",children:\"React 18 introduces the concurrent features\"}),\". The core idea is to classify state updates into two categories:\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Urgent updates\"}),\": they provide responsive feedback to user interactions, like typing and clicking.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Transition updates\"}),\": they provide non-urgent UI transitions, like displaying dataset.\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"The purpose is to create a snappier and more responsive experience for the users.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Before React 18, all updates are considered urgent and a simple click or typing can cause the screen to freeze when there's a larger rending. So in React 18, by deferring non-urgent updates to urgent updates, users are able to receive immediate feedback from their interaction while React is working on the non-urgent updates in the background and reflect the result when ready.\"}),`\n`,(0,e.jsx)(n.p,{children:\"React Working Group published a couple great articles about transition updates:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/reactwg/react-18/discussions/41\",children:\"New feature: startTransition\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/reactwg/react-18/discussions/65\",children:\"Real world example: adding startTransition for slow renders\"})}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"According to the working group, the concurrent rendering is able to perform the following things:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Yielding\"}),\": React will periodically stop working and let the browser fire one or more side effects.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Interrupting\"}),\": When React detects new urgent updates, it will interrupt and pause non-urgent updates and start working on incoming urgent updates so the page can stay responsive.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Skipping old results\"}),\": React will discard outdated transition updates and only render with the newest state.\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"We'll use the format and methods from the articles to test the 3D rendering demo and observe the impact on the performance and user experience.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"3d-rendering-demo-overview\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#3d-rendering-demo-overview\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"3D Rendering Demo Overview\"]}),`\n`,(0,e.jsx)(n.p,{children:\"In order to create heavy computations for rendering, I built a 3D visualization to show the connections between a GitHub user and the users she's connected with on GitHub.\"}),`\n`,(0,e.jsx)(n.p,{children:\"The technology includes:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/mrdoob/three.js/\",children:\"three.js\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/pmndrs/react-three-fiber\",children:\"react-three-fiber\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://reactjs.org/blog/2022/03/29/react-v18.html\",children:\"React 18\"})}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"The UI looks like this:\"}),`\n`,(0,e.jsx)(\"img\",{src:\"/optimized/articles/concurrent-react-18/screenshot.webp\",alt:\"Demo screen shot\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,e.jsx)(n.p,{children:\"The components we will be discussing today includes:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Search Bar\"}),\": to search for a GitHub username and fetch the user info from the GitHub GraphQL API.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Scene\"}),\": to visualize the connections between the user and her connections in on a 3D globe.\"]}),`\n`]}),`\n`,(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsxs)(n.strong,{children:[\"You can find \",(0,e.jsx)(n.a,{href:\"https://github.com/DawChihLiou/concurrent-react-stress-testing\",children:\"the repository on GitHub\"}),\" and \",(0,e.jsx)(n.a,{href:\"https://sweaty-concurrent-react.netlify.app\",children:\"the demo on Netlify\"}),\".\"]})}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:\"Please note that the demo might crash due to a task timeout. The timeout is caused by the slow experimental API call to fetch the coordinates of the cities. If you'd like to interact with the demo, it's recommended to fork the repository and run the development server locally.\"})}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"As we type into the search bar, you'll see an increasing amount of stars in the scene to simulate the high rendering demand on the UI. The amount of stars is \",(0,e.jsx)(n.code,{children:\"100,000 * inputValue.length\"}),\". We'll use it to stress test concurrent rendering.\"]}),`\n`,(0,e.jsxs)(n.h2,{id:\"the-problem\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#the-problem\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The Problem\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Let's start with our base case with the most basic implementation. The outcome looks like this:\"}),`\n`,(0,e.jsxs)(\"video\",{controls:!0,children:[(0,e.jsx)(\"source\",{src:\"/articles/concurrent-react-18/perf-sync.mp4\",type:\"video/mp4\"}),(0,e.jsx)(\"p\",{children:\"Your browser doesn't support HTML5 video.\"})]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:\"You can see my typing on the bottom left corner of the video.\"})}),`\n`,(0,e.jsx)(n.p,{children:\"As I was typing, the search bar was frozen. It didn't display the input value until the very end. Not just the search bar, the scene was frozen too. The stars didn't get rendered until I finished typing. Ideally, we want to be able to observe immediate feedback from our typing.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Let's look into the performance together. We'll slow down the CPU by 4x and run a performance profiling.\"}),`\n`,(0,e.jsx)(\"img\",{src:\"/optimized/articles/concurrent-react-18/perf-sync.webp\",alt:\"Performance profile for unoptimized rendering\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,e.jsx)(n.p,{children:\"You can see the big chunks of tasks with keypress event in the flame chart. With each keypress, React computes the next rendering for the SearchBar and the Scene. As we see in the chart, the longest task takes almost 0.8 seconds to complete. That's why the page feels so slow.\"}),`\n`,(0,e.jsxs)(n.h3,{id:\"so-whats-happening\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#so-whats-happening\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"So, what's happening?\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"In the Home page component, the SearchBar listens to the keypress event and update the \",(0,e.jsx)(n.code,{children:\"username\"}),\" when changes happens.\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-tsx\",children:(0,e.jsxs)(n.code,{className:\"language-tsx code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"Home\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"NextPage\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" setUsername\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token generic-function\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"useState\"}),(0,e.jsxs)(n.span,{className:\"token generic class-name\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"})]})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" vertices \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"useMemo\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"computeVertices\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"length\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"handleChange\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"username\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setUsername\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token tag\",children:(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"      \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"SearchBar\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"value\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"onChange\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"handleChange\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/\u003e\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"      \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Scene\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"vertices\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"vertices\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/\u003e\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"    \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token tag\",children:(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c/\"})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Whenever there's a \",(0,e.jsx)(n.code,{children:\"username\"}),\" update, React recomputes \",(0,e.jsx)(n.code,{children:\"vertices\"}),\" by calling \",(0,e.jsx)(n.code,{children:\"computeVertices()\"}),\" and pass the result in to the Scene component to render the stars. Since the number of vertices is \",(0,e.jsx)(n.code,{children:\"100,000 * username.length\"}),\", coupling the two state updates together is a very expensive rendering cycle.\"]}),`\n`,(0,e.jsxs)(n.h2,{id:\"how-did-we-fix-it-before-react-18\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#how-did-we-fix-it-before-react-18\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"How did We Fix It Before React 18?\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Ideally, we want to see what we typed in the search bar immediately. Knowing that updating both states in the same rendering cycle takes too long, we can simply split the two updates so that SearchBar and Scene gets rendered separately.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Let's first add a new state for the SearchBar:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-tsx\",children:(0,e.jsxs)(n.code,{className:\"language-tsx code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"FastSearchBarProps\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  defaultValue\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"onChange\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"FastSearchBar\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" defaultValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" onChange \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"FastSearchBarProps\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// new state designated to SearchBar\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" setValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"useState\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"defaultValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"handleChange\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// update input value\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setValue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// update vertices\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"onChange\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"SearchBar\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"value\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"onChange\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"handleChange\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"Home\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"NextPage\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" setUsername\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token generic-function\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"useState\"}),(0,e.jsxs)(n.span,{className:\"token generic class-name\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"})]})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" vertices \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"useMemo\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"computeVertices\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"length\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"handleChange\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"username\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setUsername\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token tag\",children:(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"      \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"FastSearchBar\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"defaultValue\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"onChange\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"handleChange\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/\u003e\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"      \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Scene\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"vertices\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"vertices\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/\u003e\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"    \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token tag\",children:(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c/\"})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Now we have a \",(0,e.jsx)(n.code,{children:\"value\"}),\" state for SearchBar and a \",(0,e.jsx)(n.code,{children:\"username\"}),\" state for computing \",(0,e.jsx)(n.code,{children:\"vertices\"}),\". We'll need additional work to separate the renderings because React will batch the state updates together in the same event to avoid additional rendering. Let's take a look at some of the typical approaches.\"]}),`\n`,(0,e.jsxs)(n.h3,{id:\"approach-1-settimeout\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#approach-1-settimeout\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Approach #1: setTimeout\"]}),`\n`,(0,e.jsx)(n.p,{children:\"We can simply defer the slower update by adding setTimeout to put the it in the event loop.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-tsx\",children:(0,e.jsxs)(n.code,{className:\"language-tsx code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"FastSearchBar\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" defaultValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" onChange \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"FastSearchBarProps\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" setValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"useState\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"defaultValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"handleChange\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setValue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setTimeout\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token function\",children:\"onChange\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"SearchBar\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"value\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"onChange\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"handleChange\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Now even with the 4x slowdown, the SearchBar looks more responsive. We also observed that the stars are getting rendered while we were typing.\"}),`\n`,(0,e.jsxs)(\"video\",{controls:!0,children:[(0,e.jsx)(\"source\",{src:\"/articles/concurrent-react-18/perf-timeout-throttle-x4.mp4\",type:\"video/mp4\"}),(0,e.jsx)(\"p\",{children:\"Your browser doesn't support HTML5 video.\"})]}),`\n`,(0,e.jsx)(n.p,{children:\"If you take a look at the performance profile, you can see that we were able to separate the keypress events from the expensive tasks.\"}),`\n`,(0,e.jsx)(\"img\",{src:\"/optimized/articles/concurrent-react-18/perf-timeout.webp\",alt:\"Performance profile for rendering with timeout\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"However, we noticed that the Scene was rendered twice after the last keypress event. That's because the renderings were still scheduled with outdated state when the \",(0,e.jsx)(n.code,{children:\"setTimeout\"}),\"s were fired.\"]}),`\n`,(0,e.jsxs)(n.h3,{id:\"approach-2-debouncing\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#approach-2-debouncing\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Approach #2: Debouncing\"]}),`\n`,(0,e.jsx)(n.p,{children:\"We can actually cancel the rendering schedule by implementing debouncing.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-tsx\",children:(0,e.jsxs)(n.code,{className:\"language-tsx code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"FastSearchBar\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" defaultValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" onChange \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"FastSearchBarProps\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" setValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"useState\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"defaultValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" timeout \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token generic-function\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"useRef\"}),(0,e.jsxs)(n.span,{className:\"token generic class-name\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),\"NodeJS\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Timeout\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"})]})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"handleChange\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// cancel the schedule if `value` changed within 100ms.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"clearTimeout\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"timeout\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"current\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setValue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// schedule a new update if input value hasn't changed for 100ms.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    timeout\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"current\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setTimeout\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token function\",children:\"onChange\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"100\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"SearchBar\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"value\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"onChange\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"handleChange\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(\"video\",{controls:!0,children:[(0,e.jsx)(\"source\",{src:\"/articles/concurrent-react-18/perf-debounce-throttle-x4.mp4\",type:\"video/mp4\"}),(0,e.jsx)(\"p\",{children:\"Your browser doesn't support HTML5 video.\"})]}),`\n`,(0,e.jsx)(n.p,{children:\"The user experience looks better now. The SearchBar stays fairly responsive with 4x slowdown and the redundant update on the Scene after the last keypress event was gone.\"}),`\n`,(0,e.jsx)(n.p,{children:\"However, the shortcoming of debouncing in this case is that the Scene update will always be delayed by 100ms. With faster CPU, the delay is most likely redundant and it makes the page feel slow.\"}),`\n`,(0,e.jsx)(\"img\",{src:\"/optimized/articles/concurrent-react-18/perf-debounce.webp\",alt:\"Performance profile for rendering with debouncing\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"react-18s-concurrent-rendering-starttransition\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#react-18s-concurrent-rendering-starttransition\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"React 18's Concurrent Rendering: startTransition\"]}),`\n`,(0,e.jsx)(n.p,{children:\"The page feel more responsive with either adding setTimeout or debouncing, but they introduces different problems:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"setTimeout: results in additional UI updates with outdated states\"}),`\n`,(0,e.jsx)(n.li,{children:\"debouncing: results in artificial delay in UI updates\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"Let's take a look at how React 18 solves the problems with concurrent rendering:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-tsx\",children:(0,e.jsxs)(n.code,{className:\"language-tsx code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,e.jsxs)(n.span,{className:\"token imports\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" startTransition \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'react'\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"FastSearchBarProps\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  defaultValue\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"onChange\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"FastSearchBar\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" defaultValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" onChange \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"FastSearchBarProps\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" setValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"useState\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"defaultValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"handleChange\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setValue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"onChange\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"SearchBar\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"value\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"onChange\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"handleChange\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"Home\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"NextPage\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" setUsername\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token generic-function\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"useState\"}),(0,e.jsxs)(n.span,{className:\"token generic class-name\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u003e\"})]})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" vertices \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"useMemo\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"computeCoordinates\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"length\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"handleChange\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"username\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// defer username update in a less urgent UI transition\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"startTransition\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setUsername\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Container\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"      \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"FastSearchBar\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"defaultValue\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"onChange\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"handleChange\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/\u003e\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"      \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Scene\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"vertices\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"vertices\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/\u003e\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"    \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003c/\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Container\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"\u003e\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"We call \",(0,e.jsx)(n.code,{children:\"setUsername\"}),\" inside of \",(0,e.jsx)(n.code,{children:\"startTransition\"}),\" function. It tells React to defer \",(0,e.jsx)(n.code,{children:\"setUsername\"}),\" to the other urgent updates.\"]}),`\n`,(0,e.jsxs)(\"video\",{controls:!0,children:[(0,e.jsx)(\"source\",{src:\"/articles/concurrent-react-18/perf-transition-throttle-x4.mp4\",type:\"video/mp4\"}),(0,e.jsx)(\"p\",{children:\"Your browser doesn't support HTML5 video.\"})]}),`\n`,(0,e.jsx)(n.p,{children:\"As you can see, we are able to separate the rendering of SearchBar and Scene without any asynchronous functions. If we take a look at the performance profile, we can observe a few things:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"The keypress events are separated from the long rendering function calls.\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"The keypress events are grouped. It aligns with the \",(0,e.jsx)(n.strong,{children:\"yielding\"}),\" behavior in concurrent rendering.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[\"There's only one rendering call after the last group of keypress events. It aligns with the \",(0,e.jsx)(n.strong,{children:\"skipping old results\"}),\" behavior in concurrent rendering.\"]}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"The \",(0,e.jsx)(n.strong,{children:\"interrupting\"}),\" behavior is not very straight forward to observe. If you know how to analyze it from the performance profile, please feel free to \",(0,e.jsx)(n.a,{href:\"https://twitter.com/dawchihliou\",children:\"reach out to me on Twitter\"}),\"!\"]}),`\n`,(0,e.jsx)(\"img\",{src:\"/optimized/articles/concurrent-react-18/perf-transition.webp\",alt:\"Performance profile for rendering with startTransition\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,e.jsx)(n.p,{children:\"Let's remove the slowdown and see the final result:\"}),`\n`,(0,e.jsxs)(\"video\",{controls:!0,children:[(0,e.jsx)(\"source\",{src:\"/articles/concurrent-react-18/perf-transition.mp4\",type:\"video/mp4\"}),(0,e.jsx)(\"p\",{children:\"Your browser doesn't support HTML5 video.\"})]}),`\n`,(0,e.jsx)(n.p,{children:\"As you can see, the SearchBar is always responsive while the Scene updates quickly. The user experience feels so much smoother.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"final-thoughts\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#final-thoughts\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Final Thoughts\"]}),`\n`,(0,e.jsx)(n.p,{children:\"In the past, adding debouncing was the go-to solution for rendering large UI updates while keeping pages responsive. Based on this experiment, concurrent rendering makes the UI more responsive without the shortcoming of debouncing. Even for the heavy computation with at least 100,000 3D objects, concurrent rendering still helped the page to be snappy.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Here's the side-by-side comparisons:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"UI Comparison with 4x CPU Throttling\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Basic implementation without concurrent rendering:\"}),`\n`,(0,e.jsxs)(\"video\",{controls:!0,children:[(0,e.jsx)(\"source\",{src:\"/articles/concurrent-react-18/perf-sync-throttle-x4.mp4\",type:\"video/mp4\"}),(0,e.jsx)(\"p\",{children:\"Your browser doesn't support HTML5 video.\"})]}),`\n`,(0,e.jsx)(n.p,{children:\"Optimized implementation with concurrent rendering:\"}),`\n`,(0,e.jsxs)(\"video\",{controls:!0,children:[(0,e.jsx)(\"source\",{src:\"/articles/concurrent-react-18/perf-transition-throttle-x4.mp4\",type:\"video/mp4\"}),(0,e.jsx)(\"p\",{children:\"Your browser doesn't support HTML5 video.\"})]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"UI Comparison with No CPU Throttling\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Basic implementation without concurrent rendering:\"}),`\n`,(0,e.jsxs)(\"video\",{controls:!0,children:[(0,e.jsx)(\"source\",{src:\"/articles/concurrent-react-18/perf-sync.mp4\",type:\"video/mp4\"}),(0,e.jsx)(\"p\",{children:\"Your browser doesn't support HTML5 video.\"})]}),`\n`,(0,e.jsx)(n.p,{children:\"Optimized implementation with concurrent rendering:\"}),`\n`,(0,e.jsxs)(\"video\",{controls:!0,children:[(0,e.jsx)(\"source\",{src:\"/articles/concurrent-react-18/perf-transition.mp4\",type:\"video/mp4\"}),(0,e.jsx)(\"p\",{children:\"Your browser doesn't support HTML5 video.\"})]}),`\n`,(0,e.jsxs)(n.h2,{id:\"references\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#references\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"References\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/DawChihLiou/concurrent-react-stress-testing\",children:\"GitHub: Demo repository\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://sweaty-concurrent-react.netlify.app\",children:\"Website: Demo Site\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://reactjs.org/blog/2022/03/29/react-v18.html\",children:\"Website: React v18.0\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/reactwg/react-18/discussions/41\",children:\"GitHub: New feature: startTransition\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/reactwg/react-18/discussions/65\",children:\"GitHub: Real world example: adding startTransition for slow renders\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/mrdoob/three.js/\",children:\"GitHub: three.js\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/pmndrs/react-three-fiber\",children:\"GitHub: react-three-fiber\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://webgl-globe-solutions.stackblitz.io\",children:\"Website: WebGL Globe Solution\"})}),`\n`]}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsxs)(n.p,{children:[\"Here you have it! Thanks for reading through\",(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"raising hands\",children:\"\\u{1F64C}\"}),`\nIf you find this article useful, please share it to help more people in their engineering journey.`]}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"bird\",children:\"\\u{1F426}\"}),\" Feel free to connect with me on \",(0,e.jsx)(n.a,{href:\"https://twitter.com/dawchihliou\",children:\"twitter\"}),\"!\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u23ED Ready for the next article? \",(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"backhand index pointing right\",children:\"\\u{1F449}\"}),\" \",(0,e.jsx)(n.a,{href:\"/articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters\",children:(0,e.jsx)(n.strong,{children:\"I Built A Snappy Static Full-text Search with WebAssembly, Rust, Next.js, and Xor Filters\"})})]}),`\n`,(0,e.jsx)(n.p,{children:\"Happy coding!\"})]})}function v(a={}){let{wrapper:n}=a.components||{};return n?(0,e.jsx)(n,Object.assign({},a,{children:(0,e.jsx)(p,a)})):p(a)}var y=v;return w(x);})();\n;return Component;"},"_id":"articles/stress-testing-concurrent-features-in-react-18.mdx","_raw":{"sourceFilePath":"articles/stress-testing-concurrent-features-in-react-18.mdx","sourceFileName":"stress-testing-concurrent-features-in-react-18.mdx","sourceFileDir":"articles","contentType":"mdx","flattenedPath":"articles/stress-testing-concurrent-features-in-react-18"},"type":"Article","readingTime":{"text":"10 min read","minutes":10,"time":600000,"words":2000},"wordCount":2002,"slug":"stress-testing-concurrent-features-in-react-18"}},"__N_SSG":true},"page":"/articles/[slug]","query":{"slug":"stress-testing-concurrent-features-in-react-18"},"buildId":"tFhmm6xD3rE0bddb1eR6E","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>