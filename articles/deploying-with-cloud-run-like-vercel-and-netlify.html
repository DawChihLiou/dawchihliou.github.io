<!DOCTYPE html><html lang="en"><head><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/svg" sizes="32x32" href="/favicon.svg"/><link rel="icon" type="image/svg" sizes="16x16" href="/favicon.svg"/><link rel="mask-icon" href="/favicon.svg" color="#ffffff"/><link rel="manifest" href="/site.webmanifest"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><meta name="msapplication-TileColor" content="#007cf0"/><meta name="theme-color" content="#ffff"/><title>Deploying Like Vercel and Netlify with Cloud Run: Live, Preview, and Modern Workflow</title><meta name="description" content="The modern workflow that unlocks your team&#x27;s potential to ship faster."/><meta name="robots" content="follow, index"/><link rel="canonical" href="https://dawchihliou.github.io/articles/deploying-with-cloud-run-like-vercel-and-netlify"/><meta itemProp="name" content="Deploying Like Vercel and Netlify with Cloud Run: Live, Preview, and Modern Workflow"/><meta itemProp="description" content="The modern workflow that unlocks your team&#x27;s potential to ship faster."/><meta itemProp="image" content="https://dawchihliou.github.io/optimized/articles/deploy-with-cloud-run/hero.png"/><meta property="og:title" content="Deploying Like Vercel and Netlify with Cloud Run: Live, Preview, and Modern Workflow"/><meta property="og:type" content="website"/><meta property="og:url" content="https://dawchihliou.github.io/articles/deploying-with-cloud-run-like-vercel-and-netlify"/><meta property="og:description" content="The modern workflow that unlocks your team&#x27;s potential to ship faster."/><meta property="og:image" content="https://dawchihliou.github.io/optimized/articles/deploy-with-cloud-run/hero.png"/><meta property="og:image:type" content="image/png"/><meta property="og:image:width" content="1400"/><meta property="og:image:height" content="600"/><meta property="og:image:alt" content="The modern workflow that unlocks your team&#x27;s potential to ship faster."/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@dawchihliou"/><meta name="twitter:creator" content="@dawchihliou"/><meta name="twitter:title" content="Deploying Like Vercel and Netlify with Cloud Run: Live, Preview, and Modern Workflow"/><meta name="twitter:description" content="The modern workflow that unlocks your team&#x27;s potential to ship faster."/><meta name="twitter:image" content="https://dawchihliou.github.io/optimized/articles/deploy-with-cloud-run/hero.webp"/><meta property="article:published_time" content="2022-11-30T00:00:00.000Z"/><meta property="article:section" content="Article Section"/><meta property="article:tag" content="Article Tag"/><meta name="next-head-count" content="34"/><link rel="preload" href="/_next/static/css/f4214c3b71874d65.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f4214c3b71874d65.css" data-n-g=""/><link rel="preload" href="/_next/static/css/54ba867c7255694d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/54ba867c7255694d.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-59c5c889f52620d6.js" defer=""></script><script src="/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/_next/static/chunks/main-010ff0b6bbe5ac8f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5784eb5f9f6cd23e.js" defer=""></script><script src="/_next/static/chunks/pages/articles/%5Bslug%5D-9a8f919cad4c24e6.js" defer=""></script><script src="/_next/static/2U3Dcm5RVLxSdI7jxkC5t/_buildManifest.js" defer=""></script><script src="/_next/static/2U3Dcm5RVLxSdI7jxkC5t/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div id="outer-container"><header><div><div class="bm-overlay" style="position:fixed;z-index:1000;width:100%;height:100%;background:rgba(0, 0, 0, 0.3);opacity:0;-moz-transform:translate3d(100%, 0, 0);-ms-transform:translate3d(100%, 0, 0);-o-transform:translate3d(100%, 0, 0);-webkit-transform:translate3d(100%, 0, 0);transform:translate3d(100%, 0, 0);transition:opacity 0.3s, transform 0s 0.3s"></div><div><div class="bm-burger-button" style="z-index:1000"><button id="react-burger-menu-btn" style="position:absolute;left:0;top:0;z-index:1;width:100%;height:100%;margin:0;padding:0;border:none;font-size:0;background:transparent;cursor:pointer">Open Menu</button><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="bm-icon" style="width:100%;height:100%" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div></div><div id="" class="bm-menu-wrap" style="position:fixed;right:inherit;z-index:1100;width:300px;height:100%;-moz-transform:translate3d(-100%, 0, 0);-ms-transform:translate3d(-100%, 0, 0);-o-transform:translate3d(-100%, 0, 0);-webkit-transform:translate3d(-100%, 0, 0);transform:translate3d(-100%, 0, 0);transition:all 0.5s" aria-hidden="true"><div class="bm-menu" style="height:100%;box-sizing:border-box;overflow:auto"><nav class="bm-item-list" style="height:100%"><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/"><button class="Nav_button__YJwKE" tabindex="-1">Home</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/articles"><button class="Nav_button__YJwKE" tabindex="-1">Articles</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/work"><button class="Nav_button__YJwKE" tabindex="-1">Work</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/now"><button class="Nav_button__YJwKE" tabindex="-1">Now</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/expertise"><button class="Nav_button__YJwKE" tabindex="-1">Expertise</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/contact"><button class="Nav_button__YJwKE" tabindex="-1">Contact</button></a><span class="bm-item Nav_pusher__93Gc6" style="display:block" tabindex="-1"></span><span class="bm-item Nav_divider__QD8Pt" style="display:block" tabindex="-1"></span><div class="bm-item Nav_profile__Kf2nU" style="display:block" tabindex="-1"><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/dawchihliou" aria-label="Link to Daw-Chih&#x27;s Linkedin profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M20.45175,20.45025 L16.89225,20.45025 L16.89225,14.88075 C16.89225,13.5525 16.86975,11.844 15.04275,11.844 C13.191,11.844 12.90825,13.2915 12.90825,14.7855 L12.90825,20.45025 L9.3525,20.45025 L9.3525,8.997 L12.765,8.997 L12.765,10.563 L12.81375,10.563 C13.2885,9.66225 14.4495,8.71275 16.18125,8.71275 C19.78575,8.71275 20.45175,11.08425 20.45175,14.169 L20.45175,20.45025 Z M5.33925,7.4325 C4.1955,7.4325 3.27375,6.50775 3.27375,5.36775 C3.27375,4.2285 4.1955,3.30375 5.33925,3.30375 C6.47775,3.30375 7.4025,4.2285 7.4025,5.36775 C7.4025,6.50775 6.47775,7.4325 5.33925,7.4325 L5.33925,7.4325 Z M7.11975,20.45025 L3.5565,20.45025 L3.5565,8.997 L7.11975,8.997 L7.11975,20.45025 Z M23.00025,0 L1.0005,0 C0.44775,0 0,0.44775 0,0.99975 L0,22.9995 C0,23.55225 0.44775,24 1.0005,24 L23.00025,24 C23.55225,24 24,23.55225 24,22.9995 L24,0.99975 C24,0.44775 23.55225,0 23.00025,0 L23.00025,0 Z"></path></svg></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou" aria-label="Link to Daw-Chih&#x27;s GitHub profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M11.9989871,1 C5.92550416,1 1,5.92482888 1,12.0003376 C1,16.8603395 4.15153934,20.9829338 8.52263728,22.4374904 C9.0729918,22.5387827 9.27355045,22.199116 9.27355045,21.9073943 C9.27355045,21.6467356 9.2640965,20.954572 9.25869425,20.0368642 C6.19899322,20.7013414 5.55342398,18.5620492 5.55342398,18.5620492 C5.0530403,17.2911692 4.33183953,16.9528531 4.33183953,16.9528531 C3.33309801,16.2708186 4.40747107,16.2843243 4.40747107,16.2843243 C5.51155652,16.3619816 6.09229872,17.4181221 6.09229872,17.4181221 C7.07348292,19.0988981 8.66714755,18.6133706 9.2938089,18.3317781 C9.39375058,17.6213819 9.67804414,17.1365297 9.99205009,16.86169 C7.54955646,16.5841493 4.98146045,15.6401056 4.98146045,11.4249977 C4.98146045,10.224347 5.41026428,9.24181221 6.11390773,8.47334172 C6.00046042,8.19512569 5.62297799,7.07618404 6.22195279,5.56220265 C6.22195279,5.56220265 7.14506277,5.26642929 9.24653918,6.68992296 C10.12373,6.44547101 11.0650726,6.32392032 12.0003376,6.31919335 C12.9349274,6.32392032 13.8755947,6.44547101 14.7541361,6.68992296 C16.8542619,5.26642929 17.7760214,5.56220265 17.7760214,5.56220265 C18.3763467,7.07618404 17.9988643,8.19512569 17.8860923,8.47334172 C18.5910863,9.24181221 19.0165137,10.224347 19.0165137,11.4249977 C19.0165137,15.6509101 16.444366,16.5807729 13.9944443,16.8529114 C14.3888087,17.192578 14.7406305,17.863808 14.7406305,18.890236 C14.7406305,20.3603241 14.7271248,21.5467939 14.7271248,21.9073943 C14.7271248,22.2018171 14.9256576,22.5441849 15.4834403,22.4368151 C19.8511618,20.9788821 23,16.8589889 23,12.0003376 C23,5.92482888 18.0744958,1 11.9989871,1"></path></svg></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://medium.com/@dawchihliou" aria-label="Link to Daw-Chih&#x27;s Medium profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2.84593838,5.88685595 C2.87575654,5.59224254 2.76340763,5.30104995 2.54341737,5.10276397 L0.302521008,2.4032473 L0.302521008,2 L7.2605042,2 L12.6386555,13.7949836 L17.3669469,2 L24,2 L24,2.4032473 L22.0840336,4.2402628 C21.9188563,4.36617057 21.8369199,4.57310892 21.8711485,4.77792587 L21.8711485,18.2755093 C21.8369199,18.4803262 21.9188563,18.6872645 22.0840336,18.8131723 L23.9551821,20.6501878 L23.9551821,21.0534351 L14.5434174,21.0534351 L14.5434174,20.6501878 L16.4817928,18.7683671 C16.6722689,18.5779447 16.6722689,18.5219382 16.6722689,18.2307041 L16.6722689,7.32062416 L11.2829132,21.0086299 L10.5546219,21.0086299 L4.28011204,7.32062416 L4.28011204,16.4945003 C4.22779746,16.8801958 4.35589372,17.2685069 4.62745097,17.5474239 L7.14845938,20.6053826 L7.14845938,21.0086299 L0,21.0086299 L0,20.6053826 L2.5210084,17.5474239 C2.79058848,17.2680445 2.91121535,16.8771576 2.84593838,16.4945003 L2.84593838,5.88685595 Z"></path></svg></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://hackernoon.com/u/dawchihliou" aria-label="Link to Daw-Chih&#x27;s Hackernoon profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="1.5em" width="1.5em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M5.701 0v6.223H8.85V4.654h1.576v7.842H12V4.654h1.574v1.569h3.15V0zm11.024 6.223v3.136h1.574V6.223zm1.574 3.136v4.705h1.576v-1.568h1.574v-1.568h-1.574V9.359zm0 4.705h-1.574v3.137h1.574zm-1.574 3.137h-3.15v1.569H8.85V17.2H5.7V24h11.024zm-11.024 0v-3.137H4.125v3.137zm-1.576-3.137V9.36H2.551v4.705zm0-4.705h1.576V6.223H4.125Z"></path></svg><span hidden="">Link to Daw-Chih&#x27;s Hacker Noon profile</span></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://twitter.com/dawchihliou" aria-label="Link to Daw-Chih&#x27;s Twitter profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M24,4.3086 C23.117,4.7006 22.168,4.9646 21.172,5.0836 C22.188,4.4746 22.969,3.5096 23.337,2.3596 C22.386,2.9246 21.332,3.3336 20.21,3.5556 C19.312,2.5976 18.032,1.9996 16.616,1.9996 C13.897,1.9996 11.692,4.2046 11.692,6.9236 C11.692,7.3096 11.736,7.6856 11.82,8.0456 C7.728,7.8406 4.099,5.8806 1.671,2.9006 C1.247,3.6286 1.004,4.4736 1.004,5.3766 C1.004,7.0846 1.873,8.5926 3.195,9.4756 C2.388,9.4486 1.628,9.2276 0.964,8.8596 L0.964,8.9206 C0.964,11.3066 2.661,13.2966 4.914,13.7486 C4.501,13.8626 4.065,13.9216 3.617,13.9216 C3.299,13.9216 2.991,13.8906 2.69,13.8336 C3.317,15.7896 5.135,17.2136 7.29,17.2536 C5.604,18.5736 3.481,19.3606 1.175,19.3606 C0.777,19.3606 0.385,19.3376 0,19.2926 C2.179,20.6886 4.767,21.5046 7.548,21.5046 C16.605,21.5046 21.557,14.0016 21.557,7.4946 C21.557,7.2816 21.552,7.0696 21.543,6.8586 C22.505,6.1636 23.34,5.2966 24,4.3086"></path></svg></a></div><div class="DarkmodeSwitch_container__uFGHQ" tabindex="-1"><div class="DarkmodeSwitch_wrap__e71_4"></div></div></nav></div><div><div class="bm-cross-button" style="position:absolute;width:24px;height:24px;right:8px;top:8px"><button id="react-burger-cross-btn" style="position:absolute;left:0;top:0;z-index:1;width:100%;height:100%;margin:0;padding:0;border:none;font-size:0;background:transparent;cursor:pointer" tabindex="-1">Close Menu</button><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="bm-cross" style="width:100%;height:100%" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div></div></div></div></header><div class="Menubar_menubar__gvU4b"><a class="styles_anchor__g18qA Menubar_hireMe__zuAig" href="/contact"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1.5em" width="1.5em" xmlns="http://www.w3.org/2000/svg"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>Hire Me</a><div class="DarkmodeSwitch_container__uFGHQ" tabindex="0"><div class="DarkmodeSwitch_wrap__e71_4"></div></div><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou" aria-label="See more Daw-Chih&#x27;s work on GitHub"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1.5em" width="1.5em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M11.9989871,1 C5.92550416,1 1,5.92482888 1,12.0003376 C1,16.8603395 4.15153934,20.9829338 8.52263728,22.4374904 C9.0729918,22.5387827 9.27355045,22.199116 9.27355045,21.9073943 C9.27355045,21.6467356 9.2640965,20.954572 9.25869425,20.0368642 C6.19899322,20.7013414 5.55342398,18.5620492 5.55342398,18.5620492 C5.0530403,17.2911692 4.33183953,16.9528531 4.33183953,16.9528531 C3.33309801,16.2708186 4.40747107,16.2843243 4.40747107,16.2843243 C5.51155652,16.3619816 6.09229872,17.4181221 6.09229872,17.4181221 C7.07348292,19.0988981 8.66714755,18.6133706 9.2938089,18.3317781 C9.39375058,17.6213819 9.67804414,17.1365297 9.99205009,16.86169 C7.54955646,16.5841493 4.98146045,15.6401056 4.98146045,11.4249977 C4.98146045,10.224347 5.41026428,9.24181221 6.11390773,8.47334172 C6.00046042,8.19512569 5.62297799,7.07618404 6.22195279,5.56220265 C6.22195279,5.56220265 7.14506277,5.26642929 9.24653918,6.68992296 C10.12373,6.44547101 11.0650726,6.32392032 12.0003376,6.31919335 C12.9349274,6.32392032 13.8755947,6.44547101 14.7541361,6.68992296 C16.8542619,5.26642929 17.7760214,5.56220265 17.7760214,5.56220265 C18.3763467,7.07618404 17.9988643,8.19512569 17.8860923,8.47334172 C18.5910863,9.24181221 19.0165137,10.224347 19.0165137,11.4249977 C19.0165137,15.6509101 16.444366,16.5807729 13.9944443,16.8529114 C14.3888087,17.192578 14.7406305,17.863808 14.7406305,18.890236 C14.7406305,20.3603241 14.7271248,21.5467939 14.7271248,21.9073943 C14.7271248,22.2018171 14.9256576,22.5441849 15.4834403,22.4368151 C19.8511618,20.9788821 23,16.8589889 23,12.0003376 C23,5.92482888 18.0744958,1 11.9989871,1"></path></svg></a></div><div id="page-wrap"><article><div class="Article_container__q__L3"><div class="Article_wrap__LZypL"><h1>Deploying Like Vercel and Netlify with Cloud Run: Live, Preview, and Modern Workflow</h1><div class="Article_info__bOKys"><div class="Article_author__grS8U"><img alt="Daw-Chih Liou" src="/optimized/raw/portrait-sm.webp" loading="lazy"/><p>Daw-Chih Liou</p></div><p>Nov 30, 2022<!-- --> · 10 min read</p></div><img alt="Deploying Like Vercel and Netlify with Cloud Run: Live, Preview, and Modern Workflow" src="/optimized/articles/deploy-with-cloud-run/hero.webp" width="100%" class="rounded centered" loading="lazy"/><div class="article-content"><h2 id="tldr"><a class="styles_anchor__g18qA anchor" href="/articles/deploying-with-cloud-run-like-vercel-and-netlify#tldr"><span class="icon icon-link"></span></a>TL;DR</h2>
<ul>
<li><span role="img" aria-label="cloud">☁️</span> We&#x27;ll learn how to deploy on Google Cloud Run</li>
<li><span role="img" aria-label="sparkles">✨</span> We&#x27;ll learn how to design and implement a modern workflow with GitHub Actions</li>
<li><span role="img" aria-label="" aria-hidden="true">🤿</span> We&#x27;ll see code snippets of real-world workflows</li>
</ul>
<hr/>
<p>This article is also available on</p>
<ul>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://medium.com/gitconnected/deploying-like-vercel-and-netlify-with-cloud-run-live-preview-and-modern-workflow-ea661e411136">Level Up Coding</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://hackernoon.com/deploy-like-vercel-and-netlify-with-cloud-run-live-preview-and-modern-workflow">Hacker Noon</a></li>
</ul>
<p>Feel free to read it on your favorite platform<span role="img" aria-label="sparkles">✨</span></p>
<hr/>
<p>If you want to learn how to deploy like <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://vercel.com/features/previews">Vercel</a> or <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.netlify.com/products/deploy-previews/">Netlify</a> with <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com">Google Cloud</a>, this is the right place for you.</p>
<p>Vercel and Netlify both offer seamless transition from development to shipping your features and they make <a class="styles_anchor__g18qA undefined" href="/articles/ex-principal-engineers-guide-to-design-thinking-and-continous-delivery#what-is-continuous-delivery">continuous delivery</a> accessible out of the box. Today we&#x27;ll be looking into how to design and re-create the live deployment and <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://vercel.com/features/previews">Deploy Preview</a> with <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/run">Cloud Run</a> and <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/features/actions">GitHub Actions</a>.</p>
<p>Let&#x27;s go.</p>
<h2 id="the-modern-workflow-design"><a class="styles_anchor__g18qA anchor" href="/articles/deploying-with-cloud-run-like-vercel-and-netlify#the-modern-workflow-design"><span class="icon icon-link"></span></a>The Modern Workflow Design</h2>
<p>If you are familiar with <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://vercel.com/">Vercel</a> or <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.netlify.com/">Netlify</a>, you&#x27;ll notice the <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/architecture/devops/devops-tech-trunk-based-development">trunk-based development</a> principle by default. Your code changes directly go <strong>live</strong> when pushing your commits or merging a pull request to the <em>main</em> branch. Whenever you work on a pull request, both platforms create <strong>Deploy Previews</strong> so that you can collect feedback from your reviewers and stakeholders during development. This type of workflow enables us to collaborate early, mitigate errors, and ship fast.</p>
<p>To design the workflow, we can break it down to two paths:</p>
<ul>
<li>Production workflow: triggered by <em>push</em> events in the <em>main</em> branch.</li>
<li>Preview workflow: triggered by <em>push</em> and <em>pull_request</em> events in all branches except <em>main</em>.</li>
</ul>
<img src="/optimized/articles/deploy-with-cloud-run/workflows.webp" alt="workflows overview" width="100%" class="rounded centered" loading="lazy"/>
<p>Let&#x27;s look into the <em>prod workflow</em> first.</p>
<h2 id="production-workflow"><a class="styles_anchor__g18qA anchor" href="/articles/deploying-with-cloud-run-like-vercel-and-netlify#production-workflow"><span class="icon icon-link"></span></a>Production Workflow</h2>
<img src="/optimized/articles/deploy-with-cloud-run/workflows-main.webp" alt="production workflow overview" width="100%" class="rounded centered" loading="lazy"/>
<p>The production workflow does only one thing: live deployment. When a pull request merges into <em>main</em>, it triggers the workflow to deploy your production build to <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/run">Cloud Run</a>.</p>
<p>The workflow looks like this:</p>
<p>Set up Google Cloud</p>
<ul>
<li>Authenticate to Google Cloud</li>
<li>Setup Google <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/sdk">Cloud SDK</a></li>
<li>Authorize to push docker containers to <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/artifact-registry">Artifact Registry</a></li>
</ul>
<p>Push Docker Image to Artifact Registry</p>
<ul>
<li>Generate image tag</li>
<li>Build docker container</li>
<li>push docker container to registry</li>
</ul>
<p>Deploy</p>
<ul>
<li>Deploy to Cloud Run</li>
</ul>
<h3 id="set-up-google-cloud"><a class="styles_anchor__g18qA anchor" href="/articles/deploying-with-cloud-run-like-vercel-and-netlify#set-up-google-cloud"><span class="icon icon-link"></span></a>Set up Google Cloud</h3>
<blockquote>
<p>If you don&#x27;t have a project on Google Cloud yet, follow <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/resource-manager/docs/creating-managing-projects">this guide</a> to create one. I&#x27;ll name my project <em>awesome-project</em>.</p>
</blockquote>
<p>To authenticate the workflow to access Google Cloud, we can use the <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/google-github-actions/auth"><em>auth</em></a> GitHub Action to create an access token:</p>
<pre class="language-yaml"><code class="language-yaml code-highlight"><span class="code-line"><span class="token key atrule">env</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token key atrule">PROJECT_ID</span><span class="token punctuation">:</span> <span class="token string">&#x27;awesome-project&#x27;</span>
</span><span class="code-line">  <span class="token key atrule">SERVICE</span><span class="token punctuation">:</span> <span class="token string">&#x27;homepage&#x27;</span>
</span><span class="code-line">  <span class="token key atrule">REGION</span><span class="token punctuation">:</span> <span class="token string">&#x27;us-west1&#x27;</span> <span class="token comment"># <span role="img" aria-label="shamrock">☘️</span>Low CO2</span>
</span><span class="code-line">  <span class="token key atrule">REGISTRY</span><span class="token punctuation">:</span> <span class="token string">&#x27;[YOUR_REGISTRY_ID]&#x27;</span>
</span><span class="code-line">  <span class="token key atrule">IMAGE_NAME</span><span class="token punctuation">:</span> <span class="token string">&#x27;live&#x27;</span>
</span><span class="code-line">  <span class="token key atrule">WORKLOAD_IDENTITY_PROVIDER</span><span class="token punctuation">:</span> <span class="token string">&#x27;[YOUR_WORKLOAD_PROVIDER_ID]&#x27;</span>
</span><span class="code-line">  <span class="token key atrule">SERVICE_ACCOUNT</span><span class="token punctuation">:</span> <span class="token string">&#x27;[YOUR_SERVICE_ACCOUNT_ID]&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token key atrule">jobs</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token key atrule">deploy</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span><span class="token number">20.04</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout
</span><span class="code-line">        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
</span><span class="code-line">
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#x27;Authenticate to Google Cloud&#x27;</span>
</span><span class="code-line">        <span class="token key atrule">uses</span><span class="token punctuation">:</span> <span class="token string">&#x27;google-github-actions/auth@v0.4.0&#x27;</span>
</span><span class="code-line">        <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token string">&#x27;auth&#x27;</span>
</span><span class="code-line">        <span class="token key atrule">with</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token key atrule">token_format</span><span class="token punctuation">:</span> <span class="token string">&#x27;access_token&#x27;</span>
</span><span class="code-line">          <span class="token key atrule">workload_identity_provider</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> env.WORKLOAD_IDENTITY_PROVIDER <span class="token punctuation">}</span><span class="token punctuation">}</span>
</span><span class="code-line">          <span class="token key atrule">service_account</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> env.SERVICE_ACCOUNT <span class="token punctuation">}</span><span class="token punctuation">}</span>
</span></code></pre>
<p>Here we are authenticating via <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/iam/docs/workload-identity-federation">Workload Identity Federation</a>. To make it work, we&#x27;ll need</p>
<ul>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/iam/docs/creating-managing-service-account-keys">a service account</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/iam/docs/configuring-workforce-identity-federation">a workload identity provider</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/blog/products/identity-security/enabling-keyless-authentication-from-github-actions">to grand IAM roles to the Workload Identity Provider</a>.</li>
</ul>
<p>Congratulations, you&#x27;ve done it! It&#x27;s the most difficult part of the workflow.</p>
<p>Now we can set up Cloud SDK and authorize the workflow to be able to push Docker containers to Artifact Registry:</p>
<pre class="language-yaml"><code class="language-yaml code-highlight"><span class="code-line"><span class="token key atrule">steps</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Set up Cloud SDK
</span><span class="code-line">    <span class="token key atrule">uses</span><span class="token punctuation">:</span> google<span class="token punctuation">-</span>github<span class="token punctuation">-</span>actions/setup<span class="token punctuation">-</span>gcloud@v0
</span><span class="code-line">
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Authorize Docker push
</span><span class="code-line">    <span class="token key atrule">run</span><span class="token punctuation">:</span> gcloud auth configure<span class="token punctuation">-</span>docker $<span class="token punctuation">{</span><span class="token punctuation">{</span> env.REGISTRY <span class="token punctuation">}</span><span class="token punctuation">}</span>
</span></code></pre>
<p>You can follow <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/artifact-registry/docs/docker/store-docker-container-images">this guide</a> to set up Artifact Registry for storing Docker containers.</p>
<h3 id="push-docker-image-to-artifact-registry"><a class="styles_anchor__g18qA anchor" href="/articles/deploying-with-cloud-run-like-vercel-and-netlify#push-docker-image-to-artifact-registry"><span class="icon icon-link"></span></a>Push Docker Image to Artifact Registry</h3>
<p>We are now able to push containers so let&#x27;s dockerize your project and tag your image:</p>
<pre class="language-yaml"><code class="language-yaml code-highlight"><span class="code-line"><span class="token key atrule">steps</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Generate Image Tag
</span><span class="code-line">    <span class="token key atrule">id</span><span class="token punctuation">:</span> image<span class="token punctuation">-</span>tag
</span><span class="code-line">    <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line"><span class="token scalar string">      image_tag=&quot;$REGISTRY/$PROJECT_ID/$SERVICE/$IMAGE_NAME:${GITHUB_SHA::8}&quot;
</span></span><span class="code-line"><span class="token scalar string">      echo &quot;tag=$image_tag&quot; &gt;&gt; $GITHUB_OUTPUT</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build Docker Container
</span><span class="code-line">    <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line"><span class="token scalar string">      docker build -t ${{ steps.image-tag.outputs.tag }}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Push Docker Container
</span><span class="code-line">    <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line"><span class="token scalar string">      docker push ${{ steps.image-tag.outputs.tag }}</span>
</span></code></pre>
<h3 id="deploy"><a class="styles_anchor__g18qA anchor" href="/articles/deploying-with-cloud-run-like-vercel-and-netlify#deploy"><span class="icon icon-link"></span></a>Deploy</h3>
<p>Now you are ready to deploy to cloud run using the docker container:</p>
<pre class="language-yaml"><code class="language-yaml code-highlight"><span class="code-line"><span class="token key atrule">steps</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy to Cloud Run
</span><span class="code-line">    <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line"><span class="token scalar string">      gcloud run deploy ${{ env.SERVICE }} \
</span></span><span class="code-line"><span class="token scalar string">        --platform &quot;managed&quot;
</span></span><span class="code-line"><span class="token scalar string">        --region ${{ env.REGION }} \
</span></span><span class="code-line"><span class="token scalar string">        --image ${{ steps.image-tag.outputs.tag }}</span>
</span></code></pre>
<p>Cloud Run will assign 100% of the traffic to this deployment by default so all visitors will be directed to this revision.</p>
<p>In the Cloud Console, you&#x27;ll find a URL to your Cloud Run deployment. It looks like this: <em><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://homepage-12345abcde-ez.a.run.app">https://homepage-12345abcde-ez.a.run.app</a></em>. We&#x27;ll need it later for our preview workflow.</p>
<h3 id="the-complete-production-workflow"><a class="styles_anchor__g18qA anchor" href="/articles/deploying-with-cloud-run-like-vercel-and-netlify#the-complete-production-workflow"><span class="icon icon-link"></span></a>The Complete Production Workflow</h3>
<div class="rehype-code-title">prod-ci.yaml</div><pre class="language-yaml"><code class="language-yaml code-highlight"><span class="code-line"><span class="token key atrule">name</span><span class="token punctuation">:</span> Production Workflow
</span><span class="code-line">
</span><span class="code-line"><span class="token key atrule">on</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token key atrule">push</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token key atrule">branches</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> main
</span><span class="code-line">
</span><span class="code-line"><span class="token key atrule">env</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token key atrule">PROJECT_ID</span><span class="token punctuation">:</span> <span class="token string">&#x27;awesome-project&#x27;</span>
</span><span class="code-line">  <span class="token key atrule">SERVICE</span><span class="token punctuation">:</span> <span class="token string">&#x27;homepage&#x27;</span>
</span><span class="code-line">  <span class="token key atrule">REGION</span><span class="token punctuation">:</span> <span class="token string">&#x27;us-west1&#x27;</span> <span class="token comment"># <span role="img" aria-label="shamrock">☘️</span>Low CO2</span>
</span><span class="code-line">  <span class="token key atrule">REGISTRY</span><span class="token punctuation">:</span> <span class="token string">&#x27;[YOUR_REGISTRY_ID]&#x27;</span>
</span><span class="code-line">  <span class="token key atrule">IMAGE_NAME</span><span class="token punctuation">:</span> <span class="token string">&#x27;live&#x27;</span>
</span><span class="code-line">  <span class="token key atrule">WORKLOAD_IDENTITY_PROVIDER</span><span class="token punctuation">:</span> <span class="token string">&#x27;[YOUR_WORKLOAD_PROVIDER_ID]&#x27;</span>
</span><span class="code-line">  <span class="token key atrule">SERVICE_ACCOUNT</span><span class="token punctuation">:</span> <span class="token string">&#x27;[YOUR_SERVICE_ACCOUNT_ID]&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token key atrule">jobs</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token key atrule">deploy</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span><span class="token number">20.04</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout
</span><span class="code-line">        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
</span><span class="code-line">
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#x27;Authenticate to Google Cloud&#x27;</span>
</span><span class="code-line">        <span class="token key atrule">uses</span><span class="token punctuation">:</span> <span class="token string">&#x27;google-github-actions/auth@v0.4.0&#x27;</span>
</span><span class="code-line">        <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token string">&#x27;auth&#x27;</span>
</span><span class="code-line">        <span class="token key atrule">with</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token key atrule">token_format</span><span class="token punctuation">:</span> <span class="token string">&#x27;access_token&#x27;</span>
</span><span class="code-line">          <span class="token key atrule">workload_identity_provider</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> env.WORKLOAD_IDENTITY_PROVIDER <span class="token punctuation">}</span><span class="token punctuation">}</span>
</span><span class="code-line">          <span class="token key atrule">service_account</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> env.SERVICE_ACCOUNT <span class="token punctuation">}</span><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Set up Cloud SDK
</span><span class="code-line">        <span class="token key atrule">uses</span><span class="token punctuation">:</span> google<span class="token punctuation">-</span>github<span class="token punctuation">-</span>actions/setup<span class="token punctuation">-</span>gcloud@v0
</span><span class="code-line">
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Authorize Docker push
</span><span class="code-line">        <span class="token key atrule">run</span><span class="token punctuation">:</span> gcloud auth configure<span class="token punctuation">-</span>docker $<span class="token punctuation">{</span><span class="token punctuation">{</span> env.REGISTRY <span class="token punctuation">}</span><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Generate Image Tag
</span><span class="code-line">        <span class="token key atrule">id</span><span class="token punctuation">:</span> image<span class="token punctuation">-</span>tag
</span><span class="code-line">        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line"><span class="token scalar string">          image_tag=&quot;$REGISTRY/$PROJECT_ID/$SERVICE/$IMAGE_NAME:${GITHUB_SHA::8}&quot;
</span></span><span class="code-line"><span class="token scalar string">          echo &quot;tag=$image_tag&quot; &gt;&gt; $GITHUB_OUTPUT</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build Docker Container
</span><span class="code-line">        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line"><span class="token scalar string">          docker build -t ${{ steps.image-tag.outputs.tag }}</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Push Docker Container
</span><span class="code-line">        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line"><span class="token scalar string">          docker push ${{ steps.image-tag.outputs.tag }}</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy to Cloud Run
</span><span class="code-line">        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line"><span class="token scalar string">          gcloud run deploy ${{ env.SERVICE }} \
</span></span><span class="code-line"><span class="token scalar string">            --platform &quot;managed&quot;
</span></span><span class="code-line"><span class="token scalar string">            --region ${{ env.REGION }} \
</span></span><span class="code-line"><span class="token scalar string">            --image ${{ steps.image-tag.outputs.tag }}</span>
</span></code></pre>
<h2 id="preview-workflow"><a class="styles_anchor__g18qA anchor" href="/articles/deploying-with-cloud-run-like-vercel-and-netlify#preview-workflow"><span class="icon icon-link"></span></a>Preview Workflow</h2>
<img src="/optimized/articles/deploy-with-cloud-run/workflows-branch.webp" alt="preview workflow overview" width="100%" class="rounded centered" loading="lazy"/>
<p>The preview workflow is similar to production with a few modifications:</p>
<p>Set up Google Cloud</p>
<ul>
<li>Authenticate to Google Cloud</li>
<li>Setup Google <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/sdk">Cloud SDK</a></li>
<li>Authorize to push docker containers to <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/artifact-registry">Artifact Registry</a></li>
</ul>
<p>Push Docker Image to Artifact Registry</p>
<ul>
<li><strong>Get Task Id from Reference</strong></li>
<li>Generate image tag</li>
<li>Build docker container</li>
<li>push docker container to registry</li>
</ul>
<p>Deploy</p>
<ul>
<li><strong>Deploy revision with tag</strong></li>
<li><strong>Comment preview URL in the pull request</strong></li>
</ul>
<p>Let&#x27;s take a look at the differences.</p>
<h3 id="push-docker-image-to-artifact-registry-1"><a class="styles_anchor__g18qA anchor" href="/articles/deploying-with-cloud-run-like-vercel-and-netlify#push-docker-image-to-artifact-registry-1"><span class="icon icon-link"></span></a>Push Docker Image to Artifact Registry</h3>
<p>The first difference is tagging the Docker image. In the production workflow, we use a constant <code>$IMAGE_NAME</code> in environment variables to tag the production image. However, for previews, we want to use an identifier that represents the pull request. We are using the first 8 characters of the branch name as the identifier:</p>
<pre class="language-yaml"><code class="language-yaml code-highlight"><span class="code-line"><span class="token key atrule">steps</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Get Task Id from Reference
</span><span class="code-line">  <span class="token key atrule">id</span><span class="token punctuation">:</span> task
</span><span class="code-line">  <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line"><span class="token scalar string">    name=&quot;${{ github.ref_name }}&quot;
</span></span><span class="code-line"><span class="token scalar string">    lowercase=&quot;${name,,}&quot;
</span></span><span class="code-line"><span class="token scalar string">    echo &quot;id=${lowercase:0:8}&quot; &gt;&gt; $GITHUB_OUTPUT</span>
</span></code></pre>
<p>As an example I&#x27;ll name the branch <em>TASK-123-awesome-workflow</em>. The <em>task</em> step will extract the task ID <em>task-123</em> from the branch name.</p>
<blockquote>
<p>If you are curious about the shell script syntax, check out <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html">Shell Parameter Expansion</a>.</p>
</blockquote>
<p>The identifier is set to be in lowercase because we&#x27;ll use it for tagging the Cloud Run revision later. The naming convention of <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/run/docs/rollouts-rollbacks-traffic-migration#tags">Cloud Run tags</a> is as follows:</p>
<ul>
<li>it allows lowercase characters</li>
<li>it allows numbers</li>
<li>it allows &quot;-&quot;</li>
<li>it has a maximum length limit of 63 characters</li>
</ul>
<p>Next we can use the task id to tag the image, build a container, and push to the registry:</p>
<pre class="language-yaml"><code class="language-yaml code-highlight"><span class="code-line"><span class="token key atrule">steps</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Generate Image Tag
</span><span class="code-line">    <span class="token key atrule">id</span><span class="token punctuation">:</span> image<span class="token punctuation">-</span>tag
</span><span class="code-line">    <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line"><span class="token scalar string">      image_tag=&quot;$REGISTRY/$PROJECT_ID/$SERVICE/${{ steps.task.outputs.id }}:${GITHUB_SHA::8}&quot;
</span></span><span class="code-line"><span class="token scalar string">      echo &quot;tag=$image_tag&quot; &gt;&gt; $GITHUB_OUTPUT</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build Docker Container
</span><span class="code-line">    <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line"><span class="token scalar string">      docker build -t ${{ steps.image-tag.outputs.tag }}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Push Docker Container
</span><span class="code-line">    <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line"><span class="token scalar string">      docker push ${{ steps.image-tag.outputs.tag }}</span>
</span></code></pre>
<h3 id="deploy-1"><a class="styles_anchor__g18qA anchor" href="/articles/deploying-with-cloud-run-like-vercel-and-netlify#deploy-1"><span class="icon icon-link"></span></a>Deploy</h3>
<p>Now we are ready to deploy the preview. The deployment is similar to live deployment with two differences:</p>
<ul>
<li>Unlike live deployment, we want to assign 0% of the traffic to the preview revision.</li>
<li>We want to give the deployment a different URL other than the live URL.</li>
</ul>
<p>We can use <em>--tag</em> and <em>--no-traffic</em> parameters to achieve them:</p>
<pre class="language-yaml"><code class="language-yaml code-highlight"><span class="code-line"><span class="token key atrule">steps</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy Revision with Tag
</span><span class="code-line">      <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line"><span class="token scalar string">        gcloud run deploy ${{ env.SERVICE }} \
</span></span><span class="code-line"><span class="token scalar string">          --platform &quot;managed&quot; \
</span></span><span class="code-line"><span class="token scalar string">          --region ${{ env.REGION }} \
</span></span><span class="code-line"><span class="token scalar string">          --image ${{ steps.image-tag.outputs.tag }} \
</span></span><span class="code-line"><span class="token scalar string">          --tag pr-${{ steps.task.outputs.id }} \
</span></span><span class="code-line"><span class="token scalar string">          --no-traffic</span>
</span></code></pre>
<p>After running the step successfully, you&#x27;ll get the preview URL like this: <em><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://pr-task-123---homepage-12345abcde-ez.a.run.app">https://pr-task-123---homepage-12345abcde-ez.a.run.app</a></em>.</p>
<p>Finally, we can post a comment about the preview URL on the pull request:</p>
<pre class="language-yaml"><code class="language-yaml code-highlight"><span class="code-line"><span class="token key atrule">steps</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Comment Preview URL in PR
</span><span class="code-line">    <span class="token key atrule">uses</span><span class="token punctuation">:</span> mshick/add<span class="token punctuation">-</span>pr<span class="token punctuation">-</span>comment@v2
</span><span class="code-line">    <span class="token key atrule">env</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token key atrule">GITHUB_TOKEN</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.GITHUB_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token key atrule">with</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token key atrule">message</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line"><span class="token scalar string">        <span role="img" aria-label="popcorn">🍿</span> Successfully deployed preview revision at https://pr-${{ steps.jira.outputs.id }}---homepage-12345abcde-ez.a.run.app</span>
</span><span class="code-line">      <span class="token key atrule">allow-repeats</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</span></code></pre>
<h3 id="the-complete-preview-workflow"><a class="styles_anchor__g18qA anchor" href="/articles/deploying-with-cloud-run-like-vercel-and-netlify#the-complete-preview-workflow"><span class="icon icon-link"></span></a>The Complete Preview Workflow</h3>
<div class="rehype-code-title">preview.yaml</div><pre class="language-yaml"><code class="language-yaml code-highlight"><span class="code-line"><span class="token key atrule">name</span><span class="token punctuation">:</span> Preview Workflow
</span><span class="code-line">
</span><span class="code-line"><span class="token key atrule">on</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token key atrule">push</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token key atrule">branches-ignore</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> main
</span><span class="code-line">  <span class="token key atrule">pull_request</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token key atrule">branches-ignore</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> main
</span><span class="code-line">  <span class="token key atrule">workflow_run</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token key atrule">workflows</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&#x27;Dev CI&#x27;</span><span class="token punctuation">]</span>
</span><span class="code-line">    <span class="token key atrule">types</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>completed<span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token key atrule">env</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token key atrule">PROJECT_ID</span><span class="token punctuation">:</span> <span class="token string">&#x27;awesome-project&#x27;</span>
</span><span class="code-line">  <span class="token key atrule">SERVICE</span><span class="token punctuation">:</span> <span class="token string">&#x27;homepage&#x27;</span>
</span><span class="code-line">  <span class="token key atrule">REGION</span><span class="token punctuation">:</span> <span class="token string">&#x27;us-west1&#x27;</span>
</span><span class="code-line">  <span class="token key atrule">REGISTRY</span><span class="token punctuation">:</span> <span class="token string">&#x27;[YOUR_REGISTRY_ID]&#x27;</span>
</span><span class="code-line">  <span class="token key atrule">WORKLOAD_IDENTITY_PROVIDER</span><span class="token punctuation">:</span> <span class="token string">&#x27;[YOUR_WORKLOAD_PROVIDER_ID]&#x27;</span>
</span><span class="code-line">  <span class="token key atrule">SERVICE_ACCOUNT</span><span class="token punctuation">:</span> <span class="token string">&#x27;[YOUR_SERVICE_ACCOUNT_ID]&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token key atrule">jobs</span><span class="token punctuation">:</span>
</span><span class="code-line">  <span class="token key atrule">preview</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token key atrule">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span><span class="token number">20.04</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token key atrule">permissions</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token key atrule">pull-requests</span><span class="token punctuation">:</span> <span class="token string">&#x27;write&#x27;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Checkout
</span><span class="code-line">        <span class="token key atrule">uses</span><span class="token punctuation">:</span> actions/checkout@v3
</span><span class="code-line">
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&#x27;Authenticate to Google Cloud&#x27;</span>
</span><span class="code-line">        <span class="token key atrule">uses</span><span class="token punctuation">:</span> <span class="token string">&#x27;google-github-actions/auth@v0.4.0&#x27;</span>
</span><span class="code-line">        <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token string">&#x27;auth&#x27;</span>
</span><span class="code-line">        <span class="token key atrule">with</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token key atrule">token_format</span><span class="token punctuation">:</span> <span class="token string">&#x27;access_token&#x27;</span>
</span><span class="code-line">          <span class="token key atrule">workload_identity_provider</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> env.WORKLOAD_IDENTITY_PROVIDER <span class="token punctuation">}</span><span class="token punctuation">}</span>
</span><span class="code-line">          <span class="token key atrule">service_account</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> env.SERVICE_ACCOUNT <span class="token punctuation">}</span><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Set up Cloud SDK
</span><span class="code-line">        <span class="token key atrule">uses</span><span class="token punctuation">:</span> google<span class="token punctuation">-</span>github<span class="token punctuation">-</span>actions/setup<span class="token punctuation">-</span>gcloud@v0
</span><span class="code-line">
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Authorize Docker push
</span><span class="code-line">        <span class="token key atrule">run</span><span class="token punctuation">:</span> gcloud auth configure<span class="token punctuation">-</span>docker $<span class="token punctuation">{</span><span class="token punctuation">{</span> env.REGISTRY <span class="token punctuation">}</span><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token comment"># Get task id in lowercase from branch name for docker image naming convention</span>
</span><span class="code-line">      <span class="token comment"># More detail on base parameter expansion: https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html</span>
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Get Task Id from Reference
</span><span class="code-line">        <span class="token key atrule">id</span><span class="token punctuation">:</span> task
</span><span class="code-line">        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line"><span class="token scalar string">          name=&quot;${{ github.ref_name }}&quot;
</span></span><span class="code-line"><span class="token scalar string">          lowercase=&quot;${name,,}&quot;
</span></span><span class="code-line"><span class="token scalar string">          echo &quot;id=${lowercase:0:8}&quot; &gt;&gt; $GITHUB_OUTPUT</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Generate Image Tag
</span><span class="code-line">        <span class="token key atrule">id</span><span class="token punctuation">:</span> image<span class="token punctuation">-</span>tag
</span><span class="code-line">        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line"><span class="token scalar string">          image_tag=&quot;$REGISTRY/$PROJECT_ID/$SERVICE/${{ steps.task.outputs.id }}:${GITHUB_SHA::8}&quot;
</span></span><span class="code-line"><span class="token scalar string">          echo &quot;tag=$image_tag&quot; &gt;&gt; $GITHUB_OUTPUT</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Build Docker Container
</span><span class="code-line">        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line"><span class="token scalar string">          docker build -t ${{ steps.image-tag.outputs.tag }}</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Push Docker Container
</span><span class="code-line">        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line"><span class="token scalar string">          docker push ${{ steps.image-tag.outputs.tag }}</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy Revision with Tag
</span><span class="code-line">        <span class="token key atrule">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line"><span class="token scalar string">          gcloud run deploy ${{ env.SERVICE }} \
</span></span><span class="code-line"><span class="token scalar string">            --platform &quot;managed&quot; \
</span></span><span class="code-line"><span class="token scalar string">            --region ${{ env.REGION }} \
</span></span><span class="code-line"><span class="token scalar string">            --image ${{ steps.image-tag.outputs.tag }} \
</span></span><span class="code-line"><span class="token scalar string">            --tag pr-${{ steps.jira.outputs.id }} \
</span></span><span class="code-line"><span class="token scalar string">            --no-traffic</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Comment Preview URL in PR
</span><span class="code-line">        <span class="token key atrule">uses</span><span class="token punctuation">:</span> mshick/add<span class="token punctuation">-</span>pr<span class="token punctuation">-</span>comment@v2
</span><span class="code-line">        <span class="token key atrule">env</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token key atrule">GITHUB_TOKEN</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span><span class="token punctuation">{</span> secrets.GITHUB_TOKEN <span class="token punctuation">}</span><span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token key atrule">with</span><span class="token punctuation">:</span>
</span><span class="code-line">          <span class="token key atrule">message</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
</span></span><span class="code-line"><span class="token scalar string">            <span role="img" aria-label="popcorn">🍿</span> Successfully deployed preview revision at https://pr-${{ steps.jira.outputs.id }}---homepage-12345abcde-ez.a.run.app</span>
</span><span class="code-line">          <span class="token key atrule">allow-repeats</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</span></code></pre>
<h2 id="final-thoughts"><a class="styles_anchor__g18qA anchor" href="/articles/deploying-with-cloud-run-like-vercel-and-netlify#final-thoughts"><span class="icon icon-link"></span></a>Final Thoughts</h2>
<p>We&#x27;ve just re-created the modern workflow from Vercel and Netlify! There are a few improvements to make the workflow more robust:</p>
<ul>
<li>use a short hash as the identifier to tag preview image and Cloud Run revision</li>
<li>replace the hard coded live URL with a step output in the preview comment step</li>
<li>add a workflow that cleans up the unused Cloud Run revisions and Docker containers</li>
</ul>
<h2 id="references"><a class="styles_anchor__g18qA anchor" href="/articles/deploying-with-cloud-run-like-vercel-and-netlify#references"><span class="icon icon-link"></span></a>References</h2>
<ul>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/google-github-actions/auth">GitHub: auth GitHub Action</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/blog/products/identity-security/enabling-keyless-authentication-from-github-actions">Article: Enabling keyless authentication from GitHub Actions - Google Cloud</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://vercel.com/features/previews">Website: Vercel Previews</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.netlify.com/products/deploy-previews/">Website: Netlify Deploy Previews</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://vercel.com/">Website: Vercel</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.netlify.com/">Website: Netlify</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html">Document: Shell Parameter Expansion - GNU</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com">Google Cloud</a></li>
<li><a class="styles_anchor__g18qA undefined" href="/articles/ex-principal-engineers-guide-to-design-thinking-and-continous-delivery#what-is-continuous-delivery">Article: Ex-Principal Engineer&#x27;s Guide to Design Thinking and Continuous Delivery - Daw-Chih Liou</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/run">Document: Cloud Run - Google Cloud</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/features/actions">Website: GitHub Actions</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/architecture/devops/devops-tech-trunk-based-development">Document: DevOps tech: Trunk-based development - Google Cloud</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/artifact-registry">Website: Artifact Registry - Google Cloud</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/sdk">Website: Cloud SDK - Google Cloud</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/iam/docs/workload-identity-federation">Document: Workload identity federation - Google Cloud</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/iam/docs/creating-managing-service-account-keys">Document: Create and manage service account keys- Google Cloud</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/iam/docs/configuring-workforce-identity-federation">Document: Configure workforce identity federation - Google Cloud</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/artifact-registry/docs/docker/store-docker-container-images">Document: Store Docker container images in Artifact Registry - Google Cloud</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/resource-manager/docs/creating-managing-projects">Document: Creating and managing projects - Google Cloud</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://cloud.google.com/run/docs/rollouts-rollbacks-traffic-migration#tags">Document: Use tags for testing, traffic migration and rollbacks - Google Cloud</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/mshick/add-pr-comment">GitHub: add-pr-comment</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/google-github-actions/setup-gcloud">Github: setup-gcloud GitHub Action</a></li>
</ul>
<hr/>
<p>Here you have it! Thanks for reading through<span role="img" aria-label="raising hands">🙌</span>
If you find this article useful, please share it to help more people in their engineering journey.</p>
<p><span role="img" aria-label="bird">🐦</span> Feel free to connect with me on <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://twitter.com/dawchihliou">twitter</a>!</p>
<p>⏭ Ready for the next article? <span role="img" aria-label="backhand index pointing right">👉</span> <a class="styles_anchor__g18qA undefined" href="/articles/easiest-way-to-understand-rust-modules-across-multiple-files"><strong>Easiest Way to Understand Rust Modules Across Multiple Files</strong></a></p>
<p>Happy coding!</p></div><article class="Author_wrap__s8DeE"><img src="/optimized/raw/portrait-sm.webp" alt="Daw-Chih Liou" class="Author_avatar__j6KIn" loading="lazy"/><div><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://dawchihliou.github.io">Daw-Chih Liou</a><p>Daw-Chih is a software engineer, UX advocate, and creator who is dedicated to Web engineering. His background in Human Centered Computing has led him to work with startups and public companies across North America, Asia, and Europe. He is passionate about meeting business trajectory with user journey and utilizing engineering architecture and performance monitoring to provide optimal user experience.</p></div></article></div></div></article><footer class="Footer_footer__1IwEk"><div class="Footer_wrap__FVCTX"><div class="Footer_resources__fG_vu"><p><span role="img" aria-label="build with love" class="Footer_emoji__u15jg">💚</span>This site is built with</p><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://nextjs.org">Next.js</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://react-icons.github.io/react-icons">React Icons</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://mdxjs.com">MDX</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://unifiedjs.com">unified</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/contentlayerdev/contentlayer">Contentlayer</a></div><div class="Footer_contact__9GJn6"><p><span role="img" aria-label="build with love" class="Footer_emoji__u15jg">🦄</span>Where to find me</p><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/dawchihliou">Linkedin</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou">GitHub</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://twitter.com/dawchihliou">Twitter</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://medium.com/@dawchihliou">Medium</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://hackernoon.com/u/dawchihliou">Hacker Noon</a><a class="styles_anchor__g18qA undefined" href="/rss.xml">RSS Feed <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></div><div class="Footer_sitemap__92ono"><p><span role="img" aria-label="build with love" class="Footer_emoji__u15jg">🗺</span>Sitemap</p><a class="styles_anchor__g18qA undefined" href="/">Home</a><a class="styles_anchor__g18qA undefined" href="/articles">Articles</a><a class="styles_anchor__g18qA undefined" href="/work">Work</a><a class="styles_anchor__g18qA undefined" href="/now">Now</a><a class="styles_anchor__g18qA undefined" href="/expertise">Expertise</a><a class="styles_anchor__g18qA undefined" href="/contact">Contact</a></div></div><div class="Footer_copyright__vZZRL">© <!-- -->2023<!-- --> <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/dawchihliou">Daw-Chih Liou</a></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Deploying Like Vercel and Netlify with Cloud Run: Live, Preview, and Modern Workflow","publishedAt":"Nov 30, 2022","description":"The modern workflow that unlocks your team's potential to ship faster.","cover":"/optimized/articles/deploy-with-cloud-run/hero.webp","category":"Cloud","coverWidth":"1400","coverHeight":"600","body":{"raw":"\n## TL;DR\n\n- ☁️ We'll learn how to deploy on Google Cloud Run\n- ✨ We'll learn how to design and implement a modern workflow with GitHub Actions\n- 🤿 We'll see code snippets of real-world workflows\n\n---\n\nThis article is also available on\n\n- [Level Up Coding](https://medium.com/gitconnected/deploying-like-vercel-and-netlify-with-cloud-run-live-preview-and-modern-workflow-ea661e411136)\n- [Hacker Noon](https://hackernoon.com/deploy-like-vercel-and-netlify-with-cloud-run-live-preview-and-modern-workflow)\n\nFeel free to read it on your favorite platform✨\n\n---\n\nIf you want to learn how to deploy like [Vercel][3] or [Netlify][4] with [Google Cloud][8], this is the right place for you.\n\nVercel and Netlify both offer seamless transition from development to shipping your features and they make [continuous delivery][9] accessible out of the box. Today we'll be looking into how to design and re-create the live deployment and [Deploy Preview][3] with [Cloud Run][10] and [GitHub Actions][11].\n\nLet's go.\n\n## The Modern Workflow Design\n\nIf you are familiar with [Vercel][5] or [Netlify][6], you'll notice the [trunk-based development][12] principle by default. Your code changes directly go **live** when pushing your commits or merging a pull request to the _main_ branch. Whenever you work on a pull request, both platforms create **Deploy Previews** so that you can collect feedback from your reviewers and stakeholders during development. This type of workflow enables us to collaborate early, mitigate errors, and ship fast.\n\nTo design the workflow, we can break it down to two paths:\n\n- Production workflow: triggered by _push_ events in the _main_ branch.\n- Preview workflow: triggered by _push_ and _pull_request_ events in all branches except _main_.\n\n\u003cimg\n  src=\"/optimized/articles/deploy-with-cloud-run/workflows.webp\"\n  alt=\"workflows overview\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/\u003e\n\nLet's look into the _prod workflow_ first.\n\n## Production Workflow\n\n\u003cimg\n  src=\"/optimized/articles/deploy-with-cloud-run/workflows-main.webp\"\n  alt=\"production workflow overview\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/\u003e\n\nThe production workflow does only one thing: live deployment. When a pull request merges into _main_, it triggers the workflow to deploy your production build to [Cloud Run][10].\n\nThe workflow looks like this:\n\nSet up Google Cloud\n\n- Authenticate to Google Cloud\n- Setup Google [Cloud SDK][14]\n- Authorize to push docker containers to [Artifact Registry][13]\n\nPush Docker Image to Artifact Registry\n\n- Generate image tag\n- Build docker container\n- push docker container to registry\n\nDeploy\n\n- Deploy to Cloud Run\n\n### Set up Google Cloud\n\n\u003e If you don't have a project on Google Cloud yet, follow [this guide][19] to create one. I'll name my project _awesome-project_.\n\nTo authenticate the workflow to access Google Cloud, we can use the [_auth_][1] GitHub Action to create an access token:\n\n```yaml\nenv:\n  PROJECT_ID: 'awesome-project'\n  SERVICE: 'homepage'\n  REGION: 'us-west1' # ☘️Low CO2\n  REGISTRY: '[YOUR_REGISTRY_ID]'\n  IMAGE_NAME: 'live'\n  WORKLOAD_IDENTITY_PROVIDER: '[YOUR_WORKLOAD_PROVIDER_ID]'\n  SERVICE_ACCOUNT: '[YOUR_SERVICE_ACCOUNT_ID]'\n\njobs:\n  deploy:\n    runs-on: ubuntu-20.04\n\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v3\n\n      - name: 'Authenticate to Google Cloud'\n        uses: 'google-github-actions/auth@v0.4.0'\n        id: 'auth'\n        with:\n          token_format: 'access_token'\n          workload_identity_provider: ${{ env.WORKLOAD_IDENTITY_PROVIDER }}\n          service_account: ${{ env.SERVICE_ACCOUNT }}\n```\n\nHere we are authenticating via [Workload Identity Federation][15]. To make it work, we'll need\n\n- [a service account][16]\n- [a workload identity provider][17]\n- [to grand IAM roles to the Workload Identity Provider][2].\n\nCongratulations, you've done it! It's the most difficult part of the workflow.\n\nNow we can set up Cloud SDK and authorize the workflow to be able to push Docker containers to Artifact Registry:\n\n```yaml\nsteps:\n  - name: Set up Cloud SDK\n    uses: google-github-actions/setup-gcloud@v0\n\n  - name: Authorize Docker push\n    run: gcloud auth configure-docker ${{ env.REGISTRY }}\n```\n\nYou can follow [this guide][18] to set up Artifact Registry for storing Docker containers.\n\n### Push Docker Image to Artifact Registry\n\nWe are now able to push containers so let's dockerize your project and tag your image:\n\n```yaml\nsteps:\n  - name: Generate Image Tag\n    id: image-tag\n    run: |\n      image_tag=\"$REGISTRY/$PROJECT_ID/$SERVICE/$IMAGE_NAME:${GITHUB_SHA::8}\"\n      echo \"tag=$image_tag\" \u003e\u003e $GITHUB_OUTPUT\n\n  - name: Build Docker Container\n    run: |\n      docker build -t ${{ steps.image-tag.outputs.tag }}\n\n  - name: Push Docker Container\n    run: |\n      docker push ${{ steps.image-tag.outputs.tag }}\n```\n\n### Deploy\n\nNow you are ready to deploy to cloud run using the docker container:\n\n```yaml\nsteps:\n  - name: Deploy to Cloud Run\n    run: |\n      gcloud run deploy ${{ env.SERVICE }} \\\n        --platform \"managed\"\n        --region ${{ env.REGION }} \\\n        --image ${{ steps.image-tag.outputs.tag }}\n```\n\nCloud Run will assign 100% of the traffic to this deployment by default so all visitors will be directed to this revision.\n\nIn the Cloud Console, you'll find a URL to your Cloud Run deployment. It looks like this: _https://homepage-12345abcde-ez.a.run.app_. We'll need it later for our preview workflow.\n\n### The Complete Production Workflow\n\n```yaml:prod-ci.yaml\nname: Production Workflow\n\non:\n  push:\n    branches:\n      - main\n\nenv:\n  PROJECT_ID: 'awesome-project'\n  SERVICE: 'homepage'\n  REGION: 'us-west1' # ☘️Low CO2\n  REGISTRY: '[YOUR_REGISTRY_ID]'\n  IMAGE_NAME: 'live'\n  WORKLOAD_IDENTITY_PROVIDER: '[YOUR_WORKLOAD_PROVIDER_ID]'\n  SERVICE_ACCOUNT: '[YOUR_SERVICE_ACCOUNT_ID]'\n\njobs:\n  deploy:\n    runs-on: ubuntu-20.04\n\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v3\n\n      - name: 'Authenticate to Google Cloud'\n        uses: 'google-github-actions/auth@v0.4.0'\n        id: 'auth'\n        with:\n          token_format: 'access_token'\n          workload_identity_provider: ${{ env.WORKLOAD_IDENTITY_PROVIDER }}\n          service_account: ${{ env.SERVICE_ACCOUNT }}\n\n      - name: Set up Cloud SDK\n        uses: google-github-actions/setup-gcloud@v0\n\n      - name: Authorize Docker push\n        run: gcloud auth configure-docker ${{ env.REGISTRY }}\n\n      - name: Generate Image Tag\n        id: image-tag\n        run: |\n          image_tag=\"$REGISTRY/$PROJECT_ID/$SERVICE/$IMAGE_NAME:${GITHUB_SHA::8}\"\n          echo \"tag=$image_tag\" \u003e\u003e $GITHUB_OUTPUT\n\n      - name: Build Docker Container\n        run: |\n          docker build -t ${{ steps.image-tag.outputs.tag }}\n\n      - name: Push Docker Container\n        run: |\n          docker push ${{ steps.image-tag.outputs.tag }}\n\n      - name: Deploy to Cloud Run\n        run: |\n          gcloud run deploy ${{ env.SERVICE }} \\\n            --platform \"managed\"\n            --region ${{ env.REGION }} \\\n            --image ${{ steps.image-tag.outputs.tag }}\n```\n\n## Preview Workflow\n\n\u003cimg\n  src=\"/optimized/articles/deploy-with-cloud-run/workflows-branch.webp\"\n  alt=\"preview workflow overview\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/\u003e\n\nThe preview workflow is similar to production with a few modifications:\n\nSet up Google Cloud\n\n- Authenticate to Google Cloud\n- Setup Google [Cloud SDK][14]\n- Authorize to push docker containers to [Artifact Registry][13]\n\nPush Docker Image to Artifact Registry\n\n- **Get Task Id from Reference**\n- Generate image tag\n- Build docker container\n- push docker container to registry\n\nDeploy\n\n- **Deploy revision with tag**\n- **Comment preview URL in the pull request**\n\nLet's take a look at the differences.\n\n### Push Docker Image to Artifact Registry\n\nThe first difference is tagging the Docker image. In the production workflow, we use a constant `$IMAGE_NAME` in environment variables to tag the production image. However, for previews, we want to use an identifier that represents the pull request. We are using the first 8 characters of the branch name as the identifier:\n\n```yaml\nsteps:\n  - name: Get Task Id from Reference\n  id: task\n  run: |\n    name=\"${{ github.ref_name }}\"\n    lowercase=\"${name,,}\"\n    echo \"id=${lowercase:0:8}\" \u003e\u003e $GITHUB_OUTPUT\n```\n\nAs an example I'll name the branch _TASK-123-awesome-workflow_. The _task_ step will extract the task ID _task-123_ from the branch name.\n\n\u003e If you are curious about the shell script syntax, check out [Shell Parameter Expansion][7].\n\nThe identifier is set to be in lowercase because we'll use it for tagging the Cloud Run revision later. The naming convention of [Cloud Run tags][20] is as follows:\n\n- it allows lowercase characters\n- it allows numbers\n- it allows \"-\"\n- it has a maximum length limit of 63 characters\n\nNext we can use the task id to tag the image, build a container, and push to the registry:\n\n```yaml\nsteps:\n  - name: Generate Image Tag\n    id: image-tag\n    run: |\n      image_tag=\"$REGISTRY/$PROJECT_ID/$SERVICE/${{ steps.task.outputs.id }}:${GITHUB_SHA::8}\"\n      echo \"tag=$image_tag\" \u003e\u003e $GITHUB_OUTPUT\n\n  - name: Build Docker Container\n    run: |\n      docker build -t ${{ steps.image-tag.outputs.tag }}\n\n  - name: Push Docker Container\n    run: |\n      docker push ${{ steps.image-tag.outputs.tag }}\n```\n\n### Deploy\n\nNow we are ready to deploy the preview. The deployment is similar to live deployment with two differences:\n\n- Unlike live deployment, we want to assign 0% of the traffic to the preview revision.\n- We want to give the deployment a different URL other than the live URL.\n\nWe can use _--tag_ and _--no-traffic_ parameters to achieve them:\n\n```yaml\nsteps:\n  - name: Deploy Revision with Tag\n      run: |\n        gcloud run deploy ${{ env.SERVICE }} \\\n          --platform \"managed\" \\\n          --region ${{ env.REGION }} \\\n          --image ${{ steps.image-tag.outputs.tag }} \\\n          --tag pr-${{ steps.task.outputs.id }} \\\n          --no-traffic\n```\n\nAfter running the step successfully, you'll get the preview URL like this: _https://pr-task-123---homepage-12345abcde-ez.a.run.app_.\n\nFinally, we can post a comment about the preview URL on the pull request:\n\n```yaml\nsteps:\n  - name: Comment Preview URL in PR\n    uses: mshick/add-pr-comment@v2\n    env:\n      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n    with:\n      message: |\n        🍿 Successfully deployed preview revision at https://pr-${{ steps.jira.outputs.id }}---homepage-12345abcde-ez.a.run.app\n      allow-repeats: false\n```\n\n### The Complete Preview Workflow\n\n```yaml:preview.yaml\nname: Preview Workflow\n\non:\n  push:\n    branches-ignore:\n      - main\n  pull_request:\n    branches-ignore:\n      - main\n  workflow_run:\n    workflows: ['Dev CI']\n    types: [completed]\n\nenv:\n  PROJECT_ID: 'awesome-project'\n  SERVICE: 'homepage'\n  REGION: 'us-west1'\n  REGISTRY: '[YOUR_REGISTRY_ID]'\n  WORKLOAD_IDENTITY_PROVIDER: '[YOUR_WORKLOAD_PROVIDER_ID]'\n  SERVICE_ACCOUNT: '[YOUR_SERVICE_ACCOUNT_ID]'\n\njobs:\n  preview:\n    runs-on: ubuntu-20.04\n\n    permissions:\n      pull-requests: 'write'\n\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v3\n\n      - name: 'Authenticate to Google Cloud'\n        uses: 'google-github-actions/auth@v0.4.0'\n        id: 'auth'\n        with:\n          token_format: 'access_token'\n          workload_identity_provider: ${{ env.WORKLOAD_IDENTITY_PROVIDER }}\n          service_account: ${{ env.SERVICE_ACCOUNT }}\n\n      - name: Set up Cloud SDK\n        uses: google-github-actions/setup-gcloud@v0\n\n      - name: Authorize Docker push\n        run: gcloud auth configure-docker ${{ env.REGISTRY }}\n\n      # Get task id in lowercase from branch name for docker image naming convention\n      # More detail on base parameter expansion: https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html\n      - name: Get Task Id from Reference\n        id: task\n        run: |\n          name=\"${{ github.ref_name }}\"\n          lowercase=\"${name,,}\"\n          echo \"id=${lowercase:0:8}\" \u003e\u003e $GITHUB_OUTPUT\n\n      - name: Generate Image Tag\n        id: image-tag\n        run: |\n          image_tag=\"$REGISTRY/$PROJECT_ID/$SERVICE/${{ steps.task.outputs.id }}:${GITHUB_SHA::8}\"\n          echo \"tag=$image_tag\" \u003e\u003e $GITHUB_OUTPUT\n\n      - name: Build Docker Container\n        run: |\n          docker build -t ${{ steps.image-tag.outputs.tag }}\n\n      - name: Push Docker Container\n        run: |\n          docker push ${{ steps.image-tag.outputs.tag }}\n\n      - name: Deploy Revision with Tag\n        run: |\n          gcloud run deploy ${{ env.SERVICE }} \\\n            --platform \"managed\" \\\n            --region ${{ env.REGION }} \\\n            --image ${{ steps.image-tag.outputs.tag }} \\\n            --tag pr-${{ steps.jira.outputs.id }} \\\n            --no-traffic\n\n      - name: Comment Preview URL in PR\n        uses: mshick/add-pr-comment@v2\n        env:\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n        with:\n          message: |\n            🍿 Successfully deployed preview revision at https://pr-${{ steps.jira.outputs.id }}---homepage-12345abcde-ez.a.run.app\n          allow-repeats: false\n```\n\n## Final Thoughts\n\nWe've just re-created the modern workflow from Vercel and Netlify! There are a few improvements to make the workflow more robust:\n\n- use a short hash as the identifier to tag preview image and Cloud Run revision\n- replace the hard coded live URL with a step output in the preview comment step\n- add a workflow that cleans up the unused Cloud Run revisions and Docker containers\n\n## References\n\n- [GitHub: auth GitHub Action][1]\n- [Article: Enabling keyless authentication from GitHub Actions - Google Cloud][2]\n- [Website: Vercel Previews][3]\n- [Website: Netlify Deploy Previews][4]\n- [Website: Vercel][5]\n- [Website: Netlify][6]\n- [Document: Shell Parameter Expansion - GNU][7]\n- [Google Cloud][8]\n- [Article: Ex-Principal Engineer's Guide to Design Thinking and Continuous Delivery - Daw-Chih Liou][9]\n- [Document: Cloud Run - Google Cloud][10]\n- [Website: GitHub Actions][11]\n- [Document: DevOps tech: Trunk-based development - Google Cloud][12]\n- [Website: Artifact Registry - Google Cloud][13]\n- [Website: Cloud SDK - Google Cloud][14]\n- [Document: Workload identity federation - Google Cloud][15]\n- [Document: Create and manage service account keys- Google Cloud][16]\n- [Document: Configure workforce identity federation - Google Cloud][17]\n- [Document: Store Docker container images in Artifact Registry - Google Cloud][18]\n- [Document: Creating and managing projects - Google Cloud][19]\n- [Document: Use tags for testing, traffic migration and rollbacks - Google Cloud][20]\n- [GitHub: add-pr-comment][21]\n- [Github: setup-gcloud GitHub Action][22]\n\n[1]: https://github.com/google-github-actions/auth\n[2]: https://cloud.google.com/blog/products/identity-security/enabling-keyless-authentication-from-github-actions\n[3]: https://vercel.com/features/previews\n[4]: https://www.netlify.com/products/deploy-previews/\n[5]: https://vercel.com/\n[6]: https://www.netlify.com/\n[7]: https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html\n[8]: https://cloud.google.com\n[9]: /articles/ex-principal-engineers-guide-to-design-thinking-and-continous-delivery#what-is-continuous-delivery\n[10]: https://cloud.google.com/run\n[11]: https://github.com/features/actions\n[12]: https://cloud.google.com/architecture/devops/devops-tech-trunk-based-development\n[13]: https://cloud.google.com/artifact-registry\n[14]: https://cloud.google.com/sdk\n[15]: https://cloud.google.com/iam/docs/workload-identity-federation\n[16]: https://cloud.google.com/iam/docs/creating-managing-service-account-keys\n[17]: https://cloud.google.com/iam/docs/configuring-workforce-identity-federation\n[18]: https://cloud.google.com/artifact-registry/docs/docker/store-docker-container-images\n[19]: https://cloud.google.com/resource-manager/docs/creating-managing-projects\n[20]: https://cloud.google.com/run/docs/rollouts-rollbacks-traffic-migration#tags\n[21]: https://github.com/mshick/add-pr-comment\n[22]: https://github.com/google-github-actions/setup-gcloud\n\n---\n\nHere you have it! Thanks for reading through🙌\nIf you find this article useful, please share it to help more people in their engineering journey.\n\n🐦 Feel free to connect with me on [twitter](https://twitter.com/dawchihliou)!\n\n⏭ Ready for the next article? 👉 [**Easiest Way to Understand Rust Modules Across Multiple Files**](/articles/easiest-way-to-understand-rust-modules-across-multiple-files)\n\nHappy coding!\n","code":"var Component=(()=\u003e{var h=Object.create;var c=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var N=(a,e)=\u003e()=\u003e(e||a((e={exports:{}}).exports,e),e.exports),g=(a,e)=\u003e{for(var s in e)c(a,s,{get:e[s],enumerable:!0})},t=(a,e,s,i)=\u003e{if(e\u0026\u0026typeof e==\"object\"||typeof e==\"function\")for(let l of u(e))!k.call(a,l)\u0026\u0026l!==s\u0026\u0026c(a,l,{get:()=\u003ee[l],enumerable:!(i=p(e,l))||i.enumerable});return a};var y=(a,e,s)=\u003e(s=a!=null?h(m(a)):{},t(e||!a||!a.__esModule?c(s,\"default\",{value:a,enumerable:!0}):s,a)),f=a=\u003et(c({},\"__esModule\",{value:!0}),a);var r=N((C,o)=\u003e{o.exports=_jsx_runtime});var b={};g(b,{default:()=\u003eR,frontmatter:()=\u003ew});var n=y(r()),w={title:\"Deploying Like Vercel and Netlify with Cloud Run: Live, Preview, and Modern Workflow\",publishedAt:\"Nov 30, 2022\",description:\"The modern workflow that unlocks your team's potential to ship faster.\",cover:\"/optimized/articles/deploy-with-cloud-run/hero.webp\",category:\"Cloud\",coverWidth:\"1400\",coverHeight:\"600\"};function d(a){let e=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",ul:\"ul\",li:\"li\",hr:\"hr\",p:\"p\",strong:\"strong\",em:\"em\",h3:\"h3\",blockquote:\"blockquote\",pre:\"pre\",code:\"code\",div:\"div\"},a.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.h2,{id:\"tldr\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#tldr\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"TL;DR\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"cloud\",children:\"\\u2601\\uFE0F\"}),\" We'll learn how to deploy on Google Cloud Run\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"sparkles\",children:\"\\u2728\"}),\" We'll learn how to design and implement a modern workflow with GitHub Actions\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"\",\"aria-hidden\":!0,children:\"\\u{1F93F}\"}),\" We'll see code snippets of real-world workflows\"]}),`\n`]}),`\n`,(0,n.jsx)(e.hr,{}),`\n`,(0,n.jsx)(e.p,{children:\"This article is also available on\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://medium.com/gitconnected/deploying-like-vercel-and-netlify-with-cloud-run-live-preview-and-modern-workflow-ea661e411136\",children:\"Level Up Coding\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://hackernoon.com/deploy-like-vercel-and-netlify-with-cloud-run-live-preview-and-modern-workflow\",children:\"Hacker Noon\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Feel free to read it on your favorite platform\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"sparkles\",children:\"\\u2728\"})]}),`\n`,(0,n.jsx)(e.hr,{}),`\n`,(0,n.jsxs)(e.p,{children:[\"If you want to learn how to deploy like \",(0,n.jsx)(e.a,{href:\"https://vercel.com/features/previews\",children:\"Vercel\"}),\" or \",(0,n.jsx)(e.a,{href:\"https://www.netlify.com/products/deploy-previews/\",children:\"Netlify\"}),\" with \",(0,n.jsx)(e.a,{href:\"https://cloud.google.com\",children:\"Google Cloud\"}),\", this is the right place for you.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Vercel and Netlify both offer seamless transition from development to shipping your features and they make \",(0,n.jsx)(e.a,{href:\"/articles/ex-principal-engineers-guide-to-design-thinking-and-continous-delivery#what-is-continuous-delivery\",children:\"continuous delivery\"}),\" accessible out of the box. Today we'll be looking into how to design and re-create the live deployment and \",(0,n.jsx)(e.a,{href:\"https://vercel.com/features/previews\",children:\"Deploy Preview\"}),\" with \",(0,n.jsx)(e.a,{href:\"https://cloud.google.com/run\",children:\"Cloud Run\"}),\" and \",(0,n.jsx)(e.a,{href:\"https://github.com/features/actions\",children:\"GitHub Actions\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Let's go.\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"the-modern-workflow-design\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#the-modern-workflow-design\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"The Modern Workflow Design\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"If you are familiar with \",(0,n.jsx)(e.a,{href:\"https://vercel.com/\",children:\"Vercel\"}),\" or \",(0,n.jsx)(e.a,{href:\"https://www.netlify.com/\",children:\"Netlify\"}),\", you'll notice the \",(0,n.jsx)(e.a,{href:\"https://cloud.google.com/architecture/devops/devops-tech-trunk-based-development\",children:\"trunk-based development\"}),\" principle by default. Your code changes directly go \",(0,n.jsx)(e.strong,{children:\"live\"}),\" when pushing your commits or merging a pull request to the \",(0,n.jsx)(e.em,{children:\"main\"}),\" branch. Whenever you work on a pull request, both platforms create \",(0,n.jsx)(e.strong,{children:\"Deploy Previews\"}),\" so that you can collect feedback from your reviewers and stakeholders during development. This type of workflow enables us to collaborate early, mitigate errors, and ship fast.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"To design the workflow, we can break it down to two paths:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"Production workflow: triggered by \",(0,n.jsx)(e.em,{children:\"push\"}),\" events in the \",(0,n.jsx)(e.em,{children:\"main\"}),\" branch.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Preview workflow: triggered by \",(0,n.jsx)(e.em,{children:\"push\"}),\" and \",(0,n.jsx)(e.em,{children:\"pull_request\"}),\" events in all branches except \",(0,n.jsx)(e.em,{children:\"main\"}),\".\"]}),`\n`]}),`\n`,(0,n.jsx)(\"img\",{src:\"/optimized/articles/deploy-with-cloud-run/workflows.webp\",alt:\"workflows overview\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Let's look into the \",(0,n.jsx)(e.em,{children:\"prod workflow\"}),\" first.\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"production-workflow\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#production-workflow\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Production Workflow\"]}),`\n`,(0,n.jsx)(\"img\",{src:\"/optimized/articles/deploy-with-cloud-run/workflows-main.webp\",alt:\"production workflow overview\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"The production workflow does only one thing: live deployment. When a pull request merges into \",(0,n.jsx)(e.em,{children:\"main\"}),\", it triggers the workflow to deploy your production build to \",(0,n.jsx)(e.a,{href:\"https://cloud.google.com/run\",children:\"Cloud Run\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"The workflow looks like this:\"}),`\n`,(0,n.jsx)(e.p,{children:\"Set up Google Cloud\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Authenticate to Google Cloud\"}),`\n`,(0,n.jsxs)(e.li,{children:[\"Setup Google \",(0,n.jsx)(e.a,{href:\"https://cloud.google.com/sdk\",children:\"Cloud SDK\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Authorize to push docker containers to \",(0,n.jsx)(e.a,{href:\"https://cloud.google.com/artifact-registry\",children:\"Artifact Registry\"})]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Push Docker Image to Artifact Registry\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Generate image tag\"}),`\n`,(0,n.jsx)(e.li,{children:\"Build docker container\"}),`\n`,(0,n.jsx)(e.li,{children:\"push docker container to registry\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Deploy\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Deploy to Cloud Run\"}),`\n`]}),`\n`,(0,n.jsxs)(e.h3,{id:\"set-up-google-cloud\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#set-up-google-cloud\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Set up Google Cloud\"]}),`\n`,(0,n.jsxs)(e.blockquote,{children:[`\n`,(0,n.jsxs)(e.p,{children:[\"If you don't have a project on Google Cloud yet, follow \",(0,n.jsx)(e.a,{href:\"https://cloud.google.com/resource-manager/docs/creating-managing-projects\",children:\"this guide\"}),\" to create one. I'll name my project \",(0,n.jsx)(e.em,{children:\"awesome-project\"}),\".\"]}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"To authenticate the workflow to access Google Cloud, we can use the \",(0,n.jsx)(e.a,{href:\"https://github.com/google-github-actions/auth\",children:(0,n.jsx)(e.em,{children:\"auth\"})}),\" GitHub Action to create an access token:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"env\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"PROJECT_ID\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'awesome-project'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"SERVICE\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'homepage'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"REGION\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'us-west1'\"}),\" \",(0,n.jsxs)(e.span,{className:\"token comment\",children:[\"# \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"shamrock\",children:\"\\u2618\\uFE0F\"}),\"Low CO2\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"REGISTRY\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'[YOUR_REGISTRY_ID]'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"IMAGE_NAME\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'live'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"WORKLOAD_IDENTITY_PROVIDER\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'[YOUR_WORKLOAD_PROVIDER_ID]'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"SERVICE_ACCOUNT\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'[YOUR_SERVICE_ACCOUNT_ID]'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"jobs\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"deploy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"runs-on\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" ubuntu\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"20.04\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"steps\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Checkout\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"uses\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` actions/checkout@v3\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'Authenticate to Google Cloud'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"uses\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'google-github-actions/auth@v0.4.0'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'auth'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"with\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"token_format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'access_token'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"workload_identity_provider\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" $\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" env.WORKLOAD_IDENTITY_PROVIDER \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"service_account\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" $\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" env.SERVICE_ACCOUNT \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Here we are authenticating via \",(0,n.jsx)(e.a,{href:\"https://cloud.google.com/iam/docs/workload-identity-federation\",children:\"Workload Identity Federation\"}),\". To make it work, we'll need\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://cloud.google.com/iam/docs/creating-managing-service-account-keys\",children:\"a service account\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://cloud.google.com/iam/docs/configuring-workforce-identity-federation\",children:\"a workload identity provider\"})}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://cloud.google.com/blog/products/identity-security/enabling-keyless-authentication-from-github-actions\",children:\"to grand IAM roles to the Workload Identity Provider\"}),\".\"]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Congratulations, you've done it! It's the most difficult part of the workflow.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Now we can set up Cloud SDK and authorize the workflow to be able to push Docker containers to Artifact Registry:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"steps\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Set up Cloud SDK\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"uses\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" google\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"github\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"actions/setup\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`gcloud@v0\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Authorize Docker push\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" gcloud auth configure\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"docker $\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" env.REGISTRY \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"You can follow \",(0,n.jsx)(e.a,{href:\"https://cloud.google.com/artifact-registry/docs/docker/store-docker-container-images\",children:\"this guide\"}),\" to set up Artifact Registry for storing Docker containers.\"]}),`\n`,(0,n.jsxs)(e.h3,{id:\"push-docker-image-to-artifact-registry\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#push-docker-image-to-artifact-registry\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Push Docker Image to Artifact Registry\"]}),`\n`,(0,n.jsx)(e.p,{children:\"We are now able to push containers so let's dockerize your project and tag your image:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"steps\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Generate Image Tag\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" image\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`tag\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token scalar string\",children:`\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:'      image_tag=\"$REGISTRY/$PROJECT_ID/$SERVICE/$IMAGE_NAME:${GITHUB_SHA::8}\"\\n'})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token scalar string\",children:'      echo \"tag=$image_tag\" \u003e\u003e $GITHUB_OUTPUT'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Build Docker Container\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token scalar string\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"      docker build -t ${{ steps.image-tag.outputs.tag }}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Push Docker Container\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token scalar string\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"      docker push ${{ steps.image-tag.outputs.tag }}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h3,{id:\"deploy\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#deploy\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Deploy\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Now you are ready to deploy to cloud run using the docker container:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"steps\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Deploy to Cloud Run\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token scalar string\",children:`\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"      gcloud run deploy ${{ env.SERVICE }} \\\\\\n\"})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:`        --platform \"managed\"\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"        --region ${{ env.REGION }} \\\\\\n\"})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"        --image ${{ steps.image-tag.outputs.tag }}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Cloud Run will assign 100% of the traffic to this deployment by default so all visitors will be directed to this revision.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"In the Cloud Console, you'll find a URL to your Cloud Run deployment. It looks like this: \",(0,n.jsx)(e.em,{children:(0,n.jsx)(e.a,{href:\"https://homepage-12345abcde-ez.a.run.app\",children:\"https://homepage-12345abcde-ez.a.run.app\"})}),\". We'll need it later for our preview workflow.\"]}),`\n`,(0,n.jsxs)(e.h3,{id:\"the-complete-production-workflow\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#the-complete-production-workflow\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"The Complete Production Workflow\"]}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"prod-ci.yaml\"}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Production Workflow\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"on\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"push\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"branches\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` main\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"env\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"PROJECT_ID\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'awesome-project'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"SERVICE\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'homepage'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"REGION\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'us-west1'\"}),\" \",(0,n.jsxs)(e.span,{className:\"token comment\",children:[\"# \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"shamrock\",children:\"\\u2618\\uFE0F\"}),\"Low CO2\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"REGISTRY\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'[YOUR_REGISTRY_ID]'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"IMAGE_NAME\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'live'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"WORKLOAD_IDENTITY_PROVIDER\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'[YOUR_WORKLOAD_PROVIDER_ID]'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"SERVICE_ACCOUNT\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'[YOUR_SERVICE_ACCOUNT_ID]'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"jobs\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"deploy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"runs-on\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" ubuntu\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"20.04\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"steps\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Checkout\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"uses\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` actions/checkout@v3\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'Authenticate to Google Cloud'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"uses\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'google-github-actions/auth@v0.4.0'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'auth'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"with\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"token_format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'access_token'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"workload_identity_provider\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" $\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" env.WORKLOAD_IDENTITY_PROVIDER \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"service_account\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" $\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" env.SERVICE_ACCOUNT \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Set up Cloud SDK\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"uses\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" google\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"github\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"actions/setup\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`gcloud@v0\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Authorize Docker push\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" gcloud auth configure\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"docker $\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" env.REGISTRY \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Generate Image Tag\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" image\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`tag\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token scalar string\",children:`\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:'          image_tag=\"$REGISTRY/$PROJECT_ID/$SERVICE/$IMAGE_NAME:${GITHUB_SHA::8}\"\\n'})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token scalar string\",children:'          echo \"tag=$image_tag\" \u003e\u003e $GITHUB_OUTPUT'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Build Docker Container\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token scalar string\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"          docker build -t ${{ steps.image-tag.outputs.tag }}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Push Docker Container\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token scalar string\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"          docker push ${{ steps.image-tag.outputs.tag }}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Deploy to Cloud Run\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token scalar string\",children:`\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"          gcloud run deploy ${{ env.SERVICE }} \\\\\\n\"})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:`            --platform \"managed\"\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"            --region ${{ env.REGION }} \\\\\\n\"})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"            --image ${{ steps.image-tag.outputs.tag }}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h2,{id:\"preview-workflow\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#preview-workflow\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Preview Workflow\"]}),`\n`,(0,n.jsx)(\"img\",{src:\"/optimized/articles/deploy-with-cloud-run/workflows-branch.webp\",alt:\"preview workflow overview\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,n.jsx)(e.p,{children:\"The preview workflow is similar to production with a few modifications:\"}),`\n`,(0,n.jsx)(e.p,{children:\"Set up Google Cloud\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Authenticate to Google Cloud\"}),`\n`,(0,n.jsxs)(e.li,{children:[\"Setup Google \",(0,n.jsx)(e.a,{href:\"https://cloud.google.com/sdk\",children:\"Cloud SDK\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Authorize to push docker containers to \",(0,n.jsx)(e.a,{href:\"https://cloud.google.com/artifact-registry\",children:\"Artifact Registry\"})]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Push Docker Image to Artifact Registry\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.strong,{children:\"Get Task Id from Reference\"})}),`\n`,(0,n.jsx)(e.li,{children:\"Generate image tag\"}),`\n`,(0,n.jsx)(e.li,{children:\"Build docker container\"}),`\n`,(0,n.jsx)(e.li,{children:\"push docker container to registry\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Deploy\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.strong,{children:\"Deploy revision with tag\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.strong,{children:\"Comment preview URL in the pull request\"})}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Let's take a look at the differences.\"}),`\n`,(0,n.jsxs)(e.h3,{id:\"push-docker-image-to-artifact-registry-1\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#push-docker-image-to-artifact-registry-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Push Docker Image to Artifact Registry\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"The first difference is tagging the Docker image. In the production workflow, we use a constant \",(0,n.jsx)(e.code,{children:\"$IMAGE_NAME\"}),\" in environment variables to tag the production image. However, for previews, we want to use an identifier that represents the pull request. We are using the first 8 characters of the branch name as the identifier:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"steps\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Get Task Id from Reference\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` task\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token scalar string\",children:`\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:'    name=\"${{ github.ref_name }}\"\\n'})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:'    lowercase=\"${name,,}\"\\n'})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token scalar string\",children:'    echo \"id=${lowercase:0:8}\" \u003e\u003e $GITHUB_OUTPUT'}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"As an example I'll name the branch \",(0,n.jsx)(e.em,{children:\"TASK-123-awesome-workflow\"}),\". The \",(0,n.jsx)(e.em,{children:\"task\"}),\" step will extract the task ID \",(0,n.jsx)(e.em,{children:\"task-123\"}),\" from the branch name.\"]}),`\n`,(0,n.jsxs)(e.blockquote,{children:[`\n`,(0,n.jsxs)(e.p,{children:[\"If you are curious about the shell script syntax, check out \",(0,n.jsx)(e.a,{href:\"https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html\",children:\"Shell Parameter Expansion\"}),\".\"]}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"The identifier is set to be in lowercase because we'll use it for tagging the Cloud Run revision later. The naming convention of \",(0,n.jsx)(e.a,{href:\"https://cloud.google.com/run/docs/rollouts-rollbacks-traffic-migration#tags\",children:\"Cloud Run tags\"}),\" is as follows:\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"it allows lowercase characters\"}),`\n`,(0,n.jsx)(e.li,{children:\"it allows numbers\"}),`\n`,(0,n.jsx)(e.li,{children:'it allows \"-\"'}),`\n`,(0,n.jsx)(e.li,{children:\"it has a maximum length limit of 63 characters\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Next we can use the task id to tag the image, build a container, and push to the registry:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"steps\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Generate Image Tag\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" image\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`tag\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token scalar string\",children:`\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:'      image_tag=\"$REGISTRY/$PROJECT_ID/$SERVICE/${{ steps.task.outputs.id }}:${GITHUB_SHA::8}\"\\n'})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token scalar string\",children:'      echo \"tag=$image_tag\" \u003e\u003e $GITHUB_OUTPUT'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Build Docker Container\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token scalar string\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"      docker build -t ${{ steps.image-tag.outputs.tag }}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Push Docker Container\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token scalar string\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"      docker push ${{ steps.image-tag.outputs.tag }}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h3,{id:\"deploy-1\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#deploy-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Deploy\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Now we are ready to deploy the preview. The deployment is similar to live deployment with two differences:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Unlike live deployment, we want to assign 0% of the traffic to the preview revision.\"}),`\n`,(0,n.jsx)(e.li,{children:\"We want to give the deployment a different URL other than the live URL.\"}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"We can use \",(0,n.jsx)(e.em,{children:\"--tag\"}),\" and \",(0,n.jsx)(e.em,{children:\"--no-traffic\"}),\" parameters to achieve them:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"steps\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Deploy Revision with Tag\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token scalar string\",children:`\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"        gcloud run deploy ${{ env.SERVICE }} \\\\\\n\"})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:`          --platform \"managed\" \\\\\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"          --region ${{ env.REGION }} \\\\\\n\"})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"          --image ${{ steps.image-tag.outputs.tag }} \\\\\\n\"})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"          --tag pr-${{ steps.task.outputs.id }} \\\\\\n\"})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"          --no-traffic\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"After running the step successfully, you'll get the preview URL like this: \",(0,n.jsx)(e.em,{children:(0,n.jsx)(e.a,{href:\"https://pr-task-123---homepage-12345abcde-ez.a.run.app\",children:\"https://pr-task-123---homepage-12345abcde-ez.a.run.app\"})}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Finally, we can post a comment about the preview URL on the pull request:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"steps\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Comment Preview URL in PR\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"uses\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" mshick/add\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"pr\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`comment@v2\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"env\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"GITHUB_TOKEN\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" $\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" secrets.GITHUB_TOKEN \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"with\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"message\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token scalar string\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token scalar string\",children:[\"        \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"popcorn\",children:\"\\u{1F37F}\"}),\" Successfully deployed preview revision at https://pr-${{ steps.jira.outputs.id }}---homepage-12345abcde-ez.a.run.app\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"allow-repeats\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean important\",children:\"false\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h3,{id:\"the-complete-preview-workflow\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#the-complete-preview-workflow\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"The Complete Preview Workflow\"]}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"preview.yaml\"}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Preview Workflow\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"on\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"push\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"branches-ignore\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` main\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"pull_request\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"branches-ignore\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` main\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"workflow_run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"workflows\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'Dev CI'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"types\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"completed\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"env\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"PROJECT_ID\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'awesome-project'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"SERVICE\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'homepage'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"REGION\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'us-west1'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"REGISTRY\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'[YOUR_REGISTRY_ID]'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"WORKLOAD_IDENTITY_PROVIDER\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'[YOUR_WORKLOAD_PROVIDER_ID]'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"SERVICE_ACCOUNT\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'[YOUR_SERVICE_ACCOUNT_ID]'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"jobs\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"preview\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"runs-on\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" ubuntu\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"20.04\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"permissions\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"pull-requests\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'write'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"steps\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Checkout\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"uses\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` actions/checkout@v3\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'Authenticate to Google Cloud'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"uses\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'google-github-actions/auth@v0.4.0'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'auth'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"with\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"token_format\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'access_token'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"workload_identity_provider\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" $\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" env.WORKLOAD_IDENTITY_PROVIDER \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"service_account\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" $\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" env.SERVICE_ACCOUNT \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Set up Cloud SDK\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"uses\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" google\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"github\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"actions/setup\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`gcloud@v0\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Authorize Docker push\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" gcloud auth configure\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"docker $\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" env.REGISTRY \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Get task id in lowercase from branch name for docker image naming convention\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# More detail on base parameter expansion: https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Get Task Id from Reference\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` task\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token scalar string\",children:`\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:'          name=\"${{ github.ref_name }}\"\\n'})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:'          lowercase=\"${name,,}\"\\n'})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token scalar string\",children:'          echo \"id=${lowercase:0:8}\" \u003e\u003e $GITHUB_OUTPUT'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Generate Image Tag\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" image\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`tag\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token scalar string\",children:`\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:'          image_tag=\"$REGISTRY/$PROJECT_ID/$SERVICE/${{ steps.task.outputs.id }}:${GITHUB_SHA::8}\"\\n'})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token scalar string\",children:'          echo \"tag=$image_tag\" \u003e\u003e $GITHUB_OUTPUT'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Build Docker Container\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token scalar string\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"          docker build -t ${{ steps.image-tag.outputs.tag }}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Push Docker Container\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token scalar string\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"          docker push ${{ steps.image-tag.outputs.tag }}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Deploy Revision with Tag\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token scalar string\",children:`\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"          gcloud run deploy ${{ env.SERVICE }} \\\\\\n\"})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:`            --platform \"managed\" \\\\\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"            --region ${{ env.REGION }} \\\\\\n\"})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"            --image ${{ steps.image-tag.outputs.tag }} \\\\\\n\"})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"            --tag pr-${{ steps.jira.outputs.id }} \\\\\\n\"})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token scalar string\",children:\"            --no-traffic\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Comment Preview URL in PR\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"uses\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" mshick/add\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"pr\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`comment@v2\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"env\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"GITHUB_TOKEN\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" $\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" secrets.GITHUB_TOKEN \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"with\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"message\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"|\"}),(0,n.jsx)(e.span,{className:\"token scalar string\",children:`\n`})]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token scalar string\",children:[\"            \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"popcorn\",children:\"\\u{1F37F}\"}),\" Successfully deployed preview revision at https://pr-${{ steps.jira.outputs.id }}---homepage-12345abcde-ez.a.run.app\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"allow-repeats\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean important\",children:\"false\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h2,{id:\"final-thoughts\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#final-thoughts\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Final Thoughts\"]}),`\n`,(0,n.jsx)(e.p,{children:\"We've just re-created the modern workflow from Vercel and Netlify! There are a few improvements to make the workflow more robust:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"use a short hash as the identifier to tag preview image and Cloud Run revision\"}),`\n`,(0,n.jsx)(e.li,{children:\"replace the hard coded live URL with a step output in the preview comment step\"}),`\n`,(0,n.jsx)(e.li,{children:\"add a workflow that cleans up the unused Cloud Run revisions and Docker containers\"}),`\n`]}),`\n`,(0,n.jsxs)(e.h2,{id:\"references\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#references\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"References\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/google-github-actions/auth\",children:\"GitHub: auth GitHub Action\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://cloud.google.com/blog/products/identity-security/enabling-keyless-authentication-from-github-actions\",children:\"Article: Enabling keyless authentication from GitHub Actions - Google Cloud\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://vercel.com/features/previews\",children:\"Website: Vercel Previews\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://www.netlify.com/products/deploy-previews/\",children:\"Website: Netlify Deploy Previews\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://vercel.com/\",children:\"Website: Vercel\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://www.netlify.com/\",children:\"Website: Netlify\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html\",children:\"Document: Shell Parameter Expansion - GNU\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://cloud.google.com\",children:\"Google Cloud\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"/articles/ex-principal-engineers-guide-to-design-thinking-and-continous-delivery#what-is-continuous-delivery\",children:\"Article: Ex-Principal Engineer's Guide to Design Thinking and Continuous Delivery - Daw-Chih Liou\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://cloud.google.com/run\",children:\"Document: Cloud Run - Google Cloud\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/features/actions\",children:\"Website: GitHub Actions\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://cloud.google.com/architecture/devops/devops-tech-trunk-based-development\",children:\"Document: DevOps tech: Trunk-based development - Google Cloud\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://cloud.google.com/artifact-registry\",children:\"Website: Artifact Registry - Google Cloud\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://cloud.google.com/sdk\",children:\"Website: Cloud SDK - Google Cloud\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://cloud.google.com/iam/docs/workload-identity-federation\",children:\"Document: Workload identity federation - Google Cloud\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://cloud.google.com/iam/docs/creating-managing-service-account-keys\",children:\"Document: Create and manage service account keys- Google Cloud\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://cloud.google.com/iam/docs/configuring-workforce-identity-federation\",children:\"Document: Configure workforce identity federation - Google Cloud\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://cloud.google.com/artifact-registry/docs/docker/store-docker-container-images\",children:\"Document: Store Docker container images in Artifact Registry - Google Cloud\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://cloud.google.com/resource-manager/docs/creating-managing-projects\",children:\"Document: Creating and managing projects - Google Cloud\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://cloud.google.com/run/docs/rollouts-rollbacks-traffic-migration#tags\",children:\"Document: Use tags for testing, traffic migration and rollbacks - Google Cloud\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/mshick/add-pr-comment\",children:\"GitHub: add-pr-comment\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/google-github-actions/setup-gcloud\",children:\"Github: setup-gcloud GitHub Action\"})}),`\n`]}),`\n`,(0,n.jsx)(e.hr,{}),`\n`,(0,n.jsxs)(e.p,{children:[\"Here you have it! Thanks for reading through\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"raising hands\",children:\"\\u{1F64C}\"}),`\nIf you find this article useful, please share it to help more people in their engineering journey.`]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"bird\",children:\"\\u{1F426}\"}),\" Feel free to connect with me on \",(0,n.jsx)(e.a,{href:\"https://twitter.com/dawchihliou\",children:\"twitter\"}),\"!\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u23ED Ready for the next article? \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"backhand index pointing right\",children:\"\\u{1F449}\"}),\" \",(0,n.jsx)(e.a,{href:\"/articles/easiest-way-to-understand-rust-modules-across-multiple-files\",children:(0,n.jsx)(e.strong,{children:\"Easiest Way to Understand Rust Modules Across Multiple Files\"})})]}),`\n`,(0,n.jsx)(e.p,{children:\"Happy coding!\"})]})}function v(a={}){let{wrapper:e}=a.components||{};return e?(0,n.jsx)(e,Object.assign({},a,{children:(0,n.jsx)(d,a)})):d(a)}var R=v;return f(b);})();\n;return Component;"},"_id":"articles/deploying-with-cloud-run-like-vercel-and-netlify.mdx","_raw":{"sourceFilePath":"articles/deploying-with-cloud-run-like-vercel-and-netlify.mdx","sourceFileName":"deploying-with-cloud-run-like-vercel-and-netlify.mdx","sourceFileDir":"articles","contentType":"mdx","flattenedPath":"articles/deploying-with-cloud-run-like-vercel-and-netlify"},"type":"Article","readingTime":{"text":"10 min read","minutes":9.555,"time":573300,"words":1911},"wordCount":1913,"slug":"deploying-with-cloud-run-like-vercel-and-netlify"}},"__N_SSG":true},"page":"/articles/[slug]","query":{"slug":"deploying-with-cloud-run-like-vercel-and-netlify"},"buildId":"2U3Dcm5RVLxSdI7jxkC5t","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>