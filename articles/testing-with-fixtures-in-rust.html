<!DOCTYPE html><html lang="en"><head><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/svg" sizes="32x32" href="/favicon.svg"/><link rel="icon" type="image/svg" sizes="16x16" href="/favicon.svg"/><link rel="mask-icon" href="/favicon.svg" color="#ffffff"/><link rel="manifest" href="/site.webmanifest"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><meta name="msapplication-TileColor" content="#007cf0"/><meta name="theme-color" content="#ffff"/><title>Testing With Fixtures in Rust</title><meta name="description" content="‚úçÔ∏è Enter description here"/><meta name="robots" content="follow, index"/><link rel="canonical" href="https://dawchihliou.github.io/articles/testing-with-fixtures-in-rust"/><meta itemProp="name" content="Testing With Fixtures in Rust"/><meta itemProp="description" content="‚úçÔ∏è Enter description here"/><meta itemProp="image" content="https://dawchihliou.github.io/optimized/articles/testing-with-fixtures-in-rust/hero.png"/><meta property="og:title" content="Testing With Fixtures in Rust"/><meta property="og:type" content="website"/><meta property="og:url" content="https://dawchihliou.github.io/articles/testing-with-fixtures-in-rust"/><meta property="og:description" content="‚úçÔ∏è Enter description here"/><meta property="og:image" content="https://dawchihliou.github.io/optimized/articles/testing-with-fixtures-in-rust/hero.png"/><meta property="og:image:type" content="image/png"/><meta property="og:image:width" content="1400"/><meta property="og:image:height" content="700"/><meta property="og:image:alt" content="‚úçÔ∏è Enter description here"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@dawchihliou"/><meta name="twitter:creator" content="@dawchihliou"/><meta name="twitter:title" content="Testing With Fixtures in Rust"/><meta name="twitter:description" content="‚úçÔ∏è Enter description here"/><meta name="twitter:image" content="https://dawchihliou.github.io/optimized/articles/testing-with-fixtures-in-rust/hero.webp"/><meta property="article:published_time" content="2023-06-23T00:00:00.000Z"/><meta property="article:section" content="Article Section"/><meta property="article:tag" content="Article Tag"/><meta name="next-head-count" content="34"/><link rel="preload" href="/_next/static/css/f4214c3b71874d65.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f4214c3b71874d65.css" data-n-g=""/><link rel="preload" href="/_next/static/css/54ba867c7255694d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/54ba867c7255694d.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-59c5c889f52620d6.js" defer=""></script><script src="/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/_next/static/chunks/main-010ff0b6bbe5ac8f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5784eb5f9f6cd23e.js" defer=""></script><script src="/_next/static/chunks/pages/articles/%5Bslug%5D-9a8f919cad4c24e6.js" defer=""></script><script src="/_next/static/D-X5pHW8_vz6tc-oPN55J/_buildManifest.js" defer=""></script><script src="/_next/static/D-X5pHW8_vz6tc-oPN55J/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div id="outer-container"><header><div><div class="bm-overlay" style="position:fixed;z-index:1000;width:100%;height:100%;background:rgba(0, 0, 0, 0.3);opacity:0;-moz-transform:translate3d(100%, 0, 0);-ms-transform:translate3d(100%, 0, 0);-o-transform:translate3d(100%, 0, 0);-webkit-transform:translate3d(100%, 0, 0);transform:translate3d(100%, 0, 0);transition:opacity 0.3s, transform 0s 0.3s"></div><div><div class="bm-burger-button" style="z-index:1000"><button id="react-burger-menu-btn" style="position:absolute;left:0;top:0;z-index:1;width:100%;height:100%;margin:0;padding:0;border:none;font-size:0;background:transparent;cursor:pointer">Open Menu</button><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="bm-icon" style="width:100%;height:100%" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div></div><div id="" class="bm-menu-wrap" style="position:fixed;right:inherit;z-index:1100;width:300px;height:100%;-moz-transform:translate3d(-100%, 0, 0);-ms-transform:translate3d(-100%, 0, 0);-o-transform:translate3d(-100%, 0, 0);-webkit-transform:translate3d(-100%, 0, 0);transform:translate3d(-100%, 0, 0);transition:all 0.5s" aria-hidden="true"><div class="bm-menu" style="height:100%;box-sizing:border-box;overflow:auto"><nav class="bm-item-list" style="height:100%"><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/"><button class="Nav_button__YJwKE" tabindex="-1">Home</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/articles"><button class="Nav_button__YJwKE" tabindex="-1">Articles</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/work"><button class="Nav_button__YJwKE" tabindex="-1">Work</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/now"><button class="Nav_button__YJwKE" tabindex="-1">Now</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/expertise"><button class="Nav_button__YJwKE" tabindex="-1">Expertise</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/contact"><button class="Nav_button__YJwKE" tabindex="-1">Contact</button></a><span class="bm-item Nav_pusher__93Gc6" style="display:block" tabindex="-1"></span><span class="bm-item Nav_divider__QD8Pt" style="display:block" tabindex="-1"></span><div class="bm-item Nav_profile__Kf2nU" style="display:block" tabindex="-1"><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/dawchihliou" aria-label="Link to Daw-Chih&#x27;s Linkedin profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M20.45175,20.45025 L16.89225,20.45025 L16.89225,14.88075 C16.89225,13.5525 16.86975,11.844 15.04275,11.844 C13.191,11.844 12.90825,13.2915 12.90825,14.7855 L12.90825,20.45025 L9.3525,20.45025 L9.3525,8.997 L12.765,8.997 L12.765,10.563 L12.81375,10.563 C13.2885,9.66225 14.4495,8.71275 16.18125,8.71275 C19.78575,8.71275 20.45175,11.08425 20.45175,14.169 L20.45175,20.45025 Z M5.33925,7.4325 C4.1955,7.4325 3.27375,6.50775 3.27375,5.36775 C3.27375,4.2285 4.1955,3.30375 5.33925,3.30375 C6.47775,3.30375 7.4025,4.2285 7.4025,5.36775 C7.4025,6.50775 6.47775,7.4325 5.33925,7.4325 L5.33925,7.4325 Z M7.11975,20.45025 L3.5565,20.45025 L3.5565,8.997 L7.11975,8.997 L7.11975,20.45025 Z M23.00025,0 L1.0005,0 C0.44775,0 0,0.44775 0,0.99975 L0,22.9995 C0,23.55225 0.44775,24 1.0005,24 L23.00025,24 C23.55225,24 24,23.55225 24,22.9995 L24,0.99975 C24,0.44775 23.55225,0 23.00025,0 L23.00025,0 Z"></path></svg></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou" aria-label="Link to Daw-Chih&#x27;s GitHub profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M11.9989871,1 C5.92550416,1 1,5.92482888 1,12.0003376 C1,16.8603395 4.15153934,20.9829338 8.52263728,22.4374904 C9.0729918,22.5387827 9.27355045,22.199116 9.27355045,21.9073943 C9.27355045,21.6467356 9.2640965,20.954572 9.25869425,20.0368642 C6.19899322,20.7013414 5.55342398,18.5620492 5.55342398,18.5620492 C5.0530403,17.2911692 4.33183953,16.9528531 4.33183953,16.9528531 C3.33309801,16.2708186 4.40747107,16.2843243 4.40747107,16.2843243 C5.51155652,16.3619816 6.09229872,17.4181221 6.09229872,17.4181221 C7.07348292,19.0988981 8.66714755,18.6133706 9.2938089,18.3317781 C9.39375058,17.6213819 9.67804414,17.1365297 9.99205009,16.86169 C7.54955646,16.5841493 4.98146045,15.6401056 4.98146045,11.4249977 C4.98146045,10.224347 5.41026428,9.24181221 6.11390773,8.47334172 C6.00046042,8.19512569 5.62297799,7.07618404 6.22195279,5.56220265 C6.22195279,5.56220265 7.14506277,5.26642929 9.24653918,6.68992296 C10.12373,6.44547101 11.0650726,6.32392032 12.0003376,6.31919335 C12.9349274,6.32392032 13.8755947,6.44547101 14.7541361,6.68992296 C16.8542619,5.26642929 17.7760214,5.56220265 17.7760214,5.56220265 C18.3763467,7.07618404 17.9988643,8.19512569 17.8860923,8.47334172 C18.5910863,9.24181221 19.0165137,10.224347 19.0165137,11.4249977 C19.0165137,15.6509101 16.444366,16.5807729 13.9944443,16.8529114 C14.3888087,17.192578 14.7406305,17.863808 14.7406305,18.890236 C14.7406305,20.3603241 14.7271248,21.5467939 14.7271248,21.9073943 C14.7271248,22.2018171 14.9256576,22.5441849 15.4834403,22.4368151 C19.8511618,20.9788821 23,16.8589889 23,12.0003376 C23,5.92482888 18.0744958,1 11.9989871,1"></path></svg></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://medium.com/@dawchihliou" aria-label="Link to Daw-Chih&#x27;s Medium profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2.84593838,5.88685595 C2.87575654,5.59224254 2.76340763,5.30104995 2.54341737,5.10276397 L0.302521008,2.4032473 L0.302521008,2 L7.2605042,2 L12.6386555,13.7949836 L17.3669469,2 L24,2 L24,2.4032473 L22.0840336,4.2402628 C21.9188563,4.36617057 21.8369199,4.57310892 21.8711485,4.77792587 L21.8711485,18.2755093 C21.8369199,18.4803262 21.9188563,18.6872645 22.0840336,18.8131723 L23.9551821,20.6501878 L23.9551821,21.0534351 L14.5434174,21.0534351 L14.5434174,20.6501878 L16.4817928,18.7683671 C16.6722689,18.5779447 16.6722689,18.5219382 16.6722689,18.2307041 L16.6722689,7.32062416 L11.2829132,21.0086299 L10.5546219,21.0086299 L4.28011204,7.32062416 L4.28011204,16.4945003 C4.22779746,16.8801958 4.35589372,17.2685069 4.62745097,17.5474239 L7.14845938,20.6053826 L7.14845938,21.0086299 L0,21.0086299 L0,20.6053826 L2.5210084,17.5474239 C2.79058848,17.2680445 2.91121535,16.8771576 2.84593838,16.4945003 L2.84593838,5.88685595 Z"></path></svg></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://hackernoon.com/u/dawchihliou" aria-label="Link to Daw-Chih&#x27;s Hackernoon profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="1.5em" width="1.5em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M5.701 0v6.223H8.85V4.654h1.576v7.842H12V4.654h1.574v1.569h3.15V0zm11.024 6.223v3.136h1.574V6.223zm1.574 3.136v4.705h1.576v-1.568h1.574v-1.568h-1.574V9.359zm0 4.705h-1.574v3.137h1.574zm-1.574 3.137h-3.15v1.569H8.85V17.2H5.7V24h11.024zm-11.024 0v-3.137H4.125v3.137zm-1.576-3.137V9.36H2.551v4.705zm0-4.705h1.576V6.223H4.125Z"></path></svg><span hidden="">Link to Daw-Chih&#x27;s Hacker Noon profile</span></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://twitter.com/dawchihliou" aria-label="Link to Daw-Chih&#x27;s Twitter profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M24,4.3086 C23.117,4.7006 22.168,4.9646 21.172,5.0836 C22.188,4.4746 22.969,3.5096 23.337,2.3596 C22.386,2.9246 21.332,3.3336 20.21,3.5556 C19.312,2.5976 18.032,1.9996 16.616,1.9996 C13.897,1.9996 11.692,4.2046 11.692,6.9236 C11.692,7.3096 11.736,7.6856 11.82,8.0456 C7.728,7.8406 4.099,5.8806 1.671,2.9006 C1.247,3.6286 1.004,4.4736 1.004,5.3766 C1.004,7.0846 1.873,8.5926 3.195,9.4756 C2.388,9.4486 1.628,9.2276 0.964,8.8596 L0.964,8.9206 C0.964,11.3066 2.661,13.2966 4.914,13.7486 C4.501,13.8626 4.065,13.9216 3.617,13.9216 C3.299,13.9216 2.991,13.8906 2.69,13.8336 C3.317,15.7896 5.135,17.2136 7.29,17.2536 C5.604,18.5736 3.481,19.3606 1.175,19.3606 C0.777,19.3606 0.385,19.3376 0,19.2926 C2.179,20.6886 4.767,21.5046 7.548,21.5046 C16.605,21.5046 21.557,14.0016 21.557,7.4946 C21.557,7.2816 21.552,7.0696 21.543,6.8586 C22.505,6.1636 23.34,5.2966 24,4.3086"></path></svg></a></div><div class="DarkmodeSwitch_container__uFGHQ" tabindex="-1"><div class="DarkmodeSwitch_wrap__e71_4"></div></div></nav></div><div><div class="bm-cross-button" style="position:absolute;width:24px;height:24px;right:8px;top:8px"><button id="react-burger-cross-btn" style="position:absolute;left:0;top:0;z-index:1;width:100%;height:100%;margin:0;padding:0;border:none;font-size:0;background:transparent;cursor:pointer" tabindex="-1">Close Menu</button><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="bm-cross" style="width:100%;height:100%" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div></div></div></div></header><div class="Menubar_menubar__gvU4b"><a class="styles_anchor__g18qA Menubar_hireMe__zuAig" href="/contact"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1.5em" width="1.5em" xmlns="http://www.w3.org/2000/svg"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>Hire Me</a><div class="DarkmodeSwitch_container__uFGHQ" tabindex="0"><div class="DarkmodeSwitch_wrap__e71_4"></div></div><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou" aria-label="See more Daw-Chih&#x27;s work on GitHub"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1.5em" width="1.5em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M11.9989871,1 C5.92550416,1 1,5.92482888 1,12.0003376 C1,16.8603395 4.15153934,20.9829338 8.52263728,22.4374904 C9.0729918,22.5387827 9.27355045,22.199116 9.27355045,21.9073943 C9.27355045,21.6467356 9.2640965,20.954572 9.25869425,20.0368642 C6.19899322,20.7013414 5.55342398,18.5620492 5.55342398,18.5620492 C5.0530403,17.2911692 4.33183953,16.9528531 4.33183953,16.9528531 C3.33309801,16.2708186 4.40747107,16.2843243 4.40747107,16.2843243 C5.51155652,16.3619816 6.09229872,17.4181221 6.09229872,17.4181221 C7.07348292,19.0988981 8.66714755,18.6133706 9.2938089,18.3317781 C9.39375058,17.6213819 9.67804414,17.1365297 9.99205009,16.86169 C7.54955646,16.5841493 4.98146045,15.6401056 4.98146045,11.4249977 C4.98146045,10.224347 5.41026428,9.24181221 6.11390773,8.47334172 C6.00046042,8.19512569 5.62297799,7.07618404 6.22195279,5.56220265 C6.22195279,5.56220265 7.14506277,5.26642929 9.24653918,6.68992296 C10.12373,6.44547101 11.0650726,6.32392032 12.0003376,6.31919335 C12.9349274,6.32392032 13.8755947,6.44547101 14.7541361,6.68992296 C16.8542619,5.26642929 17.7760214,5.56220265 17.7760214,5.56220265 C18.3763467,7.07618404 17.9988643,8.19512569 17.8860923,8.47334172 C18.5910863,9.24181221 19.0165137,10.224347 19.0165137,11.4249977 C19.0165137,15.6509101 16.444366,16.5807729 13.9944443,16.8529114 C14.3888087,17.192578 14.7406305,17.863808 14.7406305,18.890236 C14.7406305,20.3603241 14.7271248,21.5467939 14.7271248,21.9073943 C14.7271248,22.2018171 14.9256576,22.5441849 15.4834403,22.4368151 C19.8511618,20.9788821 23,16.8589889 23,12.0003376 C23,5.92482888 18.0744958,1 11.9989871,1"></path></svg></a></div><div id="page-wrap"><article><div class="Article_container__q__L3"><div class="Article_wrap__LZypL"><h1>Testing With Fixtures in Rust</h1><div class="Article_info__bOKys"><div class="Article_author__grS8U"><img alt="Daw-Chih Liou" src="/optimized/raw/portrait-sm.webp" loading="lazy"/><p>Daw-Chih Liou</p></div><p>Jun 23, 2023<!-- --> ¬∑ 6 min read</p></div><img alt="Testing With Fixtures in Rust" src="/optimized/articles/testing-with-fixtures-in-rust/hero.webp" width="100%" class="rounded centered" loading="lazy"/><div class="article-content"><h2 id="in-this-article"><a class="styles_anchor__g18qA anchor" href="/articles/testing-with-fixtures-in-rust#in-this-article"><span class="icon icon-link"></span></a>In this article</h2>
<ul>
<li><span role="img" aria-label="microscope">üî¨</span> We&#x27;ll learn the limitations of #[test] in Rust.</li>
<li>ü™Ñ We&#x27;ll explore an alternative to write cleaner unit tests with fixtures.</li>
<li>üèó We&#x27;ll refactor the unit tests in one of my open source projects!</li>
</ul>
<p>Let&#x27;s go.</p>
<hr/>
<h2 id="the-fixture-problem"><a class="styles_anchor__g18qA anchor" href="/articles/testing-with-fixtures-in-rust#the-fixture-problem"><span class="icon icon-link"></span></a>The Fixture Problem</h2>
<p><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Test_fixture">Test fixtures</a> are very effective in producing repeatable tests. A test fixture can be a constant or function that encapsulates a test&#x27;s dependency.</p>
<p>I wanted to create a few test fixtures for my unit tests in one of my open source projects called <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/tantaraio/voy">Voy</a>. It&#x27;s a Webassembly semantic engine written in Rust. What it does is to <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Feature_extraction">extract features</a> using machine learning models, build an index, and provide a query function that enables users to search the index based on meaning and semantics. Here&#x27;s a quick demo:</p>
<img src="/articles/share-rust-types-with-typescript-for-webassembly-in-30-seconds/voy.gif" alt="Voy demo" width="100%" class="rounded centered" loading="lazy"/>
<blockquote>
<p>You can find the <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/tantaraio/voy">Voy&#x27;s repository on GitHub</a>! Feel free to try it out. The repository includes <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/tantaraio/voy/tree/main/examples">examples</a> that you can see how to use Voy in different frameworks.</p>
</blockquote>
<p>While I was still working on the feature extraction, I needed pre-generated <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://developers.google.com/machine-learning/crash-course/embeddings/video-lecture">embeddings</a> to test the index and query part of the engine. The fixture for embeddings looks like this:</p>
<pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token constant">EMBEDDING</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">768</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
</span><span class="code-line">    <span class="token punctuation">[</span>
</span><span class="code-line">        <span class="token number">0.01960003957247733</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token operator">-</span><span class="token number">0.03651725347725505</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token number">0.03361894761373059</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token comment">// ...</span>
</span><span class="code-line">    <span class="token punctuation">]</span>
</span></code></pre>
<p>I created a static variable for 6 embeddings in an array. Each item is a 768 dimensional vector that represents a sentence.</p>
<p>To use the fixture, I simply imported it in my test module. My unit test looks like this:</p>
<pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token keyword">super</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>engine_fixtures<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token constant">EMBEDDING</span><span class="token punctuation">,</span> <span class="token constant">CONTENT</span><span class="token punctuation">,</span> <span class="token constant">QUESTION</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>engine<span class="token punctuation">::</span></span><span class="token punctuation">{</span>add<span class="token punctuation">,</span> index<span class="token punctuation">,</span> remove<span class="token punctuation">,</span> search<span class="token punctuation">,</span> <span class="token class-name">Query</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token punctuation">::</span><span class="token punctuation">{</span><span class="token class-name">EmbeddedResource</span><span class="token punctuation">,</span> <span class="token class-name">Resource</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function-definition function">get_resource</span><span class="token punctuation">(</span>k<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Resource</span> <span class="token punctuation">{</span>
</span><span class="code-line">     <span class="token keyword">let</span> embeddings <span class="token operator">=</span> <span class="token constant">EMBEDDING</span>
</span><span class="code-line">         <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">         <span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span>
</span><span class="code-line">         <span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">         <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token class-name">EmbeddedResource</span> <span class="token punctuation">{</span>
</span><span class="code-line">             id<span class="token punctuation">:</span> i<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">             title<span class="token punctuation">:</span> <span class="token constant">CONTENT</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">             url<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">to_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">             embeddings<span class="token punctuation">:</span> x<span class="token punctuation">.</span><span class="token function">to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">         <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">         <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">     <span class="token class-name">Resource</span> <span class="token punctuation">{</span> embeddings <span class="token punctuation">}</span>
</span><span class="code-line"> <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token attribute attr-name">#[test]</span>
</span><span class="code-line"> <span class="token keyword">fn</span> <span class="token function-definition function">it_returns_vector_search_result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">     <span class="token keyword">let</span> resource<span class="token punctuation">:</span> <span class="token class-name">Resource</span> <span class="token operator">=</span> <span class="token function">get_resource</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">     <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token function">index</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">     <span class="token keyword">let</span> query <span class="token operator">=</span> <span class="token class-name">Query</span><span class="token punctuation">::</span><span class="token class-name">Embeddings</span><span class="token punctuation">(</span><span class="token constant">QUESTION</span><span class="token punctuation">.</span><span class="token function">to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">     <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>index<span class="token punctuation">,</span> <span class="token operator">&amp;</span>query<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">     <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token constant">CONTENT</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">     <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token constant">CONTENT</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">     <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token constant">CONTENT</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">     <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token constant">CONTENT</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">     <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token constant">CONTENT</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">     <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token constant">CONTENT</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"> <span class="token punctuation">}</span>
</span></code></pre>
<p>I created another 2 fixtures for the sentences the generated the embeddings and a question embedding to perform the query.</p>
<p>The test case worked. The fixture produced repeatable results. However, it seems a little off. It&#x27;s not very clean:</p>
<ul>
<li>I needed a helper function to &quot;get_resource&quot; in the test case to initiate the fixture.</li>
<li>The fixtures were not encapsulated in the unit test and the usages were scattered.</li>
</ul>
<p>So I started looking for a better way to write the test.</p>
<h2 id="introducing-the-rstest-crate"><a class="styles_anchor__g18qA anchor" href="/articles/testing-with-fixtures-in-rust#introducing-the-rstest-crate"><span class="icon icon-link"></span></a>Introducing The rstest Crate</h2>
<p><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://docs.rs/rstest/latest/rstest/">rstest</a> makes it very easy to write unit tests with fixtures. All you need to do is:</p>
<h4 id="defining-fixtures"><a class="styles_anchor__g18qA anchor" href="/articles/testing-with-fixtures-in-rust#defining-fixtures"><span class="icon icon-link"></span></a>Defining fixtures</h4>
<pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line"><span class="token attribute attr-name">#[fixture]</span>
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">fixture</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u32</span> <span class="token punctuation">{</span> <span class="token number">42</span> <span class="token punctuation">}</span>
</span></code></pre>
<h4 id="replacing-test-with-rstest-macro"><a class="styles_anchor__g18qA anchor" href="/articles/testing-with-fixtures-in-rust#replacing-test-with-rstest-macro"><span class="icon icon-link"></span></a>Replacing #[test] with #[rstest] macro.</h4>
<pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line"><span class="token attribute attr-name">#[rstest]</span>
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function-definition function">should_success</span><span class="token punctuation">(</span>fixture<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>fixture<span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>You can check out <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://docs.rs/rstest/latest/rstest/">rstest&#x27;s repository</a> to find more ways to write test fixtures.</p>
<p>Now let&#x27;s use rstest to refactor the fixtures above. I&#x27;ll simply create a function to return the static variable. Like this:</p>
<div class="rehype-code-title">src/engine/tests/fixtures.rs</div><pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">rstest<span class="token punctuation">::</span></span>fixture<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token attribute attr-name">#[fixture]</span>
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">embedding_fixture</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">768</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token number">6</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token constant">EMBEDDING</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>We can refactor the &quot;get_resource&quot; helper function as a fixture too:</p>
<div class="rehype-code-title">src/engine/tests/fixtures.rs</div><pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line"><span class="token attribute attr-name">#[fixture]</span>
</span><span class="code-line"><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">resource_fixture</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Resource</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">let</span> content <span class="token operator">=</span> <span class="token function">content_fixture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">let</span> embeddings <span class="token operator">=</span> <span class="token function">embedding_fixture</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token class-name">EmbeddedResource</span> <span class="token punctuation">{</span>
</span><span class="code-line">            id<span class="token punctuation">:</span> i<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            title<span class="token punctuation">:</span> content<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            url<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">to_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">            embeddings<span class="token punctuation">:</span> x<span class="token punctuation">.</span><span class="token function">to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token class-name">Resource</span> <span class="token punctuation">{</span> embeddings <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>Since each fixture functions are just functions, we can use them inside another fixture function like we see in the &quot;resource_fixture&quot; function above.</p>
<p>To use the fixtures in a test case, we&#x27;ll need to import the fixtures and inject them as parameters:</p>
<div class="rehype-code-title">src/engine/tests/mod.rs</div><pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">fixtures<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">rstest<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token attribute attr-name">#[rstest]</span>
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function-definition function">it_returns_vector_search_result</span><span class="token punctuation">(</span>
</span><span class="code-line">    resource_fixture<span class="token punctuation">:</span> <span class="token class-name">Resource</span><span class="token punctuation">,</span>
</span><span class="code-line">    question_fixture<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">f32</span><span class="token punctuation">;</span> <span class="token number">768</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line">    content_fixture<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#x27;static</span> <span class="token keyword">str</span><span class="token punctuation">;</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token function">index</span><span class="token punctuation">(</span>resource_fixture<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">let</span> query <span class="token operator">=</span> <span class="token class-name">Query</span><span class="token punctuation">::</span><span class="token class-name">Embeddings</span><span class="token punctuation">(</span>question_fixture<span class="token punctuation">.</span><span class="token function">to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">search</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>index<span class="token punctuation">,</span> <span class="token operator">&amp;</span>query<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span> content_fixture<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span> content_fixture<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span> content_fixture<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span> content_fixture<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span> content_fixture<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span> content_fixture<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>Make sure the parameters have the same names as the fixtures. rstest uses the names to inject and initiate the fixtures in the test functions.</p>
<p>Let&#x27;s run &quot;cargo test&quot; to see if it works.</p>
<img src="/optimized/articles/testing-with-fixtures-in-rust/terminal.webp" alt="Unit result with fixtures" width="100%" class="rounded centered" loading="lazy"/>
<p>It does!</p>
<h2 id="final-thoughts"><a class="styles_anchor__g18qA anchor" href="/articles/testing-with-fixtures-in-rust#final-thoughts"><span class="icon icon-link"></span></a>Final Thoughts</h2>
<p><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://docs.rs/rstest/latest/rstest/">rstest</a> has more convenient features. For example, you can write multiple test cases with #[case]:</p>
<pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">rstest<span class="token punctuation">::</span></span>rstest<span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token attribute attr-name">#[rstest]</span>
</span><span class="code-line"><span class="token attribute attr-name">#[case(0, 0)]</span>
</span><span class="code-line"><span class="token attribute attr-name">#[case(1, 1)]</span>
</span><span class="code-line"><span class="token attribute attr-name">#[case(2, 1)]</span>
</span><span class="code-line"><span class="token attribute attr-name">#[case(3, 2)]</span>
</span><span class="code-line"><span class="token attribute attr-name">#[case(4, 3)]</span>
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function-definition function">fibonacci_test</span><span class="token punctuation">(</span><span class="token attribute attr-name">#[case]</span> input<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token attribute attr-name">#[case]</span> expected<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>expected<span class="token punctuation">,</span> <span class="token function">fibonacci</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>You can also test <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/std/future/index.html">Future</a>!</p>
<pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">rstest<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token attribute attr-name">#[fixture]</span>
</span><span class="code-line"><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">base</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u32</span> <span class="token punctuation">{</span> <span class="token number">42</span> <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token attribute attr-name">#[rstest]</span>
</span><span class="code-line"><span class="token attribute attr-name">#[case(21, async { 2 })]</span>
</span><span class="code-line"><span class="token attribute attr-name">#[case(6, async { 7 })]</span>
</span><span class="code-line"><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">my_async_test</span><span class="token punctuation">(</span><span class="token attribute attr-name">#[future]</span> base<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token attribute attr-name">#[case]</span> expected<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token attribute attr-name">#[future]</span> <span class="token attribute attr-name">#[case]</span> div<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>expected<span class="token punctuation">,</span> base<span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token operator">/</span> div<span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>These are just a few examples I took from rstest. It has more fixture-based features that help us to structure cleaner unit tests with test fixtures. I really enjoyed it.</p>
<p><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/tantaraio/voy">Voy</a> is an open source semantic search engine in WebAssembly. I created it to empower more projects to build semantic features and create better user experiences for people around the world. Voy follows several design principles:</p>
<ul>
<li><span role="img" aria-label="" aria-hidden="true">ü§è</span> <strong>Tiny</strong>: Reduce overhead for limited devices, such as mobile browsers with slow network or IoT.</li>
<li><span role="img" aria-label="rocket">üöÄ</span> <strong>Fast</strong>: Create the best search experience for the users.</li>
<li><span role="img" aria-label="deciduous tree">üå≥</span> <strong>Tree Shakable</strong>: Optimize bundle size and enable asynchronous capabilities for modern Web API, such as Web Workers.</li>
<li><span role="img" aria-label="battery">üîã</span> <strong>Resumable</strong>: Generate portable embeddings index anywhere, anytime.</li>
<li><span role="img" aria-label="cloud">‚òÅÔ∏è</span> <strong>Worldwide</strong>: Run semantic search on CDN edge servers.</li>
</ul>
<p>It&#x27;s available on npm. You can simply install it with your favorite package manager and you&#x27;re ready to go.</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line"><span class="token comment"># with npm</span>
</span><span class="code-line"><span class="token function">npm</span> i voy-search
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># with Yarn</span>
</span><span class="code-line"><span class="token function">yarn</span> <span class="token function">add</span> voy-search
</span><span class="code-line">
</span><span class="code-line"><span class="token comment"># with pnpm</span>
</span><span class="code-line"><span class="token function">pnpm</span> <span class="token function">add</span> voy-search
</span></code></pre>
<p>Give it a try and I&#x27;m happy to hear from you!</p>
<h2 id="references"><a class="styles_anchor__g18qA anchor" href="/articles/testing-with-fixtures-in-rust#references"><span class="icon icon-link"></span></a>References</h2>
<ul>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Feature_extraction">Feature extraction</a> - Wikipedia</li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://doc.rust-lang.org/std/future/index.html">Future</a> - Rust Doc</li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.rust-lang.org">Rust</a> - Rust Team</li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://docs.rs/rstest/latest/rstest/">rstest</a> - GitHub</li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Test_fixture">Test fixture</a> - Wikipedia</li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/tantaraio/voy">Voy</a> - GitHub</li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://webassembly.org">WebAssembly</a> - WebAssembly.org</li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://developers.google.com/machine-learning/crash-course/embeddings/video-lecture">Embeddings</a> - Google for Developers</li>
</ul>
<hr/>
<p>Here you have it! Thanks for reading through <span role="img" aria-label="raising hands">üôå</span>
If you find this article useful, please share it to help more people in their engineering journey.</p>
<p><span role="img" aria-label="bird">üê¶</span> Feel free to connect with me on <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://twitter.com/dawchihliou">twitter</a>!</p>
<p><span role="img" aria-label="" aria-hidden="true">‚è≠Ô∏è</span> Ready for the next article? <span role="img" aria-label="backhand index pointing right">üëâ</span> <a class="styles_anchor__g18qA undefined" href="/articles/share-rust-types-with-typescript-for-webassembly-in-30-seconds">Share Rust Types With TypeScript for WebAssembly in 30 Seconds</a></p>
<p>Happy coding!</p></div><article class="Author_wrap__s8DeE"><img src="/optimized/raw/portrait-sm.webp" alt="Daw-Chih Liou" class="Author_avatar__j6KIn" loading="lazy"/><div><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://dawchihliou.github.io">Daw-Chih Liou</a><p>Daw-Chih is a software engineer, UX advocate, and creator who is dedicated to Web engineering. His background in Human Centered Computing has led him to work with startups and public companies across North America, Asia, and Europe. He is passionate about meeting business trajectory with user journey and utilizing engineering architecture and performance monitoring to provide optimal user experience.</p></div></article></div></div></article><footer class="Footer_footer__1IwEk"><div class="Footer_wrap__FVCTX"><div class="Footer_resources__fG_vu"><p><span role="img" aria-label="build with love" class="Footer_emoji__u15jg">üíö</span>This site is built with</p><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://nextjs.org">Next.js</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://react-icons.github.io/react-icons">React Icons</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://mdxjs.com">MDX</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://unifiedjs.com">unified</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/contentlayerdev/contentlayer">Contentlayer</a></div><div class="Footer_contact__9GJn6"><p><span role="img" aria-label="build with love" class="Footer_emoji__u15jg">ü¶Ñ</span>Where to find me</p><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/dawchihliou">Linkedin</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou">GitHub</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://twitter.com/dawchihliou">Twitter</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://medium.com/@dawchihliou">Medium</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://hackernoon.com/u/dawchihliou">Hacker Noon</a><a class="styles_anchor__g18qA undefined" href="/rss.xml">RSS Feed <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></div><div class="Footer_sitemap__92ono"><p><span role="img" aria-label="build with love" class="Footer_emoji__u15jg">üó∫</span>Sitemap</p><a class="styles_anchor__g18qA undefined" href="/">Home</a><a class="styles_anchor__g18qA undefined" href="/articles">Articles</a><a class="styles_anchor__g18qA undefined" href="/work">Work</a><a class="styles_anchor__g18qA undefined" href="/now">Now</a><a class="styles_anchor__g18qA undefined" href="/expertise">Expertise</a><a class="styles_anchor__g18qA undefined" href="/contact">Contact</a></div></div><div class="Footer_copyright__vZZRL">¬© <!-- -->2023<!-- --> <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/dawchihliou">Daw-Chih Liou</a></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"Testing With Fixtures in Rust","publishedAt":"Jun 23, 2023","description":"‚úçÔ∏è Enter description here","cover":"/optimized/articles/testing-with-fixtures-in-rust/hero.webp","category":"Rust","coverWidth":"1400","coverHeight":"700","body":{"raw":"\n## In this article\n\n- üî¨ We'll learn the limitations of #[test] in Rust.\n- ü™Ñ We'll explore an alternative to write cleaner unit tests with fixtures.\n- üèó We'll refactor the unit tests in one of my open source projects!\n\nLet's go.\n\n---\n\n## The Fixture Problem\n\n[Test fixtures][2] are very effective in producing repeatable tests. A test fixture can be a constant or function that encapsulates a test's dependency.\n\nI wanted to create a few test fixtures for my unit tests in one of my open source projects called [Voy][7]. It's a Webassembly semantic engine written in Rust. What it does is to [extract features][4] using machine learning models, build an index, and provide a query function that enables users to search the index based on meaning and semantics. Here's a quick demo:\n\n\u003cimg\n  src=\"/articles/share-rust-types-with-typescript-for-webassembly-in-30-seconds/voy.gif\"\n  alt=\"Voy demo\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/\u003e\n\n\u003e You can find the [Voy's repository on GitHub][7]! Feel free to try it out. The repository includes [examples](https://github.com/tantaraio/voy/tree/main/examples) that you can see how to use Voy in different frameworks.\n\nWhile I was still working on the feature extraction, I needed pre-generated [embeddings][6] to test the index and query part of the engine. The fixture for embeddings looks like this:\n\n```rust\npub static EMBEDDING: [[f32; 768]; 6] = [\n    [\n        0.01960003957247733,\n        -0.03651725347725505,\n        0.03361894761373059,\n        // ...\n    ]\n```\n\nI created a static variable for 6 embeddings in an array. Each item is a 768 dimensional vector that represents a sentence.\n\nTo use the fixture, I simply imported it in my test module. My unit test looks like this:\n\n```rust\nuse super::engine_fixtures::{EMBEDDING, CONTENT, QUESTION};\nuse crate::engine::{add, index, remove, search, Query};\nuse crate::{EmbeddedResource, Resource};\n\nfn get_resource(k: usize) -\u003e Resource {\n     let embeddings = EMBEDDING\n         .iter()\n         .take(k)\n         .enumerate()\n         .map(|(i, x)| EmbeddedResource {\n             id: i.to_string(),\n             title: CONTENT.get(i).unwrap().to_string(),\n             url: \"\".to_owned(),\n             embeddings: x.to_vec(),\n         })\n         .collect();\n     Resource { embeddings }\n }\n\n#[test]\n fn it_returns_vector_search_result() {\n     let resource: Resource = get_resource(6);\n     let index = index(resource).unwrap();\n\n     let query = Query::Embeddings(QUESTION.to_vec());\n     let result = search(\u0026index, \u0026query, 1).unwrap();\n\n     assert_eq!(result.get(0).unwrap().title, CONTENT[0]);\n     assert_eq!(result.get(1).unwrap().title, CONTENT[1]);\n     assert_eq!(result.get(2).unwrap().title, CONTENT[2]);\n     assert_eq!(result.get(3).unwrap().title, CONTENT[4]);\n     assert_eq!(result.get(4).unwrap().title, CONTENT[5]);\n     assert_eq!(result.get(5).unwrap().title, CONTENT[3]);\n }\n```\n\nI created another 2 fixtures for the sentences the generated the embeddings and a question embedding to perform the query.\n\nThe test case worked. The fixture produced repeatable results. However, it seems a little off. It's not very clean:\n\n- I needed a helper function to \"get_resource\" in the test case to initiate the fixture.\n- The fixtures were not encapsulated in the unit test and the usages were scattered.\n\nSo I started looking for a better way to write the test.\n\n## Introducing The rstest Crate\n\n[rstest][1] makes it very easy to write unit tests with fixtures. All you need to do is:\n\n#### Defining fixtures\n\n```rust\n#[fixture]\npub fn fixture() -\u003e u32 { 42 }\n```\n\n#### Replacing #[test] with #[rstest] macro.\n\n```rust\n#[rstest]\nfn should_success(fixture: u32) {\n    assert_eq!(fixture, 42);\n}\n```\n\nYou can check out [rstest's repository][1] to find more ways to write test fixtures.\n\nNow let's use rstest to refactor the fixtures above. I'll simply create a function to return the static variable. Like this:\n\n```rust:src/engine/tests/fixtures.rs\nuse rstest::fixture;\n\n#[fixture]\npub fn embedding_fixture() -\u003e [[f32; 768]; 6] {\n    EMBEDDING\n}\n```\n\nWe can refactor the \"get_resource\" helper function as a fixture too:\n\n```rust:src/engine/tests/fixtures.rs\n#[fixture]\npub fn resource_fixture() -\u003e Resource {\n    let content = content_fixture();\n    let embeddings = embedding_fixture()\n        .iter()\n        .enumerate()\n        .map(|(i, x)| EmbeddedResource {\n            id: i.to_string(),\n            title: content.get(i).unwrap().to_string(),\n            url: \"\".to_owned(),\n            embeddings: x.to_vec(),\n        })\n        .collect();\n    Resource { embeddings }\n}\n```\n\nSince each fixture functions are just functions, we can use them inside another fixture function like we see in the \"resource_fixture\" function above.\n\nTo use the fixtures in a test case, we'll need to import the fixtures and inject them as parameters:\n\n```rust:src/engine/tests/mod.rs\nuse fixtures::*;\nuse rstest::*;\n\n#[rstest]\nfn it_returns_vector_search_result(\n    resource_fixture: Resource,\n    question_fixture: [f32; 768],\n    content_fixture: [\u0026'static str; 6],\n) {\n    let index = index(resource_fixture).unwrap();\n    let query = Query::Embeddings(question_fixture.to_vec());\n    let result = search(\u0026index, \u0026query, 6).unwrap();\n\n    assert_eq!(result.get(0).unwrap().title, content_fixture[0]);\n    assert_eq!(result.get(1).unwrap().title, content_fixture[1]);\n    assert_eq!(result.get(2).unwrap().title, content_fixture[2]);\n    assert_eq!(result.get(3).unwrap().title, content_fixture[4]);\n    assert_eq!(result.get(4).unwrap().title, content_fixture[5]);\n    assert_eq!(result.get(5).unwrap().title, content_fixture[3]);\n}\n```\n\nMake sure the parameters have the same names as the fixtures. rstest uses the names to inject and initiate the fixtures in the test functions.\n\nLet's run \"cargo test\" to see if it works.\n\n\u003cimg\n  src=\"/optimized/articles/testing-with-fixtures-in-rust/terminal.webp\"\n  alt=\"Unit result with fixtures\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/\u003e\n\nIt does!\n\n## Final Thoughts\n\n[rstest][1] has more convenient features. For example, you can write multiple test cases with #[case]:\n\n```rust\nuse rstest::rstest;\n\n#[rstest]\n#[case(0, 0)]\n#[case(1, 1)]\n#[case(2, 1)]\n#[case(3, 2)]\n#[case(4, 3)]\nfn fibonacci_test(#[case] input: u32, #[case] expected: u32) {\n    assert_eq!(expected, fibonacci(input))\n}\n```\n\nYou can also test [Future][8]!\n\n```rust\nuse rstest::*;\n#[fixture]\nasync fn base() -\u003e u32 { 42 }\n\n#[rstest]\n#[case(21, async { 2 })]\n#[case(6, async { 7 })]\nasync fn my_async_test(#[future] base: u32, #[case] expected: u32, #[future] #[case] div: u32) {\n    assert_eq!(expected, base.await / div.await);\n}\n```\n\nThese are just a few examples I took from rstest. It has more fixture-based features that help us to structure cleaner unit tests with test fixtures. I really enjoyed it.\n\n[Voy][7] is an open source semantic search engine in WebAssembly. I created it to empower more projects to build semantic features and create better user experiences for people around the world. Voy follows several design principles:\n\n- ü§è **Tiny**: Reduce overhead for limited devices, such as mobile browsers with slow network or IoT.\n- üöÄ **Fast**: Create the best search experience for the users.\n- üå≥ **Tree Shakable**: Optimize bundle size and enable asynchronous capabilities for modern Web API, such as Web Workers.\n- üîã **Resumable**: Generate portable embeddings index anywhere, anytime.\n- ‚òÅÔ∏è **Worldwide**: Run semantic search on CDN edge servers.\n\nIt's available on npm. You can simply install it with your favorite package manager and you're ready to go.\n\n```bash\n# with npm\nnpm i voy-search\n\n# with Yarn\nyarn add voy-search\n\n# with pnpm\npnpm add voy-search\n```\n\nGive it a try and I'm happy to hear from you!\n\n## References\n\n- [Feature extraction][4] - Wikipedia\n- [Future][8] - Rust Doc\n- [Rust][3] - Rust Team\n- [rstest][1] - GitHub\n- [Test fixture][2] - Wikipedia\n- [Voy][7] - GitHub\n- [WebAssembly][5] - WebAssembly.org\n- [Embeddings][6] - Google for Developers\n\n[1]: https://docs.rs/rstest/latest/rstest/\n[2]: https://en.wikipedia.org/wiki/Test_fixture\n[3]: https://www.rust-lang.org\n[4]: https://en.wikipedia.org/wiki/Feature_extraction\n[5]: https://webassembly.org\n[6]: https://developers.google.com/machine-learning/crash-course/embeddings/video-lecture\n[7]: https://github.com/tantaraio/voy\n[8]: https://doc.rust-lang.org/std/future/index.html\n\n---\n\nHere you have it! Thanks for reading through üôå\nIf you find this article useful, please share it to help more people in their engineering journey.\n\nüê¶ Feel free to connect with me on [twitter](https://twitter.com/dawchihliou)!\n\n‚è≠Ô∏è Ready for the next article? üëâ [Share Rust Types With TypeScript for WebAssembly in 30 Seconds](/articles/share-rust-types-with-typescript-for-webassembly-in-30-seconds)\n\nHappy coding!\n","code":"var Component=(()=\u003e{var u=Object.create;var t=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var k=(a,n)=\u003e()=\u003e(n||a((n={exports:{}}).exports,n),n.exports),f=(a,n)=\u003e{for(var s in n)t(a,s,{get:n[s],enumerable:!0})},i=(a,n,s,l)=\u003e{if(n\u0026\u0026typeof n==\"object\"||typeof n==\"function\")for(let c of h(n))!N.call(a,c)\u0026\u0026c!==s\u0026\u0026t(a,c,{get:()=\u003en[c],enumerable:!(l=d(n,c))||l.enumerable});return a};var g=(a,n,s)=\u003e(s=a!=null?u(m(a)):{},i(n||!a||!a.__esModule?t(s,\"default\",{value:a,enumerable:!0}):s,a)),b=a=\u003ei(t({},\"__esModule\",{value:!0}),a);var r=k((T,o)=\u003e{o.exports=_jsx_runtime});var _={};f(_,{default:()=\u003ex,frontmatter:()=\u003ey});var e=g(r()),y={title:\"Testing With Fixtures in Rust\",publishedAt:\"Jun 23, 2023\",description:\"\\u270D\\uFE0F Enter description here\",cover:\"/optimized/articles/testing-with-fixtures-in-rust/hero.webp\",category:\"Rust\",coverWidth:\"1400\",coverHeight:\"700\"};function p(a){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",ul:\"ul\",li:\"li\",p:\"p\",hr:\"hr\",blockquote:\"blockquote\",pre:\"pre\",code:\"code\",h4:\"h4\",div:\"div\",strong:\"strong\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"in-this-article\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#in-this-article\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"In this article\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"microscope\",children:\"\\u{1F52C}\"}),\" We'll learn the limitations of #[test] in Rust.\"]}),`\n`,(0,e.jsx)(n.li,{children:\"\\u{1FA84} We'll explore an alternative to write cleaner unit tests with fixtures.\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u{1F3D7} We'll refactor the unit tests in one of my open source projects!\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"Let's go.\"}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsxs)(n.h2,{id:\"the-fixture-problem\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#the-fixture-problem\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The Fixture Problem\"]}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.a,{href:\"https://en.wikipedia.org/wiki/Test_fixture\",children:\"Test fixtures\"}),\" are very effective in producing repeatable tests. A test fixture can be a constant or function that encapsulates a test's dependency.\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"I wanted to create a few test fixtures for my unit tests in one of my open source projects called \",(0,e.jsx)(n.a,{href:\"https://github.com/tantaraio/voy\",children:\"Voy\"}),\". It's a Webassembly semantic engine written in Rust. What it does is to \",(0,e.jsx)(n.a,{href:\"https://en.wikipedia.org/wiki/Feature_extraction\",children:\"extract features\"}),\" using machine learning models, build an index, and provide a query function that enables users to search the index based on meaning and semantics. Here's a quick demo:\"]}),`\n`,(0,e.jsx)(\"img\",{src:\"/articles/share-rust-types-with-typescript-for-webassembly-in-30-seconds/voy.gif\",alt:\"Voy demo\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsxs)(n.p,{children:[\"You can find the \",(0,e.jsx)(n.a,{href:\"https://github.com/tantaraio/voy\",children:\"Voy's repository on GitHub\"}),\"! Feel free to try it out. The repository includes \",(0,e.jsx)(n.a,{href:\"https://github.com/tantaraio/voy/tree/main/examples\",children:\"examples\"}),\" that you can see how to use Voy in different frameworks.\"]}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"While I was still working on the feature extraction, I needed pre-generated \",(0,e.jsx)(n.a,{href:\"https://developers.google.com/machine-learning/crash-course/embeddings/video-lecture\",children:\"embeddings\"}),\" to test the index and query part of the engine. The fixture for embeddings looks like this:\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"static\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"EMBEDDING\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"f32\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"768\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"6\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0.01960003957247733\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0.03651725347725505\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0.03361894761373059\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// ...\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"I created a static variable for 6 embeddings in an array. Each item is a 768 dimensional vector that represents a sentence.\"}),`\n`,(0,e.jsx)(n.p,{children:\"To use the fixture, I simply imported it in my test module. My unit test looks like this:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"super\"}),(0,e.jsxs)(n.span,{className:\"token module-declaration namespace\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),\"engine_fixtures\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"EMBEDDING\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONTENT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"QUESTION\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"crate\"}),(0,e.jsxs)(n.span,{className:\"token module-declaration namespace\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),\"engine\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"add\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" index\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" remove\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" search\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Query\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"crate\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"EmbeddedResource\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Resource\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-definition function\",children:\"get_resource\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"k\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"usize\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Resource\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" embeddings \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"EMBEDDING\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"         \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"iter\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"         \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"take\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"k\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"         \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"enumerate\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"         \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"map\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token closure-params\",children:[(0,e.jsx)(n.span,{className:\"token closure-punctuation punctuation\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" x\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token closure-punctuation punctuation\",children:\"|\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"EmbeddedResource\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"             id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"to_string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"             title\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONTENT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"get\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"to_string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"             url\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"to_owned\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"             embeddings\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" x\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"to_vec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"         \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"         \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"collect\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Resource\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" embeddings \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attribute attr-name\",children:\"#[test]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-definition function\",children:\"it_returns_vector_search_result\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" resource\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Resource\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"get_resource\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"6\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" index \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"index\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"resource\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" query \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Query\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Embeddings\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token constant\",children:\"QUESTION\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"to_vec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" result \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"search\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\"index\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\"query\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     \",(0,e.jsx)(n.span,{className:\"token macro property\",children:\"assert_eq!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"get\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"title\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONTENT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     \",(0,e.jsx)(n.span,{className:\"token macro property\",children:\"assert_eq!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"get\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"title\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONTENT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     \",(0,e.jsx)(n.span,{className:\"token macro property\",children:\"assert_eq!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"get\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"title\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONTENT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     \",(0,e.jsx)(n.span,{className:\"token macro property\",children:\"assert_eq!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"get\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"title\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONTENT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     \",(0,e.jsx)(n.span,{className:\"token macro property\",children:\"assert_eq!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"get\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"title\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONTENT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     \",(0,e.jsx)(n.span,{className:\"token macro property\",children:\"assert_eq!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"get\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"title\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"CONTENT\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"I created another 2 fixtures for the sentences the generated the embeddings and a question embedding to perform the query.\"}),`\n`,(0,e.jsx)(n.p,{children:\"The test case worked. The fixture produced repeatable results. However, it seems a little off. It's not very clean:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:'I needed a helper function to \"get_resource\" in the test case to initiate the fixture.'}),`\n`,(0,e.jsx)(n.li,{children:\"The fixtures were not encapsulated in the unit test and the usages were scattered.\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"So I started looking for a better way to write the test.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"introducing-the-rstest-crate\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#introducing-the-rstest-crate\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Introducing The rstest Crate\"]}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.a,{href:\"https://docs.rs/rstest/latest/rstest/\",children:\"rstest\"}),\" makes it very easy to write unit tests with fixtures. All you need to do is:\"]}),`\n`,(0,e.jsxs)(n.h4,{id:\"defining-fixtures\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#defining-fixtures\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Defining fixtures\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attribute attr-name\",children:\"#[fixture]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-definition function\",children:\"fixture\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"u32\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"42\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.h4,{id:\"replacing-test-with-rstest-macro\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#replacing-test-with-rstest-macro\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Replacing #[test] with #[rstest] macro.\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attribute attr-name\",children:\"#[rstest]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-definition function\",children:\"should_success\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"fixture\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"u32\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token macro property\",children:\"assert_eq!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"fixture\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"42\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"You can check out \",(0,e.jsx)(n.a,{href:\"https://docs.rs/rstest/latest/rstest/\",children:\"rstest's repository\"}),\" to find more ways to write test fixtures.\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Now let's use rstest to refactor the fixtures above. I'll simply create a function to return the static variable. Like this:\"}),`\n`,(0,e.jsx)(n.div,{className:\"rehype-code-title\",children:\"src/engine/tests/fixtures.rs\"}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"rstest\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),\"fixture\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attribute attr-name\",children:\"#[fixture]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-definition function\",children:\"embedding_fixture\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"f32\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"768\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"6\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token constant\",children:\"EMBEDDING\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:'We can refactor the \"get_resource\" helper function as a fixture too:'}),`\n`,(0,e.jsx)(n.div,{className:\"rehype-code-title\",children:\"src/engine/tests/fixtures.rs\"}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attribute attr-name\",children:\"#[fixture]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"pub\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-definition function\",children:\"resource_fixture\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Resource\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" content \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"content_fixture\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" embeddings \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"embedding_fixture\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"iter\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"enumerate\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"map\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token closure-params\",children:[(0,e.jsx)(n.span,{className:\"token closure-punctuation punctuation\",children:\"|\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" x\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token closure-punctuation punctuation\",children:\"|\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"EmbeddedResource\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"to_string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            title\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" content\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"get\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"i\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"to_string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            url\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"to_owned\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            embeddings\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" x\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"to_vec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"collect\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Resource\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" embeddings \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:'Since each fixture functions are just functions, we can use them inside another fixture function like we see in the \"resource_fixture\" function above.'}),`\n`,(0,e.jsx)(n.p,{children:\"To use the fixtures in a test case, we'll need to import the fixtures and inject them as parameters:\"}),`\n`,(0,e.jsx)(n.div,{className:\"rehype-code-title\",children:\"src/engine/tests/mod.rs\"}),(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"fixtures\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"rstest\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attribute attr-name\",children:\"#[rstest]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-definition function\",children:\"it_returns_vector_search_result\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    resource_fixture\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Resource\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    question_fixture\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"f32\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"768\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    content_fixture\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),(0,e.jsx)(n.span,{className:\"token lifetime-annotation symbol\",children:\"'static\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"str\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"6\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" index \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"index\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"resource_fixture\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" query \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Query\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Embeddings\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"question_fixture\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"to_vec\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" result \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"search\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\"index\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"\u0026\"}),\"query\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"6\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token macro property\",children:\"assert_eq!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"get\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"title\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" content_fixture\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token macro property\",children:\"assert_eq!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"get\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"title\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" content_fixture\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token macro property\",children:\"assert_eq!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"get\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"title\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" content_fixture\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"2\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token macro property\",children:\"assert_eq!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"get\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"title\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" content_fixture\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token macro property\",children:\"assert_eq!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"get\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"title\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" content_fixture\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token macro property\",children:\"assert_eq!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"result\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"get\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"5\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token function\",children:\"unwrap\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"title\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" content_fixture\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Make sure the parameters have the same names as the fixtures. rstest uses the names to inject and initiate the fixtures in the test functions.\"}),`\n`,(0,e.jsx)(n.p,{children:`Let's run \"cargo test\" to see if it works.`}),`\n`,(0,e.jsx)(\"img\",{src:\"/optimized/articles/testing-with-fixtures-in-rust/terminal.webp\",alt:\"Unit result with fixtures\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,e.jsx)(n.p,{children:\"It does!\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"final-thoughts\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#final-thoughts\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Final Thoughts\"]}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.a,{href:\"https://docs.rs/rstest/latest/rstest/\",children:\"rstest\"}),\" has more convenient features. For example, you can write multiple test cases with #[case]:\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"rstest\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),\"rstest\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attribute attr-name\",children:\"#[rstest]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attribute attr-name\",children:\"#[case(0, 0)]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attribute attr-name\",children:\"#[case(1, 1)]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attribute attr-name\",children:\"#[case(2, 1)]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attribute attr-name\",children:\"#[case(3, 2)]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attribute attr-name\",children:\"#[case(4, 3)]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-definition function\",children:\"fibonacci_test\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token attribute attr-name\",children:\"#[case]\"}),\" input\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"u32\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token attribute attr-name\",children:\"#[case]\"}),\" expected\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"u32\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token macro property\",children:\"assert_eq!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"expected\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"fibonacci\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"input\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"You can also test \",(0,e.jsx)(n.a,{href:\"https://doc.rust-lang.org/std/future/index.html\",children:\"Future\"}),\"!\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-rust\",children:(0,e.jsxs)(n.code,{className:\"language-rust code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,e.jsxs)(n.span,{className:\"token namespace\",children:[\"rstest\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"::\"})]}),(0,e.jsx)(n.span,{className:\"token operator\",children:\"*\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attribute attr-name\",children:\"#[fixture]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-definition function\",children:\"base\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"u32\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"42\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attribute attr-name\",children:\"#[rstest]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attribute attr-name\",children:\"#[case(21, async { 2 })]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token attribute attr-name\",children:\"#[case(6, async { 7 })]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-definition function\",children:\"my_async_test\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token attribute attr-name\",children:\"#[future]\"}),\" base\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"u32\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token attribute attr-name\",children:\"#[case]\"}),\" expected\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"u32\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token attribute attr-name\",children:\"#[future]\"}),\" \",(0,e.jsx)(n.span,{className:\"token attribute attr-name\",children:\"#[case]\"}),\" div\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"u32\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token macro property\",children:\"assert_eq!\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"expected\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" base\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"await\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"/\"}),\" div\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token keyword\",children:\"await\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"These are just a few examples I took from rstest. It has more fixture-based features that help us to structure cleaner unit tests with test fixtures. I really enjoyed it.\"}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.a,{href:\"https://github.com/tantaraio/voy\",children:\"Voy\"}),\" is an open source semantic search engine in WebAssembly. I created it to empower more projects to build semantic features and create better user experiences for people around the world. Voy follows several design principles:\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"\",\"aria-hidden\":!0,children:\"\\u{1F90F}\"}),\" \",(0,e.jsx)(n.strong,{children:\"Tiny\"}),\": Reduce overhead for limited devices, such as mobile browsers with slow network or IoT.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"rocket\",children:\"\\u{1F680}\"}),\" \",(0,e.jsx)(n.strong,{children:\"Fast\"}),\": Create the best search experience for the users.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"deciduous tree\",children:\"\\u{1F333}\"}),\" \",(0,e.jsx)(n.strong,{children:\"Tree Shakable\"}),\": Optimize bundle size and enable asynchronous capabilities for modern Web API, such as Web Workers.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"battery\",children:\"\\u{1F50B}\"}),\" \",(0,e.jsx)(n.strong,{children:\"Resumable\"}),\": Generate portable embeddings index anywhere, anytime.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"cloud\",children:\"\\u2601\\uFE0F\"}),\" \",(0,e.jsx)(n.strong,{children:\"Worldwide\"}),\": Run semantic search on CDN edge servers.\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"It's available on npm. You can simply install it with your favorite package manager and you're ready to go.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"language-bash code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# with npm\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"npm\"}),` i voy-search\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# with Yarn\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"yarn\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"add\"}),` voy-search\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# with pnpm\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"pnpm\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"add\"}),` voy-search\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Give it a try and I'm happy to hear from you!\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"references\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#references\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"References\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.a,{href:\"https://en.wikipedia.org/wiki/Feature_extraction\",children:\"Feature extraction\"}),\" - Wikipedia\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.a,{href:\"https://doc.rust-lang.org/std/future/index.html\",children:\"Future\"}),\" - Rust Doc\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.a,{href:\"https://www.rust-lang.org\",children:\"Rust\"}),\" - Rust Team\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.a,{href:\"https://docs.rs/rstest/latest/rstest/\",children:\"rstest\"}),\" - GitHub\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.a,{href:\"https://en.wikipedia.org/wiki/Test_fixture\",children:\"Test fixture\"}),\" - Wikipedia\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.a,{href:\"https://github.com/tantaraio/voy\",children:\"Voy\"}),\" - GitHub\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.a,{href:\"https://webassembly.org\",children:\"WebAssembly\"}),\" - WebAssembly.org\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.a,{href:\"https://developers.google.com/machine-learning/crash-course/embeddings/video-lecture\",children:\"Embeddings\"}),\" - Google for Developers\"]}),`\n`]}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsxs)(n.p,{children:[\"Here you have it! Thanks for reading through \",(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"raising hands\",children:\"\\u{1F64C}\"}),`\nIf you find this article useful, please share it to help more people in their engineering journey.`]}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"bird\",children:\"\\u{1F426}\"}),\" Feel free to connect with me on \",(0,e.jsx)(n.a,{href:\"https://twitter.com/dawchihliou\",children:\"twitter\"}),\"!\"]}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"\",\"aria-hidden\":!0,children:\"\\u23ED\\uFE0F\"}),\" Ready for the next article? \",(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"backhand index pointing right\",children:\"\\u{1F449}\"}),\" \",(0,e.jsx)(n.a,{href:\"/articles/share-rust-types-with-typescript-for-webassembly-in-30-seconds\",children:\"Share Rust Types With TypeScript for WebAssembly in 30 Seconds\"})]}),`\n`,(0,e.jsx)(n.p,{children:\"Happy coding!\"})]})}function w(a={}){let{wrapper:n}=a.components||{};return n?(0,e.jsx)(n,Object.assign({},a,{children:(0,e.jsx)(p,a)})):p(a)}var x=w;return b(_);})();\n;return Component;"},"_id":"articles/testing-with-fixtures-in-rust.mdx","_raw":{"sourceFilePath":"articles/testing-with-fixtures-in-rust.mdx","sourceFileName":"testing-with-fixtures-in-rust.mdx","sourceFileDir":"articles","contentType":"mdx","flattenedPath":"articles/testing-with-fixtures-in-rust"},"type":"Article","readingTime":{"text":"6 min read","minutes":5.485,"time":329100,"words":1097},"wordCount":1099,"slug":"testing-with-fixtures-in-rust"}},"__N_SSG":true},"page":"/articles/[slug]","query":{"slug":"testing-with-fixtures-in-rust"},"buildId":"D-X5pHW8_vz6tc-oPN55J","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>