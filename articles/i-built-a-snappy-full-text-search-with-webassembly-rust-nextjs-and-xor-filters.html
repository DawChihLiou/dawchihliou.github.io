<!DOCTYPE html><html lang="en"><head><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/svg" sizes="32x32" href="/favicon.svg"/><link rel="icon" type="image/svg" sizes="16x16" href="/favicon.svg"/><link rel="mask-icon" href="/favicon.svg" color="#ffffff"/><link rel="manifest" href="/site.webmanifest"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta charSet="utf-8"/><meta name="msapplication-TileColor" content="#007cf0"/><meta name="theme-color" content="#ffff"/><title>I Built A Snappy Static Full-text Search with WebAssembly, Rust, Next.js, and Xor Filters</title><meta name="description" content="After migrating to Contentlayer, I started exploring how to use the content data to roll out a search feature for my portfolio. Inspired by some of the amazing open-source projects, I built my own full-text search engine in Rust and WebAssembly. It is fast, lightweight, and tons of fun to build!"/><meta name="robots" content="follow, index"/><link rel="canonical" href="https://dawchihliou.github.io/articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters"/><meta itemProp="name" content="I Built A Snappy Static Full-text Search with WebAssembly, Rust, Next.js, and Xor Filters"/><meta itemProp="description" content="After migrating to Contentlayer, I started exploring how to use the content data to roll out a search feature for my portfolio. Inspired by some of the amazing open-source projects, I built my own full-text search engine in Rust and WebAssembly. It is fast, lightweight, and tons of fun to build!"/><meta itemProp="image" content="https://dawchihliou.github.io/optimized/articles/wasm-fulltext-search/hero.png"/><meta property="og:title" content="I Built A Snappy Static Full-text Search with WebAssembly, Rust, Next.js, and Xor Filters"/><meta property="og:type" content="website"/><meta property="og:url" content="https://dawchihliou.github.io/articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters"/><meta property="og:description" content="After migrating to Contentlayer, I started exploring how to use the content data to roll out a search feature for my portfolio. Inspired by some of the amazing open-source projects, I built my own full-text search engine in Rust and WebAssembly. It is fast, lightweight, and tons of fun to build!"/><meta property="og:image" content="https://dawchihliou.github.io/optimized/articles/wasm-fulltext-search/hero.png"/><meta property="og:image:type" content="image/png"/><meta property="og:image:width" content="1400"/><meta property="og:image:height" content="600"/><meta property="og:image:alt" content="After migrating to Contentlayer, I started exploring how to use the content data to roll out a search feature for my portfolio. Inspired by some of the amazing open-source projects, I built my own full-text search engine in Rust and WebAssembly. It is fast, lightweight, and tons of fun to build!"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@dawchihliou"/><meta name="twitter:creator" content="@dawchihliou"/><meta name="twitter:title" content="I Built A Snappy Static Full-text Search with WebAssembly, Rust, Next.js, and Xor Filters"/><meta name="twitter:description" content="After migrating to Contentlayer, I started exploring how to use the content data to roll out a search feature for my portfolio. Inspired by some of the amazing open-source projects, I built my own full-text search engine in Rust and WebAssembly. It is fast, lightweight, and tons of fun to build!"/><meta name="twitter:image" content="https://dawchihliou.github.io/optimized/articles/wasm-fulltext-search/hero.webp"/><meta property="article:published_time" content="2022-03-30T00:00:00.000Z"/><meta property="article:section" content="Article Section"/><meta property="article:tag" content="Article Tag"/><meta name="next-head-count" content="34"/><link rel="preload" href="/_next/static/css/f4214c3b71874d65.css" as="style"/><link rel="stylesheet" href="/_next/static/css/f4214c3b71874d65.css" data-n-g=""/><link rel="preload" href="/_next/static/css/54ba867c7255694d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/54ba867c7255694d.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-59c5c889f52620d6.js" defer=""></script><script src="/_next/static/chunks/framework-114634acb84f8baa.js" defer=""></script><script src="/_next/static/chunks/main-010ff0b6bbe5ac8f.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5784eb5f9f6cd23e.js" defer=""></script><script src="/_next/static/chunks/pages/articles/%5Bslug%5D-9a8f919cad4c24e6.js" defer=""></script><script src="/_next/static/SaFesCcMEJqgZ4vyltQ1K/_buildManifest.js" defer=""></script><script src="/_next/static/SaFesCcMEJqgZ4vyltQ1K/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div id="outer-container"><header><div><div class="bm-overlay" style="position:fixed;z-index:1000;width:100%;height:100%;background:rgba(0, 0, 0, 0.3);opacity:0;-moz-transform:translate3d(100%, 0, 0);-ms-transform:translate3d(100%, 0, 0);-o-transform:translate3d(100%, 0, 0);-webkit-transform:translate3d(100%, 0, 0);transform:translate3d(100%, 0, 0);transition:opacity 0.3s, transform 0s 0.3s"></div><div><div class="bm-burger-button" style="z-index:1000"><button id="react-burger-menu-btn" style="position:absolute;left:0;top:0;z-index:1;width:100%;height:100%;margin:0;padding:0;border:none;font-size:0;background:transparent;cursor:pointer">Open Menu</button><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="bm-icon" style="width:100%;height:100%" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div></div><div id="" class="bm-menu-wrap" style="position:fixed;right:inherit;z-index:1100;width:300px;height:100%;-moz-transform:translate3d(-100%, 0, 0);-ms-transform:translate3d(-100%, 0, 0);-o-transform:translate3d(-100%, 0, 0);-webkit-transform:translate3d(-100%, 0, 0);transform:translate3d(-100%, 0, 0);transition:all 0.5s" aria-hidden="true"><div class="bm-menu" style="height:100%;box-sizing:border-box;overflow:auto"><nav class="bm-item-list" style="height:100%"><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/"><button class="Nav_button__YJwKE" tabindex="-1">Home</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/articles"><button class="Nav_button__YJwKE" tabindex="-1">Articles</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/work"><button class="Nav_button__YJwKE" tabindex="-1">Work</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/now"><button class="Nav_button__YJwKE" tabindex="-1">Now</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/expertise"><button class="Nav_button__YJwKE" tabindex="-1">Expertise</button></a><a class="styles_anchor__g18qA bm-item Nav_link__ZgDoZ" style="display:block" tabindex="-1" href="/contact"><button class="Nav_button__YJwKE" tabindex="-1">Contact</button></a><span class="bm-item Nav_pusher__93Gc6" style="display:block" tabindex="-1"></span><span class="bm-item Nav_divider__QD8Pt" style="display:block" tabindex="-1"></span><div class="bm-item Nav_profile__Kf2nU" style="display:block" tabindex="-1"><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/dawchihliou" aria-label="Link to Daw-Chih&#x27;s Linkedin profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M20.45175,20.45025 L16.89225,20.45025 L16.89225,14.88075 C16.89225,13.5525 16.86975,11.844 15.04275,11.844 C13.191,11.844 12.90825,13.2915 12.90825,14.7855 L12.90825,20.45025 L9.3525,20.45025 L9.3525,8.997 L12.765,8.997 L12.765,10.563 L12.81375,10.563 C13.2885,9.66225 14.4495,8.71275 16.18125,8.71275 C19.78575,8.71275 20.45175,11.08425 20.45175,14.169 L20.45175,20.45025 Z M5.33925,7.4325 C4.1955,7.4325 3.27375,6.50775 3.27375,5.36775 C3.27375,4.2285 4.1955,3.30375 5.33925,3.30375 C6.47775,3.30375 7.4025,4.2285 7.4025,5.36775 C7.4025,6.50775 6.47775,7.4325 5.33925,7.4325 L5.33925,7.4325 Z M7.11975,20.45025 L3.5565,20.45025 L3.5565,8.997 L7.11975,8.997 L7.11975,20.45025 Z M23.00025,0 L1.0005,0 C0.44775,0 0,0.44775 0,0.99975 L0,22.9995 C0,23.55225 0.44775,24 1.0005,24 L23.00025,24 C23.55225,24 24,23.55225 24,22.9995 L24,0.99975 C24,0.44775 23.55225,0 23.00025,0 L23.00025,0 Z"></path></svg></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou" aria-label="Link to Daw-Chih&#x27;s GitHub profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M11.9989871,1 C5.92550416,1 1,5.92482888 1,12.0003376 C1,16.8603395 4.15153934,20.9829338 8.52263728,22.4374904 C9.0729918,22.5387827 9.27355045,22.199116 9.27355045,21.9073943 C9.27355045,21.6467356 9.2640965,20.954572 9.25869425,20.0368642 C6.19899322,20.7013414 5.55342398,18.5620492 5.55342398,18.5620492 C5.0530403,17.2911692 4.33183953,16.9528531 4.33183953,16.9528531 C3.33309801,16.2708186 4.40747107,16.2843243 4.40747107,16.2843243 C5.51155652,16.3619816 6.09229872,17.4181221 6.09229872,17.4181221 C7.07348292,19.0988981 8.66714755,18.6133706 9.2938089,18.3317781 C9.39375058,17.6213819 9.67804414,17.1365297 9.99205009,16.86169 C7.54955646,16.5841493 4.98146045,15.6401056 4.98146045,11.4249977 C4.98146045,10.224347 5.41026428,9.24181221 6.11390773,8.47334172 C6.00046042,8.19512569 5.62297799,7.07618404 6.22195279,5.56220265 C6.22195279,5.56220265 7.14506277,5.26642929 9.24653918,6.68992296 C10.12373,6.44547101 11.0650726,6.32392032 12.0003376,6.31919335 C12.9349274,6.32392032 13.8755947,6.44547101 14.7541361,6.68992296 C16.8542619,5.26642929 17.7760214,5.56220265 17.7760214,5.56220265 C18.3763467,7.07618404 17.9988643,8.19512569 17.8860923,8.47334172 C18.5910863,9.24181221 19.0165137,10.224347 19.0165137,11.4249977 C19.0165137,15.6509101 16.444366,16.5807729 13.9944443,16.8529114 C14.3888087,17.192578 14.7406305,17.863808 14.7406305,18.890236 C14.7406305,20.3603241 14.7271248,21.5467939 14.7271248,21.9073943 C14.7271248,22.2018171 14.9256576,22.5441849 15.4834403,22.4368151 C19.8511618,20.9788821 23,16.8589889 23,12.0003376 C23,5.92482888 18.0744958,1 11.9989871,1"></path></svg></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://medium.com/@dawchihliou" aria-label="Link to Daw-Chih&#x27;s Medium profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M2.84593838,5.88685595 C2.87575654,5.59224254 2.76340763,5.30104995 2.54341737,5.10276397 L0.302521008,2.4032473 L0.302521008,2 L7.2605042,2 L12.6386555,13.7949836 L17.3669469,2 L24,2 L24,2.4032473 L22.0840336,4.2402628 C21.9188563,4.36617057 21.8369199,4.57310892 21.8711485,4.77792587 L21.8711485,18.2755093 C21.8369199,18.4803262 21.9188563,18.6872645 22.0840336,18.8131723 L23.9551821,20.6501878 L23.9551821,21.0534351 L14.5434174,21.0534351 L14.5434174,20.6501878 L16.4817928,18.7683671 C16.6722689,18.5779447 16.6722689,18.5219382 16.6722689,18.2307041 L16.6722689,7.32062416 L11.2829132,21.0086299 L10.5546219,21.0086299 L4.28011204,7.32062416 L4.28011204,16.4945003 C4.22779746,16.8801958 4.35589372,17.2685069 4.62745097,17.5474239 L7.14845938,20.6053826 L7.14845938,21.0086299 L0,21.0086299 L0,20.6053826 L2.5210084,17.5474239 C2.79058848,17.2680445 2.91121535,16.8771576 2.84593838,16.4945003 L2.84593838,5.88685595 Z"></path></svg></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://hackernoon.com/u/dawchihliou" aria-label="Link to Daw-Chih&#x27;s Hackernoon profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" height="1.5em" width="1.5em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M5.701 0v6.223H8.85V4.654h1.576v7.842H12V4.654h1.574v1.569h3.15V0zm11.024 6.223v3.136h1.574V6.223zm1.574 3.136v4.705h1.576v-1.568h1.574v-1.568h-1.574V9.359zm0 4.705h-1.574v3.137h1.574zm-1.574 3.137h-3.15v1.569H8.85V17.2H5.7V24h11.024zm-11.024 0v-3.137H4.125v3.137zm-1.576-3.137V9.36H2.551v4.705zm0-4.705h1.576V6.223H4.125Z"></path></svg><span hidden="">Link to Daw-Chih&#x27;s Hacker Noon profile</span></a><a class="styles_anchor__g18qA Nav_iconLink__z5y5Q" target="_blank" rel="noopener noreferrer" href="https://twitter.com/dawchihliou" aria-label="Link to Daw-Chih&#x27;s Twitter profile" tabindex="-1"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M24,4.3086 C23.117,4.7006 22.168,4.9646 21.172,5.0836 C22.188,4.4746 22.969,3.5096 23.337,2.3596 C22.386,2.9246 21.332,3.3336 20.21,3.5556 C19.312,2.5976 18.032,1.9996 16.616,1.9996 C13.897,1.9996 11.692,4.2046 11.692,6.9236 C11.692,7.3096 11.736,7.6856 11.82,8.0456 C7.728,7.8406 4.099,5.8806 1.671,2.9006 C1.247,3.6286 1.004,4.4736 1.004,5.3766 C1.004,7.0846 1.873,8.5926 3.195,9.4756 C2.388,9.4486 1.628,9.2276 0.964,8.8596 L0.964,8.9206 C0.964,11.3066 2.661,13.2966 4.914,13.7486 C4.501,13.8626 4.065,13.9216 3.617,13.9216 C3.299,13.9216 2.991,13.8906 2.69,13.8336 C3.317,15.7896 5.135,17.2136 7.29,17.2536 C5.604,18.5736 3.481,19.3606 1.175,19.3606 C0.777,19.3606 0.385,19.3376 0,19.2926 C2.179,20.6886 4.767,21.5046 7.548,21.5046 C16.605,21.5046 21.557,14.0016 21.557,7.4946 C21.557,7.2816 21.552,7.0696 21.543,6.8586 C22.505,6.1636 23.34,5.2966 24,4.3086"></path></svg></a></div><div class="DarkmodeSwitch_container__uFGHQ" tabindex="-1"><div class="DarkmodeSwitch_wrap__e71_4"></div></div></nav></div><div><div class="bm-cross-button" style="position:absolute;width:24px;height:24px;right:8px;top:8px"><button id="react-burger-cross-btn" style="position:absolute;left:0;top:0;z-index:1;width:100%;height:100%;margin:0;padding:0;border:none;font-size:0;background:transparent;cursor:pointer" tabindex="-1">Close Menu</button><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="bm-cross" style="width:100%;height:100%" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></div></div></div></div></header><div class="Menubar_menubar__gvU4b"><a class="styles_anchor__g18qA Menubar_hireMe__zuAig" href="/contact"><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1.5em" width="1.5em" xmlns="http://www.w3.org/2000/svg"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>Hire Me</a><div class="DarkmodeSwitch_container__uFGHQ" tabindex="0"><div class="DarkmodeSwitch_wrap__e71_4"></div></div><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou" aria-label="See more Daw-Chih&#x27;s work on GitHub"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1.5em" width="1.5em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M11.9989871,1 C5.92550416,1 1,5.92482888 1,12.0003376 C1,16.8603395 4.15153934,20.9829338 8.52263728,22.4374904 C9.0729918,22.5387827 9.27355045,22.199116 9.27355045,21.9073943 C9.27355045,21.6467356 9.2640965,20.954572 9.25869425,20.0368642 C6.19899322,20.7013414 5.55342398,18.5620492 5.55342398,18.5620492 C5.0530403,17.2911692 4.33183953,16.9528531 4.33183953,16.9528531 C3.33309801,16.2708186 4.40747107,16.2843243 4.40747107,16.2843243 C5.51155652,16.3619816 6.09229872,17.4181221 6.09229872,17.4181221 C7.07348292,19.0988981 8.66714755,18.6133706 9.2938089,18.3317781 C9.39375058,17.6213819 9.67804414,17.1365297 9.99205009,16.86169 C7.54955646,16.5841493 4.98146045,15.6401056 4.98146045,11.4249977 C4.98146045,10.224347 5.41026428,9.24181221 6.11390773,8.47334172 C6.00046042,8.19512569 5.62297799,7.07618404 6.22195279,5.56220265 C6.22195279,5.56220265 7.14506277,5.26642929 9.24653918,6.68992296 C10.12373,6.44547101 11.0650726,6.32392032 12.0003376,6.31919335 C12.9349274,6.32392032 13.8755947,6.44547101 14.7541361,6.68992296 C16.8542619,5.26642929 17.7760214,5.56220265 17.7760214,5.56220265 C18.3763467,7.07618404 17.9988643,8.19512569 17.8860923,8.47334172 C18.5910863,9.24181221 19.0165137,10.224347 19.0165137,11.4249977 C19.0165137,15.6509101 16.444366,16.5807729 13.9944443,16.8529114 C14.3888087,17.192578 14.7406305,17.863808 14.7406305,18.890236 C14.7406305,20.3603241 14.7271248,21.5467939 14.7271248,21.9073943 C14.7271248,22.2018171 14.9256576,22.5441849 15.4834403,22.4368151 C19.8511618,20.9788821 23,16.8589889 23,12.0003376 C23,5.92482888 18.0744958,1 11.9989871,1"></path></svg></a></div><div id="page-wrap"><article><div class="Article_container__q__L3"><div class="Article_wrap__LZypL"><h1>I Built A Snappy Static Full-text Search with WebAssembly, Rust, Next.js, and Xor Filters</h1><div class="Article_info__bOKys"><div class="Article_author__grS8U"><img alt="Daw-Chih Liou" src="/optimized/raw/portrait-sm.webp" loading="lazy"/><p>Daw-Chih Liou</p></div><p>March 30, 2022<!-- --> ¬∑ 11 min read</p></div><img alt="I Built A Snappy Static Full-text Search with WebAssembly, Rust, Next.js, and Xor Filters" src="/optimized/articles/wasm-fulltext-search/hero.webp" width="100%" class="rounded centered" loading="lazy"/><div class="article-content"><h2 id="tldr"><a class="styles_anchor__g18qA anchor" href="/articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters#tldr"><span class="icon icon-link"></span></a>TL;DR</h2>
<ul>
<li><span role="img" aria-label="crab">ü¶Ä</span> There is a rich toolkit for developing WebAssembly with Rust. It&#x27;s fun!</li>
<li><span role="img" aria-label="handshake">ü§ù</span> WebAssembly and Next.js play fairly well together, but be aware of the known issues.</li>
<li><span role="img" aria-label="" aria-hidden="true">üßë</span>‚Äç<span role="img" aria-label="microscope">üî¨</span> Xor filters are data structures that provides great memory efficiency and fast lookup for value existence.</li>
<li><span role="img" aria-label="" aria-hidden="true">üßë</span>‚Äç<span role="img" aria-label="cooking">üç≥</span> WebAssembly&#x27;s performance and code size is not guaranteed. Make sure to measure and benchmark.</li>
</ul>
<hr/>
<p>This article is also available on</p>
<ul>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://betterprogramming.pub/i-built-a-snappy-static-full-text-search-with-webassembly-rust-next-js-and-xor-filters-a21a4824832e">Better Programming</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://hackernoon.com/static-full-text-search-in-nextjs-with-webassembly-rust-and-xor-filters-tldr">Hacker Noon</a></li>
</ul>
<p>Feel free to read it on your favorite platform<span role="img" aria-label="sparkles">‚ú®</span></p>
<hr/>
<p>I always knew I wanted a full-text search feature for the articles in my <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://dawchihliou.github.io">portfolio</a> to provide the visitors with a quick access to the content they are interested in. After <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://dawchihliou.github.io/articles/build-better-nextjs-static-sites-with-mdx-and-contentlayer">migrating to Contentlayer</a>, it doesn&#x27;t seemed to be so far-fetched anymore. So I started exploring<span role="img" aria-label="rocket">üöÄ</span></p>
<h2 id="inspired-by-tinysearch-a-webassembly-full-text-search-engine"><a class="styles_anchor__g18qA anchor" href="/articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters#inspired-by-tinysearch-a-webassembly-full-text-search-engine"><span class="icon icon-link"></span></a>Inspired by <code>tinysearch</code>: A WebAssembly Full-text Search Engine</h2>
<p>After some researching, I found a search engine called <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/tinysearch/tinysearch"><code>tinysearch</code></a>. It&#x27;s a static search engine built with <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.rust-lang.org">Rust</a> and <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://webassembly.org">WebAssembly</a> (Wasm). The author Matthias Endler wrote <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://endler.dev/2019/tinysearch">an amazing blog post</a> about how <code>tinysearch</code> came about.</p>
<p>I loved the idea of constructing a minimalistic search engine at build time and shipping it in optimized low-level code to the browsers. So I decided to use <code>tinysearch</code> as the blueprint and write my own search engine to integrate with my <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://nextjs.org/">Next.js static site</a>.</p>
<p><em>I highly recommend reading <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/tinysearch/tinysearch"><code>tinysearch</code>&#x27;s codebase</a>. It&#x27;s very well-written. My search engine&#x27;s implementation is a simplified version of it. The core logic is the same.</em></p>
<h2 id="what-does-the-search-feature-looks-like"><a class="styles_anchor__g18qA anchor" href="/articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters#what-does-the-search-feature-looks-like"><span class="icon icon-link"></span></a>What Does The Search Feature Looks Like?</h2>
<img src="/articles/wasm-fulltext-search/recording.gif" alt="Search demo" width="auto" class="rounded centered" loading="lazy"/>
<p>Very simple:</p>
<ul>
<li>Users type anything in the search input.</li>
<li>Search engine searches the key words in all the contents and finds the most relevant articles.</li>
<li>UI displays a ranked search result list.</li>
</ul>
<p>You can try out the search function at the <a class="styles_anchor__g18qA undefined" href="/articles">Articles page</a>!</p>
<h2 id="a-little-bit-of-stats"><a class="styles_anchor__g18qA anchor" href="/articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters#a-little-bit-of-stats"><span class="icon icon-link"></span></a>A Little Bit of Stats</h2>
<p>At the time of writing this article, there are:</p>
<ul>
<li>7 articles (more to come<span role="img" aria-label="rocket">üöÄ</span>)</li>
<li>13,925 words</li>
<li>682KB of data files (generated by Contentlayer)</li>
</ul>
<blockquote>
<p>For the full-text search to work for static sites that are priming for speed, the code size has to be small.</p>
</blockquote>
<h2 id="how-does-webassembly-full-text-search-function-work"><a class="styles_anchor__g18qA anchor" href="/articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters#how-does-webassembly-full-text-search-function-work"><span class="icon icon-link"></span></a>How Does WebAssembly Full-text Search Function Work?</h2>
<p>Most of the <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://caniuse.com/?search=webassembly">modern browsers now support WebAssembly</a>. They are able to run native WebAssembly code and binary alongside JavaScript.</p>
<p>The concept for the search function is straightforward. It takes in a query string as parameter. In the function, we tokenize the query into search terms. We then give a ranking score to each article based on how many search terms does it contain. Finally, we rank the articles by relevancy. The higher the score, the more relevant it is.</p>
<p>The flow looks like this:</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">+--------------+               +--------------+
</span><span class="code-line"><span class="token operator">|</span>              <span class="token operator">|</span>               <span class="token operator">|</span>              <span class="token operator">|</span>
</span><span class="code-line"><span class="token operator">|</span> Query String <span class="token operator">|</span> - tokenize -<span class="token operator">&gt;</span> <span class="token operator">|</span> Search Terms <span class="token operator">|</span>
</span><span class="code-line"><span class="token operator">|</span>              <span class="token operator">|</span>               <span class="token operator">|</span>              <span class="token operator">|</span>
</span><span class="code-line">+--------------+               +--------------+
</span><span class="code-line">                                      <span class="token operator">|</span>
</span><span class="code-line">+--------------+                      <span class="token operator">|</span>      +-----------------------+           +-----------------------+              +--------------+
</span><span class="code-line"><span class="token operator">|</span>              <span class="token operator">|</span>                      <span class="token operator">|</span>      <span class="token operator">|</span>                       <span class="token operator">|</span>           <span class="token operator">|</span>                       <span class="token operator">|</span>              <span class="token operator">|</span>              <span class="token operator">|</span>
</span><span class="code-line"><span class="token operator">|</span> Vec<span class="token operator">&lt;</span>Article<span class="token operator">&gt;</span> <span class="token operator">|</span> ------------------ score -<span class="token operator">&gt;</span> <span class="token operator">|</span> Vec<span class="token operator">&lt;</span><span class="token punctuation">(</span>Article, Score<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token operator">|</span> - rank -<span class="token operator">&gt;</span> <span class="token operator">|</span> Vec<span class="token operator">&lt;</span><span class="token punctuation">(</span>Article, Score<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token operator">|</span> - take<span class="token punctuation">(</span>n<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token operator">|</span> Vec<span class="token operator">&lt;</span>Article<span class="token operator">&gt;</span> <span class="token operator">|</span>
</span><span class="code-line"><span class="token operator">|</span>              <span class="token operator">|</span>                             <span class="token operator">|</span>                       <span class="token operator">|</span>           <span class="token operator">|</span>                       <span class="token operator">|</span>              <span class="token operator">|</span>              <span class="token operator">|</span>
</span><span class="code-line">+--------------+                             +-----------------------+           +-----------------------+              +--------------+
</span><span class="code-line">
</span></code></pre>
<p>Scoring the articles is where the most computing comes in. A naive approach would be transforming each article into a hash set that contains all the unique words in the article. We can calculate the score by simply counting how many search terms are in the hash set.</p>
<p>You can image that this is not the most memory efficient approach with hash set. There are better data structures to replace it: <strong>xor filters</strong>.</p>
<h2 id="what-are-xor-filters"><a class="styles_anchor__g18qA anchor" href="/articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters#what-are-xor-filters"><span class="icon icon-link"></span></a>What are Xor Filters?</h2>
<p><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://arxiv.org/abs/1912.08258">Xor filters</a> are relatively new data structures that allow us to estimate whether a value exists or not. It&#x27;s fast and memory efficient so it&#x27;s very suitable for the full-text search.</p>
<p>Instead of storing the actual input values like hash set, xor filters store fingerprints (L-bit hashed sequence) of input values <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://web.stanford.edu/class/archive/cs/cs166/cs166.1216/lectures/13/Slides13.pdf#page=49">in a specific way</a>. When looking for whether a value exists in the filter, it checks if the fingerprint of the value is present.</p>
<p>However, Xor filters have a couple of trade-offs:</p>
<ul>
<li>Xor filters are probabilistic and there&#x27;s a chance false-positive can happen.</li>
<li>Xor filters are not able to estimate the existence of partial values. So in my use case, the full-text search will only be able to search for complete words.</li>
</ul>
<h2 id="how-did-i-build-the-xor-filters-with-rust"><a class="styles_anchor__g18qA anchor" href="/articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters#how-did-i-build-the-xor-filters-with-rust"><span class="icon icon-link"></span></a>How Did I Build the Xor Filters with Rust?</h2>
<p>Since I had the article data generated by Contentlayer, I constructed the xor filters by feeding them with the data before the WebAssembly is built. I then serialized the xor filters and stored them in a file. To use the filters in the WebAssembly, all I needed to do was to read from the storage file and deserialize the filters.</p>
<p>The filter generation flow looks like this:</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">+-------------------+               +---------------+                +----------------------------+                +-------------+
</span><span class="code-line"><span class="token operator">|</span>                   <span class="token operator">|</span>               <span class="token operator">|</span>               <span class="token operator">|</span>                <span class="token operator">|</span>                            <span class="token operator">|</span>                <span class="token operator">|</span>             <span class="token operator">|</span>
</span><span class="code-line"><span class="token operator">|</span> Contentlayer Data <span class="token operator">|</span> - generate -<span class="token operator">&gt;</span> <span class="token operator">|</span> Article Index <span class="token operator">|</span> - construct -<span class="token operator">&gt;</span> <span class="token operator">|</span> Vec<span class="token operator">&lt;</span><span class="token punctuation">(</span>Article, Xor Filter<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token operator">|</span> - serialize -<span class="token operator">&gt;</span> <span class="token operator">|</span> storage.txt <span class="token operator">|</span>
</span><span class="code-line"><span class="token operator">|</span>                   <span class="token operator">|</span>               <span class="token operator">|</span>               <span class="token operator">|</span>                <span class="token operator">|</span>                            <span class="token operator">|</span>                <span class="token operator">|</span>             <span class="token operator">|</span>
</span><span class="code-line">+-------------------+               +---------------+                +----------------------------+                +-------------+
</span></code></pre>
<p><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/ayazhafiz/xorf"><code>xorf</code></a> crate is a good choice for xor filters implementation because it offers serialization/deserialization and a few features that improve memory efficiency and false-positive rate. It also provides a very handy <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://docs.rs/xorf/latest/xorf/struct.HashProxy.html"><code>HashProxy</code></a> struct for my use case to construct a xor filter with a slice of strings. The construction written in Rust roughly look like this:</p>
<pre class="language-rust"><code class="language-rust code-highlight"><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span>hash_map<span class="token punctuation">::</span></span><span class="token class-name">DefaultHasher</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">use</span> <span class="token namespace">xorf<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Filter</span><span class="token punctuation">,</span> <span class="token class-name">HashProxy</span><span class="token punctuation">,</span> <span class="token class-name">Xor8</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">mod</span> <span class="token module-declaration namespace">utils</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">fn</span> <span class="token function-definition function">build_filter</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">HashProxy</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">DefaultHasher</span><span class="token punctuation">,</span> <span class="token class-name">Xor8</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword">let</span> title_tokens<span class="token punctuation">:</span> <span class="token class-name">HashSet</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token namespace">utils<span class="token punctuation">::</span></span><span class="token function">tokenize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">let</span> body_tokens<span class="token punctuation">:</span> <span class="token class-name">HashSet</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token namespace">utils<span class="token punctuation">::</span></span><span class="token function">tokenize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token keyword">let</span> tokens<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span> <span class="token operator">=</span> body_tokens<span class="token punctuation">.</span><span class="token keyword">union</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>title_tokens<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cloned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token class-name">HashProxy</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tokens<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>If you are interested in the actual implementation, you can <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou/dawchihliou.github.io/blob/main/scripts/fulltext-search/src/storage.rs">read more in the repository</a>.</p>
<h2 id="putting-it-all-together"><a class="styles_anchor__g18qA anchor" href="/articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters#putting-it-all-together"><span class="icon icon-link"></span></a>Putting It All Together</h2>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">
</span><span class="code-line">        <span role="img" aria-label="alien monster">üëæ</span>Build-Time                      <span role="img" aria-label="" aria-hidden="true">üèÉ‚Äç‚ôÄÔ∏è</span>Run-Time
</span><span class="code-line">
</span><span class="code-line">    +-------------------+                +------------+
</span><span class="code-line">    <span class="token operator">|</span> Contentlayer Data <span class="token operator">|</span>                <span class="token operator">|</span> User Input <span class="token operator">|</span>
</span><span class="code-line">    +-------------------+                +------------+
</span><span class="code-line">              <span class="token operator">|</span>                                <span class="token operator">|</span>
</span><span class="code-line">           generate                 call wasm.search<span class="token punctuation">(</span>query<span class="token punctuation">)</span>
</span><span class="code-line">              <span class="token operator">|</span>                                <span class="token operator">|</span>
</span><span class="code-line">      +---------------+                +---------------+
</span><span class="code-line">      <span class="token operator">|</span> Article Index <span class="token operator">|</span>                <span class="token operator">|</span> Query String  <span class="token operator">|</span>
</span><span class="code-line">      +---------------+                +---------------+
</span><span class="code-line">              <span class="token operator">|</span>                                <span class="token operator">|</span>
</span><span class="code-line">          construct                         tokenize
</span><span class="code-line">              <span class="token operator">|</span>                                <span class="token operator">|</span>
</span><span class="code-line">+----------------------------+          +--------------+
</span><span class="code-line"><span class="token operator">|</span> Vec<span class="token operator">&lt;</span><span class="token punctuation">(</span>Article, Xor Filter<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token operator">|</span>          <span class="token operator">|</span> Search Terms <span class="token operator">|</span>
</span><span class="code-line">+----------------------------+          +--------------+
</span><span class="code-line">              <span class="token operator">|</span>                                <span class="token operator">|</span>
</span><span class="code-line">          serialize                            <span class="token operator">|</span>
</span><span class="code-line">              <span class="token operator">|</span>                                <span class="token operator">|</span>
</span><span class="code-line">       +-------------+                         <span class="token operator">|</span>
</span><span class="code-line">       <span class="token operator">|</span> storage.txt <span class="token operator">|</span> - deserialize ------<span class="token operator">&gt;</span> score
</span><span class="code-line">       +-------------+                         <span class="token operator">|</span>
</span><span class="code-line">                                   +-----------------------+
</span><span class="code-line">                                   <span class="token operator">|</span> Vec<span class="token operator">&lt;</span><span class="token punctuation">(</span>Article, Score<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token operator">|</span>
</span><span class="code-line">                                   +-----------------------+
</span><span class="code-line">                                               <span class="token operator">|</span>
</span><span class="code-line">                                              rank
</span><span class="code-line">                                               <span class="token operator">|</span>
</span><span class="code-line">                                   +-----------------------+
</span><span class="code-line">                                   <span class="token operator">|</span> Vec<span class="token operator">&lt;</span><span class="token punctuation">(</span>Article, Score<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token operator">|</span>
</span><span class="code-line">                                   +-----------------------+
</span><span class="code-line">                                               <span class="token operator">|</span>
</span><span class="code-line">                                             take<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
</span><span class="code-line">                                               <span class="token operator">|</span>
</span><span class="code-line">                                        +--------------+
</span><span class="code-line">                                        <span class="token operator">|</span> Vec<span class="token operator">&lt;</span>Article<span class="token operator">&gt;</span> <span class="token operator">|</span>
</span><span class="code-line">                                        +--------------+
</span><span class="code-line">                                               <span class="token operator">|</span>
</span><span class="code-line">                                             <span class="token builtin class-name">return</span>
</span><span class="code-line">                                               <span class="token operator">|</span>
</span><span class="code-line">                                        +--------------+
</span><span class="code-line">                                        <span class="token operator">|</span> Vec<span class="token operator">&lt;</span>Article<span class="token operator">&gt;</span> <span class="token operator">|</span>
</span><span class="code-line">                                        +--------------+
</span><span class="code-line">                                               <span class="token operator">|</span>
</span><span class="code-line">                                            display
</span><span class="code-line">                                               <span class="token operator">|</span>
</span><span class="code-line">                                       +---------------+
</span><span class="code-line">                                       <span class="token operator">|</span> Search Result <span class="token operator">|</span>
</span><span class="code-line">                                       +---------------+
</span></code></pre>
<h2 id="integrating-webassembly-in-nextjs"><a class="styles_anchor__g18qA anchor" href="/articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters#integrating-webassembly-in-nextjs"><span class="icon icon-link"></span></a>Integrating WebAssembly in Next.js</h2>
<p>Here&#x27;s how I integrated the xor filter generation script and WebAssembly inside Next.js.</p>
<p>The file structure looks like this:</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">my-portfolio
</span><span class="code-line">‚îú‚îÄ‚îÄ next.config.js
</span><span class="code-line">‚îú‚îÄ‚îÄ pages
</span><span class="code-line">‚îú‚îÄ‚îÄ scripts
</span><span class="code-line">‚îÇ   ‚îî‚îÄ‚îÄ fulltext-search
</span><span class="code-line">‚îú‚îÄ‚îÄ components
</span><span class="code-line">‚îÇ   ‚îî‚îÄ‚îÄ Search.tsx
</span><span class="code-line">‚îî‚îÄ‚îÄ wasm
</span><span class="code-line">    ‚îî‚îÄ‚îÄ fulltext-search
</span></code></pre>
<p>To support WebAssembly, I updated my Webpack configuration to load WebAssembly modules as async modules. To make it work for static site generation, I needed <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/vercel/next.js/issues/25852">a workaround</a> to generate the WebAssembly module in <code>.next/server</code> directory so that the static pages can pre-render successfully when running the <code>next build</code> script.</p>
<div class="rehype-code-title">next.config.js</div><pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token function-variable function">webpack</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">config<span class="token punctuation">,</span> <span class="token punctuation">{</span> isServer <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token comment">// it makes a WebAssembly modules async modules</span>
</span><span class="code-line">  config<span class="token punctuation">.</span><span class="token property-access">experiments</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">asyncWebAssembly</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token comment">// generate wasm module in &quot;.next/server&quot; for ssr &amp; ssg</span>
</span><span class="code-line">  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isServer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    config<span class="token punctuation">.</span><span class="token property-access">output</span><span class="token punctuation">.</span><span class="token property-access">webassemblyModuleFilename</span> <span class="token operator">=</span>
</span><span class="code-line">      <span class="token string">&#x27;./../static/wasm/[modulehash].wasm&#x27;</span>
</span><span class="code-line">  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">    config<span class="token punctuation">.</span><span class="token property-access">output</span><span class="token punctuation">.</span><span class="token property-access">webassemblyModuleFilename</span> <span class="token operator">=</span> <span class="token string">&#x27;static/wasm/[modulehash].wasm&#x27;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">  <span class="token keyword control-flow">return</span> config
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">,</span>
</span></code></pre>
<p>That&#x27;s all there is for the integration<span role="img" aria-label="sparkles">‚ú®</span></p>
<h2 id="using-the-webassembly-in-the-react-component"><a class="styles_anchor__g18qA anchor" href="/articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters#using-the-webassembly-in-the-react-component"><span class="icon icon-link"></span></a>Using The WebAssembly in The React Component</h2>
<p>To build the WebAssembly module from the Rust code, I use <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/rustwasm/wasm-pack"><code>wasm-pack</code></a>.</p>
<p>The generated <code>.wasm</code> file and the glue code for JavaScript are located in <code>wasm/fulltext-search/pkg</code>. All I needed to do was to use <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://nextjs.org/docs/advanced-features/dynamic-import"><code>next/dynamic</code></a> to dynamically import the them. Like this:</p>
<div class="rehype-code-title">components/Search.tsx</div><pre class="language-ts"><code class="language-ts code-highlight"><span class="code-line"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useCallback<span class="token punctuation">,</span> ChangeEvent<span class="token punctuation">,</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#x27;react&#x27;</span>
</span><span class="code-line"><span class="token keyword">import</span> dynamic <span class="token keyword">from</span> <span class="token string">&#x27;next/dynamic&#x27;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">type</span> <span class="token class-name">Title</span> <span class="token operator">=</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">type</span> <span class="token class-name">Url</span> <span class="token operator">=</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">type</span> <span class="token class-name">SearchResult</span> <span class="token operator">=</span> <span class="token punctuation">[</span>Title<span class="token punctuation">,</span> Url<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> Search <span class="token operator">=</span> <span class="token function">dynamic</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token function-variable function">loader</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">const</span> wasm <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#x27;../../wasm/fulltext-search/pkg&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword">const</span> <span class="token punctuation">[</span>term<span class="token punctuation">,</span> setTerm<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#x27;&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token keyword">const</span> <span class="token punctuation">[</span>results<span class="token punctuation">,</span> setResults<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>SearchResult<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token keyword">const</span> onChange <span class="token operator">=</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token operator">:</span> ChangeEvent<span class="token operator">&lt;</span>HTMLInputElement<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token function">setTerm</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token keyword">const</span> pending <span class="token operator">=</span> wasm<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>term<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token function">setResults</span><span class="token punctuation">(</span>pending<span class="token punctuation">)</span>
</span><span class="code-line">      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>term<span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">      <span class="token keyword">return</span> <span class="token punctuation">(</span>
</span><span class="code-line">        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
</span><span class="code-line">          <span class="token operator">&lt;</span>input
</span><span class="code-line">            value<span class="token operator">=</span><span class="token punctuation">{</span>term<span class="token punctuation">}</span>
</span><span class="code-line">            onChange<span class="token operator">=</span><span class="token punctuation">{</span>onChange<span class="token punctuation">}</span>
</span><span class="code-line">            placeholder<span class="token operator">=</span><span class="token string">&quot;<span role="img" aria-label="telescope">üî≠</span> search...&quot;</span>
</span><span class="code-line">          <span class="token operator">/</span><span class="token operator">&gt;</span>
</span><span class="code-line">          <span class="token punctuation">{</span>results<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>title<span class="token punctuation">,</span> url<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
</span><span class="code-line">            <span class="token operator">&lt;</span>a key<span class="token operator">=</span><span class="token punctuation">{</span>url<span class="token punctuation">}</span> href<span class="token operator">=</span><span class="token punctuation">{</span>url<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
</span><span class="code-line">          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
</span><span class="code-line">        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</span><span class="code-line">      <span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">export</span> <span class="token keyword">default</span> Search
</span></code></pre>
<h2 id="optimizing-the-webassembly-code-size"><a class="styles_anchor__g18qA anchor" href="/articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters#optimizing-the-webassembly-code-size"><span class="icon icon-link"></span></a>Optimizing The WebAssembly Code Size</h2>
<p>Without any optimization, the original Wasm file size was <code>114.56KB</code>. I used <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/rustwasm/twiggy">Twiggy</a> to find out the code size.</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">Shallow Bytes  ‚îÇ Shallow % ‚îÇ Item
</span><span class="code-line">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
</span><span class="code-line">        <span class="token number">117314</span> ‚îä   <span class="token number">100.00</span>% ‚îä Œ£ <span class="token punctuation">[</span><span class="token number">1670</span> Total Rows<span class="token punctuation">]</span>
</span></code></pre>
<p>Compared with the <code>628KB</code> of raw data files, it was so much smaller than I expected. I was happy to ship it to the production already but I was curious to see how much code size I could trim off with <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://rustwasm.github.io/docs/book/reference/code-size.html">The Rust And WebAssembly Working Group&#x27;s optimization recommendation</a>.</p>
<p>The first experiment was toggling LTO and trying out different <code>opt-level</code>s. The following configuration yields the smallest <code>.wasm</code> code size:</p>
<div class="rehype-code-title">Cargo.toml</div><pre class="language-diff"><code class="language-diff code-highlight"><span class="code-line">[profile.release]
</span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> opt-level = &#x27;s&#x27;
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line"> lto = true
</span></span></span></code></pre>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">Shallow Bytes  ‚îÇ Shallow % ‚îÇ Item
</span><span class="code-line">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
</span><span class="code-line">        <span class="token number">111319</span> ‚îä   <span class="token number">100.00</span>% ‚îä Œ£ <span class="token punctuation">[</span><span class="token number">1604</span> Total Rows<span class="token punctuation">]</span>
</span></code></pre>
<p>Next I replaced the default allocator with <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/rustwasm/wee_alloc"><code>wee_alloc</code></a>.</p>
<div class="rehype-code-title">wasm/fulltext-search/src/lib.rs</div><pre class="language-diff"><code class="language-diff code-highlight"><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> #[global_allocator]
</span></span></span><span class="code-line inserted"><span class="token inserted-sign inserted"><span class="token line"></span><span class="token prefix inserted">+</span><span class="token line"> static ALLOC: wee_alloc::WeeAlloc = wee_alloc::WeeAlloc::INIT;
</span></span></span></code></pre>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">Shallow Bytes  ‚îÇ Shallow % ‚îÇ Item
</span><span class="code-line">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
</span><span class="code-line">        <span class="token number">100483</span> ‚îä   <span class="token number">100.00</span>% ‚îä Œ£ <span class="token punctuation">[</span><span class="token number">1625</span> Total Rows<span class="token punctuation">]</span>
</span></code></pre>
<p>Then I tried the <code>wasm-opt</code> tool in <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/WebAssembly/binaryen">Binaryen</a>.</p>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">wasm-opt <span class="token parameter variable">-Oz</span> <span class="token parameter variable">-o</span> wasm/fulltext-search/pkg/fulltext_search_core_bg.wasm wasm/fulltext-search/pkg/fulltext_search_core_bg.wasm
</span></code></pre>
<pre class="language-bash"><code class="language-bash code-highlight"><span class="code-line">Shallow Bytes  ‚îÇ Shallow % ‚îÇ Item
</span><span class="code-line">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
</span><span class="code-line">        <span class="token number">100390</span> ‚îä   <span class="token number">100.00</span>% ‚îä Œ£ <span class="token punctuation">[</span><span class="token number">1625</span> Total Rows<span class="token punctuation">]</span>
</span></code></pre>
<p>That&#x27;s a <code>14.4%</code> off from the original code size.</p>
<p>At the end, I was able to ship a full-text search engine in:</p>
<ul>
<li>98.04 KB raw</li>
<li>45.92 KB gzipped</li>
</ul>
<p>Not bad<span role="img" aria-label="smiling face with sunglasses">üòé</span></p>
<h2 id="is-it-really-snappy"><a class="styles_anchor__g18qA anchor" href="/articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters#is-it-really-snappy"><span class="icon icon-link"></span></a>Is It Really Snappy?</h2>
<img src="/optimized/articles/wasm-fulltext-search/perf.webp" alt="Performance profiling" width="100%" class="rounded" loading="lazy"/>
<p>I profiled the performance with <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/rustwasm/wasm-bindgen/tree/main/crates/web-sys"><code>web-sys</code></a> and collected some data:</p>
<ul>
<li>number of searches: 208</li>
<li>min: 0.046 ms</li>
<li>max: 0.814 ms</li>
<li>mean: 0.0994 ms <span role="img" aria-label="sparkles">‚ú®</span></li>
<li>standard deviation: 0.0678</li>
</ul>
<p>On average, it takes less than 0.1 ms to perform a full-text search.</p>
<p>It&#x27;s pretty snappy<span role="img" aria-label="smiling face with sunglasses">üòé</span></p>
<h2 id="final-thoughts"><a class="styles_anchor__g18qA anchor" href="/articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters#final-thoughts"><span class="icon icon-link"></span></a>Final Thoughts</h2>
<p>After some experiment, I was able to build a fast and lightweight full-text search with WebAssembly, Rust, and xor filters. It integrates well with Next.js and static site generation.</p>
<p>The speed and size come with a few trade-offs but they don&#x27;t have a big impact on the user experience. If you are looking for a more comprehensive search functionality, here are a few cool products available:</p>
<p><strong>SaaS Search Engines</strong></p>
<ul>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.algolia.com">Algolia</a></li>
</ul>
<p><strong>Static Search Engines</strong></p>
<ul>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/tinysearch/tinysearch">tinysearch</a></li>
</ul>
<p><strong>Server-based Search Engines</strong></p>
<ul>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.meilisearch.com">Meilisearch</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://typesense.org">Typesense</a></li>
</ul>
<p><strong>In-browser Search Engines</strong></p>
<ul>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/nextapps-de/flexsearch">FlexSearch</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/lucaong/minisearch">MiniSearch</a></li>
<li><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="http://elasticlunr.com">Elasticlunr.js</a></li>
</ul>
<h2 id="references"><a class="styles_anchor__g18qA anchor" href="/articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters#references"><span class="icon icon-link"></span></a>References</h2>
<ul>
<li>Article: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://endler.dev/2019/tinysearch">A Tiny, Static, Full-Text Search Engine using Rust and WebAssembly - Matthias Endler</a></li>
<li>Article: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.stavros.io/posts/bloom-filter-search-engine/">Writing a full-text search engine using Bloom filters - Stavros Korokithakis</a></li>
<li>Article: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://lemire.me/blog/2019/12/19/xor-filters-faster-and-smaller-than-bloom-filters/">Xor Filters: Faster and Smaller Than Bloom Filters - Daniel Lemire</a></li>
<li>Article: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://rustwasm.github.io/docs/book/reference/code-size.html">Shrinking .wasm Code Size - The Rust and WebAssembly Working Group</a></li>
<li>Article: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://dawchihliou.github.io/articles/build-better-nextjs-static-sites-with-mdx-and-contentlayer">Building Better Next.js Static Sites with MDX and Contentlayer - Daw-Chih Liou</a></li>
<li>Article: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://nextjs.org/docs/advanced-features/dynamic-import">Next.js - Dynamic Import</a></li>
<li>Website: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://arxiv.org/abs/1912.08258">Xor Filters: Faster and Smaller Than Bloom and Cuckoo Filters</a></li>
<li>Website: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://dawchihliou.github.io">Daw-Chih Liou&#x27;s Portfolio</a></li>
<li>Website: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.meilisearch.com">Meilisearch</a></li>
<li>Website: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://typesense.org">Typesense</a></li>
<li>Website: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.algolia.com">Algolia</a></li>
<li>Website: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="http://elasticlunr.com">Elasticlunr.js</a></li>
<li>Website: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.rust-lang.org">Rust</a></li>
<li>Website: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://webassembly.org">WebAssembly</a></li>
<li>Website: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://developer.mozilla.org/en-US/docs/WebAssembly">MDN WebAssembly</a></li>
<li>Website: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://nextjs.org/">Next.js</a></li>
<li>Website: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://caniuse.com/?search=webassembly">Can I use WebAssembly?</a></li>
<li>Lecture: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://web.stanford.edu/class/archive/cs/cs166/cs166.1216/lectures/13/Slides13.pdf#page=49">Approximate Membership Queries - Stanford</a></li>
<li>Wiki: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Full-text_search">Full-text Search</a></li>
<li>GitHub: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/vercel/next.js/tree/canary/examples/with-webassembly">Next.js &amp; WebAssembly example</a></li>
<li>GitHub: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/johnthagen/min-sized-rust">Minimizing Rust Binary Size</a></li>
<li>GitHub: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou/dawchihliou.github.io/blob/main/scripts/fulltext-search/src/storage.rs">dawchihliou.github.io</a></li>
<li>GitHub: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/vercel/next.js/issues/25852">Webpack 5 breaks dynamic wasm import for SSR</a></li>
<li>Github: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/tinysearch/tinysearch">tinysearch</a></li>
<li>GitHub: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/meilisearch/meilisearch">Meilisearch</a></li>
<li>GitHub: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/ayazhafiz/xorf">xorf</a></li>
<li>GitHub: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/rustwasm/wasm-pack">wasm-pack</a></li>
<li>GitHub: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/WebAssembly/binaryen">Binaryen</a></li>
<li>GitHub: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/rustwasm/twiggy">Twiggy</a></li>
<li>GitHub: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/rust-lang/rust-clippy">Clippy</a></li>
<li>GitHub: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/rustwasm/wasm-bindgen/tree/main/crates/web-sys">web-sys</a></li>
<li>GitHub: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/matklad/once_cell">once_cell</a></li>
<li>GitHub: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/bincode-org/bincode">Bincode</a></li>
<li>GitHub: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/rustwasm/wee_alloc">wee_alloc</a></li>
<li>GitHub: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/serde-rs/serde">Serde</a></li>
<li>GitHub: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/dtolnay/anyhow">Anyhow</a></li>
<li>GitHub: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/contentlayerdev/contentlayer">Contentlayer</a></li>
<li>GitHub: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/nextapps-de/flexsearch">FlexSearch</a></li>
<li>GitHub: <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/lucaong/minisearch">MiniSearch</a></li>
</ul>
<hr/>
<p>Here you have it! Thanks for reading through<span role="img" aria-label="raising hands">üôå</span>
If you find this article useful, please share it to help more people in their engineering journey.</p>
<p><span role="img" aria-label="bird">üê¶</span> Feel free to connect with me on <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://twitter.com/dawchihliou">twitter</a>!</p>
<p>‚è≠ Read the next article: <a class="styles_anchor__g18qA undefined" href="/articles/how-to-plan-a-project-as-a-principal-software-engineer">How to Plan A Project as A Principal Software Engineer: A Human-centered Approach</a></p>
<p>Happy coding!</p></div><article class="Author_wrap__s8DeE"><img src="/optimized/raw/portrait-sm.webp" alt="Daw-Chih Liou" class="Author_avatar__j6KIn" loading="lazy"/><div><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://dawchihliou.github.io">Daw-Chih Liou</a><p>Daw-Chih is a software engineer, UX advocate, and creator who is dedicated to Web engineering. His background in Human Centered Computing has led him to work with startups and public companies across North America, Asia, and Europe. He is passionate about meeting business trajectory with user journey and utilizing engineering architecture and performance monitoring to provide optimal user experience.</p></div></article></div></div></article><footer class="Footer_footer__1IwEk"><div class="Footer_wrap__FVCTX"><div class="Footer_resources__fG_vu"><p><span role="img" aria-label="build with love" class="Footer_emoji__u15jg">üíö</span>This site is built with</p><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://nextjs.org">Next.js</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://react-icons.github.io/react-icons">React Icons</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://mdxjs.com">MDX</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://unifiedjs.com">unified</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/contentlayerdev/contentlayer">Contentlayer</a></div><div class="Footer_contact__9GJn6"><p><span role="img" aria-label="build with love" class="Footer_emoji__u15jg">ü¶Ñ</span>Where to find me</p><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/dawchihliou">Linkedin</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://github.com/DawChihLiou">GitHub</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://twitter.com/dawchihliou">Twitter</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://medium.com/@dawchihliou">Medium</a><a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://hackernoon.com/u/dawchihliou">Hacker Noon</a><a class="styles_anchor__g18qA undefined" href="/rss.xml">RSS Feed <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></div><div class="Footer_sitemap__92ono"><p><span role="img" aria-label="build with love" class="Footer_emoji__u15jg">üó∫</span>Sitemap</p><a class="styles_anchor__g18qA undefined" href="/">Home</a><a class="styles_anchor__g18qA undefined" href="/articles">Articles</a><a class="styles_anchor__g18qA undefined" href="/work">Work</a><a class="styles_anchor__g18qA undefined" href="/now">Now</a><a class="styles_anchor__g18qA undefined" href="/expertise">Expertise</a><a class="styles_anchor__g18qA undefined" href="/contact">Contact</a></div></div><div class="Footer_copyright__vZZRL">¬© <!-- -->2023<!-- --> <a class="styles_anchor__g18qA undefined" target="_blank" rel="noopener noreferrer" href="https://www.linkedin.com/in/dawchihliou">Daw-Chih Liou</a></div></footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"I Built A Snappy Static Full-text Search with WebAssembly, Rust, Next.js, and Xor Filters","publishedAt":"March 30, 2022","description":"After migrating to Contentlayer, I started exploring how to use the content data to roll out a search feature for my portfolio. Inspired by some of the amazing open-source projects, I built my own full-text search engine in Rust and WebAssembly. It is fast, lightweight, and tons of fun to build!","cover":"/optimized/articles/wasm-fulltext-search/hero.webp","category":"Rust","coverWidth":"1400","coverHeight":"600","body":{"raw":"\n## TL;DR\n\n- ü¶Ä There is a rich toolkit for developing WebAssembly with Rust. It's fun!\n- ü§ù WebAssembly and Next.js play fairly well together, but be aware of the known issues.\n- üßë‚Äçüî¨ Xor filters are data structures that provides great memory efficiency and fast lookup for value existence.\n- üßë‚Äçüç≥ WebAssembly's performance and code size is not guaranteed. Make sure to measure and benchmark.\n\n---\n\nThis article is also available on\n\n- [Better Programming](https://betterprogramming.pub/i-built-a-snappy-static-full-text-search-with-webassembly-rust-next-js-and-xor-filters-a21a4824832e)\n- [Hacker Noon](https://hackernoon.com/static-full-text-search-in-nextjs-with-webassembly-rust-and-xor-filters-tldr)\n\nFeel free to read it on your favorite platform‚ú®\n\n---\n\nI always knew I wanted a full-text search feature for the articles in my [portfolio](https://dawchihliou.github.io) to provide the visitors with a quick access to the content they are interested in. After [migrating to Contentlayer](https://dawchihliou.github.io/articles/build-better-nextjs-static-sites-with-mdx-and-contentlayer), it doesn't seemed to be so far-fetched anymore. So I started exploringüöÄ\n\n## Inspired by `tinysearch`: A WebAssembly Full-text Search Engine\n\nAfter some researching, I found a search engine called [`tinysearch`](https://github.com/tinysearch/tinysearch). It's a static search engine built with [Rust](https://www.rust-lang.org) and [WebAssembly](https://webassembly.org) (Wasm). The author Matthias Endler wrote [an amazing blog post](https://endler.dev/2019/tinysearch) about how `tinysearch` came about.\n\nI loved the idea of constructing a minimalistic search engine at build time and shipping it in optimized low-level code to the browsers. So I decided to use `tinysearch` as the blueprint and write my own search engine to integrate with my [Next.js static site](https://nextjs.org/).\n\n_I highly recommend reading [`tinysearch`'s codebase](https://github.com/tinysearch/tinysearch). It's very well-written. My search engine's implementation is a simplified version of it. The core logic is the same._\n\n## What Does The Search Feature Looks Like?\n\n\u003cimg\n  src=\"/articles/wasm-fulltext-search/recording.gif\"\n  alt=\"Search demo\"\n  width=\"auto\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/\u003e\n\nVery simple:\n\n- Users type anything in the search input.\n- Search engine searches the key words in all the contents and finds the most relevant articles.\n- UI displays a ranked search result list.\n\nYou can try out the search function at the [Articles page](/articles)!\n\n## A Little Bit of Stats\n\nAt the time of writing this article, there are:\n\n- 7 articles (more to comeüöÄ)\n- 13,925 words\n- 682KB of data files (generated by Contentlayer)\n\n\u003e For the full-text search to work for static sites that are priming for speed, the code size has to be small.\n\n## How Does WebAssembly Full-text Search Function Work?\n\nMost of the [modern browsers now support WebAssembly](https://caniuse.com/?search=webassembly). They are able to run native WebAssembly code and binary alongside JavaScript.\n\nThe concept for the search function is straightforward. It takes in a query string as parameter. In the function, we tokenize the query into search terms. We then give a ranking score to each article based on how many search terms does it contain. Finally, we rank the articles by relevancy. The higher the score, the more relevant it is.\n\nThe flow looks like this:\n\n```bash\n+--------------+               +--------------+\n|              |               |              |\n| Query String | - tokenize -\u003e | Search Terms |\n|              |               |              |\n+--------------+               +--------------+\n                                      |\n+--------------+                      |      +-----------------------+           +-----------------------+              +--------------+\n|              |                      |      |                       |           |                       |              |              |\n| Vec\u003cArticle\u003e | ------------------ score -\u003e | Vec\u003c(Article, Score)\u003e | - rank -\u003e | Vec\u003c(Article, Score)\u003e | - take(n) -\u003e | Vec\u003cArticle\u003e |\n|              |                             |                       |           |                       |              |              |\n+--------------+                             +-----------------------+           +-----------------------+              +--------------+\n\n```\n\nScoring the articles is where the most computing comes in. A naive approach would be transforming each article into a hash set that contains all the unique words in the article. We can calculate the score by simply counting how many search terms are in the hash set.\n\nYou can image that this is not the most memory efficient approach with hash set. There are better data structures to replace it: **xor filters**.\n\n## What are Xor Filters?\n\n[Xor filters](https://arxiv.org/abs/1912.08258) are relatively new data structures that allow us to estimate whether a value exists or not. It's fast and memory efficient so it's very suitable for the full-text search.\n\nInstead of storing the actual input values like hash set, xor filters store fingerprints (L-bit hashed sequence) of input values [in a specific way](https://web.stanford.edu/class/archive/cs/cs166/cs166.1216/lectures/13/Slides13.pdf#page=49). When looking for whether a value exists in the filter, it checks if the fingerprint of the value is present.\n\nHowever, Xor filters have a couple of trade-offs:\n\n- Xor filters are probabilistic and there's a chance false-positive can happen.\n- Xor filters are not able to estimate the existence of partial values. So in my use case, the full-text search will only be able to search for complete words.\n\n## How Did I Build the Xor Filters with Rust?\n\nSince I had the article data generated by Contentlayer, I constructed the xor filters by feeding them with the data before the WebAssembly is built. I then serialized the xor filters and stored them in a file. To use the filters in the WebAssembly, all I needed to do was to read from the storage file and deserialize the filters.\n\nThe filter generation flow looks like this:\n\n```bash\n+-------------------+               +---------------+                +----------------------------+                +-------------+\n|                   |               |               |                |                            |                |             |\n| Contentlayer Data | - generate -\u003e | Article Index | - construct -\u003e | Vec\u003c(Article, Xor Filter)\u003e | - serialize -\u003e | storage.txt |\n|                   |               |               |                |                            |                |             |\n+-------------------+               +---------------+                +----------------------------+                +-------------+\n```\n\n[`xorf`](https://github.com/ayazhafiz/xorf) crate is a good choice for xor filters implementation because it offers serialization/deserialization and a few features that improve memory efficiency and false-positive rate. It also provides a very handy [`HashProxy`](https://docs.rs/xorf/latest/xorf/struct.HashProxy.html) struct for my use case to construct a xor filter with a slice of strings. The construction written in Rust roughly look like this:\n\n```rust\nuse std::collections::hash_map::DefaultHasher;\nuse xorf::{Filter, HashProxy, Xor8};\n\nmod utils;\n\nfn build_filter(title: String, body: String) -\u003e HashProxy\u003cString, DefaultHasher, Xor8\u003e {\n  let title_tokens: HashSet\u003cString\u003e = utils::tokenize(\u0026title);\n  let body_tokens: HashSet\u003cString\u003e = utils::tokenize(\u0026body);\n  let tokens: Vec\u003cString\u003e = body_tokens.union(\u0026title_tokens).cloned().collect();\n\n  HashProxy::from(\u0026tokens)\n}\n```\n\nIf you are interested in the actual implementation, you can [read more in the repository](https://github.com/DawChihLiou/dawchihliou.github.io/blob/main/scripts/fulltext-search/src/storage.rs).\n\n## Putting It All Together\n\n```bash\n\n        üëæBuild-Time                      üèÉ‚Äç‚ôÄÔ∏èRun-Time\n\n    +-------------------+                +------------+\n    | Contentlayer Data |                | User Input |\n    +-------------------+                +------------+\n              |                                |\n           generate                 call wasm.search(query)\n              |                                |\n      +---------------+                +---------------+\n      | Article Index |                | Query String  |\n      +---------------+                +---------------+\n              |                                |\n          construct                         tokenize\n              |                                |\n+----------------------------+          +--------------+\n| Vec\u003c(Article, Xor Filter)\u003e |          | Search Terms |\n+----------------------------+          +--------------+\n              |                                |\n          serialize                            |\n              |                                |\n       +-------------+                         |\n       | storage.txt | - deserialize ------\u003e score\n       +-------------+                         |\n                                   +-----------------------+\n                                   | Vec\u003c(Article, Score)\u003e |\n                                   +-----------------------+\n                                               |\n                                              rank\n                                               |\n                                   +-----------------------+\n                                   | Vec\u003c(Article, Score)\u003e |\n                                   +-----------------------+\n                                               |\n                                             take(n)\n                                               |\n                                        +--------------+\n                                        | Vec\u003cArticle\u003e |\n                                        +--------------+\n                                               |\n                                             return\n                                               |\n                                        +--------------+\n                                        | Vec\u003cArticle\u003e |\n                                        +--------------+\n                                               |\n                                            display\n                                               |\n                                       +---------------+\n                                       | Search Result |\n                                       +---------------+\n```\n\n## Integrating WebAssembly in Next.js\n\nHere's how I integrated the xor filter generation script and WebAssembly inside Next.js.\n\nThe file structure looks like this:\n\n```bash\nmy-portfolio\n‚îú‚îÄ‚îÄ next.config.js\n‚îú‚îÄ‚îÄ pages\n‚îú‚îÄ‚îÄ scripts\n‚îÇ   ‚îî‚îÄ‚îÄ fulltext-search\n‚îú‚îÄ‚îÄ components\n‚îÇ   ‚îî‚îÄ‚îÄ Search.tsx\n‚îî‚îÄ‚îÄ wasm\n    ‚îî‚îÄ‚îÄ fulltext-search\n```\n\nTo support WebAssembly, I updated my Webpack configuration to load WebAssembly modules as async modules. To make it work for static site generation, I needed [a workaround](https://github.com/vercel/next.js/issues/25852) to generate the WebAssembly module in `.next/server` directory so that the static pages can pre-render successfully when running the `next build` script.\n\n```js:next.config.js\nwebpack: function (config, { isServer }) {\n  // it makes a WebAssembly modules async modules\n  config.experiments = { asyncWebAssembly: true }\n\n  // generate wasm module in \".next/server\" for ssr \u0026 ssg\n  if (isServer) {\n    config.output.webassemblyModuleFilename =\n      './../static/wasm/[modulehash].wasm'\n  } else {\n    config.output.webassemblyModuleFilename = 'static/wasm/[modulehash].wasm'\n  }\n\n  return config\n},\n```\n\nThat's all there is for the integration‚ú®\n\n## Using The WebAssembly in The React Component\n\nTo build the WebAssembly module from the Rust code, I use [`wasm-pack`](https://github.com/rustwasm/wasm-pack).\n\nThe generated `.wasm` file and the glue code for JavaScript are located in `wasm/fulltext-search/pkg`. All I needed to do was to use [`next/dynamic`](https://nextjs.org/docs/advanced-features/dynamic-import) to dynamically import the them. Like this:\n\n```ts:components/Search.tsx\nimport React, { useState, useCallback, ChangeEvent, useEffect } from 'react'\nimport dynamic from 'next/dynamic'\n\ntype Title = string;\ntype Url = string;\ntype SearchResult = [Title, Url][];\n\nconst Search = dynamic({\n  loader: async () =\u003e {\n    const wasm = await import('../../wasm/fulltext-search/pkg')\n\n    return () =\u003e {\n      const [term, setTerm] = useState('')\n      const [results, setResults] = useState\u003cSearchResult\u003e([])\n\n      const onChange = useCallback((e: ChangeEvent\u003cHTMLInputElement\u003e) =\u003e {\n        setTerm(e.target.value)\n      }, [])\n\n      useEffect(() =\u003e {\n        const pending = wasm.search(term, 5)\n        setResults(pending)\n      }, [term])\n\n      return (\n        \u003cdiv\u003e\n          \u003cinput\n            value={term}\n            onChange={onChange}\n            placeholder=\"üî≠ search...\"\n          /\u003e\n          {results.map(([title, url]) =\u003e (\n            \u003ca key={url} href={url}\u003e{title}\u003c/a\u003e\n          ))}\n        \u003c/div\u003e\n      )\n    }\n  },\n})\n\nexport default Search\n```\n\n## Optimizing The WebAssembly Code Size\n\nWithout any optimization, the original Wasm file size was `114.56KB`. I used [Twiggy](https://github.com/rustwasm/twiggy) to find out the code size.\n\n```bash\nShallow Bytes  ‚îÇ Shallow % ‚îÇ Item\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n        117314 ‚îä   100.00% ‚îä Œ£ [1670 Total Rows]\n```\n\nCompared with the `628KB` of raw data files, it was so much smaller than I expected. I was happy to ship it to the production already but I was curious to see how much code size I could trim off with [The Rust And WebAssembly Working Group's optimization recommendation](https://rustwasm.github.io/docs/book/reference/code-size.html).\n\nThe first experiment was toggling LTO and trying out different `opt-level`s. The following configuration yields the smallest `.wasm` code size:\n\n```diff:Cargo.toml\n[profile.release]\n+ opt-level = 's'\n+ lto = true\n```\n\n```bash\nShallow Bytes  ‚îÇ Shallow % ‚îÇ Item\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n        111319 ‚îä   100.00% ‚îä Œ£ [1604 Total Rows]\n```\n\nNext I replaced the default allocator with [`wee_alloc`](https://github.com/rustwasm/wee_alloc).\n\n```diff:wasm/fulltext-search/src/lib.rs\n+ #[global_allocator]\n+ static ALLOC: wee_alloc::WeeAlloc = wee_alloc::WeeAlloc::INIT;\n```\n\n```bash\nShallow Bytes  ‚îÇ Shallow % ‚îÇ Item\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n        100483 ‚îä   100.00% ‚îä Œ£ [1625 Total Rows]\n```\n\nThen I tried the `wasm-opt` tool in [Binaryen](https://github.com/WebAssembly/binaryen).\n\n```bash\nwasm-opt -Oz -o wasm/fulltext-search/pkg/fulltext_search_core_bg.wasm wasm/fulltext-search/pkg/fulltext_search_core_bg.wasm\n```\n\n```bash\nShallow Bytes  ‚îÇ Shallow % ‚îÇ Item\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n        100390 ‚îä   100.00% ‚îä Œ£ [1625 Total Rows]\n```\n\nThat's a `14.4%` off from the original code size.\n\nAt the end, I was able to ship a full-text search engine in:\n\n- 98.04 KB raw\n- 45.92 KB gzipped\n\nNot badüòé\n\n## Is It Really Snappy?\n\n\u003cimg\n  src=\"/optimized/articles/wasm-fulltext-search/perf.webp\"\n  alt=\"Performance profiling\"\n  width=\"100%\"\n  className=\"rounded\"\n  loading=\"lazy\"\n/\u003e\n\nI profiled the performance with [`web-sys`](https://github.com/rustwasm/wasm-bindgen/tree/main/crates/web-sys) and collected some data:\n\n- number of searches: 208\n- min: 0.046 ms\n- max: 0.814 ms\n- mean: 0.0994 ms ‚ú®\n- standard deviation: 0.0678\n\nOn average, it takes less than 0.1 ms to perform a full-text search.\n\nIt's pretty snappyüòé\n\n## Final Thoughts\n\nAfter some experiment, I was able to build a fast and lightweight full-text search with WebAssembly, Rust, and xor filters. It integrates well with Next.js and static site generation.\n\nThe speed and size come with a few trade-offs but they don't have a big impact on the user experience. If you are looking for a more comprehensive search functionality, here are a few cool products available:\n\n**SaaS Search Engines**\n\n- [Algolia](https://www.algolia.com)\n\n**Static Search Engines**\n\n- [tinysearch](https://github.com/tinysearch/tinysearch)\n\n**Server-based Search Engines**\n\n- [Meilisearch](https://www.meilisearch.com)\n- [Typesense](https://typesense.org)\n\n**In-browser Search Engines**\n\n- [FlexSearch](https://github.com/nextapps-de/flexsearch)\n- [MiniSearch](https://github.com/lucaong/minisearch)\n- [Elasticlunr.js](http://elasticlunr.com)\n\n## References\n\n- Article: [A Tiny, Static, Full-Text Search Engine using Rust and WebAssembly - Matthias Endler](https://endler.dev/2019/tinysearch)\n- Article: [Writing a full-text search engine using Bloom filters - Stavros Korokithakis](https://www.stavros.io/posts/bloom-filter-search-engine/)\n- Article: [Xor Filters: Faster and Smaller Than Bloom Filters - Daniel Lemire](https://lemire.me/blog/2019/12/19/xor-filters-faster-and-smaller-than-bloom-filters/)\n- Article: [Shrinking .wasm Code Size - The Rust and WebAssembly Working Group](https://rustwasm.github.io/docs/book/reference/code-size.html)\n- Article: [Building Better Next.js Static Sites with MDX and Contentlayer - Daw-Chih Liou](https://dawchihliou.github.io/articles/build-better-nextjs-static-sites-with-mdx-and-contentlayer)\n- Article: [Next.js - Dynamic Import](https://nextjs.org/docs/advanced-features/dynamic-import)\n- Website: [Xor Filters: Faster and Smaller Than Bloom and Cuckoo Filters](https://arxiv.org/abs/1912.08258)\n- Website: [Daw-Chih Liou's Portfolio](https://dawchihliou.github.io)\n- Website: [Meilisearch](https://www.meilisearch.com)\n- Website: [Typesense](https://typesense.org)\n- Website: [Algolia](https://www.algolia.com)\n- Website: [Elasticlunr.js](http://elasticlunr.com)\n- Website: [Rust](https://www.rust-lang.org)\n- Website: [WebAssembly](https://webassembly.org)\n- Website: [MDN WebAssembly](https://developer.mozilla.org/en-US/docs/WebAssembly)\n- Website: [Next.js](https://nextjs.org/)\n- Website: [Can I use WebAssembly?](https://caniuse.com/?search=webassembly)\n- Lecture: [Approximate Membership Queries - Stanford](https://web.stanford.edu/class/archive/cs/cs166/cs166.1216/lectures/13/Slides13.pdf#page=49)\n- Wiki: [Full-text Search](https://en.wikipedia.org/wiki/Full-text_search)\n- GitHub: [Next.js \u0026 WebAssembly example](https://github.com/vercel/next.js/tree/canary/examples/with-webassembly)\n- GitHub: [Minimizing Rust Binary Size](https://github.com/johnthagen/min-sized-rust)\n- GitHub: [dawchihliou.github.io](https://github.com/DawChihLiou/dawchihliou.github.io/blob/main/scripts/fulltext-search/src/storage.rs)\n- GitHub: [Webpack 5 breaks dynamic wasm import for SSR](https://github.com/vercel/next.js/issues/25852)\n- Github: [tinysearch](https://github.com/tinysearch/tinysearch)\n- GitHub: [Meilisearch](https://github.com/meilisearch/meilisearch)\n- GitHub: [xorf](https://github.com/ayazhafiz/xorf)\n- GitHub: [wasm-pack](https://github.com/rustwasm/wasm-pack)\n- GitHub: [Binaryen](https://github.com/WebAssembly/binaryen)\n- GitHub: [Twiggy](https://github.com/rustwasm/twiggy)\n- GitHub: [Clippy](https://github.com/rust-lang/rust-clippy)\n- GitHub: [web-sys](https://github.com/rustwasm/wasm-bindgen/tree/main/crates/web-sys)\n- GitHub: [once_cell](https://github.com/matklad/once_cell)\n- GitHub: [Bincode](https://github.com/bincode-org/bincode)\n- GitHub: [wee_alloc](https://github.com/rustwasm/wee_alloc)\n- GitHub: [Serde](https://github.com/serde-rs/serde)\n- GitHub: [Anyhow](https://github.com/dtolnay/anyhow)\n- GitHub: [Contentlayer](https://github.com/contentlayerdev/contentlayer)\n- GitHub: [FlexSearch](https://github.com/nextapps-de/flexsearch)\n- GitHub: [MiniSearch](https://github.com/lucaong/minisearch)\n\n---\n\nHere you have it! Thanks for reading throughüôå\nIf you find this article useful, please share it to help more people in their engineering journey.\n\nüê¶ Feel free to connect with me on [twitter](https://twitter.com/dawchihliou)!\n\n‚è≠ Read the next article: [How to Plan A Project as A Principal Software Engineer: A Human-centered Approach](/articles/how-to-plan-a-project-as-a-principal-software-engineer)\n\nHappy coding!\n","code":"var Component=(()=\u003e{var d=Object.create;var l=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var k=(a,e)=\u003e()=\u003e(e||a((e={exports:{}}).exports,e),e.exports),g=(a,e)=\u003e{for(var s in e)l(a,s,{get:e[s],enumerable:!0})},i=(a,e,s,t)=\u003e{if(e\u0026\u0026typeof e==\"object\"||typeof e==\"function\")for(let c of m(e))!N.call(a,c)\u0026\u0026c!==s\u0026\u0026l(a,c,{get:()=\u003ee[c],enumerable:!(t=p(e,c))||t.enumerable});return a};var f=(a,e,s)=\u003e(s=a!=null?d(u(a)):{},i(e||!a||!a.__esModule?l(s,\"default\",{value:a,enumerable:!0}):s,a)),b=a=\u003ei(l({},\"__esModule\",{value:!0}),a);var o=k((A,r)=\u003e{r.exports=_jsx_runtime});var S={};g(S,{default:()=\u003ex,frontmatter:()=\u003ew});var n=f(o()),w={title:\"I Built A Snappy Static Full-text Search with WebAssembly, Rust, Next.js, and Xor Filters\",publishedAt:\"March 30, 2022\",description:\"After migrating to Contentlayer, I started exploring how to use the content data to roll out a search feature for my portfolio. Inspired by some of the amazing open-source projects, I built my own full-text search engine in Rust and WebAssembly. It is fast, lightweight, and tons of fun to build!\",cover:\"/optimized/articles/wasm-fulltext-search/hero.webp\",category:\"Rust\",coverWidth:\"1400\",coverHeight:\"600\"};function h(a){let e=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",ul:\"ul\",li:\"li\",hr:\"hr\",p:\"p\",code:\"code\",em:\"em\",blockquote:\"blockquote\",pre:\"pre\",strong:\"strong\",div:\"div\"},a.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.h2,{id:\"tldr\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#tldr\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"TL;DR\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"crab\",children:\"\\u{1F980}\"}),\" There is a rich toolkit for developing WebAssembly with Rust. It's fun!\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"handshake\",children:\"\\u{1F91D}\"}),\" WebAssembly and Next.js play fairly well together, but be aware of the known issues.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"\",\"aria-hidden\":!0,children:\"\\u{1F9D1}\"}),\"\\u200D\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"microscope\",children:\"\\u{1F52C}\"}),\" Xor filters are data structures that provides great memory efficiency and fast lookup for value existence.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"\",\"aria-hidden\":!0,children:\"\\u{1F9D1}\"}),\"\\u200D\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"cooking\",children:\"\\u{1F373}\"}),\" WebAssembly's performance and code size is not guaranteed. Make sure to measure and benchmark.\"]}),`\n`]}),`\n`,(0,n.jsx)(e.hr,{}),`\n`,(0,n.jsx)(e.p,{children:\"This article is also available on\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://betterprogramming.pub/i-built-a-snappy-static-full-text-search-with-webassembly-rust-next-js-and-xor-filters-a21a4824832e\",children:\"Better Programming\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://hackernoon.com/static-full-text-search-in-nextjs-with-webassembly-rust-and-xor-filters-tldr\",children:\"Hacker Noon\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Feel free to read it on your favorite platform\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"sparkles\",children:\"\\u2728\"})]}),`\n`,(0,n.jsx)(e.hr,{}),`\n`,(0,n.jsxs)(e.p,{children:[\"I always knew I wanted a full-text search feature for the articles in my \",(0,n.jsx)(e.a,{href:\"https://dawchihliou.github.io\",children:\"portfolio\"}),\" to provide the visitors with a quick access to the content they are interested in. After \",(0,n.jsx)(e.a,{href:\"https://dawchihliou.github.io/articles/build-better-nextjs-static-sites-with-mdx-and-contentlayer\",children:\"migrating to Contentlayer\"}),\", it doesn't seemed to be so far-fetched anymore. So I started exploring\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"rocket\",children:\"\\u{1F680}\"})]}),`\n`,(0,n.jsxs)(e.h2,{id:\"inspired-by-tinysearch-a-webassembly-full-text-search-engine\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#inspired-by-tinysearch-a-webassembly-full-text-search-engine\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Inspired by \",(0,n.jsx)(e.code,{children:\"tinysearch\"}),\": A WebAssembly Full-text Search Engine\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"After some researching, I found a search engine called \",(0,n.jsx)(e.a,{href:\"https://github.com/tinysearch/tinysearch\",children:(0,n.jsx)(e.code,{children:\"tinysearch\"})}),\". It's a static search engine built with \",(0,n.jsx)(e.a,{href:\"https://www.rust-lang.org\",children:\"Rust\"}),\" and \",(0,n.jsx)(e.a,{href:\"https://webassembly.org\",children:\"WebAssembly\"}),\" (Wasm). The author Matthias Endler wrote \",(0,n.jsx)(e.a,{href:\"https://endler.dev/2019/tinysearch\",children:\"an amazing blog post\"}),\" about how \",(0,n.jsx)(e.code,{children:\"tinysearch\"}),\" came about.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"I loved the idea of constructing a minimalistic search engine at build time and shipping it in optimized low-level code to the browsers. So I decided to use \",(0,n.jsx)(e.code,{children:\"tinysearch\"}),\" as the blueprint and write my own search engine to integrate with my \",(0,n.jsx)(e.a,{href:\"https://nextjs.org/\",children:\"Next.js static site\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsxs)(e.em,{children:[\"I highly recommend reading \",(0,n.jsxs)(e.a,{href:\"https://github.com/tinysearch/tinysearch\",children:[(0,n.jsx)(e.code,{children:\"tinysearch\"}),\"'s codebase\"]}),\". It's very well-written. My search engine's implementation is a simplified version of it. The core logic is the same.\"]})}),`\n`,(0,n.jsxs)(e.h2,{id:\"what-does-the-search-feature-looks-like\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#what-does-the-search-feature-looks-like\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"What Does The Search Feature Looks Like?\"]}),`\n`,(0,n.jsx)(\"img\",{src:\"/articles/wasm-fulltext-search/recording.gif\",alt:\"Search demo\",width:\"auto\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,n.jsx)(e.p,{children:\"Very simple:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Users type anything in the search input.\"}),`\n`,(0,n.jsx)(e.li,{children:\"Search engine searches the key words in all the contents and finds the most relevant articles.\"}),`\n`,(0,n.jsx)(e.li,{children:\"UI displays a ranked search result list.\"}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"You can try out the search function at the \",(0,n.jsx)(e.a,{href:\"/articles\",children:\"Articles page\"}),\"!\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"a-little-bit-of-stats\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#a-little-bit-of-stats\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"A Little Bit of Stats\"]}),`\n`,(0,n.jsx)(e.p,{children:\"At the time of writing this article, there are:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"7 articles (more to come\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"rocket\",children:\"\\u{1F680}\"}),\")\"]}),`\n`,(0,n.jsx)(e.li,{children:\"13,925 words\"}),`\n`,(0,n.jsx)(e.li,{children:\"682KB of data files (generated by Contentlayer)\"}),`\n`]}),`\n`,(0,n.jsxs)(e.blockquote,{children:[`\n`,(0,n.jsx)(e.p,{children:\"For the full-text search to work for static sites that are priming for speed, the code size has to be small.\"}),`\n`]}),`\n`,(0,n.jsxs)(e.h2,{id:\"how-does-webassembly-full-text-search-function-work\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#how-does-webassembly-full-text-search-function-work\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"How Does WebAssembly Full-text Search Function Work?\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Most of the \",(0,n.jsx)(e.a,{href:\"https://caniuse.com/?search=webassembly\",children:\"modern browsers now support WebAssembly\"}),\". They are able to run native WebAssembly code and binary alongside JavaScript.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"The concept for the search function is straightforward. It takes in a query string as parameter. In the function, we tokenize the query into search terms. We then give a ranking score to each article based on how many search terms does it contain. Finally, we rank the articles by relevancy. The higher the score, the more relevant it is.\"}),`\n`,(0,n.jsx)(e.p,{children:\"The flow looks like this:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`+--------------+               +--------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Query String \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" - tokenize -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Search Terms \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`+--------------+               +--------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                      \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"+--------------+                      \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`      +-----------------------+           +-----------------------+              +--------------+\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                      \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"      \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                       \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"           \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                       \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Vec\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"Article\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" ------------------ score -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Vec\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"Article, Score\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" - rank -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Vec\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"Article, Score\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" - take\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"n\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Vec\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"Article\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                             \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                       \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"           \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                       \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`+--------------+                             +-----------------------+           +-----------------------+              +--------------+\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Scoring the articles is where the most computing comes in. A naive approach would be transforming each article into a hash set that contains all the unique words in the article. We can calculate the score by simply counting how many search terms are in the hash set.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"You can image that this is not the most memory efficient approach with hash set. There are better data structures to replace it: \",(0,n.jsx)(e.strong,{children:\"xor filters\"}),\".\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"what-are-xor-filters\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#what-are-xor-filters\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"What are Xor Filters?\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://arxiv.org/abs/1912.08258\",children:\"Xor filters\"}),\" are relatively new data structures that allow us to estimate whether a value exists or not. It's fast and memory efficient so it's very suitable for the full-text search.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Instead of storing the actual input values like hash set, xor filters store fingerprints (L-bit hashed sequence) of input values \",(0,n.jsx)(e.a,{href:\"https://web.stanford.edu/class/archive/cs/cs166/cs166.1216/lectures/13/Slides13.pdf#page=49\",children:\"in a specific way\"}),\". When looking for whether a value exists in the filter, it checks if the fingerprint of the value is present.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"However, Xor filters have a couple of trade-offs:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Xor filters are probabilistic and there's a chance false-positive can happen.\"}),`\n`,(0,n.jsx)(e.li,{children:\"Xor filters are not able to estimate the existence of partial values. So in my use case, the full-text search will only be able to search for complete words.\"}),`\n`]}),`\n`,(0,n.jsxs)(e.h2,{id:\"how-did-i-build-the-xor-filters-with-rust\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#how-did-i-build-the-xor-filters-with-rust\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"How Did I Build the Xor Filters with Rust?\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Since I had the article data generated by Contentlayer, I constructed the xor filters by feeding them with the data before the WebAssembly is built. I then serialized the xor filters and stored them in a file. To use the filters in the WebAssembly, all I needed to do was to read from the storage file and deserialize the filters.\"}),`\n`,(0,n.jsx)(e.p,{children:\"The filter generation flow looks like this:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`+-------------------+               +---------------+                +----------------------------+                +-------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                   \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                            \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"             \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Contentlayer Data \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" - generate -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Article Index \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" - construct -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Vec\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"Article, Xor Filter\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" - serialize -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" storage.txt \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                   \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                            \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"             \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`+-------------------+               +---------------+                +----------------------------+                +-------------+\n`})]})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/ayazhafiz/xorf\",children:(0,n.jsx)(e.code,{children:\"xorf\"})}),\" crate is a good choice for xor filters implementation because it offers serialization/deserialization and a few features that improve memory efficiency and false-positive rate. It also provides a very handy \",(0,n.jsx)(e.a,{href:\"https://docs.rs/xorf/latest/xorf/struct.HashProxy.html\",children:(0,n.jsx)(e.code,{children:\"HashProxy\"})}),\" struct for my use case to construct a xor filter with a slice of strings. The construction written in Rust roughly look like this:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-rust\",children:(0,n.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"std\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"::\"}),\"collections\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"::\"}),\"hash_map\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"::\"})]}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"DefaultHasher\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"xorf\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"::\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Filter\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HashProxy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Xor8\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"mod\"}),\" \",(0,n.jsx)(e.span,{className:\"token module-declaration namespace\",children:\"utils\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,n.jsx)(e.span,{className:\"token function-definition function\",children:\"build_filter\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"title\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" body\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HashProxy\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"DefaultHasher\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Xor8\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"let\"}),\" title_tokens\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HashSet\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"utils\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"::\"})]}),(0,n.jsx)(e.span,{className:\"token function\",children:\"tokenize\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"title\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"let\"}),\" body_tokens\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HashSet\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"utils\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"::\"})]}),(0,n.jsx)(e.span,{className:\"token function\",children:\"tokenize\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"body\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"let\"}),\" tokens\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Vec\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" body_tokens\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"union\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"title_tokens\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"cloned\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"collect\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HashProxy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"::\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u0026\"}),\"tokens\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"If you are interested in the actual implementation, you can \",(0,n.jsx)(e.a,{href:\"https://github.com/DawChihLiou/dawchihliou.github.io/blob/main/scripts/fulltext-search/src/storage.rs\",children:\"read more in the repository\"}),\".\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"putting-it-all-together\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#putting-it-all-together\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Putting It All Together\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"alien monster\",children:\"\\u{1F47E}\"}),\"Build-Time                      \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"\",\"aria-hidden\":!0,children:\"\\u{1F3C3}\\u200D\\u2640\\uFE0F\"}),`Run-Time\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    +-------------------+                +------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Contentlayer Data \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" User Input \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    +-------------------+                +------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"           generate                 call wasm.search\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`      +---------------+                +---------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Article Index \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Query String  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`      +---------------+                +---------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          construct                         tokenize\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`+----------------------------+          +--------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Vec\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"Article, Xor Filter\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"          \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Search Terms \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`+----------------------------+          +--------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          serialize                            \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"       +-------------+                         \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"       \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" storage.txt \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" - deserialize ------\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),` score\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"       +-------------+                         \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                   +-----------------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                   \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Vec\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"Article, Score\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                   +-----------------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                              rank\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                   +-----------------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                   \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Vec\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"Article, Score\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                   +-----------------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                             take\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"n\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                        +--------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                        \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Vec\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"Article\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                        +--------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                             \",(0,n.jsx)(e.span,{className:\"token builtin class-name\",children:\"return\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                        +--------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                        \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Vec\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"Article\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                        +--------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                            display\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                       +---------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                       \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Search Result \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                       +---------------+\n`})]})}),`\n`,(0,n.jsxs)(e.h2,{id:\"integrating-webassembly-in-nextjs\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#integrating-webassembly-in-nextjs\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Integrating WebAssembly in Next.js\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Here's how I integrated the xor filter generation script and WebAssembly inside Next.js.\"}),`\n`,(0,n.jsx)(e.p,{children:\"The file structure looks like this:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`my-portfolio\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 next.config.js\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 pages\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 scripts\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u2514\\u2500\\u2500 fulltext-search\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 components\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u2514\\u2500\\u2500 Search.tsx\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2514\\u2500\\u2500 wasm\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \\u2514\\u2500\\u2500 fulltext-search\n`})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"To support WebAssembly, I updated my Webpack configuration to load WebAssembly modules as async modules. To make it work for static site generation, I needed \",(0,n.jsx)(e.a,{href:\"https://github.com/vercel/next.js/issues/25852\",children:\"a workaround\"}),\" to generate the WebAssembly module in \",(0,n.jsx)(e.code,{children:\".next/server\"}),\" directory so that the static pages can pre-render successfully when running the \",(0,n.jsx)(e.code,{children:\"next build\"}),\" script.\"]}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"next.config.js\"}),(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"language-js code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function-variable function\",children:\"webpack\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token parameter\",children:[\"config\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" isServer \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// it makes a WebAssembly modules async modules\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  config\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"experiments\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"asyncWebAssembly\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"true\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:'// generate wasm module in \".next/server\" for ssr \u0026 ssg'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"isServer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    config\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"output\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"webassemblyModuleFilename\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'./../static/wasm/[modulehash].wasm'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"else\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    config\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"output\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"webassemblyModuleFilename\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'static/wasm/[modulehash].wasm'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),` config\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"That's all there is for the integration\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"sparkles\",children:\"\\u2728\"})]}),`\n`,(0,n.jsxs)(e.h2,{id:\"using-the-webassembly-in-the-react-component\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#using-the-webassembly-in-the-react-component\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Using The WebAssembly in The React Component\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"To build the WebAssembly module from the Rust code, I use \",(0,n.jsx)(e.a,{href:\"https://github.com/rustwasm/wasm-pack\",children:(0,n.jsx)(e.code,{children:\"wasm-pack\"})}),\".\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"The generated \",(0,n.jsx)(e.code,{children:\".wasm\"}),\" file and the glue code for JavaScript are located in \",(0,n.jsx)(e.code,{children:\"wasm/fulltext-search/pkg\"}),\". All I needed to do was to use \",(0,n.jsx)(e.a,{href:\"https://nextjs.org/docs/advanced-features/dynamic-import\",children:(0,n.jsx)(e.code,{children:\"next/dynamic\"})}),\" to dynamically import the them. Like this:\"]}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"components/Search.tsx\"}),(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"language-ts code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" React\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" useState\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" useCallback\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" ChangeEvent\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" useEffect \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'react'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" dynamic \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'next/dynamic'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Title\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Url\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"SearchResult\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"Title\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" Search \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"dynamic\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function-variable function\",children:\"loader\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" wasm \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"await\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'../../wasm/fulltext-search/pkg'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"term\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" setTerm\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"useState\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"''\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"results\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" setResults\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token generic-function\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"useState\"}),(0,n.jsxs)(e.span,{className:\"token generic class-name\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"SearchResult\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"})]})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" onChange \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"useCallback\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"e\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" ChangeEvent\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"HTMLInputElement\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token function\",children:\"setTerm\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"target\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token function\",children:\"useEffect\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" pending \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" wasm\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"search\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"term\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token function\",children:\"setResults\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"pending\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"term\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"div\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),`input\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            value\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"term\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            onChange\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"onChange\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            placeholder\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsxs)(e.span,{className:\"token string\",children:['\"',(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"telescope\",children:\"\\u{1F52D}\"}),' search...\"']}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"/\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"results\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"map\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"title\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\u003e\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),\"a key\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" href\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"title\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"/\"}),\"a\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003c\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"/\"}),\"div\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"\u003e\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"default\"}),` Search\n`]})]})}),`\n`,(0,n.jsxs)(e.h2,{id:\"optimizing-the-webassembly-code-size\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#optimizing-the-webassembly-code-size\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Optimizing The WebAssembly Code Size\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Without any optimization, the original Wasm file size was \",(0,n.jsx)(e.code,{children:\"114.56KB\"}),\". I used \",(0,n.jsx)(e.a,{href:\"https://github.com/rustwasm/twiggy\",children:\"Twiggy\"}),\" to find out the code size.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`Shallow Bytes  \\u2502 Shallow % \\u2502 Item\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u253C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u253C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token number\",children:\"117314\"}),\" \\u250A   \",(0,n.jsx)(e.span,{className:\"token number\",children:\"100.00\"}),\"% \\u250A \\u03A3 \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1670\"}),\" Total Rows\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Compared with the \",(0,n.jsx)(e.code,{children:\"628KB\"}),\" of raw data files, it was so much smaller than I expected. I was happy to ship it to the production already but I was curious to see how much code size I could trim off with \",(0,n.jsx)(e.a,{href:\"https://rustwasm.github.io/docs/book/reference/code-size.html\",children:\"The Rust And WebAssembly Working Group's optimization recommendation\"}),\".\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"The first experiment was toggling LTO and trying out different \",(0,n.jsx)(e.code,{children:\"opt-level\"}),\"s. The following configuration yields the smallest \",(0,n.jsx)(e.code,{children:\".wasm\"}),\" code size:\"]}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"Cargo.toml\"}),(0,n.jsx)(e.pre,{className:\"language-diff\",children:(0,n.jsxs)(e.code,{className:\"language-diff code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`[profile.release]\n`}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:` opt-level = 's'\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:` lto = true\n`})]})})]})}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`Shallow Bytes  \\u2502 Shallow % \\u2502 Item\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u253C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u253C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token number\",children:\"111319\"}),\" \\u250A   \",(0,n.jsx)(e.span,{className:\"token number\",children:\"100.00\"}),\"% \\u250A \\u03A3 \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1604\"}),\" Total Rows\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Next I replaced the default allocator with \",(0,n.jsx)(e.a,{href:\"https://github.com/rustwasm/wee_alloc\",children:(0,n.jsx)(e.code,{children:\"wee_alloc\"})}),\".\"]}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"wasm/fulltext-search/src/lib.rs\"}),(0,n.jsx)(e.pre,{className:\"language-diff\",children:(0,n.jsxs)(e.code,{className:\"language-diff code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:` #[global_allocator]\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:` static ALLOC: wee_alloc::WeeAlloc = wee_alloc::WeeAlloc::INIT;\n`})]})})]})}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`Shallow Bytes  \\u2502 Shallow % \\u2502 Item\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u253C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u253C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token number\",children:\"100483\"}),\" \\u250A   \",(0,n.jsx)(e.span,{className:\"token number\",children:\"100.00\"}),\"% \\u250A \\u03A3 \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1625\"}),\" Total Rows\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Then I tried the \",(0,n.jsx)(e.code,{children:\"wasm-opt\"}),\" tool in \",(0,n.jsx)(e.a,{href:\"https://github.com/WebAssembly/binaryen\",children:\"Binaryen\"}),\".\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"wasm-opt \",(0,n.jsx)(e.span,{className:\"token parameter variable\",children:\"-Oz\"}),\" \",(0,n.jsx)(e.span,{className:\"token parameter variable\",children:\"-o\"}),` wasm/fulltext-search/pkg/fulltext_search_core_bg.wasm wasm/fulltext-search/pkg/fulltext_search_core_bg.wasm\n`]})})}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`Shallow Bytes  \\u2502 Shallow % \\u2502 Item\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u253C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u253C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token number\",children:\"100390\"}),\" \\u250A   \",(0,n.jsx)(e.span,{className:\"token number\",children:\"100.00\"}),\"% \\u250A \\u03A3 \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1625\"}),\" Total Rows\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"That's a \",(0,n.jsx)(e.code,{children:\"14.4%\"}),\" off from the original code size.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"At the end, I was able to ship a full-text search engine in:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"98.04 KB raw\"}),`\n`,(0,n.jsx)(e.li,{children:\"45.92 KB gzipped\"}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Not bad\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"smiling face with sunglasses\",children:\"\\u{1F60E}\"})]}),`\n`,(0,n.jsxs)(e.h2,{id:\"is-it-really-snappy\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#is-it-really-snappy\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Is It Really Snappy?\"]}),`\n`,(0,n.jsx)(\"img\",{src:\"/optimized/articles/wasm-fulltext-search/perf.webp\",alt:\"Performance profiling\",width:\"100%\",className:\"rounded\",loading:\"lazy\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"I profiled the performance with \",(0,n.jsx)(e.a,{href:\"https://github.com/rustwasm/wasm-bindgen/tree/main/crates/web-sys\",children:(0,n.jsx)(e.code,{children:\"web-sys\"})}),\" and collected some data:\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"number of searches: 208\"}),`\n`,(0,n.jsx)(e.li,{children:\"min: 0.046 ms\"}),`\n`,(0,n.jsx)(e.li,{children:\"max: 0.814 ms\"}),`\n`,(0,n.jsxs)(e.li,{children:[\"mean: 0.0994 ms \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"sparkles\",children:\"\\u2728\"})]}),`\n`,(0,n.jsx)(e.li,{children:\"standard deviation: 0.0678\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"On average, it takes less than 0.1 ms to perform a full-text search.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"It's pretty snappy\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"smiling face with sunglasses\",children:\"\\u{1F60E}\"})]}),`\n`,(0,n.jsxs)(e.h2,{id:\"final-thoughts\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#final-thoughts\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Final Thoughts\"]}),`\n`,(0,n.jsx)(e.p,{children:\"After some experiment, I was able to build a fast and lightweight full-text search with WebAssembly, Rust, and xor filters. It integrates well with Next.js and static site generation.\"}),`\n`,(0,n.jsx)(e.p,{children:\"The speed and size come with a few trade-offs but they don't have a big impact on the user experience. If you are looking for a more comprehensive search functionality, here are a few cool products available:\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"SaaS Search Engines\"})}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://www.algolia.com\",children:\"Algolia\"})}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"Static Search Engines\"})}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/tinysearch/tinysearch\",children:\"tinysearch\"})}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"Server-based Search Engines\"})}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://www.meilisearch.com\",children:\"Meilisearch\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://typesense.org\",children:\"Typesense\"})}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"In-browser Search Engines\"})}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/nextapps-de/flexsearch\",children:\"FlexSearch\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/lucaong/minisearch\",children:\"MiniSearch\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"http://elasticlunr.com\",children:\"Elasticlunr.js\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.h2,{id:\"references\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#references\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"References\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"Article: \",(0,n.jsx)(e.a,{href:\"https://endler.dev/2019/tinysearch\",children:\"A Tiny, Static, Full-Text Search Engine using Rust and WebAssembly - Matthias Endler\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Article: \",(0,n.jsx)(e.a,{href:\"https://www.stavros.io/posts/bloom-filter-search-engine/\",children:\"Writing a full-text search engine using Bloom filters - Stavros Korokithakis\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Article: \",(0,n.jsx)(e.a,{href:\"https://lemire.me/blog/2019/12/19/xor-filters-faster-and-smaller-than-bloom-filters/\",children:\"Xor Filters: Faster and Smaller Than Bloom Filters - Daniel Lemire\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Article: \",(0,n.jsx)(e.a,{href:\"https://rustwasm.github.io/docs/book/reference/code-size.html\",children:\"Shrinking .wasm Code Size - The Rust and WebAssembly Working Group\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Article: \",(0,n.jsx)(e.a,{href:\"https://dawchihliou.github.io/articles/build-better-nextjs-static-sites-with-mdx-and-contentlayer\",children:\"Building Better Next.js Static Sites with MDX and Contentlayer - Daw-Chih Liou\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Article: \",(0,n.jsx)(e.a,{href:\"https://nextjs.org/docs/advanced-features/dynamic-import\",children:\"Next.js - Dynamic Import\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Website: \",(0,n.jsx)(e.a,{href:\"https://arxiv.org/abs/1912.08258\",children:\"Xor Filters: Faster and Smaller Than Bloom and Cuckoo Filters\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Website: \",(0,n.jsx)(e.a,{href:\"https://dawchihliou.github.io\",children:\"Daw-Chih Liou's Portfolio\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Website: \",(0,n.jsx)(e.a,{href:\"https://www.meilisearch.com\",children:\"Meilisearch\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Website: \",(0,n.jsx)(e.a,{href:\"https://typesense.org\",children:\"Typesense\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Website: \",(0,n.jsx)(e.a,{href:\"https://www.algolia.com\",children:\"Algolia\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Website: \",(0,n.jsx)(e.a,{href:\"http://elasticlunr.com\",children:\"Elasticlunr.js\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Website: \",(0,n.jsx)(e.a,{href:\"https://www.rust-lang.org\",children:\"Rust\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Website: \",(0,n.jsx)(e.a,{href:\"https://webassembly.org\",children:\"WebAssembly\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Website: \",(0,n.jsx)(e.a,{href:\"https://developer.mozilla.org/en-US/docs/WebAssembly\",children:\"MDN WebAssembly\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Website: \",(0,n.jsx)(e.a,{href:\"https://nextjs.org/\",children:\"Next.js\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Website: \",(0,n.jsx)(e.a,{href:\"https://caniuse.com/?search=webassembly\",children:\"Can I use WebAssembly?\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Lecture: \",(0,n.jsx)(e.a,{href:\"https://web.stanford.edu/class/archive/cs/cs166/cs166.1216/lectures/13/Slides13.pdf#page=49\",children:\"Approximate Membership Queries - Stanford\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Wiki: \",(0,n.jsx)(e.a,{href:\"https://en.wikipedia.org/wiki/Full-text_search\",children:\"Full-text Search\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/vercel/next.js/tree/canary/examples/with-webassembly\",children:\"Next.js \u0026 WebAssembly example\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/johnthagen/min-sized-rust\",children:\"Minimizing Rust Binary Size\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/DawChihLiou/dawchihliou.github.io/blob/main/scripts/fulltext-search/src/storage.rs\",children:\"dawchihliou.github.io\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/vercel/next.js/issues/25852\",children:\"Webpack 5 breaks dynamic wasm import for SSR\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Github: \",(0,n.jsx)(e.a,{href:\"https://github.com/tinysearch/tinysearch\",children:\"tinysearch\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/meilisearch/meilisearch\",children:\"Meilisearch\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/ayazhafiz/xorf\",children:\"xorf\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/rustwasm/wasm-pack\",children:\"wasm-pack\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/WebAssembly/binaryen\",children:\"Binaryen\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/rustwasm/twiggy\",children:\"Twiggy\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/rust-lang/rust-clippy\",children:\"Clippy\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/rustwasm/wasm-bindgen/tree/main/crates/web-sys\",children:\"web-sys\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/matklad/once_cell\",children:\"once_cell\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/bincode-org/bincode\",children:\"Bincode\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/rustwasm/wee_alloc\",children:\"wee_alloc\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/serde-rs/serde\",children:\"Serde\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/dtolnay/anyhow\",children:\"Anyhow\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/contentlayerdev/contentlayer\",children:\"Contentlayer\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/nextapps-de/flexsearch\",children:\"FlexSearch\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/lucaong/minisearch\",children:\"MiniSearch\"})]}),`\n`]}),`\n`,(0,n.jsx)(e.hr,{}),`\n`,(0,n.jsxs)(e.p,{children:[\"Here you have it! Thanks for reading through\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"raising hands\",children:\"\\u{1F64C}\"}),`\nIf you find this article useful, please share it to help more people in their engineering journey.`]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"bird\",children:\"\\u{1F426}\"}),\" Feel free to connect with me on \",(0,n.jsx)(e.a,{href:\"https://twitter.com/dawchihliou\",children:\"twitter\"}),\"!\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u23ED Read the next article: \",(0,n.jsx)(e.a,{href:\"/articles/how-to-plan-a-project-as-a-principal-software-engineer\",children:\"How to Plan A Project as A Principal Software Engineer: A Human-centered Approach\"})]}),`\n`,(0,n.jsx)(e.p,{children:\"Happy coding!\"})]})}function y(a={}){let{wrapper:e}=a.components||{};return e?(0,n.jsx)(e,Object.assign({},a,{children:(0,n.jsx)(h,a)})):h(a)}var x=y;return b(S);})();\n;return Component;"},"_id":"articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters.mdx","_raw":{"sourceFilePath":"articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters.mdx","sourceFileName":"i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters.mdx","sourceFileDir":"articles","contentType":"mdx","flattenedPath":"articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters"},"type":"Article","readingTime":{"text":"11 min read","minutes":10.265,"time":615900,"words":2053},"wordCount":2055,"slug":"i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters"}},"__N_SSG":true},"page":"/articles/[slug]","query":{"slug":"i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters"},"buildId":"SaFesCcMEJqgZ4vyltQ1K","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>