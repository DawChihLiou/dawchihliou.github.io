{"pageProps":{"post":{"title":"Lean Docker Images for Next.JS","publishedAt":"Feb 2, 2023","description":"Using multi-stage builds to optimize production Docker image for faster deployment.","cover":"/optimized/articles/next-docker-image/hero.webp","category":"Cloud","coverWidth":"1400","coverHeight":"700","body":{"raw":"\n## In this article\n\n- üßë‚Äçüî¨ We'll discuss why and where optimizing docker image can be meaningful.\n- üôà We'll explore how to dockerize Next.js project with a hidden feature.\n- ü™Ñ We'll dive into the magic behind the docker image optimization.\n\n---\n\nThis article is also available on\n\n- [Level Up Coding](https://medium.com/gitconnected/lean-docker-images-for-next-js-ea6a3215af8e)\n- [Hacker Noon](https://hackernoon.com/docker-image-optimization-lean-docker-images-for-nextjs)\n\nFeel free to read it on your favorite platform‚ú®\n\n---\n\n## The Problem\n\nAt work, I noticed our deployment pipeline was significantly slower than I expected. The simplified pipeline consist of the following jobs:\n\n<img\n  src=\"/optimized/articles/next-docker-image/workflow.webp\"\n  alt=\"Next with server component performance\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/>\n\nAfter some investigation, we were able to identify the performance bottleneck. The task that consistently took the longest to complete was uploading production images to the [Google Cloud Artifact Registry][11]. It was because we were uploading large, un-optimized Docker images to the registry.\n\n[Image size][12] isn't an urgent concern like security or throughput in general. The storage and cost on the cloud are usually generous. However, it becomes problematic when it slows down the pipeline. It increases the [time to market][13] and affects our ability to [continuously deliver][14].\n\n## What's The Impact of Optimizing Docker Image?\n\nWe'll use the DALL-E demo I built for my [previous article][6] as an example. The demo looks like this:\n\n<img\n  src=\"/articles/qwik-vs-next/demo.gif\"\n  alt=\"DALL-E web app demo\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/>\n\n> You can find [the demo on GitHub][5]. Feel free to take a look at the repo and try it out‚ú®\n\nWe'll create two docker files\n\n- **Dockerfile.local**: basic image without optimization\n- **Dockerfile**: optimized image\n\nLet's build the images based on each docker file. The results are:\n\n<img\n  src=\"/optimized/articles/next-docker-image/sizes.webp\"\n  alt=\"Next with server component performance\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/>\n\n- Un-optimized image: **2.85GB**\n- Optimized image: **202MB**\n\nIt's a **92%** reduction in size. We can roughly interpret it as a 92% reduction in uploading time because the file transfer over HTTPS is linear. Now let's dive into how you can achieve the same result.\n\nLet's go.\n\n## Before Optimizing The Image\n\nWe can start off by creating a straightforward Dockerfile like this:\n\n```Dockerfile:Dockerfile.local\nFROM node:18-alpine\nRUN apk add --no-cache libc6-compat\nWORKDIR /app\n\nCOPY . ./\n\n# Build the app\nRUN yarn --frozen-lockfile\nRUN yarn build\n\n# Serve the app\nCMD [ \"yarn\", \"start\" ]\n```\n\nIn this image, we use [Alpine Linux Node 18][3] as the base image because of its much smaller size compared to other base images. We also follow the recommendation and add [libc6-compat][10] to support the use of \"process.dlopen\". The rest is just like how we build and serve the project locally:\n\n- First, we install the dependencies based on yarn.lock file,\n- we generate the production build,\n- and lastly, we start the server with the \"yarn start\" script.\n\nLet's build the image using this docker file and this is generally what you can see in the command line:\n\n<img\n  src=\"/optimized/articles/next-docker-image/unopt.webp\"\n  alt=\"Next with server component performance\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/>\n\nThe build was completed in **52.9s**.\n\n## The Optimized Docker Image\n\nThe optimization is based on two features from Docker and Next.js:\n\n- [Docker Multi-stage builds][1]\n- [Next.js Output File Tracing][2]\n\nThe idea is to use a multi-stage build to [select only what we need in production, stage by stage][7]. Let's take a look at the docker file.\n\n```Dockerfile:Dockerfile\nARG NODE=node:18-alpine\n\n# Stage 1: Install dependencies\nFROM ${NODE} AS deps\nRUN apk add --no-cache libc6-compat\nWORKDIR /app\n\nCOPY package.json yarn.lock* ./\nRUN yarn --frozen-lockfile\n\n# Stage 2: Build the app\nFROM ${NODE} AS builder\nWORKDIR /app\nCOPY --from=deps /app/node_modules ./node_modules\nCOPY . .\n\nRUN yarn build\n\n# Stage 3: Run the production\nFROM ${NODE} AS runner\nWORKDIR /app\n\nENV NODE_ENV production\n\nRUN addgroup --system --gid 1001 nodejs\nRUN adduser --system --uid 1001 nextjs\n\n# copy assets and the generated standalone server\nCOPY --from=builder /app/public ./public\nCOPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./\nCOPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static\n\nUSER nextjs\n\nEXPOSE 3000\n\nENV PORT 3000\n\n# Serve the app\nCMD [\"node\", \"server.js\"]\n```\n\nWe used the same \"node:18-alpine\" as the base image.\n\n#### Stage 1: Install dependencies\n\nInstead of copying everything to the image, we were only copying the \"package.json\" and \"yarn.lock\" for the installation.\n\n#### Stage 2: Build the app\n\nIn order to build the project, we needed the installed dependencies, source code, and all the project configurations in the project root. So we copied the dependencies **from the previous stage** and everything from the project root.\n\n#### Stage 3: Run the production\n\n[Output file tracing][2] is a Next.js feature that is designed to help us reduce deployment size by tracing all the files that are needed for production in build time.\n\nOnce we enable the \"standalone\" output, Next.js will build and output a standalone Node server in \".next/standalone\" directory.\n\n```js:next.config.js\nmodule.exports = {\n  output: 'standalone',\n}\n```\n\nThe build result looks like this:\n\n<img\n  src=\"/optimized/articles/next-docker-image/files.webp\"\n  alt=\"Next with server component performance\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/>\n\nIn this stage, all we did was to copy the standalone server, the assets in the \"./public\" folder, the JavaScript and CSS chunks from the \".next/static\" folder to the working directory and start the server with port 3000.\n\nThe magic behind the output file tracing is [@vercel/nft][9]. It statically analyzes the dependency graph and outputs the list of modules in the graph. To illustrate, let's log the dependencies for our page, API, and the Node server:\n\n```js:file-tracing.mjs\nimport { nodeFileTrace } from \"@vercel/nft\";\n\nconst files = [\n  \"./.next/server/app/sc/page.js\",\n  \"./.next/server/pages/api/images.js\",\n  \"node_modules/next/dist/server/next-server.js\",\n];\nconst { fileList } = await nodeFileTrace(files);\nconsole.log(fileList);\n```\n\nThe output looks like this:\n\n<img\n  src=\"/optimized/articles/next-docker-image/file-tracing.webp\"\n  alt=\"Next with server component performance\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/>\n\n## Final Thoughts\n\nNow that we explored the stages and the standalone server, let's build the image and observe the result:\n\n<img\n  src=\"/optimized/articles/next-docker-image/opt.webp\"\n  alt=\"Next with server component performance\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/>\n\nThe build was completed in 41.3s. Compared to the un-optimized build, we didn't compromise the build time. It's a big win considering that we significantly reduced the build size by 92%.\n\n## References\n\n- [Multi-stage builds][1] - Docker docs\n- [Output File Tracing][2] - Next.js\n- [nodejs/docker-node][3] - Node.js\n- [Docker run reference][4] - Docker docs\n- [DawChihLiou/qwik-vs-next][5] - Daw-Chih Liou\n- [Is Qwik Faster than React Server Component?][6] - Daw-Chih Liou\n- [With Docker][7] - Next.js\n- [Deployment][8] - Next.js\n- [vercel/nft][9] - Vercel\n- [libc6-compat][10] - alpine Linux\n- [Artifact Registry][11] - Google Cloud\n- [Super small Docker image based on Alpine Linux][12] - Hacker News\n- [Time to market][13] - Wikipedia\n- [Ex-Principal Engineer's Guide to Design Thinking and Continuous Delivery][14] - Daw-Chih Liou\n\n[1]: https://docs.docker.com/build/building/multi-stage/\n[2]: https://nextjs.org/docs/advanced-features/output-file-tracing\n[3]: https://github.com/nodejs/docker-node/tree/b4117f9333da4138b03a546ec926ef50a31506c3#nodealpine\n[4]: https://docs.docker.com/engine/reference/run/\n[5]: https://github.com/DawChihLiou/qwik-vs-next\n[6]: https://dawchihliou.github.io/articles/is-qwik-faster-than-react-server-component\n[7]: https://github.com/vercel/next.js/tree/canary/examples/with-docker\n[8]: https://nextjs.org/docs/deployment\n[9]: https://github.com/vercel/nft\n[10]: https://pkgs.alpinelinux.org/package/edge/main/x86/libc6-compat\n[11]: https://cloud.google.com/artifact-registry\n[12]: https://news.ycombinator.com/item?id=10782897\n[13]: https://en.wikipedia.org/wiki/Time_to_market\n[14]: https://dawchihliou.github.io/articles/ex-principal-engineers-guide-to-design-thinking-and-continous-delivery\n\n---\n\nHere you have it! Thanks for reading throughüôå\nIf you find this article useful, please share it to help more people in their engineering journey.\n\nüê¶ Feel free to connect with me on [twitter](https://twitter.com/dawchihliou)!\n\n‚è≠ Ready for the next article? üëâ [**Is Qwik Faster than React Server Component?**](/articles/is-qwik-faster-than-react-server-component)\n\nHappy coding!\n","code":"var Component=(()=>{var h=Object.create;var c=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var N=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports),g=(a,e)=>{for(var i in e)c(a,i,{get:e[i],enumerable:!0})},t=(a,e,i,l)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let s of m(e))!k.call(a,s)&&s!==i&&c(a,s,{get:()=>e[s],enumerable:!(l=p(e,s))||l.enumerable});return a};var f=(a,e,i)=>(i=a!=null?h(u(a)):{},t(e||!a||!a.__esModule?c(i,\"default\",{value:a,enumerable:!0}):i,a)),w=a=>t(c({},\"__esModule\",{value:!0}),a);var o=N((z,r)=>{r.exports=_jsx_runtime});var v={};g(v,{default:()=>x,frontmatter:()=>y});var n=f(o()),y={title:\"Lean Docker Images for Next.JS\",publishedAt:\"Feb 2, 2023\",description:\"Using multi-stage builds to optimize production Docker image for faster deployment.\",cover:\"/optimized/articles/next-docker-image/hero.webp\",category:\"Cloud\",coverWidth:\"1400\",coverHeight:\"700\"};function d(a){let e=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",ul:\"ul\",li:\"li\",hr:\"hr\",p:\"p\",blockquote:\"blockquote\",strong:\"strong\",div:\"div\",pre:\"pre\",code:\"code\",h4:\"h4\"},a.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.h2,{id:\"in-this-article\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#in-this-article\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"In this article\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"\",\"aria-hidden\":!0,children:\"\\u{1F9D1}\"}),\"\\u200D\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"microscope\",children:\"\\u{1F52C}\"}),\" We'll discuss why and where optimizing docker image can be meaningful.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"see-no-evil monkey\",children:\"\\u{1F648}\"}),\" We'll explore how to dockerize Next.js project with a hidden feature.\"]}),`\n`,(0,n.jsx)(e.li,{children:\"\\u{1FA84} We'll dive into the magic behind the docker image optimization.\"}),`\n`]}),`\n`,(0,n.jsx)(e.hr,{}),`\n`,(0,n.jsx)(e.p,{children:\"This article is also available on\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://medium.com/gitconnected/lean-docker-images-for-next-js-ea6a3215af8e\",children:\"Level Up Coding\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://hackernoon.com/docker-image-optimization-lean-docker-images-for-nextjs\",children:\"Hacker Noon\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Feel free to read it on your favorite platform\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"sparkles\",children:\"\\u2728\"})]}),`\n`,(0,n.jsx)(e.hr,{}),`\n`,(0,n.jsxs)(e.h2,{id:\"the-problem\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#the-problem\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"The Problem\"]}),`\n`,(0,n.jsx)(e.p,{children:\"At work, I noticed our deployment pipeline was significantly slower than I expected. The simplified pipeline consist of the following jobs:\"}),`\n`,(0,n.jsx)(\"img\",{src:\"/optimized/articles/next-docker-image/workflow.webp\",alt:\"Next with server component performance\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"After some investigation, we were able to identify the performance bottleneck. The task that consistently took the longest to complete was uploading production images to the \",(0,n.jsx)(e.a,{href:\"https://cloud.google.com/artifact-registry\",children:\"Google Cloud Artifact Registry\"}),\". It was because we were uploading large, un-optimized Docker images to the registry.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://news.ycombinator.com/item?id=10782897\",children:\"Image size\"}),\" isn't an urgent concern like security or throughput in general. The storage and cost on the cloud are usually generous. However, it becomes problematic when it slows down the pipeline. It increases the \",(0,n.jsx)(e.a,{href:\"https://en.wikipedia.org/wiki/Time_to_market\",children:\"time to market\"}),\" and affects our ability to \",(0,n.jsx)(e.a,{href:\"https://dawchihliou.github.io/articles/ex-principal-engineers-guide-to-design-thinking-and-continous-delivery\",children:\"continuously deliver\"}),\".\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"whats-the-impact-of-optimizing-docker-image\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#whats-the-impact-of-optimizing-docker-image\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"What's The Impact of Optimizing Docker Image?\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"We'll use the DALL-E demo I built for my \",(0,n.jsx)(e.a,{href:\"https://dawchihliou.github.io/articles/is-qwik-faster-than-react-server-component\",children:\"previous article\"}),\" as an example. The demo looks like this:\"]}),`\n`,(0,n.jsx)(\"img\",{src:\"/articles/qwik-vs-next/demo.gif\",alt:\"DALL-E web app demo\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,n.jsxs)(e.blockquote,{children:[`\n`,(0,n.jsxs)(e.p,{children:[\"You can find \",(0,n.jsx)(e.a,{href:\"https://github.com/DawChihLiou/qwik-vs-next\",children:\"the demo on GitHub\"}),\". Feel free to take a look at the repo and try it out\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"sparkles\",children:\"\\u2728\"})]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"We'll create two docker files\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Dockerfile.local\"}),\": basic image without optimization\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Dockerfile\"}),\": optimized image\"]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Let's build the images based on each docker file. The results are:\"}),`\n`,(0,n.jsx)(\"img\",{src:\"/optimized/articles/next-docker-image/sizes.webp\",alt:\"Next with server component performance\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"Un-optimized image: \",(0,n.jsx)(e.strong,{children:\"2.85GB\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Optimized image: \",(0,n.jsx)(e.strong,{children:\"202MB\"})]}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"It's a \",(0,n.jsx)(e.strong,{children:\"92%\"}),\" reduction in size. We can roughly interpret it as a 92% reduction in uploading time because the file transfer over HTTPS is linear. Now let's dive into how you can achieve the same result.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Let's go.\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"before-optimizing-the-image\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#before-optimizing-the-image\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Before Optimizing The Image\"]}),`\n`,(0,n.jsx)(e.p,{children:\"We can start off by creating a straightforward Dockerfile like this:\"}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"Dockerfile.local\"}),(0,n.jsx)(e.pre,{className:\"language-dockerfile\",children:(0,n.jsxs)(e.code,{className:\"language-Dockerfile code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"FROM\"}),\" node:18-alpine\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" apk add --no-cache libc6-compat\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"WORKDIR\"}),\" /app\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"COPY\"}),\" . ./\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Build the app\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" yarn --frozen-lockfile\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" yarn build\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Serve the app\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"CMD\"}),\" [ \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"yarn\"'}),\", \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"start\"'}),\" ]\"]}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"In this image, we use \",(0,n.jsx)(e.a,{href:\"https://github.com/nodejs/docker-node/tree/b4117f9333da4138b03a546ec926ef50a31506c3#nodealpine\",children:\"Alpine Linux Node 18\"}),\" as the base image because of its much smaller size compared to other base images. We also follow the recommendation and add \",(0,n.jsx)(e.a,{href:\"https://pkgs.alpinelinux.org/package/edge/main/x86/libc6-compat\",children:\"libc6-compat\"}),' to support the use of \"process.dlopen\". The rest is just like how we build and serve the project locally:']}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"First, we install the dependencies based on yarn.lock file,\"}),`\n`,(0,n.jsx)(e.li,{children:\"we generate the production build,\"}),`\n`,(0,n.jsx)(e.li,{children:'and lastly, we start the server with the \"yarn start\" script.'}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Let's build the image using this docker file and this is generally what you can see in the command line:\"}),`\n`,(0,n.jsx)(\"img\",{src:\"/optimized/articles/next-docker-image/unopt.webp\",alt:\"Next with server component performance\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"The build was completed in \",(0,n.jsx)(e.strong,{children:\"52.9s\"}),\".\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"the-optimized-docker-image\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#the-optimized-docker-image\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"The Optimized Docker Image\"]}),`\n`,(0,n.jsx)(e.p,{children:\"The optimization is based on two features from Docker and Next.js:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://docs.docker.com/build/building/multi-stage/\",children:\"Docker Multi-stage builds\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://nextjs.org/docs/advanced-features/output-file-tracing\",children:\"Next.js Output File Tracing\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"The idea is to use a multi-stage build to \",(0,n.jsx)(e.a,{href:\"https://github.com/vercel/next.js/tree/canary/examples/with-docker\",children:\"select only what we need in production, stage by stage\"}),\". Let's take a look at the docker file.\"]}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"Dockerfile\"}),(0,n.jsx)(e.pre,{className:\"language-dockerfile\",children:(0,n.jsxs)(e.code,{className:\"language-Dockerfile code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"ARG\"}),\" NODE=node:18-alpine\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Stage 1: Install dependencies\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"FROM\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"${NODE}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"AS\"}),\" deps\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" apk add --no-cache libc6-compat\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"WORKDIR\"}),\" /app\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"COPY\"}),\" package.json yarn.lock* ./\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" yarn --frozen-lockfile\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Stage 2: Build the app\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"FROM\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"${NODE}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"AS\"}),\" builder\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"WORKDIR\"}),\" /app\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"COPY\"}),\" \",(0,n.jsxs)(e.span,{className:\"token options\",children:[(0,n.jsx)(e.span,{className:\"token property\",children:\"--from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"deps\"})]}),\" /app/node_modules ./node_modules\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"COPY\"}),\" . .\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" yarn build\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Stage 3: Run the production\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"FROM\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"${NODE}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"AS\"}),\" runner\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"WORKDIR\"}),\" /app\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"ENV\"}),\" NODE_ENV production\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" addgroup --system --gid 1001 nodejs\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" adduser --system --uid 1001 nextjs\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# copy assets and the generated standalone server\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"COPY\"}),\" \",(0,n.jsxs)(e.span,{className:\"token options\",children:[(0,n.jsx)(e.span,{className:\"token property\",children:\"--from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"builder\"})]}),\" /app/public ./public\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"COPY\"}),\" \",(0,n.jsxs)(e.span,{className:\"token options\",children:[(0,n.jsx)(e.span,{className:\"token property\",children:\"--from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"builder\"}),\" \",(0,n.jsx)(e.span,{className:\"token property\",children:\"--chown\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"nextjs:nodejs\"})]}),\" /app/.next/standalone ./\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"COPY\"}),\" \",(0,n.jsxs)(e.span,{className:\"token options\",children:[(0,n.jsx)(e.span,{className:\"token property\",children:\"--from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"builder\"}),\" \",(0,n.jsx)(e.span,{className:\"token property\",children:\"--chown\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"nextjs:nodejs\"})]}),\" /app/.next/static ./.next/static\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"USER\"}),\" nextjs\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"EXPOSE\"}),\" 3000\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"ENV\"}),\" PORT 3000\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Serve the app\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"CMD\"}),\" [\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"node\"'}),\", \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"server.js\"'}),\"]\"]}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:'We used the same \"node:18-alpine\" as the base image.'}),`\n`,(0,n.jsxs)(e.h4,{id:\"stage-1-install-dependencies\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#stage-1-install-dependencies\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Stage 1: Install dependencies\"]}),`\n`,(0,n.jsx)(e.p,{children:'Instead of copying everything to the image, we were only copying the \"package.json\" and \"yarn.lock\" for the installation.'}),`\n`,(0,n.jsxs)(e.h4,{id:\"stage-2-build-the-app\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#stage-2-build-the-app\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Stage 2: Build the app\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"In order to build the project, we needed the installed dependencies, source code, and all the project configurations in the project root. So we copied the dependencies \",(0,n.jsx)(e.strong,{children:\"from the previous stage\"}),\" and everything from the project root.\"]}),`\n`,(0,n.jsxs)(e.h4,{id:\"stage-3-run-the-production\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#stage-3-run-the-production\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Stage 3: Run the production\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://nextjs.org/docs/advanced-features/output-file-tracing\",children:\"Output file tracing\"}),\" is a Next.js feature that is designed to help us reduce deployment size by tracing all the files that are needed for production in build time.\"]}),`\n`,(0,n.jsx)(e.p,{children:'Once we enable the \"standalone\" output, Next.js will build and output a standalone Node server in \".next/standalone\" directory.'}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"next.config.js\"}),(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"language-js code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"module\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"exports\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"output\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'standalone'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"The build result looks like this:\"}),`\n`,(0,n.jsx)(\"img\",{src:\"/optimized/articles/next-docker-image/files.webp\",alt:\"Next with server component performance\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,n.jsx)(e.p,{children:'In this stage, all we did was to copy the standalone server, the assets in the \"./public\" folder, the JavaScript and CSS chunks from the \".next/static\" folder to the working directory and start the server with port 3000.'}),`\n`,(0,n.jsxs)(e.p,{children:[\"The magic behind the output file tracing is \",(0,n.jsx)(e.a,{href:\"https://github.com/vercel/nft\",children:\"@vercel/nft\"}),\". It statically analyzes the dependency graph and outputs the list of modules in the graph. To illustrate, let's log the dependencies for our page, API, and the Node server:\"]}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"file-tracing.mjs\"}),(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"language-js code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"import\"}),\" \",(0,n.jsxs)(e.span,{className:\"token imports\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" nodeFileTrace \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,n.jsx)(e.span,{className:\"token keyword module\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"@vercel/nft\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" files \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"./.next/server/app/sc/page.js\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"./.next/server/pages/api/images.js\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"node_modules/next/dist/server/next-server.js\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" fileList \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"await\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"nodeFileTrace\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"files\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token console class-name\",children:\"console\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token method function property-access\",children:\"log\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"fileList\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:\"The output looks like this:\"}),`\n`,(0,n.jsx)(\"img\",{src:\"/optimized/articles/next-docker-image/file-tracing.webp\",alt:\"Next with server component performance\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"final-thoughts\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#final-thoughts\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Final Thoughts\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Now that we explored the stages and the standalone server, let's build the image and observe the result:\"}),`\n`,(0,n.jsx)(\"img\",{src:\"/optimized/articles/next-docker-image/opt.webp\",alt:\"Next with server component performance\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,n.jsx)(e.p,{children:\"The build was completed in 41.3s. Compared to the un-optimized build, we didn't compromise the build time. It's a big win considering that we significantly reduced the build size by 92%.\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"references\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#references\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"References\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://docs.docker.com/build/building/multi-stage/\",children:\"Multi-stage builds\"}),\" - Docker docs\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://nextjs.org/docs/advanced-features/output-file-tracing\",children:\"Output File Tracing\"}),\" - Next.js\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/nodejs/docker-node/tree/b4117f9333da4138b03a546ec926ef50a31506c3#nodealpine\",children:\"nodejs/docker-node\"}),\" - Node.js\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://docs.docker.com/engine/reference/run/\",children:\"Docker run reference\"}),\" - Docker docs\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/DawChihLiou/qwik-vs-next\",children:\"DawChihLiou/qwik-vs-next\"}),\" - Daw-Chih Liou\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://dawchihliou.github.io/articles/is-qwik-faster-than-react-server-component\",children:\"Is Qwik Faster than React Server Component?\"}),\" - Daw-Chih Liou\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/vercel/next.js/tree/canary/examples/with-docker\",children:\"With Docker\"}),\" - Next.js\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://nextjs.org/docs/deployment\",children:\"Deployment\"}),\" - Next.js\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/vercel/nft\",children:\"vercel/nft\"}),\" - Vercel\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://pkgs.alpinelinux.org/package/edge/main/x86/libc6-compat\",children:\"libc6-compat\"}),\" - alpine Linux\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://cloud.google.com/artifact-registry\",children:\"Artifact Registry\"}),\" - Google Cloud\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://news.ycombinator.com/item?id=10782897\",children:\"Super small Docker image based on Alpine Linux\"}),\" - Hacker News\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://en.wikipedia.org/wiki/Time_to_market\",children:\"Time to market\"}),\" - Wikipedia\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://dawchihliou.github.io/articles/ex-principal-engineers-guide-to-design-thinking-and-continous-delivery\",children:\"Ex-Principal Engineer's Guide to Design Thinking and Continuous Delivery\"}),\" - Daw-Chih Liou\"]}),`\n`]}),`\n`,(0,n.jsx)(e.hr,{}),`\n`,(0,n.jsxs)(e.p,{children:[\"Here you have it! Thanks for reading through\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"raising hands\",children:\"\\u{1F64C}\"}),`\nIf you find this article useful, please share it to help more people in their engineering journey.`]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"bird\",children:\"\\u{1F426}\"}),\" Feel free to connect with me on \",(0,n.jsx)(e.a,{href:\"https://twitter.com/dawchihliou\",children:\"twitter\"}),\"!\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u23ED Ready for the next article? \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"backhand index pointing right\",children:\"\\u{1F449}\"}),\" \",(0,n.jsx)(e.a,{href:\"/articles/is-qwik-faster-than-react-server-component\",children:(0,n.jsx)(e.strong,{children:\"Is Qwik Faster than React Server Component?\"})})]}),`\n`,(0,n.jsx)(e.p,{children:\"Happy coding!\"})]})}function b(a={}){let{wrapper:e}=a.components||{};return e?(0,n.jsx)(e,Object.assign({},a,{children:(0,n.jsx)(d,a)})):d(a)}var x=b;return w(v);})();\n;return Component;"},"_id":"articles/lean-docker-images-for-nextjs.mdx","_raw":{"sourceFilePath":"articles/lean-docker-images-for-nextjs.mdx","sourceFileName":"lean-docker-images-for-nextjs.mdx","sourceFileDir":"articles","contentType":"mdx","flattenedPath":"articles/lean-docker-images-for-nextjs"},"type":"Article","readingTime":{"text":"6 min read","minutes":5.875,"time":352500,"words":1175},"wordCount":1177,"slug":"lean-docker-images-for-nextjs"}},"__N_SSG":true}