{"pageProps":{"post":{"title":"The Last Dockerfile You Need for NestJS","publishedAt":"Apr 27, 2023","description":"An ultimate NestJS Dockfile for optimized production image and local development.","cover":"/optimized/articles/the-last-dockerfile-you-need-for-nestjs/hero.webp","category":"Cloud","coverWidth":"1400","coverHeight":"700","body":{"raw":"\n## In this article\n\n- ðŸš¢ We'll write a docker multi-stage build together.\n- ðŸŽ‰ We'll discover how to use the docker file in development and production.\n- âœ¨ We'll apply some of the best practices recommended by the Docker team.\n\nLet's go.\n\n---\n\nFirst, let's think about the use cases to design the docker build:\n\n- To install all the dependencies to support the local dev server.\n- To run a production server with an optimized bundle.\n\nIn order to cover both of the use cases, we'll use Docker's [multi-stage builds][1] and split the build into 3 stages:\n\n<img\n  src=\"/optimized/articles/the-last-dockerfile-you-need-for-nestjs/stages.webp\"\n  alt=\"Docker multi-stage build overview\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/>\n\n- **dev**: to simply install all the dependencies.\n- **build**: to compile a production build with optimized bundle size.\n- **prod**: to serve the production build.\n\n## The Docker Multi-stage Build\n\n### The \"dev\" Stage\n\nIt's fairly straightforward. All we need to do is to install npm dependencies and apply some of the [best practices][2]:\n\n- We'll use \"[node:alpine][3]\" as the based image to produce minimal image size.\n- We'll install [missing shared libraries][4] from node:alpine.\n- We'll assign a [non-root user][5] to Docker to limit its privileges\n- We'll set the environment to \"development\".\n- We'll install the dependencies based on [yarn lock file][6] to achieve consistent installation across machines.\n\n```dockerfile:Dockerfile\n#\n# ðŸ§‘â€ðŸ’» Development\n#\nFROM node:18-alpine as dev\n# add the missing shared libraries from alpine base image\nRUN apk add --no-cache libc6-compat\n# Create app folder\nWORKDIR /app\n\n# Set to dev environment\nENV NODE_ENV development\n\n# Create non-root user for Docker\nRUN addgroup --system --gid 1001 node\nRUN adduser --system --uid 1001 node\n\n# Copy source code into app folder\nCOPY --chown=node:node . .\n\n# Install dependencies\nRUN yarn --frozen-lockfile\n\n# Set Docker as a non-root user\nUSER node\n```\n\n### The \"build\" Stage\n\nThe build stage is the most interesting stage. The purpose is to compile the source code and generate the least amount of assets.\n\n- We'll use the same base image and best practices [as the dev stage](#the-dev-stage).\n- We'll set the environment to \"production\".\n- We'll copy the dependencies we installed in the dev stage to run the [Nest CLI build script][7].\n- Once the build is completed, we'll install the production-only dependencies and clean the [yarn cache][8]. This will minimize the bundle size.\n\n```dockerfile:Dockerfile\n#\n# ðŸ¡ Production Build\n#\nFROM node:18-alpine as build\n\nWORKDIR /app\nRUN apk add --no-cache libc6-compat\n\n# Set to production environment\nENV NODE_ENV production\n\n# Re-create non-root user for Docker\nRUN addgroup --system --gid 1001 node\nRUN adduser --system --uid 1001 node\n\n# In order to run `yarn build` we need access to the Nest CLI.\n# Nest CLI is a dev dependency.\nCOPY --chown=node:node --from=dev /app/node_modules ./node_modules\n# Copy source code\nCOPY --chown=node:node . .\n\n# Generate the production build. The build script runs \"nest build\" to compile the application.\nRUN yarn build\n\n# Install only the production dependencies and clean cache to optimize image size.\nRUN yarn --frozen-lockfile --production && yarn cache clean\n\n# Set Docker as a non-root user\nUSER node\n```\n\n### The \"prod\" Stage\n\nNow that we have the optimized production build, we can complete the docker build by serving the NestJS server.\n\n- We'll use the same base image and best practices as [the build stage](#the-build-stage).\n- We'll copy the compiled output and the production-only node_modules from the build stage. These are the necessary files we need to run the server.\n- Finally, start the server with Node. \"nest start\" command is not available at this stage because the Nest CLI is a dev dependency.\n\n```dockerfile:Dockerfile\n#\n# ðŸš€ Production Server\n#\nFROM node:18-alpine as prod\n\nWORKDIR /app\nRUN apk add --no-cache libc6-compat\n\n# Set to production environment\nENV NODE_ENV production\n\n# Re-create non-root user for Docker\nRUN addgroup --system --gid 1001 node\nRUN adduser --system --uid 1001 node\n\n# Copy only the necessary files\nCOPY --chown=node:node --from=build /app/dist dist\nCOPY --chown=node:node --from=build /app/node_modules node_modules\n\n# Set Docker as non-root user\nUSER node\n\nCMD [\"node\", \"dist/main.js\"]\n```\n\n### The Complete Multi-stage Dockerfile\n\n```dockerfile:Dockerfile\n#\n# ðŸ§‘â€ðŸ’» Development\n#\nFROM node:18-alpine as dev\n# add the missing shared libraries from alpine base image\nRUN apk add --no-cache libc6-compat\n# Create app folder\nWORKDIR /app\n\n# Set to dev environment\nENV NODE_ENV dev\n\n# Create non-root user for Docker\nRUN addgroup --system --gid 1001 node\nRUN adduser --system --uid 1001 node\n\n# Copy source code into app folder\nCOPY --chown=node:node . .\n\n# Install dependencies\nRUN yarn --frozen-lockfile\n\n# Set Docker as a non-root user\nUSER node\n\n#\n# ðŸ¡ Production Build\n#\nFROM node:18-alpine as build\n\nWORKDIR /app\nRUN apk add --no-cache libc6-compat\n\n# Set to production environment\nENV NODE_ENV production\n\n# Re-create non-root user for Docker\nRUN addgroup --system --gid 1001 node\nRUN adduser --system --uid 1001 node\n\n# In order to run `yarn build` we need access to the Nest CLI.\n# Nest CLI is a dev dependency.\nCOPY --chown=node:node --from=dev /app/node_modules ./node_modules\n# Copy source code\nCOPY --chown=node:node . .\n\n# Generate the production build. The build script runs \"nest build\" to compile the application.\nRUN yarn build\n\n# Install only the production dependencies and clean cache to optimize image size.\nRUN yarn --frozen-lockfile --production && yarn cache clean\n\n# Set Docker as a non-root user\nUSER node\n\n#\n# ðŸš€ Production Server\n#\nFROM node:18-alpine as prod\n\nWORKDIR /app\nRUN apk add --no-cache libc6-compat\n\n# Set to production environment\nENV NODE_ENV production\n\n# Re-create non-root user for Docker\nRUN addgroup --system --gid 1001 node\nRUN adduser --system --uid 1001 node\n\n# Copy only the necessary files\nCOPY --chown=node:node --from=build /app/dist dist\nCOPY --chown=node:node --from=build /app/node_modules node_modules\n\n# Set Docker as non-root user\nUSER node\n\nCMD [\"node\", \"dist/main.js\"]\n```\n\n## How to Use It in Local Development\n\nWe are done with the hard part!\n\nTo use the docker file for local development, all we need to do is to [build the docker image with the dev stage][9]. For example, we can build and run the NestJS server with watch mode in a docker compose file:\n\n```yaml:docker-compose.yml\nservices:\n  api:\n    container_name: nestjs\n    image: nestjs-dev\n    restart: unless-stopped\n    build:\n      context: .\n      dockerfile: Dockerfile\n      # âœ¨ Target the dev stage\n      target: dev\n    # Mount host directory to docker container to support watch mode\n    volumes:\n      - .:/app\n      # This ensures that the NestJS container manages the node_modules folder\n      # rather than synchronizes it with the host machine\n      - /app/node_modules\n    env_file:\n      - docker.env\n    ports:\n      - 8082:8082\n    networks:\n      - nest\n    depends_on:\n      - postgres\n    command: npx nest start --watch\n\n  # ...other services\n```\n\n## How to Use It in Production\n\nYou can simply build the production image by building all 3 stages. For example, we can run \"docker build\" in GitHub Actions as part of the deployment workflow.\n\n```yaml:.github/workflows/ci.yml\njobs\n  deploy:\n    steps:\n      - uses: actions/checkout@v3\n\n      - uses: actions/setup-node@v3\n        with:\n          node-version: '18.x'\n\n      - name: Build NestJS image\n        env:\n          REGISTRY: nestjs-regiestry\n          REPOSITORY: nestjs-example\n          IMAGE_TAG: example\n        # âœ¨ target the production stage\n        run: docker build . -t $REGISTRY/$REPOSITORY:$IMAGE_TAG --target prod\n\n      # ...rest of the steps\n```\n\nSince the \"prod\" is the last stage, we don't need to specify the target for the build command. Running\n\n```bash\ndocker build . -t $REGISTRY/$REPOSITORY:$IMAGE_TAG\n```\n\nwill build the same image.\n\n## References\n\n- [Compose file version 3 reference][9] - Docker Docs\n- [Develop with Docker][2] - Docker docs\n- [Multi-stage builds][1] - Docker docs\n- [Node][3] - Docker Hub\n- [node:alpine][4] - GitHub\n- [NestCLI and scripts][7] - NestJS\n- [USER][5] - Docker Docs\n- [yarn.lock][6] - Yarn\n- [yarn cache][8] - Yarn\n\n[1]: https://docs.docker.com/build/building/multi-stage/\n[2]: https://docs.docker.com/develop/\n[3]: https://hub.docker.com/_/node\n[4]: https://github.com/nodejs/docker-node#nodealpine\n[5]: https://docs.docker.com/engine/reference/builder/#user\n[6]: https://classic.yarnpkg.com/lang/en/docs/yarn-lock/\n[7]: https://docs.nestjs.com/cli/scripts\n[8]: https://classic.yarnpkg.com/lang/en/docs/cli/cache/\n[9]: https://docs.docker.com/compose/compose-file/compose-file-v3/\n\n---\n\nHere you have it! Thanks for reading through ðŸ™Œ\nIf you find this article useful, please share it to help more people in their engineering journey.\n\nðŸ¦ Feel free to connect with me on [twitter](https://twitter.com/dawchihliou)!\n\nâ­ï¸ Ready for the next article? ðŸ‘‰ [the Last Dockerfile You Need for NestJS](/articles/the-last-dockerfile-you-need-for-nestjs)\n\nHappy coding!\n","code":"var Component=(()=>{var h=Object.create;var l=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var N=Object.getPrototypeOf,k=Object.prototype.hasOwnProperty;var u=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports),g=(a,e)=>{for(var s in e)l(a,s,{get:e[s],enumerable:!0})},o=(a,e,s,i)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let c of m(e))!k.call(a,c)&&c!==s&&l(a,c,{get:()=>e[c],enumerable:!(i=p(e,c))||i.enumerable});return a};var y=(a,e,s)=>(s=a!=null?h(N(a)):{},o(e||!a||!a.__esModule?l(s,\"default\",{value:a,enumerable:!0}):s,a)),f=a=>o(l({},\"__esModule\",{value:!0}),a);var r=u((S,d)=>{d.exports=_jsx_runtime});var R={};g(R,{default:()=>v,frontmatter:()=>w});var n=y(r()),w={title:\"The Last Dockerfile You Need for NestJS\",publishedAt:\"Apr 27, 2023\",description:\"An ultimate NestJS Dockfile for optimized production image and local development.\",cover:\"/optimized/articles/the-last-dockerfile-you-need-for-nestjs/hero.webp\",category:\"Cloud\",coverWidth:\"1400\",coverHeight:\"700\"};function t(a){let e=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",ul:\"ul\",li:\"li\",p:\"p\",hr:\"hr\",strong:\"strong\",h3:\"h3\",div:\"div\",pre:\"pre\",code:\"code\"},a.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.h2,{id:\"in-this-article\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#in-this-article\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"In this article\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"ship\",children:\"\\u{1F6A2}\"}),\" We'll write a docker multi-stage build together.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"party popper\",children:\"\\u{1F389}\"}),\" We'll discover how to use the docker file in development and production.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"sparkles\",children:\"\\u2728\"}),\" We'll apply some of the best practices recommended by the Docker team.\"]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"Let's go.\"}),`\n`,(0,n.jsx)(e.hr,{}),`\n`,(0,n.jsx)(e.p,{children:\"First, let's think about the use cases to design the docker build:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"To install all the dependencies to support the local dev server.\"}),`\n`,(0,n.jsx)(e.li,{children:\"To run a production server with an optimized bundle.\"}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"In order to cover both of the use cases, we'll use Docker's \",(0,n.jsx)(e.a,{href:\"https://docs.docker.com/build/building/multi-stage/\",children:\"multi-stage builds\"}),\" and split the build into 3 stages:\"]}),`\n`,(0,n.jsx)(\"img\",{src:\"/optimized/articles/the-last-dockerfile-you-need-for-nestjs/stages.webp\",alt:\"Docker multi-stage build overview\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"dev\"}),\": to simply install all the dependencies.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"build\"}),\": to compile a production build with optimized bundle size.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"prod\"}),\": to serve the production build.\"]}),`\n`]}),`\n`,(0,n.jsxs)(e.h2,{id:\"the-docker-multi-stage-build\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#the-docker-multi-stage-build\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"The Docker Multi-stage Build\"]}),`\n`,(0,n.jsxs)(e.h3,{id:\"the-dev-stage\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#the-dev-stage\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),'The \"dev\" Stage']}),`\n`,(0,n.jsxs)(e.p,{children:[\"It's fairly straightforward. All we need to do is to install npm dependencies and apply some of the \",(0,n.jsx)(e.a,{href:\"https://docs.docker.com/develop/\",children:\"best practices\"}),\":\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[`We'll use \"`,(0,n.jsx)(e.a,{href:\"https://hub.docker.com/_/node\",children:\"node:alpine\"}),'\" as the based image to produce minimal image size.']}),`\n`,(0,n.jsxs)(e.li,{children:[\"We'll install \",(0,n.jsx)(e.a,{href:\"https://github.com/nodejs/docker-node#nodealpine\",children:\"missing shared libraries\"}),\" from node:alpine.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"We'll assign a \",(0,n.jsx)(e.a,{href:\"https://docs.docker.com/engine/reference/builder/#user\",children:\"non-root user\"}),\" to Docker to limit its privileges\"]}),`\n`,(0,n.jsx)(e.li,{children:`We'll set the environment to \"development\".`}),`\n`,(0,n.jsxs)(e.li,{children:[\"We'll install the dependencies based on \",(0,n.jsx)(e.a,{href:\"https://classic.yarnpkg.com/lang/en/docs/yarn-lock/\",children:\"yarn lock file\"}),\" to achieve consistent installation across machines.\"]}),`\n`]}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"Dockerfile\"}),(0,n.jsx)(e.pre,{className:\"language-dockerfile\",children:(0,n.jsxs)(e.code,{className:\"language-dockerfile code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"#\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token comment\",children:[\"# \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"\",\"aria-hidden\":!0,children:\"\\u{1F9D1}\"}),\"\\u200D\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"laptop computer\",children:\"\\u{1F4BB}\"}),\" Development\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"#\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"FROM\"}),\" node:18-alpine \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" dev\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# add the missing shared libraries from alpine base image\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" apk add --no-cache libc6-compat\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Create app folder\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"WORKDIR\"}),\" /app\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Set to dev environment\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"ENV\"}),\" NODE_ENV development\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Create non-root user for Docker\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" addgroup --system --gid 1001 node\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" adduser --system --uid 1001 node\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Copy source code into app folder\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"COPY\"}),\" \",(0,n.jsxs)(e.span,{className:\"token options\",children:[(0,n.jsx)(e.span,{className:\"token property\",children:\"--chown\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"node:node\"})]}),\" . .\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Install dependencies\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" yarn --frozen-lockfile\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Set Docker as a non-root user\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"USER\"}),\" node\"]}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h3,{id:\"the-build-stage\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#the-build-stage\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),'The \"build\" Stage']}),`\n`,(0,n.jsx)(e.p,{children:\"The build stage is the most interesting stage. The purpose is to compile the source code and generate the least amount of assets.\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"We'll use the same base image and best practices \",(0,n.jsx)(e.a,{href:\"#the-dev-stage\",children:\"as the dev stage\"}),\".\"]}),`\n`,(0,n.jsx)(e.li,{children:`We'll set the environment to \"production\".`}),`\n`,(0,n.jsxs)(e.li,{children:[\"We'll copy the dependencies we installed in the dev stage to run the \",(0,n.jsx)(e.a,{href:\"https://docs.nestjs.com/cli/scripts\",children:\"Nest CLI build script\"}),\".\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Once the build is completed, we'll install the production-only dependencies and clean the \",(0,n.jsx)(e.a,{href:\"https://classic.yarnpkg.com/lang/en/docs/cli/cache/\",children:\"yarn cache\"}),\". This will minimize the bundle size.\"]}),`\n`]}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"Dockerfile\"}),(0,n.jsx)(e.pre,{className:\"language-dockerfile\",children:(0,n.jsxs)(e.code,{className:\"language-dockerfile code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"#\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token comment\",children:[\"# \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"house with garden\",children:\"\\u{1F3E1}\"}),\" Production Build\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"#\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"FROM\"}),\" node:18-alpine \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" build\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"WORKDIR\"}),\" /app\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" apk add --no-cache libc6-compat\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Set to production environment\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"ENV\"}),\" NODE_ENV production\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Re-create non-root user for Docker\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" addgroup --system --gid 1001 node\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" adduser --system --uid 1001 node\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# In order to run `yarn build` we need access to the Nest CLI.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Nest CLI is a dev dependency.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"COPY\"}),\" \",(0,n.jsxs)(e.span,{className:\"token options\",children:[(0,n.jsx)(e.span,{className:\"token property\",children:\"--chown\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"node:node\"}),\" \",(0,n.jsx)(e.span,{className:\"token property\",children:\"--from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"dev\"})]}),\" /app/node_modules ./node_modules\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Copy source code\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"COPY\"}),\" \",(0,n.jsxs)(e.span,{className:\"token options\",children:[(0,n.jsx)(e.span,{className:\"token property\",children:\"--chown\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"node:node\"})]}),\" . .\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:'# Generate the production build. The build script runs \"nest build\" to compile the application.'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" yarn build\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Install only the production dependencies and clean cache to optimize image size.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" yarn --frozen-lockfile --production && yarn cache clean\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Set Docker as a non-root user\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"USER\"}),\" node\"]}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h3,{id:\"the-prod-stage\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#the-prod-stage\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),'The \"prod\" Stage']}),`\n`,(0,n.jsx)(e.p,{children:\"Now that we have the optimized production build, we can complete the docker build by serving the NestJS server.\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"We'll use the same base image and best practices as \",(0,n.jsx)(e.a,{href:\"#the-build-stage\",children:\"the build stage\"}),\".\"]}),`\n`,(0,n.jsx)(e.li,{children:\"We'll copy the compiled output and the production-only node_modules from the build stage. These are the necessary files we need to run the server.\"}),`\n`,(0,n.jsx)(e.li,{children:'Finally, start the server with Node. \"nest start\" command is not available at this stage because the Nest CLI is a dev dependency.'}),`\n`]}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"Dockerfile\"}),(0,n.jsx)(e.pre,{className:\"language-dockerfile\",children:(0,n.jsxs)(e.code,{className:\"language-dockerfile code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"#\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token comment\",children:[\"# \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"rocket\",children:\"\\u{1F680}\"}),\" Production Server\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"#\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"FROM\"}),\" node:18-alpine \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" prod\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"WORKDIR\"}),\" /app\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" apk add --no-cache libc6-compat\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Set to production environment\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"ENV\"}),\" NODE_ENV production\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Re-create non-root user for Docker\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" addgroup --system --gid 1001 node\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" adduser --system --uid 1001 node\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Copy only the necessary files\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"COPY\"}),\" \",(0,n.jsxs)(e.span,{className:\"token options\",children:[(0,n.jsx)(e.span,{className:\"token property\",children:\"--chown\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"node:node\"}),\" \",(0,n.jsx)(e.span,{className:\"token property\",children:\"--from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"build\"})]}),\" /app/dist dist\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"COPY\"}),\" \",(0,n.jsxs)(e.span,{className:\"token options\",children:[(0,n.jsx)(e.span,{className:\"token property\",children:\"--chown\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"node:node\"}),\" \",(0,n.jsx)(e.span,{className:\"token property\",children:\"--from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"build\"})]}),\" /app/node_modules node_modules\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Set Docker as non-root user\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"USER\"}),\" node\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"CMD\"}),\" [\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"node\"'}),\", \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"dist/main.js\"'}),\"]\"]}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h3,{id:\"the-complete-multi-stage-dockerfile\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#the-complete-multi-stage-dockerfile\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"The Complete Multi-stage Dockerfile\"]}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"Dockerfile\"}),(0,n.jsx)(e.pre,{className:\"language-dockerfile\",children:(0,n.jsxs)(e.code,{className:\"language-dockerfile code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"#\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token comment\",children:[\"# \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"\",\"aria-hidden\":!0,children:\"\\u{1F9D1}\"}),\"\\u200D\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"laptop computer\",children:\"\\u{1F4BB}\"}),\" Development\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"#\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"FROM\"}),\" node:18-alpine \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" dev\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# add the missing shared libraries from alpine base image\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" apk add --no-cache libc6-compat\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Create app folder\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"WORKDIR\"}),\" /app\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Set to dev environment\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"ENV\"}),\" NODE_ENV dev\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Create non-root user for Docker\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" addgroup --system --gid 1001 node\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" adduser --system --uid 1001 node\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Copy source code into app folder\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"COPY\"}),\" \",(0,n.jsxs)(e.span,{className:\"token options\",children:[(0,n.jsx)(e.span,{className:\"token property\",children:\"--chown\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"node:node\"})]}),\" . .\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Install dependencies\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" yarn --frozen-lockfile\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Set Docker as a non-root user\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"USER\"}),\" node\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"#\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token comment\",children:[\"# \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"house with garden\",children:\"\\u{1F3E1}\"}),\" Production Build\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"#\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"FROM\"}),\" node:18-alpine \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" build\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"WORKDIR\"}),\" /app\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" apk add --no-cache libc6-compat\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Set to production environment\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"ENV\"}),\" NODE_ENV production\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Re-create non-root user for Docker\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" addgroup --system --gid 1001 node\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" adduser --system --uid 1001 node\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# In order to run `yarn build` we need access to the Nest CLI.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Nest CLI is a dev dependency.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"COPY\"}),\" \",(0,n.jsxs)(e.span,{className:\"token options\",children:[(0,n.jsx)(e.span,{className:\"token property\",children:\"--chown\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"node:node\"}),\" \",(0,n.jsx)(e.span,{className:\"token property\",children:\"--from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"dev\"})]}),\" /app/node_modules ./node_modules\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Copy source code\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"COPY\"}),\" \",(0,n.jsxs)(e.span,{className:\"token options\",children:[(0,n.jsx)(e.span,{className:\"token property\",children:\"--chown\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"node:node\"})]}),\" . .\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:'# Generate the production build. The build script runs \"nest build\" to compile the application.'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" yarn build\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Install only the production dependencies and clean cache to optimize image size.\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" yarn --frozen-lockfile --production && yarn cache clean\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Set Docker as a non-root user\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"USER\"}),\" node\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"#\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token comment\",children:[\"# \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"rocket\",children:\"\\u{1F680}\"}),\" Production Server\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"#\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"FROM\"}),\" node:18-alpine \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" prod\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"WORKDIR\"}),\" /app\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" apk add --no-cache libc6-compat\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Set to production environment\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"ENV\"}),\" NODE_ENV production\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Re-create non-root user for Docker\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" addgroup --system --gid 1001 node\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"RUN\"}),\" adduser --system --uid 1001 node\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Copy only the necessary files\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"COPY\"}),\" \",(0,n.jsxs)(e.span,{className:\"token options\",children:[(0,n.jsx)(e.span,{className:\"token property\",children:\"--chown\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"node:node\"}),\" \",(0,n.jsx)(e.span,{className:\"token property\",children:\"--from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"build\"})]}),\" /app/dist dist\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"COPY\"}),\" \",(0,n.jsxs)(e.span,{className:\"token options\",children:[(0,n.jsx)(e.span,{className:\"token property\",children:\"--chown\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"node:node\"}),\" \",(0,n.jsx)(e.span,{className:\"token property\",children:\"--from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"build\"})]}),\" /app/node_modules node_modules\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Set Docker as non-root user\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"USER\"}),\" node\"]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token instruction\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"CMD\"}),\" [\",(0,n.jsx)(e.span,{className:\"token string\",children:'\"node\"'}),\", \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"dist/main.js\"'}),\"]\"]}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h2,{id:\"how-to-use-it-in-local-development\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#how-to-use-it-in-local-development\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"How to Use It in Local Development\"]}),`\n`,(0,n.jsx)(e.p,{children:\"We are done with the hard part!\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"To use the docker file for local development, all we need to do is to \",(0,n.jsx)(e.a,{href:\"https://docs.docker.com/compose/compose-file/compose-file-v3/\",children:\"build the docker image with the dev stage\"}),\". For example, we can build and run the NestJS server with watch mode in a docker compose file:\"]}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"docker-compose.yml\"}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"services\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"api\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"container_name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` nestjs\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"image\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" nestjs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`dev\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"restart\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" unless\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`stopped\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"build\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"context\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` .\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"dockerfile\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Dockerfile\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsxs)(e.span,{className:\"token comment\",children:[\"# \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"sparkles\",children:\"\\u2728\"}),\" Target the dev stage\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"target\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` dev\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Mount host directory to docker container to support watch mode\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"volumes\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" .\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`/app\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# This ensures that the NestJS container manages the node_modules folder\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# rather than synchronizes it with the host machine\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` /app/node_modules\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"env_file\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` docker.env\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"ports\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" 8082\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"8082\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"networks\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` nest\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"depends_on\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),` postgres\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"command\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" npx nest start \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`watch\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# ...other services\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.h2,{id:\"how-to-use-it-in-production\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#how-to-use-it-in-production\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"How to Use It in Production\"]}),`\n`,(0,n.jsx)(e.p,{children:'You can simply build the production image by building all 3 stages. For example, we can run \"docker build\" in GitHub Actions as part of the deployment workflow.'}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\".github/workflows/ci.yml\"}),(0,n.jsx)(e.pre,{className:\"language-yaml\",children:(0,n.jsxs)(e.code,{className:\"language-yaml code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`jobs\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"deploy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"steps\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"uses\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` actions/checkout@v3\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"uses\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" actions/setup\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`node@v3\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"with\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"node-version\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'18.x'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\" \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"name\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` Build NestJS image\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"env\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"REGISTRY\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" nestjs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`regiestry\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"REPOSITORY\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" nestjs\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`example\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"IMAGE_TAG\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` example\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsxs)(e.span,{className:\"token comment\",children:[\"# \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"sparkles\",children:\"\\u2728\"}),\" target the production stage\"]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token key atrule\",children:\"run\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" docker build . \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),\"t $REGISTRY/$REPOSITORY\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\"$IMAGE_TAG \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"-\"}),`target prod\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# ...rest of the steps\"}),`\n`]})]})}),`\n`,(0,n.jsx)(e.p,{children:`Since the \"prod\" is the last stage, we don't need to specify the target for the build command. Running`}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"docker\"}),\" build \",(0,n.jsx)(e.span,{className:\"token builtin class-name\",children:\".\"}),\" \",(0,n.jsx)(e.span,{className:\"token parameter variable\",children:\"-t\"}),\" \",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$REGISTRY\"}),\"/\",(0,n.jsx)(e.span,{className:\"token variable\",children:\"$REPOSITORY\"}),(0,n.jsx)(e.span,{className:\"token builtin class-name\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token variable\",children:\"$IMAGE_TAG\"}),`\n`]})})}),`\n`,(0,n.jsx)(e.p,{children:\"will build the same image.\"}),`\n`,(0,n.jsxs)(e.h2,{id:\"references\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#references\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"References\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://docs.docker.com/compose/compose-file/compose-file-v3/\",children:\"Compose file version 3 reference\"}),\" - Docker Docs\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://docs.docker.com/develop/\",children:\"Develop with Docker\"}),\" - Docker docs\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://docs.docker.com/build/building/multi-stage/\",children:\"Multi-stage builds\"}),\" - Docker docs\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://hub.docker.com/_/node\",children:\"Node\"}),\" - Docker Hub\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/nodejs/docker-node#nodealpine\",children:\"node:alpine\"}),\" - GitHub\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://docs.nestjs.com/cli/scripts\",children:\"NestCLI and scripts\"}),\" - NestJS\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://docs.docker.com/engine/reference/builder/#user\",children:\"USER\"}),\" - Docker Docs\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://classic.yarnpkg.com/lang/en/docs/yarn-lock/\",children:\"yarn.lock\"}),\" - Yarn\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.a,{href:\"https://classic.yarnpkg.com/lang/en/docs/cli/cache/\",children:\"yarn cache\"}),\" - Yarn\"]}),`\n`]}),`\n`,(0,n.jsx)(e.hr,{}),`\n`,(0,n.jsxs)(e.p,{children:[\"Here you have it! Thanks for reading through \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"raising hands\",children:\"\\u{1F64C}\"}),`\nIf you find this article useful, please share it to help more people in their engineering journey.`]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"bird\",children:\"\\u{1F426}\"}),\" Feel free to connect with me on \",(0,n.jsx)(e.a,{href:\"https://twitter.com/dawchihliou\",children:\"twitter\"}),\"!\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"\",\"aria-hidden\":!0,children:\"\\u23ED\\uFE0F\"}),\" Ready for the next article? \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"backhand index pointing right\",children:\"\\u{1F449}\"}),\" \",(0,n.jsx)(e.a,{href:\"/articles/the-last-dockerfile-you-need-for-nestjs\",children:\"the Last Dockerfile You Need for NestJS\"})]}),`\n`,(0,n.jsx)(e.p,{children:\"Happy coding!\"})]})}function b(a={}){let{wrapper:e}=a.components||{};return e?(0,n.jsx)(e,Object.assign({},a,{children:(0,n.jsx)(t,a)})):t(a)}var v=b;return f(R);})();\n;return Component;"},"_id":"articles/the-last-dockerfile-you-need-for-nestjs.mdx","_raw":{"sourceFilePath":"articles/the-last-dockerfile-you-need-for-nestjs.mdx","sourceFileName":"the-last-dockerfile-you-need-for-nestjs.mdx","sourceFileDir":"articles","contentType":"mdx","flattenedPath":"articles/the-last-dockerfile-you-need-for-nestjs"},"type":"Article","readingTime":{"text":"7 min read","minutes":6.655,"time":399300,"words":1331},"wordCount":1333,"slug":"the-last-dockerfile-you-need-for-nestjs"}},"__N_SSG":true}