{"pageProps":{"post":{"title":"I Built A Snappy Static Full-text Search with WebAssembly, Rust, Next.js, and Xor Filters","publishedAt":"March 30, 2022","description":"After migrating to Contentlayer, I started exploring how to use the content data to roll out a search feature for my portfolio. Inspired by some of the amazing open-source projects, I built my own full-text search engine in Rust and WebAssembly. It is fast, lightweight, and tons of fun to build!","cover":"/optimized/articles/wasm-fulltext-search/hero.webp","category":"Rust","coverWidth":"1400","coverHeight":"600","body":{"raw":"\n## TL;DR\n\n- ğŸ¦€ There is a rich toolkit for developing WebAssembly with Rust. It's fun!\n- ğŸ¤ WebAssembly and Next.js play fairly well together, but be aware of the known issues.\n- ğŸ§‘â€ğŸ”¬ Xor filters are data structures that provides great memory efficiency and fast lookup for value existence.\n- ğŸ§‘â€ğŸ³ WebAssembly's performance and code size is not guaranteed. Make sure to measure and benchmark.\n\n---\n\nThis article is also available on\n\n- [Better Programming](https://betterprogramming.pub/i-built-a-snappy-static-full-text-search-with-webassembly-rust-next-js-and-xor-filters-a21a4824832e)\n- [Hacker Noon](https://hackernoon.com/static-full-text-search-in-nextjs-with-webassembly-rust-and-xor-filters-tldr)\n\nFeel free to read it on your favorite platformâœ¨\n\n---\n\nI always knew I wanted a full-text search feature for the articles in my [portfolio](https://dawchihliou.github.io) to provide the visitors with a quick access to the content they are interested in. After [migrating to Contentlayer](https://dawchihliou.github.io/articles/build-better-nextjs-static-sites-with-mdx-and-contentlayer), it doesn't seemed to be so far-fetched anymore. So I started exploringğŸš€\n\n## Inspired by `tinysearch`: A WebAssembly Full-text Search Engine\n\nAfter some researching, I found a search engine called [`tinysearch`](https://github.com/tinysearch/tinysearch). It's a static search engine built with [Rust](https://www.rust-lang.org) and [WebAssembly](https://webassembly.org) (Wasm). The author Matthias Endler wrote [an amazing blog post](https://endler.dev/2019/tinysearch) about how `tinysearch` came about.\n\nI loved the idea of constructing a minimalistic search engine at build time and shipping it in optimized low-level code to the browsers. So I decided to use `tinysearch` as the blueprint and write my own search engine to integrate with my [Next.js static site](https://nextjs.org/).\n\n_I highly recommend reading [`tinysearch`'s codebase](https://github.com/tinysearch/tinysearch). It's very well-written. My search engine's implementation is a simplified version of it. The core logic is the same._\n\n## What Does The Search Feature Looks Like?\n\n<img\n  src=\"/articles/wasm-fulltext-search/recording.gif\"\n  alt=\"Search demo\"\n  width=\"auto\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/>\n\nVery simple:\n\n- Users type anything in the search input.\n- Search engine searches the key words in all the contents and finds the most relevant articles.\n- UI displays a ranked search result list.\n\nYou can try out the search function at the [Articles page](/articles)!\n\n## A Little Bit of Stats\n\nAt the time of writing this article, there are:\n\n- 7 articles (more to comeğŸš€)\n- 13,925 words\n- 682KB of data files (generated by Contentlayer)\n\n> For the full-text search to work for static sites that are priming for speed, the code size has to be small.\n\n## How Does WebAssembly Full-text Search Function Work?\n\nMost of the [modern browsers now support WebAssembly](https://caniuse.com/?search=webassembly). They are able to run native WebAssembly code and binary alongside JavaScript.\n\nThe concept for the search function is straightforward. It takes in a query string as parameter. In the function, we tokenize the query into search terms. We then give a ranking score to each article based on how many search terms does it contain. Finally, we rank the articles by relevancy. The higher the score, the more relevant it is.\n\nThe flow looks like this:\n\n```bash\n+--------------+               +--------------+\n|              |               |              |\n| Query String | - tokenize -> | Search Terms |\n|              |               |              |\n+--------------+               +--------------+\n                                      |\n+--------------+                      |      +-----------------------+           +-----------------------+              +--------------+\n|              |                      |      |                       |           |                       |              |              |\n| Vec<Article> | ------------------ score -> | Vec<(Article, Score)> | - rank -> | Vec<(Article, Score)> | - take(n) -> | Vec<Article> |\n|              |                             |                       |           |                       |              |              |\n+--------------+                             +-----------------------+           +-----------------------+              +--------------+\n\n```\n\nScoring the articles is where the most computing comes in. A naive approach would be transforming each article into a hash set that contains all the unique words in the article. We can calculate the score by simply counting how many search terms are in the hash set.\n\nYou can image that this is not the most memory efficient approach with hash set. There are better data structures to replace it: **xor filters**.\n\n## What are Xor Filters?\n\n[Xor filters](https://arxiv.org/abs/1912.08258) are relatively new data structures that allow us to estimate whether a value exists or not. It's fast and memory efficient so it's very suitable for the full-text search.\n\nInstead of storing the actual input values like hash set, xor filters store fingerprints (L-bit hashed sequence) of input values [in a specific way](https://web.stanford.edu/class/archive/cs/cs166/cs166.1216/lectures/13/Slides13.pdf#page=49). When looking for whether a value exists in the filter, it checks if the fingerprint of the value is present.\n\nHowever, Xor filters have a couple of trade-offs:\n\n- Xor filters are probabilistic and there's a chance false-positive can happen.\n- Xor filters are not able to estimate the existence of partial values. So in my use case, the full-text search will only be able to search for complete words.\n\n## How Did I Build the Xor Filters with Rust?\n\nSince I had the article data generated by Contentlayer, I constructed the xor filters by feeding them with the data before the WebAssembly is built. I then serialized the xor filters and stored them in a file. To use the filters in the WebAssembly, all I needed to do was to read from the storage file and deserialize the filters.\n\nThe filter generation flow looks like this:\n\n```bash\n+-------------------+               +---------------+                +----------------------------+                +-------------+\n|                   |               |               |                |                            |                |             |\n| Contentlayer Data | - generate -> | Article Index | - construct -> | Vec<(Article, Xor Filter)> | - serialize -> | storage.txt |\n|                   |               |               |                |                            |                |             |\n+-------------------+               +---------------+                +----------------------------+                +-------------+\n```\n\n[`xorf`](https://github.com/ayazhafiz/xorf) crate is a good choice for xor filters implementation because it offers serialization/deserialization and a few features that improve memory efficiency and false-positive rate. It also provides a very handy [`HashProxy`](https://docs.rs/xorf/latest/xorf/struct.HashProxy.html) struct for my use case to construct a xor filter with a slice of strings. The construction written in Rust roughly look like this:\n\n```rust\nuse std::collections::hash_map::DefaultHasher;\nuse xorf::{Filter, HashProxy, Xor8};\n\nmod utils;\n\nfn build_filter(title: String, body: String) -> HashProxy<String, DefaultHasher, Xor8> {\n  let title_tokens: HashSet<String> = utils::tokenize(&title);\n  let body_tokens: HashSet<String> = utils::tokenize(&body);\n  let tokens: Vec<String> = body_tokens.union(&title_tokens).cloned().collect();\n\n  HashProxy::from(&tokens)\n}\n```\n\nIf you are interested in the actual implementation, you can [read more in the repository](https://github.com/DawChihLiou/dawchihliou.github.io/blob/main/scripts/fulltext-search/src/storage.rs).\n\n## Putting It All Together\n\n```bash\n\n        ğŸ‘¾Build-Time                      ğŸƒâ€â™€ï¸Run-Time\n\n    +-------------------+                +------------+\n    | Contentlayer Data |                | User Input |\n    +-------------------+                +------------+\n              |                                |\n           generate                 call wasm.search(query)\n              |                                |\n      +---------------+                +---------------+\n      | Article Index |                | Query String  |\n      +---------------+                +---------------+\n              |                                |\n          construct                         tokenize\n              |                                |\n+----------------------------+          +--------------+\n| Vec<(Article, Xor Filter)> |          | Search Terms |\n+----------------------------+          +--------------+\n              |                                |\n          serialize                            |\n              |                                |\n       +-------------+                         |\n       | storage.txt | - deserialize ------> score\n       +-------------+                         |\n                                   +-----------------------+\n                                   | Vec<(Article, Score)> |\n                                   +-----------------------+\n                                               |\n                                              rank\n                                               |\n                                   +-----------------------+\n                                   | Vec<(Article, Score)> |\n                                   +-----------------------+\n                                               |\n                                             take(n)\n                                               |\n                                        +--------------+\n                                        | Vec<Article> |\n                                        +--------------+\n                                               |\n                                             return\n                                               |\n                                        +--------------+\n                                        | Vec<Article> |\n                                        +--------------+\n                                               |\n                                            display\n                                               |\n                                       +---------------+\n                                       | Search Result |\n                                       +---------------+\n```\n\n## Integrating WebAssembly in Next.js\n\nHere's how I integrated the xor filter generation script and WebAssembly inside Next.js.\n\nThe file structure looks like this:\n\n```bash\nmy-portfolio\nâ”œâ”€â”€ next.config.js\nâ”œâ”€â”€ pages\nâ”œâ”€â”€ scripts\nâ”‚   â””â”€â”€ fulltext-search\nâ”œâ”€â”€ components\nâ”‚   â””â”€â”€ Search.tsx\nâ””â”€â”€ wasm\n    â””â”€â”€ fulltext-search\n```\n\nTo support WebAssembly, I updated my Webpack configuration to load WebAssembly modules as async modules. To make it work for static site generation, I needed [a workaround](https://github.com/vercel/next.js/issues/25852) to generate the WebAssembly module in `.next/server` directory so that the static pages can pre-render successfully when running the `next build` script.\n\n```js:next.config.js\nwebpack: function (config, { isServer }) {\n  // it makes a WebAssembly modules async modules\n  config.experiments = { asyncWebAssembly: true }\n\n  // generate wasm module in \".next/server\" for ssr & ssg\n  if (isServer) {\n    config.output.webassemblyModuleFilename =\n      './../static/wasm/[modulehash].wasm'\n  } else {\n    config.output.webassemblyModuleFilename = 'static/wasm/[modulehash].wasm'\n  }\n\n  return config\n},\n```\n\nThat's all there is for the integrationâœ¨\n\n## Using The WebAssembly in The React Component\n\nTo build the WebAssembly module from the Rust code, I use [`wasm-pack`](https://github.com/rustwasm/wasm-pack).\n\nThe generated `.wasm` file and the glue code for JavaScript are located in `wasm/fulltext-search/pkg`. All I needed to do was to use [`next/dynamic`](https://nextjs.org/docs/advanced-features/dynamic-import) to dynamically import the them. Like this:\n\n```ts:components/Search.tsx\nimport React, { useState, useCallback, ChangeEvent, useEffect } from 'react'\nimport dynamic from 'next/dynamic'\n\ntype Title = string;\ntype Url = string;\ntype SearchResult = [Title, Url][];\n\nconst Search = dynamic({\n  loader: async () => {\n    const wasm = await import('../../wasm/fulltext-search/pkg')\n\n    return () => {\n      const [term, setTerm] = useState('')\n      const [results, setResults] = useState<SearchResult>([])\n\n      const onChange = useCallback((e: ChangeEvent<HTMLInputElement>) => {\n        setTerm(e.target.value)\n      }, [])\n\n      useEffect(() => {\n        const pending = wasm.search(term, 5)\n        setResults(pending)\n      }, [term])\n\n      return (\n        <div>\n          <input\n            value={term}\n            onChange={onChange}\n            placeholder=\"ğŸ”­ search...\"\n          />\n          {results.map(([title, url]) => (\n            <a key={url} href={url}>{title}</a>\n          ))}\n        </div>\n      )\n    }\n  },\n})\n\nexport default Search\n```\n\n## Optimizing The WebAssembly Code Size\n\nWithout any optimization, the original Wasm file size was `114.56KB`. I used [Twiggy](https://github.com/rustwasm/twiggy) to find out the code size.\n\n```bash\nShallow Bytes  â”‚ Shallow % â”‚ Item\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n        117314 â”Š   100.00% â”Š Î£ [1670 Total Rows]\n```\n\nCompared with the `628KB` of raw data files, it was so much smaller than I expected. I was happy to ship it to the production already but I was curious to see how much code size I could trim off with [The Rust And WebAssembly Working Group's optimization recommendation](https://rustwasm.github.io/docs/book/reference/code-size.html).\n\nThe first experiment was toggling LTO and trying out different `opt-level`s. The following configuration yields the smallest `.wasm` code size:\n\n```diff:Cargo.toml\n[profile.release]\n+ opt-level = 's'\n+ lto = true\n```\n\n```bash\nShallow Bytes  â”‚ Shallow % â”‚ Item\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n        111319 â”Š   100.00% â”Š Î£ [1604 Total Rows]\n```\n\nNext I replaced the default allocator with [`wee_alloc`](https://github.com/rustwasm/wee_alloc).\n\n```diff:wasm/fulltext-search/src/lib.rs\n+ #[global_allocator]\n+ static ALLOC: wee_alloc::WeeAlloc = wee_alloc::WeeAlloc::INIT;\n```\n\n```bash\nShallow Bytes  â”‚ Shallow % â”‚ Item\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n        100483 â”Š   100.00% â”Š Î£ [1625 Total Rows]\n```\n\nThen I tried the `wasm-opt` tool in [Binaryen](https://github.com/WebAssembly/binaryen).\n\n```bash\nwasm-opt -Oz -o wasm/fulltext-search/pkg/fulltext_search_core_bg.wasm wasm/fulltext-search/pkg/fulltext_search_core_bg.wasm\n```\n\n```bash\nShallow Bytes  â”‚ Shallow % â”‚ Item\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n        100390 â”Š   100.00% â”Š Î£ [1625 Total Rows]\n```\n\nThat's a `14.4%` off from the original code size.\n\nAt the end, I was able to ship a full-text search engine in:\n\n- 98.04 KB raw\n- 45.92 KB gzipped\n\nNot badğŸ˜\n\n## Is It Really Snappy?\n\n<img\n  src=\"/optimized/articles/wasm-fulltext-search/perf.webp\"\n  alt=\"Performance profiling\"\n  width=\"100%\"\n  className=\"rounded\"\n  loading=\"lazy\"\n/>\n\nI profiled the performance with [`web-sys`](https://github.com/rustwasm/wasm-bindgen/tree/main/crates/web-sys) and collected some data:\n\n- number of searches: 208\n- min: 0.046 ms\n- max: 0.814 ms\n- mean: 0.0994 ms âœ¨\n- standard deviation: 0.0678\n\nOn average, it takes less than 0.1 ms to perform a full-text search.\n\nIt's pretty snappyğŸ˜\n\n## Final Thoughts\n\nAfter some experiment, I was able to build a fast and lightweight full-text search with WebAssembly, Rust, and xor filters. It integrates well with Next.js and static site generation.\n\nThe speed and size come with a few trade-offs but they don't have a big impact on the user experience. If you are looking for a more comprehensive search functionality, here are a few cool products available:\n\n**SaaS Search Engines**\n\n- [Algolia](https://www.algolia.com)\n\n**Static Search Engines**\n\n- [tinysearch](https://github.com/tinysearch/tinysearch)\n\n**Server-based Search Engines**\n\n- [Meilisearch](https://www.meilisearch.com)\n- [Typesense](https://typesense.org)\n\n**In-browser Search Engines**\n\n- [FlexSearch](https://github.com/nextapps-de/flexsearch)\n- [MiniSearch](https://github.com/lucaong/minisearch)\n- [Elasticlunr.js](http://elasticlunr.com)\n\n## References\n\n- Article: [A Tiny, Static, Full-Text Search Engine using Rust and WebAssembly - Matthias Endler](https://endler.dev/2019/tinysearch)\n- Article: [Writing a full-text search engine using Bloom filters - Stavros Korokithakis](https://www.stavros.io/posts/bloom-filter-search-engine/)\n- Article: [Xor Filters: Faster and Smaller Than Bloom Filters - Daniel Lemire](https://lemire.me/blog/2019/12/19/xor-filters-faster-and-smaller-than-bloom-filters/)\n- Article: [Shrinking .wasm Code Size - The Rust and WebAssembly Working Group](https://rustwasm.github.io/docs/book/reference/code-size.html)\n- Article: [Building Better Next.js Static Sites with MDX and Contentlayer - Daw-Chih Liou](https://dawchihliou.github.io/articles/build-better-nextjs-static-sites-with-mdx-and-contentlayer)\n- Article: [Next.js - Dynamic Import](https://nextjs.org/docs/advanced-features/dynamic-import)\n- Website: [Xor Filters: Faster and Smaller Than Bloom and Cuckoo Filters](https://arxiv.org/abs/1912.08258)\n- Website: [Daw-Chih Liou's Portfolio](https://dawchihliou.github.io)\n- Website: [Meilisearch](https://www.meilisearch.com)\n- Website: [Typesense](https://typesense.org)\n- Website: [Algolia](https://www.algolia.com)\n- Website: [Elasticlunr.js](http://elasticlunr.com)\n- Website: [Rust](https://www.rust-lang.org)\n- Website: [WebAssembly](https://webassembly.org)\n- Website: [MDN WebAssembly](https://developer.mozilla.org/en-US/docs/WebAssembly)\n- Website: [Next.js](https://nextjs.org/)\n- Website: [Can I use WebAssembly?](https://caniuse.com/?search=webassembly)\n- Lecture: [Approximate Membership Queries - Stanford](https://web.stanford.edu/class/archive/cs/cs166/cs166.1216/lectures/13/Slides13.pdf#page=49)\n- Wiki: [Full-text Search](https://en.wikipedia.org/wiki/Full-text_search)\n- GitHub: [Next.js & WebAssembly example](https://github.com/vercel/next.js/tree/canary/examples/with-webassembly)\n- GitHub: [Minimizing Rust Binary Size](https://github.com/johnthagen/min-sized-rust)\n- GitHub: [dawchihliou.github.io](https://github.com/DawChihLiou/dawchihliou.github.io/blob/main/scripts/fulltext-search/src/storage.rs)\n- GitHub: [Webpack 5 breaks dynamic wasm import for SSR](https://github.com/vercel/next.js/issues/25852)\n- Github: [tinysearch](https://github.com/tinysearch/tinysearch)\n- GitHub: [Meilisearch](https://github.com/meilisearch/meilisearch)\n- GitHub: [xorf](https://github.com/ayazhafiz/xorf)\n- GitHub: [wasm-pack](https://github.com/rustwasm/wasm-pack)\n- GitHub: [Binaryen](https://github.com/WebAssembly/binaryen)\n- GitHub: [Twiggy](https://github.com/rustwasm/twiggy)\n- GitHub: [Clippy](https://github.com/rust-lang/rust-clippy)\n- GitHub: [web-sys](https://github.com/rustwasm/wasm-bindgen/tree/main/crates/web-sys)\n- GitHub: [once_cell](https://github.com/matklad/once_cell)\n- GitHub: [Bincode](https://github.com/bincode-org/bincode)\n- GitHub: [wee_alloc](https://github.com/rustwasm/wee_alloc)\n- GitHub: [Serde](https://github.com/serde-rs/serde)\n- GitHub: [Anyhow](https://github.com/dtolnay/anyhow)\n- GitHub: [Contentlayer](https://github.com/contentlayerdev/contentlayer)\n- GitHub: [FlexSearch](https://github.com/nextapps-de/flexsearch)\n- GitHub: [MiniSearch](https://github.com/lucaong/minisearch)\n\n---\n\nHere you have it! Thanks for reading throughğŸ™Œ\nIf you find this article useful, please share it to help more people in their engineering journey.\n\nğŸ¦ Feel free to connect with me on [twitter](https://twitter.com/dawchihliou)!\n\nâ­ Read the next article: [How to Plan A Project as A Principal Software Engineer: A Human-centered Approach](/articles/how-to-plan-a-project-as-a-principal-software-engineer)\n\nHappy coding!\n","code":"var Component=(()=>{var o=Object.create;var l=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var i=a=>l(a,\"__esModule\",{value:!0});var u=(a,e)=>()=>(e||a((e={exports:{}}).exports,e),e.exports),N=(a,e)=>{i(a);for(var s in e)l(a,s,{get:e[s],enumerable:!0})},k=(a,e,s)=>{if(e&&typeof e==\"object\"||typeof e==\"function\")for(let c of d(e))!m.call(a,c)&&c!==\"default\"&&l(a,c,{get:()=>e[c],enumerable:!(s=h(e,c))||s.enumerable});return a},g=a=>k(i(l(a!=null?o(p(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=u((x,t)=>{t.exports=_jsx_runtime});var w={};N(w,{default:()=>b});var n=g(r());function f(a={}){let e=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",ul:\"ul\",li:\"li\",hr:\"hr\",p:\"p\",code:\"code\",em:\"em\",blockquote:\"blockquote\",pre:\"pre\",strong:\"strong\",div:\"div\"},a.components),{wrapper:s}=e,c=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.h2,{id:\"tldr\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#tldr\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"TL;DR\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"crab\",children:\"\\u{1F980}\"}),\" There is a rich toolkit for developing WebAssembly with Rust. It's fun!\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"handshake\",children:\"\\u{1F91D}\"}),\" WebAssembly and Next.js play fairly well together, but be aware of the known issues.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"\",\"aria-hidden\":!0,children:\"\\u{1F9D1}\"}),\"\\u200D\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"microscope\",children:\"\\u{1F52C}\"}),\" Xor filters are data structures that provides great memory efficiency and fast lookup for value existence.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"\",\"aria-hidden\":!0,children:\"\\u{1F9D1}\"}),\"\\u200D\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"cooking\",children:\"\\u{1F373}\"}),\" WebAssembly's performance and code size is not guaranteed. Make sure to measure and benchmark.\"]}),`\n`]}),`\n`,(0,n.jsx)(e.hr,{}),`\n`,(0,n.jsx)(e.p,{children:\"This article is also available on\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://betterprogramming.pub/i-built-a-snappy-static-full-text-search-with-webassembly-rust-next-js-and-xor-filters-a21a4824832e\",children:\"Better Programming\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://hackernoon.com/static-full-text-search-in-nextjs-with-webassembly-rust-and-xor-filters-tldr\",children:\"Hacker Noon\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Feel free to read it on your favorite platform\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"sparkles\",children:\"\\u2728\"})]}),`\n`,(0,n.jsx)(e.hr,{}),`\n`,(0,n.jsxs)(e.p,{children:[\"I always knew I wanted a full-text search feature for the articles in my \",(0,n.jsx)(e.a,{href:\"https://dawchihliou.github.io\",children:\"portfolio\"}),\" to provide the visitors with a quick access to the content they are interested in. After \",(0,n.jsx)(e.a,{href:\"https://dawchihliou.github.io/articles/build-better-nextjs-static-sites-with-mdx-and-contentlayer\",children:\"migrating to Contentlayer\"}),\", it doesn't seemed to be so far-fetched anymore. So I started exploring\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"rocket\",children:\"\\u{1F680}\"})]}),`\n`,(0,n.jsxs)(e.h2,{id:\"inspired-by-tinysearch-a-webassembly-full-text-search-engine\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#inspired-by-tinysearch-a-webassembly-full-text-search-engine\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Inspired by \",(0,n.jsx)(e.code,{children:\"tinysearch\"}),\": A WebAssembly Full-text Search Engine\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"After some researching, I found a search engine called \",(0,n.jsx)(e.a,{href:\"https://github.com/tinysearch/tinysearch\",children:(0,n.jsx)(e.code,{children:\"tinysearch\"})}),\". It's a static search engine built with \",(0,n.jsx)(e.a,{href:\"https://www.rust-lang.org\",children:\"Rust\"}),\" and \",(0,n.jsx)(e.a,{href:\"https://webassembly.org\",children:\"WebAssembly\"}),\" (Wasm). The author Matthias Endler wrote \",(0,n.jsx)(e.a,{href:\"https://endler.dev/2019/tinysearch\",children:\"an amazing blog post\"}),\" about how \",(0,n.jsx)(e.code,{children:\"tinysearch\"}),\" came about.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"I loved the idea of constructing a minimalistic search engine at build time and shipping it in optimized low-level code to the browsers. So I decided to use \",(0,n.jsx)(e.code,{children:\"tinysearch\"}),\" as the blueprint and write my own search engine to integrate with my \",(0,n.jsx)(e.a,{href:\"https://nextjs.org/\",children:\"Next.js static site\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsxs)(e.em,{children:[\"I highly recommend reading \",(0,n.jsxs)(e.a,{href:\"https://github.com/tinysearch/tinysearch\",children:[(0,n.jsx)(e.code,{children:\"tinysearch\"}),\"'s codebase\"]}),\". It's very well-written. My search engine's implementation is a simplified version of it. The core logic is the same.\"]})}),`\n`,(0,n.jsxs)(e.h2,{id:\"what-does-the-search-feature-looks-like\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#what-does-the-search-feature-looks-like\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"What Does The Search Feature Looks Like?\"]}),`\n`,(0,n.jsx)(\"img\",{src:\"/articles/wasm-fulltext-search/recording.gif\",alt:\"Search demo\",width:\"auto\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,n.jsx)(e.p,{children:\"Very simple:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Users type anything in the search input.\"}),`\n`,(0,n.jsx)(e.li,{children:\"Search engine searches the key words in all the contents and finds the most relevant articles.\"}),`\n`,(0,n.jsx)(e.li,{children:\"UI displays a ranked search result list.\"}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"You can try out the search function at the \",(0,n.jsx)(e.a,{href:\"/articles\",children:\"Articles page\"}),\"!\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"a-little-bit-of-stats\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#a-little-bit-of-stats\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"A Little Bit of Stats\"]}),`\n`,(0,n.jsx)(e.p,{children:\"At the time of writing this article, there are:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"7 articles (more to come\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"rocket\",children:\"\\u{1F680}\"}),\")\"]}),`\n`,(0,n.jsx)(e.li,{children:\"13,925 words\"}),`\n`,(0,n.jsx)(e.li,{children:\"682KB of data files (generated by Contentlayer)\"}),`\n`]}),`\n`,(0,n.jsxs)(e.blockquote,{children:[`\n`,(0,n.jsx)(e.p,{children:\"For the full-text search to work for static sites that are priming for speed, the code size has to be small.\"}),`\n`]}),`\n`,(0,n.jsxs)(e.h2,{id:\"how-does-webassembly-full-text-search-function-work\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#how-does-webassembly-full-text-search-function-work\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"How Does WebAssembly Full-text Search Function Work?\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Most of the \",(0,n.jsx)(e.a,{href:\"https://caniuse.com/?search=webassembly\",children:\"modern browsers now support WebAssembly\"}),\". They are able to run native WebAssembly code and binary alongside JavaScript.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"The concept for the search function is straightforward. It takes in a query string as parameter. In the function, we tokenize the query into search terms. We then give a ranking score to each article based on how many search terms does it contain. Finally, we rank the articles by relevancy. The higher the score, the more relevant it is.\"}),`\n`,(0,n.jsx)(e.p,{children:\"The flow looks like this:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`+--------------+               +--------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Query String \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" - tokenize -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Search Terms \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`+--------------+               +--------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                      \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"+--------------+                      \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`      +-----------------------+           +-----------------------+              +--------------+\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                      \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"      \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                       \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"           \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                       \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Vec\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),\"Article\",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" ------------------ score -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Vec\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"Article, Score\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" - rank -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Vec\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"Article, Score\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" - take\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"n\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Vec\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),\"Article\",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                             \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                       \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"           \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                       \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`+--------------+                             +-----------------------+           +-----------------------+              +--------------+\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`})]})}),`\n`,(0,n.jsx)(e.p,{children:\"Scoring the articles is where the most computing comes in. A naive approach would be transforming each article into a hash set that contains all the unique words in the article. We can calculate the score by simply counting how many search terms are in the hash set.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"You can image that this is not the most memory efficient approach with hash set. There are better data structures to replace it: \",(0,n.jsx)(e.strong,{children:\"xor filters\"}),\".\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"what-are-xor-filters\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#what-are-xor-filters\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"What are Xor Filters?\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://arxiv.org/abs/1912.08258\",children:\"Xor filters\"}),\" are relatively new data structures that allow us to estimate whether a value exists or not. It's fast and memory efficient so it's very suitable for the full-text search.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Instead of storing the actual input values like hash set, xor filters store fingerprints (L-bit hashed sequence) of input values \",(0,n.jsx)(e.a,{href:\"https://web.stanford.edu/class/archive/cs/cs166/cs166.1216/lectures/13/Slides13.pdf#page=49\",children:\"in a specific way\"}),\". When looking for whether a value exists in the filter, it checks if the fingerprint of the value is present.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"However, Xor filters have a couple of trade-offs:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Xor filters are probabilistic and there's a chance false-positive can happen.\"}),`\n`,(0,n.jsx)(e.li,{children:\"Xor filters are not able to estimate the existence of partial values. So in my use case, the full-text search will only be able to search for complete words.\"}),`\n`]}),`\n`,(0,n.jsxs)(e.h2,{id:\"how-did-i-build-the-xor-filters-with-rust\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#how-did-i-build-the-xor-filters-with-rust\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"How Did I Build the Xor Filters with Rust?\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Since I had the article data generated by Contentlayer, I constructed the xor filters by feeding them with the data before the WebAssembly is built. I then serialized the xor filters and stored them in a file. To use the filters in the WebAssembly, all I needed to do was to read from the storage file and deserialize the filters.\"}),`\n`,(0,n.jsx)(e.p,{children:\"The filter generation flow looks like this:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`+-------------------+               +---------------+                +----------------------------+                +-------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                   \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                            \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"             \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Contentlayer Data \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" - generate -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Article Index \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" - construct -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Vec\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"Article, Xor Filter\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" - serialize -\",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" storage.txt \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                   \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                            \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"             \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`+-------------------+               +---------------+                +----------------------------+                +-------------+\n`})]})}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.a,{href:\"https://github.com/ayazhafiz/xorf\",children:(0,n.jsx)(e.code,{children:\"xorf\"})}),\" crate is a good choice for xor filters implementation because it offers serialization/deserialization and a few features that improve memory efficiency and false-positive rate. It also provides a very handy \",(0,n.jsx)(e.a,{href:\"https://docs.rs/xorf/latest/xorf/struct.HashProxy.html\",children:(0,n.jsx)(e.code,{children:\"HashProxy\"})}),\" struct for my use case to construct a xor filter with a slice of strings. The construction written in Rust roughly look like this:\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-rust\",children:(0,n.jsxs)(e.code,{className:\"language-rust code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"std\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"::\"}),\"collections\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"::\"}),\"hash_map\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"::\"})]}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"DefaultHasher\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"use\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"xorf\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"::\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Filter\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HashProxy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Xor8\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"mod\"}),\" \",(0,n.jsx)(e.span,{className:\"token module-declaration namespace\",children:\"utils\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"fn\"}),\" \",(0,n.jsx)(e.span,{className:\"token function-definition function\",children:\"build_filter\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"title\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" body\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"->\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HashProxy\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"DefaultHasher\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Xor8\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"let\"}),\" title_tokens\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HashSet\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"utils\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"::\"})]}),(0,n.jsx)(e.span,{className:\"token function\",children:\"tokenize\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\"title\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"let\"}),\" body_tokens\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HashSet\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token namespace\",children:[\"utils\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"::\"})]}),(0,n.jsx)(e.span,{className:\"token function\",children:\"tokenize\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\"body\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"let\"}),\" tokens\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Vec\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token class-name\",children:\"String\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" body_tokens\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"union\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\"title_tokens\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"cloned\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"collect\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HashProxy\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"::\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"from\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"&\"}),\"tokens\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"If you are interested in the actual implementation, you can \",(0,n.jsx)(e.a,{href:\"https://github.com/DawChihLiou/dawchihliou.github.io/blob/main/scripts/fulltext-search/src/storage.rs\",children:\"read more in the repository\"}),\".\"]}),`\n`,(0,n.jsxs)(e.h2,{id:\"putting-it-all-together\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#putting-it-all-together\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Putting It All Together\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"alien monster\",children:\"\\u{1F47E}\"}),\"Build-Time                      \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"\",\"aria-hidden\":!0,children:\"\\u{1F3C3}\\u200D\\u2640\\uFE0F\"}),`Run-Time\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    +-------------------+                +------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Contentlayer Data \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" User Input \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    +-------------------+                +------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"           generate                 call wasm.search\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"query\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`      +---------------+                +---------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Article Index \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Query String  \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`      +---------------+                +---------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`          construct                         tokenize\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`+----------------------------+          +--------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Vec\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"Article, Xor Filter\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"          \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Search Terms \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`+----------------------------+          +--------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          serialize                            \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"              \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\"                                \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"       +-------------+                         \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"       \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" storage.txt \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" - deserialize ------\",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),` score\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"       +-------------+                         \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                   +-----------------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                   \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Vec\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"Article, Score\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                   +-----------------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                              rank\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                   +-----------------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                   \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Vec\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"Article, Score\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                   +-----------------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                             take\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"n\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                        +--------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                        \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Vec\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),\"Article\",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                        +--------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                             \",(0,n.jsx)(e.span,{className:\"token builtin class-name\",children:\"return\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                        +--------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                        \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Vec\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),\"Article\",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                        +--------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                            display\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                               \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                       +---------------+\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"                                       \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),\" Search Result \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"|\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`                                       +---------------+\n`})]})}),`\n`,(0,n.jsxs)(e.h2,{id:\"integrating-webassembly-in-nextjs\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#integrating-webassembly-in-nextjs\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Integrating WebAssembly in Next.js\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Here's how I integrated the xor filter generation script and WebAssembly inside Next.js.\"}),`\n`,(0,n.jsx)(e.p,{children:\"The file structure looks like this:\"}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`my-portfolio\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 next.config.js\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 pages\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 scripts\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u2514\\u2500\\u2500 fulltext-search\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u251C\\u2500\\u2500 components\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2502   \\u2514\\u2500\\u2500 Search.tsx\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2514\\u2500\\u2500 wasm\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`    \\u2514\\u2500\\u2500 fulltext-search\n`})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"To support WebAssembly, I updated my Webpack configuration to load WebAssembly modules as async modules. To make it work for static site generation, I needed \",(0,n.jsx)(e.a,{href:\"https://github.com/vercel/next.js/issues/25852\",children:\"a workaround\"}),\" to generate the WebAssembly module in \",(0,n.jsx)(e.code,{children:\".next/server\"}),\" directory so that the static pages can pre-render successfully when running the \",(0,n.jsx)(e.code,{children:\"next build\"}),\" script.\"]}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"next.config.js\"}),(0,n.jsx)(e.pre,{className:\"language-js\",children:(0,n.jsxs)(e.code,{className:\"language-js code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token function-variable function\",children:\"webpack\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token parameter\",children:[\"config\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" isServer \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// it makes a WebAssembly modules async modules\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  config\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"experiments\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" \",(0,n.jsx)(e.span,{className:\"token literal-property property\",children:\"asyncWebAssembly\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"true\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token comment\",children:'// generate wasm module in \".next/server\" for ssr & ssg'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"isServer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    config\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"output\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"webassemblyModuleFilename\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'./../static/wasm/[modulehash].wasm'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"else\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    config\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"output\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"webassemblyModuleFilename\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'static/wasm/[modulehash].wasm'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token keyword control-flow\",children:\"return\"}),` config\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"That's all there is for the integration\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"sparkles\",children:\"\\u2728\"})]}),`\n`,(0,n.jsxs)(e.h2,{id:\"using-the-webassembly-in-the-react-component\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#using-the-webassembly-in-the-react-component\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Using The WebAssembly in The React Component\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"To build the WebAssembly module from the Rust code, I use \",(0,n.jsx)(e.a,{href:\"https://github.com/rustwasm/wasm-pack\",children:(0,n.jsx)(e.code,{children:\"wasm-pack\"})}),\".\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"The generated \",(0,n.jsx)(e.code,{children:\".wasm\"}),\" file and the glue code for JavaScript are located in \",(0,n.jsx)(e.code,{children:\"wasm/fulltext-search/pkg\"}),\". All I needed to do was to use \",(0,n.jsx)(e.a,{href:\"https://nextjs.org/docs/advanced-features/dynamic-import\",children:(0,n.jsx)(e.code,{children:\"next/dynamic\"})}),\" to dynamically import the them. Like this:\"]}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"components/Search.tsx\"}),(0,n.jsx)(e.pre,{className:\"language-ts\",children:(0,n.jsxs)(e.code,{className:\"language-ts code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" React\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" useState\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" useCallback\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" ChangeEvent\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" useEffect \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'react'\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),\" dynamic \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'next/dynamic'\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Title\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"Url\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"string\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"SearchResult\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"Title\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" Url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" Search \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"dynamic\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token function-variable function\",children:\"loader\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=>\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" wasm \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"await\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'../../wasm/fulltext-search/pkg'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=>\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"term\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" setTerm\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"useState\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"''\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"results\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" setResults\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token generic-function\",children:[(0,n.jsx)(e.span,{className:\"token function\",children:\"useState\"}),(0,n.jsxs)(e.span,{className:\"token generic class-name\",children:[(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),\"SearchResult\",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"})]})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" onChange \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"useCallback\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"e\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" ChangeEvent\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),\"HTMLInputElement\",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=>\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token function\",children:\"setTerm\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"target\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"value\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token function\",children:\"useEffect\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=>\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" pending \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" wasm\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"search\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"term\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"5\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token function\",children:\"setResults\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"pending\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"term\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),\"div\",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),`input\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            value\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"term\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            onChange\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"onChange\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            placeholder\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsxs)(e.span,{className:\"token string\",children:['\"',(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"telescope\",children:\"\\u{1F52D}\"}),' search...\"']}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"/\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"results\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function\",children:\"map\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"title\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=>\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),\"a key\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),\" href\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"url\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"title\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"/\"}),\"a\",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"<\"}),(0,n.jsx)(e.span,{className:\"token operator\",children:\"/\"}),\"div\",(0,n.jsx)(e.span,{className:\"token operator\",children:\">\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"export\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"default\"}),` Search\n`]})]})}),`\n`,(0,n.jsxs)(e.h2,{id:\"optimizing-the-webassembly-code-size\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#optimizing-the-webassembly-code-size\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Optimizing The WebAssembly Code Size\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Without any optimization, the original Wasm file size was \",(0,n.jsx)(e.code,{children:\"114.56KB\"}),\". I used \",(0,n.jsx)(e.a,{href:\"https://github.com/rustwasm/twiggy\",children:\"Twiggy\"}),\" to find out the code size.\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`Shallow Bytes  \\u2502 Shallow % \\u2502 Item\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u253C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u253C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token number\",children:\"117314\"}),\" \\u250A   \",(0,n.jsx)(e.span,{className:\"token number\",children:\"100.00\"}),\"% \\u250A \\u03A3 \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1670\"}),\" Total Rows\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Compared with the \",(0,n.jsx)(e.code,{children:\"628KB\"}),\" of raw data files, it was so much smaller than I expected. I was happy to ship it to the production already but I was curious to see how much code size I could trim off with \",(0,n.jsx)(e.a,{href:\"https://rustwasm.github.io/docs/book/reference/code-size.html\",children:\"The Rust And WebAssembly Working Group's optimization recommendation\"}),\".\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"The first experiment was toggling LTO and trying out different \",(0,n.jsx)(e.code,{children:\"opt-level\"}),\"s. The following configuration yields the smallest \",(0,n.jsx)(e.code,{children:\".wasm\"}),\" code size:\"]}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"Cargo.toml\"}),(0,n.jsx)(e.pre,{className:\"language-diff\",children:(0,n.jsxs)(e.code,{className:\"language-diff code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`[profile.release]\n`}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:` opt-level = 's'\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:` lto = true\n`})]})})]})}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`Shallow Bytes  \\u2502 Shallow % \\u2502 Item\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u253C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u253C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token number\",children:\"111319\"}),\" \\u250A   \",(0,n.jsx)(e.span,{className:\"token number\",children:\"100.00\"}),\"% \\u250A \\u03A3 \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1604\"}),\" Total Rows\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Next I replaced the default allocator with \",(0,n.jsx)(e.a,{href:\"https://github.com/rustwasm/wee_alloc\",children:(0,n.jsx)(e.code,{children:\"wee_alloc\"})}),\".\"]}),`\n`,(0,n.jsx)(e.div,{className:\"rehype-code-title\",children:\"wasm/fulltext-search/src/lib.rs\"}),(0,n.jsx)(e.pre,{className:\"language-diff\",children:(0,n.jsxs)(e.code,{className:\"language-diff code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:` #[global_allocator]\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line inserted\",children:(0,n.jsxs)(e.span,{className:\"token inserted-sign inserted\",children:[(0,n.jsx)(e.span,{className:\"token line\"}),(0,n.jsx)(e.span,{className:\"token prefix inserted\",children:\"+\"}),(0,n.jsx)(e.span,{className:\"token line\",children:` static ALLOC: wee_alloc::WeeAlloc = wee_alloc::WeeAlloc::INIT;\n`})]})})]})}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`Shallow Bytes  \\u2502 Shallow % \\u2502 Item\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u253C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u253C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token number\",children:\"100483\"}),\" \\u250A   \",(0,n.jsx)(e.span,{className:\"token number\",children:\"100.00\"}),\"% \\u250A \\u03A3 \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1625\"}),\" Total Rows\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Then I tried the \",(0,n.jsx)(e.code,{children:\"wasm-opt\"}),\" tool in \",(0,n.jsx)(e.a,{href:\"https://github.com/WebAssembly/binaryen\",children:\"Binaryen\"}),\".\"]}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsx)(e.code,{className:\"language-bash code-highlight\",children:(0,n.jsx)(e.span,{className:\"code-line\",children:`wasm-opt -Oz -o wasm/fulltext-search/pkg/fulltext_search_core_bg.wasm wasm/fulltext-search/pkg/fulltext_search_core_bg.wasm\n`})})}),`\n`,(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"language-bash code-highlight\",children:[(0,n.jsx)(e.span,{className:\"code-line\",children:`Shallow Bytes  \\u2502 Shallow % \\u2502 Item\n`}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u253C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u253C\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\\u2500\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token number\",children:\"100390\"}),\" \\u250A   \",(0,n.jsx)(e.span,{className:\"token number\",children:\"100.00\"}),\"% \\u250A \\u03A3 \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"1625\"}),\" Total Rows\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),`\n`,(0,n.jsxs)(e.p,{children:[\"That's a \",(0,n.jsx)(e.code,{children:\"14.4%\"}),\" off from the original code size.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"At the end, I was able to ship a full-text search engine in:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"98.04 KB raw\"}),`\n`,(0,n.jsx)(e.li,{children:\"45.92 KB gzipped\"}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Not bad\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"smiling face with sunglasses\",children:\"\\u{1F60E}\"})]}),`\n`,(0,n.jsxs)(e.h2,{id:\"is-it-really-snappy\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#is-it-really-snappy\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Is It Really Snappy?\"]}),`\n`,(0,n.jsx)(\"img\",{src:\"/optimized/articles/wasm-fulltext-search/perf.webp\",alt:\"Performance profiling\",width:\"100%\",className:\"rounded\",loading:\"lazy\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"I profiled the performance with \",(0,n.jsx)(e.a,{href:\"https://github.com/rustwasm/wasm-bindgen/tree/main/crates/web-sys\",children:(0,n.jsx)(e.code,{children:\"web-sys\"})}),\" and collected some data:\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"number of searches: 208\"}),`\n`,(0,n.jsx)(e.li,{children:\"min: 0.046 ms\"}),`\n`,(0,n.jsx)(e.li,{children:\"max: 0.814 ms\"}),`\n`,(0,n.jsxs)(e.li,{children:[\"mean: 0.0994 ms \",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"sparkles\",children:\"\\u2728\"})]}),`\n`,(0,n.jsx)(e.li,{children:\"standard deviation: 0.0678\"}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"On average, it takes less than 0.1 ms to perform a full-text search.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"It's pretty snappy\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"smiling face with sunglasses\",children:\"\\u{1F60E}\"})]}),`\n`,(0,n.jsxs)(e.h2,{id:\"final-thoughts\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#final-thoughts\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Final Thoughts\"]}),`\n`,(0,n.jsx)(e.p,{children:\"After some experiment, I was able to build a fast and lightweight full-text search with WebAssembly, Rust, and xor filters. It integrates well with Next.js and static site generation.\"}),`\n`,(0,n.jsx)(e.p,{children:\"The speed and size come with a few trade-offs but they don't have a big impact on the user experience. If you are looking for a more comprehensive search functionality, here are a few cool products available:\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"SaaS Search Engines\"})}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://www.algolia.com\",children:\"Algolia\"})}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"Static Search Engines\"})}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/tinysearch/tinysearch\",children:\"tinysearch\"})}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"Server-based Search Engines\"})}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://www.meilisearch.com\",children:\"Meilisearch\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://typesense.org\",children:\"Typesense\"})}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"In-browser Search Engines\"})}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/nextapps-de/flexsearch\",children:\"FlexSearch\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/lucaong/minisearch\",children:\"MiniSearch\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"http://elasticlunr.com\",children:\"Elasticlunr.js\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.h2,{id:\"references\",children:[(0,n.jsx)(e.a,{className:\"anchor\",href:\"#references\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"References\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"Article: \",(0,n.jsx)(e.a,{href:\"https://endler.dev/2019/tinysearch\",children:\"A Tiny, Static, Full-Text Search Engine using Rust and WebAssembly - Matthias Endler\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Article: \",(0,n.jsx)(e.a,{href:\"https://www.stavros.io/posts/bloom-filter-search-engine/\",children:\"Writing a full-text search engine using Bloom filters - Stavros Korokithakis\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Article: \",(0,n.jsx)(e.a,{href:\"https://lemire.me/blog/2019/12/19/xor-filters-faster-and-smaller-than-bloom-filters/\",children:\"Xor Filters: Faster and Smaller Than Bloom Filters - Daniel Lemire\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Article: \",(0,n.jsx)(e.a,{href:\"https://rustwasm.github.io/docs/book/reference/code-size.html\",children:\"Shrinking .wasm Code Size - The Rust and WebAssembly Working Group\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Article: \",(0,n.jsx)(e.a,{href:\"https://dawchihliou.github.io/articles/build-better-nextjs-static-sites-with-mdx-and-contentlayer\",children:\"Building Better Next.js Static Sites with MDX and Contentlayer - Daw-Chih Liou\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Article: \",(0,n.jsx)(e.a,{href:\"https://nextjs.org/docs/advanced-features/dynamic-import\",children:\"Next.js - Dynamic Import\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Website: \",(0,n.jsx)(e.a,{href:\"https://arxiv.org/abs/1912.08258\",children:\"Xor Filters: Faster and Smaller Than Bloom and Cuckoo Filters\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Website: \",(0,n.jsx)(e.a,{href:\"https://dawchihliou.github.io\",children:\"Daw-Chih Liou's Portfolio\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Website: \",(0,n.jsx)(e.a,{href:\"https://www.meilisearch.com\",children:\"Meilisearch\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Website: \",(0,n.jsx)(e.a,{href:\"https://typesense.org\",children:\"Typesense\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Website: \",(0,n.jsx)(e.a,{href:\"https://www.algolia.com\",children:\"Algolia\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Website: \",(0,n.jsx)(e.a,{href:\"http://elasticlunr.com\",children:\"Elasticlunr.js\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Website: \",(0,n.jsx)(e.a,{href:\"https://www.rust-lang.org\",children:\"Rust\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Website: \",(0,n.jsx)(e.a,{href:\"https://webassembly.org\",children:\"WebAssembly\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Website: \",(0,n.jsx)(e.a,{href:\"https://developer.mozilla.org/en-US/docs/WebAssembly\",children:\"MDN WebAssembly\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Website: \",(0,n.jsx)(e.a,{href:\"https://nextjs.org/\",children:\"Next.js\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Website: \",(0,n.jsx)(e.a,{href:\"https://caniuse.com/?search=webassembly\",children:\"Can I use WebAssembly?\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Lecture: \",(0,n.jsx)(e.a,{href:\"https://web.stanford.edu/class/archive/cs/cs166/cs166.1216/lectures/13/Slides13.pdf#page=49\",children:\"Approximate Membership Queries - Stanford\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Wiki: \",(0,n.jsx)(e.a,{href:\"https://en.wikipedia.org/wiki/Full-text_search\",children:\"Full-text Search\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/vercel/next.js/tree/canary/examples/with-webassembly\",children:\"Next.js & WebAssembly example\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/johnthagen/min-sized-rust\",children:\"Minimizing Rust Binary Size\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/DawChihLiou/dawchihliou.github.io/blob/main/scripts/fulltext-search/src/storage.rs\",children:\"dawchihliou.github.io\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/vercel/next.js/issues/25852\",children:\"Webpack 5 breaks dynamic wasm import for SSR\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Github: \",(0,n.jsx)(e.a,{href:\"https://github.com/tinysearch/tinysearch\",children:\"tinysearch\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/meilisearch/meilisearch\",children:\"Meilisearch\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/ayazhafiz/xorf\",children:\"xorf\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/rustwasm/wasm-pack\",children:\"wasm-pack\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/WebAssembly/binaryen\",children:\"Binaryen\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/rustwasm/twiggy\",children:\"Twiggy\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/rust-lang/rust-clippy\",children:\"Clippy\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/rustwasm/wasm-bindgen/tree/main/crates/web-sys\",children:\"web-sys\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/matklad/once_cell\",children:\"once_cell\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/bincode-org/bincode\",children:\"Bincode\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/rustwasm/wee_alloc\",children:\"wee_alloc\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/serde-rs/serde\",children:\"Serde\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/dtolnay/anyhow\",children:\"Anyhow\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/contentlayerdev/contentlayer\",children:\"Contentlayer\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/nextapps-de/flexsearch\",children:\"FlexSearch\"})]}),`\n`,(0,n.jsxs)(e.li,{children:[\"GitHub: \",(0,n.jsx)(e.a,{href:\"https://github.com/lucaong/minisearch\",children:\"MiniSearch\"})]}),`\n`]}),`\n`,(0,n.jsx)(e.hr,{}),`\n`,(0,n.jsxs)(e.p,{children:[\"Here you have it! Thanks for reading through\",(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"raising hands\",children:\"\\u{1F64C}\"}),`\nIf you find this article useful, please share it to help more people in their engineering journey.`]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.span,{role:\"img\",\"aria-label\":\"bird\",children:\"\\u{1F426}\"}),\" Feel free to connect with me on \",(0,n.jsx)(e.a,{href:\"https://twitter.com/dawchihliou\",children:\"twitter\"}),\"!\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"\\u23ED Read the next article: \",(0,n.jsx)(e.a,{href:\"/articles/how-to-plan-a-project-as-a-principal-software-engineer\",children:\"How to Plan A Project as A Principal Software Engineer: A Human-centered Approach\"})]}),`\n`,(0,n.jsx)(e.p,{children:\"Happy coding!\"})]});return s?(0,n.jsx)(s,Object.assign({},a,{children:c})):c}var b=f;return w;})();\n;return Component.default;"},"_id":"articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters.mdx","_raw":{"sourceFilePath":"articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters.mdx","sourceFileName":"i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters.mdx","sourceFileDir":"articles","bodyType":"mdx","flattenedPath":"articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters"},"type":"Article","readingTime":{"text":"11 min read","minutes":10.265,"time":615900,"words":2053},"wordCount":2055,"slug":"i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters"}},"__N_SSG":true}