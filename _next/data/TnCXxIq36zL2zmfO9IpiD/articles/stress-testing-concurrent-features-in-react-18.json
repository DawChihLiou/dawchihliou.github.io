{"pageProps":{"post":{"title":"Stress Testing Concurrent Features in React 18: A Case Study of startTransition & 3D Rendering","publishedAt":"May 30, 2022","description":"React 18 released the highly anticipated concurrent features. In this article, we are diving into a 3D visualization and discuss how to optimize its performance step by step with React 18's concurrent rendering.","cover":"/optimized/articles/concurrent-react-18/hero.webp","category":"Rust","coverWidth":"1400","coverHeight":"600","body":{"raw":"\n## TL;DR\n\n- üöÄ Concurrent rendering addresses the performance problem with rendering large UI updates while keeping the UI responsive.\n- üßë‚Äçüî¨ We'll use 3D rendering in the browser to stress test React 18.\n- ‚öñÔ∏è We'll look at the typical approaches alongside concurrent rendering and discuss their pros and cons.\n\n---\n\nIn this article, we are diving into a 3D visualization and discuss how to optimize its performance step by step with React 18's concurrent rendering. Here's the sneak peek.\n\n<video controls>\n  <source src=\"/articles/concurrent-react-18/demo.mp4\" type=\"video/mp4\" />\n  <p>Your browser doesn't support HTML5 video.</p>\n</video>\n\n## Concurrent Rendering with useTransition\n\n[React 18 introduces the concurrent features](https://reactjs.org/blog/2022/03/29/react-v18.html). The core idea is to classify state updates into two categories:\n\n- **Urgent updates**: they provide responsive feedback to user interactions, like typing and clicking.\n- **Transition updates**: they provide non-urgent UI transitions, like displaying dataset.\n\nThe purpose is to create a snappier and more responsive experience for the users.\n\nBefore React 18, all updates are considered urgent and a simple click or typing can cause the screen to freeze when there's a larger rending. So in React 18, by deferring non-urgent updates to urgent updates, users are able to receive immediate feedback from their interaction while React is working on the non-urgent updates in the background and reflect the result when ready.\n\nReact Working Group published a couple great articles about transition updates:\n\n- [New feature: startTransition](https://github.com/reactwg/react-18/discussions/41)\n- [Real world example: adding startTransition for slow renders](https://github.com/reactwg/react-18/discussions/65)\n\nAccording to the working group, the concurrent rendering is able to perform the following things:\n\n- **Yielding**: React will periodically stop working and let the browser fire one or more side effects.\n- **Interrupting**: When React detects new urgent updates, it will interrupt and pause non-urgent updates and start working on incoming urgent updates so the page can stay responsive.\n- **Skipping old results**: React will discard outdated transition updates and only render with the newest state.\n\nWe'll use the format and methods from the articles to test the 3D rendering demo and observe the impact on the performance and user experience.\n\n## 3D Rendering Demo Overview\n\nIn order to create heavy computations for rendering, I built a 3D visualization to show the connections between a GitHub user and the users she's connected with on GitHub.\n\nThe technology includes:\n\n- [three.js](https://github.com/mrdoob/three.js/)\n- [react-three-fiber](https://github.com/pmndrs/react-three-fiber)\n- [React 18](https://reactjs.org/blog/2022/03/29/react-v18.html)\n\nThe UI looks like this:\n\n<img\n  src=\"/optimized/articles/concurrent-react-18/screenshot.webp\"\n  alt=\"Demo screen shot\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/>\n\nThe components we will be discussing today includes:\n\n- **Search Bar**: to search for a GitHub username and fetch the user info from the GitHub GraphQL API.\n- **Scene**: to visualize the connections between the user and her connections in on a 3D globe.\n\n> **You can find [the repository on GitHub](https://github.com/DawChihLiou/concurrent-react-stress-testing) and [the demo on Netlify](https://sweaty-concurrent-react.netlify.app).**\n>\n> _Please note that the demo might crash due to a task timeout. The timeout is caused by the slow experimental API call to fetch the coordinates of the cities. If you'd like to interact with the demo, it's recommended to fork the repository and run the development server locally._\n\nAs we type into the search bar, you'll see an increasing amount of stars in the scene to simulate the high rendering demand on the UI. The amount of stars is `100,000 * inputValue.length`. We'll use it to stress test concurrent rendering.\n\n## The Problem\n\nLet's start with our base case with the most basic implementation. The outcome looks like this:\n\n<video controls>\n  <source src=\"/articles/concurrent-react-18/perf-sync.mp4\" type=\"video/mp4\" />\n  <p>Your browser doesn't support HTML5 video.</p>\n</video>\n\n_You can see my typing on the bottom left corner of the video._\n\nAs I was typing, the search bar was frozen. It didn't display the input value until the very end. Not just the search bar, the scene was frozen too. The stars didn't get rendered until I finished typing. Ideally, we want to be able to observe immediate feedback from our typing.\n\nLet's look into the performance together. We'll slow down the CPU by 4x and run a performance profiling.\n\n<img\n  src=\"/optimized/articles/concurrent-react-18/perf-sync.webp\"\n  alt=\"Performance profile for unoptimized rendering\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/>\n\nYou can see the big chunks of tasks with keypress event in the flame chart. With each keypress, React computes the next rendering for the SearchBar and the Scene. As we see in the chart, the longest task takes almost 0.8 seconds to complete. That's why the page feels so slow.\n\n### So, what's happening?\n\nIn the Home page component, the SearchBar listens to the keypress event and update the `username` when changes happens.\n\n```tsx\nconst Home: NextPage = () => {\n  const [username, setUsername] = useState<string>('')\n\n  const vertices = useMemo(() => computeVertices(username.length), [username])\n\n  const handleChange = (username: string) => {\n    setUsername(username)\n  }\n\n  return (\n    <>\n      <SearchBar value={username} onChange={handleChange} />\n      <Scene vertices={vertices} />\n    </>\n  )\n}\n```\n\nWhenever there's a `username` update, React recomputes `vertices` by calling `computeVertices()` and pass the result in to the Scene component to render the stars. Since the number of vertices is `100,000 * username.length`, coupling the two state updates together is a very expensive rendering cycle.\n\n## How did We Fix It Before React 18?\n\nIdeally, we want to see what we typed in the search bar immediately. Knowing that updating both states in the same rendering cycle takes too long, we can simply split the two updates so that SearchBar and Scene gets rendered separately.\n\nLet's first add a new state for the SearchBar:\n\n```tsx\ntype FastSearchBarProps = {\n  defaultValue: string\n  onChange: (value: string) => void\n}\n\nfunction FastSearchBar({ defaultValue, onChange }: FastSearchBarProps) {\n  // new state designated to SearchBar\n  const [value, setValue] = useState(defaultValue)\n\n  const handleChange = (value: string) => {\n    // update input value\n    setValue(value)\n\n    // update vertices\n    onChange(value)\n  }\n\n  return <SearchBar value={value} onChange={handleChange} />\n}\n\nconst Home: NextPage = () => {\n  const [username, setUsername] = useState<string>('')\n\n  const vertices = useMemo(() => computeVertices(username.length), [username])\n\n  const handleChange = (username: string) => {\n    setUsername(username)\n  }\n\n  return (\n    <>\n      <FastSearchBar defaultValue={username} onChange={handleChange} />\n      <Scene vertices={vertices} />\n    </>\n  )\n}\n```\n\nNow we have a `value` state for SearchBar and a `username` state for computing `vertices`. We'll need additional work to separate the renderings because React will batch the state updates together in the same event to avoid additional rendering. Let's take a look at some of the typical approaches.\n\n### Approach #1: setTimeout\n\nWe can simply defer the slower update by adding setTimeout to put the it in the event loop.\n\n```tsx\nfunction FastSearchBar({ defaultValue, onChange }: FastSearchBarProps) {\n  const [value, setValue] = useState(defaultValue)\n\n  const handleChange = (value: string) => {\n    setValue(value)\n\n    setTimeout(() => {\n      onChange(value)\n    }, 0)\n  }\n\n  return <SearchBar value={value} onChange={handleChange} />\n}\n```\n\nNow even with the 4x slowdown, the SearchBar looks more responsive. We also observed that the stars are getting rendered while we were typing.\n\n<video controls>\n  <source\n    src=\"/articles/concurrent-react-18/perf-timeout-throttle-x4.mp4\"\n    type=\"video/mp4\"\n  />\n  <p>Your browser doesn't support HTML5 video.</p>\n</video>\n\nIf you take a look at the performance profile, you can see that we were able to separate the keypress events from the expensive tasks.\n\n<img\n  src=\"/optimized/articles/concurrent-react-18/perf-timeout.webp\"\n  alt=\"Performance profile for rendering with timeout\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/>\n\nHowever, we noticed that the Scene was rendered twice after the last keypress event. That's because the renderings were still scheduled with outdated state when the `setTimeout`s were fired.\n\n### Approach #2: Debouncing\n\nWe can actually cancel the rendering schedule by implementing debouncing.\n\n```tsx\nfunction FastSearchBar({ defaultValue, onChange }: FastSearchBarProps) {\n  const [value, setValue] = useState(defaultValue)\n  const timeout = useRef<NodeJS.Timeout>()\n\n  const handleChange = (value: string) => {\n    // cancel the schedule if `value` changed within 100ms.\n    clearTimeout(timeout.current)\n\n    setValue(value)\n\n    // schedule a new update if input value hasn't changed for 100ms.\n    timeout.current = setTimeout(() => {\n      onChange(value)\n    }, 100)\n  }\n\n  return <SearchBar value={value} onChange={handleChange} />\n}\n```\n\n<video controls>\n  <source\n    src=\"/articles/concurrent-react-18/perf-debounce-throttle-x4.mp4\"\n    type=\"video/mp4\"\n  />\n  <p>Your browser doesn't support HTML5 video.</p>\n</video>\n\nThe user experience looks better now. The SearchBar stays fairly responsive with 4x slowdown and the redundant update on the Scene after the last keypress event was gone.\n\nHowever, the shortcoming of debouncing in this case is that the Scene update will always be delayed by 100ms. With faster CPU, the delay is most likely redundant and it makes the page feel slow.\n\n<img\n  src=\"/optimized/articles/concurrent-react-18/perf-debounce.webp\"\n  alt=\"Performance profile for rendering with debouncing\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/>\n\n## React 18's Concurrent Rendering: startTransition\n\nThe page feel more responsive with either adding setTimeout or debouncing, but they introduces different problems:\n\n- setTimeout: results in additional UI updates with outdated states\n- debouncing: results in artificial delay in UI updates\n\nLet's take a look at how React 18 solves the problems with concurrent rendering:\n\n```tsx\nimport { startTransition } from 'react'\n\ntype FastSearchBarProps = {\n  defaultValue: string\n  onChange: (value: string) => void\n}\n\nfunction FastSearchBar({ defaultValue, onChange }: FastSearchBarProps) {\n  const [value, setValue] = useState(defaultValue)\n\n  const handleChange = (value: string) => {\n    setValue(value)\n    onChange(value)\n  }\n\n  return <SearchBar value={value} onChange={handleChange} />\n}\n\nconst Home: NextPage = () => {\n  const [username, setUsername] = useState<string>('')\n\n  const vertices = useMemo(\n    () => computeCoordinates(username.length),\n    [username]\n  )\n\n  const handleChange = (username: string) => {\n    // defer username update in a less urgent UI transition\n    startTransition(() => {\n      setUsername(username)\n    })\n  }\n\n  return (\n    <Container>\n      <FastSearchBar defaultValue={username} onChange={handleChange} />\n      <Scene vertices={vertices} />\n    </Container>\n  )\n}\n```\n\nWe call `setUsername` inside of `startTransition` function. It tells React to defer `setUsername` to the other urgent updates.\n\n<video controls>\n  <source\n    src=\"/articles/concurrent-react-18/perf-transition-throttle-x4.mp4\"\n    type=\"video/mp4\"\n  />\n  <p>Your browser doesn't support HTML5 video.</p>\n</video>\n\nAs you can see, we are able to separate the rendering of SearchBar and Scene without any asynchronous functions. If we take a look at the performance profile, we can observe a few things:\n\n- The keypress events are separated from the long rendering function calls.\n- The keypress events are grouped. It aligns with the **yielding** behavior in concurrent rendering.\n- There's only one rendering call after the last group of keypress events. It aligns with the **skipping old results** behavior in concurrent rendering.\n\nThe **interrupting** behavior is not very straight forward to observe. If you know how to analyze it from the performance profile, please feel free to [reach out to me on Twitter](https://twitter.com/dawchihliou)!\n\n<img\n  src=\"/optimized/articles/concurrent-react-18/perf-transition.webp\"\n  alt=\"Performance profile for rendering with startTransition\"\n  width=\"100%\"\n  className=\"rounded centered\"\n  loading=\"lazy\"\n/>\n\nLet's remove the slowdown and see the final result:\n\n<video controls>\n  <source\n    src=\"/articles/concurrent-react-18/perf-transition.mp4\"\n    type=\"video/mp4\"\n  />\n  <p>Your browser doesn't support HTML5 video.</p>\n</video>\n\nAs you can see, the SearchBar is always responsive while the Scene updates quickly. The user experience feels so much smoother.\n\n## Final Thoughts\n\nIn the past, adding debouncing was the go-to solution for rendering large UI updates while keeping pages responsive. Based on this experiment, concurrent rendering makes the UI more responsive without the shortcoming of debouncing. Even for the heavy computation with at least 100,000 3D objects, concurrent rendering still helped the page to be snappy.\n\nHere's the side-by-side comparisons:\n\n**UI Comparison with 4x CPU Throttling**\n\nBasic implementation without concurrent rendering:\n\n<video controls>\n  <source\n    src=\"/articles/concurrent-react-18/perf-sync-throttle-x4.mp4\"\n    type=\"video/mp4\"\n  />\n  <p>Your browser doesn't support HTML5 video.</p>\n</video>\n\nOptimized implementation with concurrent rendering:\n\n<video controls>\n  <source\n    src=\"/articles/concurrent-react-18/perf-transition-throttle-x4.mp4\"\n    type=\"video/mp4\"\n  />\n  <p>Your browser doesn't support HTML5 video.</p>\n</video>\n\n**UI Comparison with No CPU Throttling**\n\nBasic implementation without concurrent rendering:\n\n<video controls>\n  <source src=\"/articles/concurrent-react-18/perf-sync.mp4\" type=\"video/mp4\" />\n  <p>Your browser doesn't support HTML5 video.</p>\n</video>\n\nOptimized implementation with concurrent rendering:\n\n<video controls>\n  <source\n    src=\"/articles/concurrent-react-18/perf-transition.mp4\"\n    type=\"video/mp4\"\n  />\n  <p>Your browser doesn't support HTML5 video.</p>\n</video>\n\n## References\n\n- [GitHub: Demo repository](https://github.com/DawChihLiou/concurrent-react-stress-testing)\n- [Website: Demo Site](https://sweaty-concurrent-react.netlify.app)\n- [Website: React v18.0](https://reactjs.org/blog/2022/03/29/react-v18.html)\n- [GitHub: New feature: startTransition](https://github.com/reactwg/react-18/discussions/41)\n- [GitHub: Real world example: adding startTransition for slow renders](https://github.com/reactwg/react-18/discussions/65)\n- [GitHub: three.js](https://github.com/mrdoob/three.js/)\n- [GitHub: react-three-fiber](https://github.com/pmndrs/react-three-fiber)\n- [Website: WebGL Globe Solution](https://webgl-globe-solutions.stackblitz.io)\n\n---\n\nHere you have it! Thanks for reading throughüôå\nIf you find this article useful, please share it to help more people in their engineering journey.\n\nüê¶ Feel free to connect with me on [twitter](https://twitter.com/dawchihliou)!\n\n‚è≠ Ready for the next article? üëâ [**I Built A Snappy Static Full-text Search with WebAssembly, Rust, Next.js, and Xor Filters**](/articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters)\n\nHappy coding!\n","code":"var Component=(()=>{var o=Object.create;var t=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var h=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var l=a=>t(a,\"__esModule\",{value:!0});var m=(a,n)=>()=>(n||a((n={exports:{}}).exports,n),n.exports),N=(a,n)=>{l(a);for(var s in n)t(a,s,{get:n[s],enumerable:!0})},k=(a,n,s)=>{if(n&&typeof n==\"object\"||typeof n==\"function\")for(let c of d(n))!u.call(a,c)&&c!==\"default\"&&t(a,c,{get:()=>n[c],enumerable:!(s=p(n,c))||s.enumerable});return a},g=a=>k(l(t(a!=null?o(h(a)):{},\"default\",a&&a.__esModule&&\"default\"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var r=m((y,i)=>{i.exports=_jsx_runtime});var b={};N(b,{default:()=>w});var e=g(r());function f(a={}){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",ul:\"ul\",li:\"li\",hr:\"hr\",p:\"p\",strong:\"strong\",blockquote:\"blockquote\",em:\"em\",code:\"code\",h3:\"h3\",pre:\"pre\"},a.components),{wrapper:s}=n,c=(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"tldr\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#tldr\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"TL;DR\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"rocket\",children:\"\\u{1F680}\"}),\" Concurrent rendering addresses the performance problem with rendering large UI updates while keeping the UI responsive.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"\",\"aria-hidden\":!0,children:\"\\u{1F9D1}\"}),\"\\u200D\",(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"microscope\",children:\"\\u{1F52C}\"}),\" We'll use 3D rendering in the browser to stress test React 18.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"balance scale\",children:\"\\u2696\\uFE0F\"}),\" We'll look at the typical approaches alongside concurrent rendering and discuss their pros and cons.\"]}),`\n`]}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsx)(n.p,{children:\"In this article, we are diving into a 3D visualization and discuss how to optimize its performance step by step with React 18's concurrent rendering. Here's the sneak peek.\"}),`\n`,(0,e.jsxs)(\"video\",{controls:!0,children:[(0,e.jsx)(\"source\",{src:\"/articles/concurrent-react-18/demo.mp4\",type:\"video/mp4\"}),(0,e.jsx)(\"p\",{children:\"Your browser doesn't support HTML5 video.\"})]}),`\n`,(0,e.jsxs)(n.h2,{id:\"concurrent-rendering-with-usetransition\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#concurrent-rendering-with-usetransition\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Concurrent Rendering with useTransition\"]}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.a,{href:\"https://reactjs.org/blog/2022/03/29/react-v18.html\",children:\"React 18 introduces the concurrent features\"}),\". The core idea is to classify state updates into two categories:\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Urgent updates\"}),\": they provide responsive feedback to user interactions, like typing and clicking.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Transition updates\"}),\": they provide non-urgent UI transitions, like displaying dataset.\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"The purpose is to create a snappier and more responsive experience for the users.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Before React 18, all updates are considered urgent and a simple click or typing can cause the screen to freeze when there's a larger rending. So in React 18, by deferring non-urgent updates to urgent updates, users are able to receive immediate feedback from their interaction while React is working on the non-urgent updates in the background and reflect the result when ready.\"}),`\n`,(0,e.jsx)(n.p,{children:\"React Working Group published a couple great articles about transition updates:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/reactwg/react-18/discussions/41\",children:\"New feature: startTransition\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/reactwg/react-18/discussions/65\",children:\"Real world example: adding startTransition for slow renders\"})}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"According to the working group, the concurrent rendering is able to perform the following things:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Yielding\"}),\": React will periodically stop working and let the browser fire one or more side effects.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Interrupting\"}),\": When React detects new urgent updates, it will interrupt and pause non-urgent updates and start working on incoming urgent updates so the page can stay responsive.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Skipping old results\"}),\": React will discard outdated transition updates and only render with the newest state.\"]}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"We'll use the format and methods from the articles to test the 3D rendering demo and observe the impact on the performance and user experience.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"3d-rendering-demo-overview\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#3d-rendering-demo-overview\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"3D Rendering Demo Overview\"]}),`\n`,(0,e.jsx)(n.p,{children:\"In order to create heavy computations for rendering, I built a 3D visualization to show the connections between a GitHub user and the users she's connected with on GitHub.\"}),`\n`,(0,e.jsx)(n.p,{children:\"The technology includes:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/mrdoob/three.js/\",children:\"three.js\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/pmndrs/react-three-fiber\",children:\"react-three-fiber\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://reactjs.org/blog/2022/03/29/react-v18.html\",children:\"React 18\"})}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"The UI looks like this:\"}),`\n`,(0,e.jsx)(\"img\",{src:\"/optimized/articles/concurrent-react-18/screenshot.webp\",alt:\"Demo screen shot\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,e.jsx)(n.p,{children:\"The components we will be discussing today includes:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Search Bar\"}),\": to search for a GitHub username and fetch the user info from the GitHub GraphQL API.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Scene\"}),\": to visualize the connections between the user and her connections in on a 3D globe.\"]}),`\n`]}),`\n`,(0,e.jsxs)(n.blockquote,{children:[`\n`,(0,e.jsx)(n.p,{children:(0,e.jsxs)(n.strong,{children:[\"You can find \",(0,e.jsx)(n.a,{href:\"https://github.com/DawChihLiou/concurrent-react-stress-testing\",children:\"the repository on GitHub\"}),\" and \",(0,e.jsx)(n.a,{href:\"https://sweaty-concurrent-react.netlify.app\",children:\"the demo on Netlify\"}),\".\"]})}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:\"Please note that the demo might crash due to a task timeout. The timeout is caused by the slow experimental API call to fetch the coordinates of the cities. If you'd like to interact with the demo, it's recommended to fork the repository and run the development server locally.\"})}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"As we type into the search bar, you'll see an increasing amount of stars in the scene to simulate the high rendering demand on the UI. The amount of stars is \",(0,e.jsx)(n.code,{children:\"100,000 * inputValue.length\"}),\". We'll use it to stress test concurrent rendering.\"]}),`\n`,(0,e.jsxs)(n.h2,{id:\"the-problem\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#the-problem\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The Problem\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Let's start with our base case with the most basic implementation. The outcome looks like this:\"}),`\n`,(0,e.jsxs)(\"video\",{controls:!0,children:[(0,e.jsx)(\"source\",{src:\"/articles/concurrent-react-18/perf-sync.mp4\",type:\"video/mp4\"}),(0,e.jsx)(\"p\",{children:\"Your browser doesn't support HTML5 video.\"})]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:\"You can see my typing on the bottom left corner of the video.\"})}),`\n`,(0,e.jsx)(n.p,{children:\"As I was typing, the search bar was frozen. It didn't display the input value until the very end. Not just the search bar, the scene was frozen too. The stars didn't get rendered until I finished typing. Ideally, we want to be able to observe immediate feedback from our typing.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Let's look into the performance together. We'll slow down the CPU by 4x and run a performance profiling.\"}),`\n`,(0,e.jsx)(\"img\",{src:\"/optimized/articles/concurrent-react-18/perf-sync.webp\",alt:\"Performance profile for unoptimized rendering\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,e.jsx)(n.p,{children:\"You can see the big chunks of tasks with keypress event in the flame chart. With each keypress, React computes the next rendering for the SearchBar and the Scene. As we see in the chart, the longest task takes almost 0.8 seconds to complete. That's why the page feels so slow.\"}),`\n`,(0,e.jsxs)(n.h3,{id:\"so-whats-happening\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#so-whats-happening\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"So, what's happening?\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"In the Home page component, the SearchBar listens to the keypress event and update the \",(0,e.jsx)(n.code,{children:\"username\"}),\" when changes happens.\"]}),`\n`,(0,e.jsx)(n.pre,{className:\"language-tsx\",children:(0,e.jsxs)(n.code,{className:\"language-tsx code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"Home\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"NextPage\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" setUsername\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token generic-function\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"useState\"}),(0,e.jsxs)(n.span,{className:\"token generic class-name\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"})]})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" vertices \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"useMemo\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"computeVertices\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"length\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"handleChange\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"username\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setUsername\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token tag\",children:(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"      \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"SearchBar\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"value\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"onChange\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"handleChange\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/>\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"      \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Scene\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"vertices\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"vertices\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/>\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"    \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token tag\",children:(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"</\"})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Whenever there's a \",(0,e.jsx)(n.code,{children:\"username\"}),\" update, React recomputes \",(0,e.jsx)(n.code,{children:\"vertices\"}),\" by calling \",(0,e.jsx)(n.code,{children:\"computeVertices()\"}),\" and pass the result in to the Scene component to render the stars. Since the number of vertices is \",(0,e.jsx)(n.code,{children:\"100,000 * username.length\"}),\", coupling the two state updates together is a very expensive rendering cycle.\"]}),`\n`,(0,e.jsxs)(n.h2,{id:\"how-did-we-fix-it-before-react-18\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#how-did-we-fix-it-before-react-18\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"How did We Fix It Before React 18?\"]}),`\n`,(0,e.jsx)(n.p,{children:\"Ideally, we want to see what we typed in the search bar immediately. Knowing that updating both states in the same rendering cycle takes too long, we can simply split the two updates so that SearchBar and Scene gets rendered separately.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Let's first add a new state for the SearchBar:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-tsx\",children:(0,e.jsxs)(n.code,{className:\"language-tsx code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"FastSearchBarProps\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  defaultValue\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"onChange\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"FastSearchBar\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" defaultValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" onChange \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"FastSearchBarProps\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// new state designated to SearchBar\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" setValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"useState\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"defaultValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"handleChange\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// update input value\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setValue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// update vertices\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"onChange\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"SearchBar\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"value\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"onChange\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"handleChange\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/>\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"Home\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"NextPage\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" setUsername\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token generic-function\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"useState\"}),(0,e.jsxs)(n.span,{className:\"token generic class-name\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"})]})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" vertices \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"useMemo\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"computeVertices\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"length\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"handleChange\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"username\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setUsername\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token tag\",children:(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"      \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"FastSearchBar\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"defaultValue\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"onChange\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"handleChange\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/>\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"      \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Scene\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"vertices\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"vertices\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/>\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"    \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token tag\",children:(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"</\"})}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"Now we have a \",(0,e.jsx)(n.code,{children:\"value\"}),\" state for SearchBar and a \",(0,e.jsx)(n.code,{children:\"username\"}),\" state for computing \",(0,e.jsx)(n.code,{children:\"vertices\"}),\". We'll need additional work to separate the renderings because React will batch the state updates together in the same event to avoid additional rendering. Let's take a look at some of the typical approaches.\"]}),`\n`,(0,e.jsxs)(n.h3,{id:\"approach-1-settimeout\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#approach-1-settimeout\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Approach #1: setTimeout\"]}),`\n`,(0,e.jsx)(n.p,{children:\"We can simply defer the slower update by adding setTimeout to put the it in the event loop.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-tsx\",children:(0,e.jsxs)(n.code,{className:\"language-tsx code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"FastSearchBar\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" defaultValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" onChange \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"FastSearchBarProps\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" setValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"useState\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"defaultValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"handleChange\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setValue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setTimeout\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token function\",children:\"onChange\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"SearchBar\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"value\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"onChange\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"handleChange\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/>\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsx)(n.p,{children:\"Now even with the 4x slowdown, the SearchBar looks more responsive. We also observed that the stars are getting rendered while we were typing.\"}),`\n`,(0,e.jsxs)(\"video\",{controls:!0,children:[(0,e.jsx)(\"source\",{src:\"/articles/concurrent-react-18/perf-timeout-throttle-x4.mp4\",type:\"video/mp4\"}),(0,e.jsx)(\"p\",{children:\"Your browser doesn't support HTML5 video.\"})]}),`\n`,(0,e.jsx)(n.p,{children:\"If you take a look at the performance profile, you can see that we were able to separate the keypress events from the expensive tasks.\"}),`\n`,(0,e.jsx)(\"img\",{src:\"/optimized/articles/concurrent-react-18/perf-timeout.webp\",alt:\"Performance profile for rendering with timeout\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,e.jsxs)(n.p,{children:[\"However, we noticed that the Scene was rendered twice after the last keypress event. That's because the renderings were still scheduled with outdated state when the \",(0,e.jsx)(n.code,{children:\"setTimeout\"}),\"s were fired.\"]}),`\n`,(0,e.jsxs)(n.h3,{id:\"approach-2-debouncing\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#approach-2-debouncing\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Approach #2: Debouncing\"]}),`\n`,(0,e.jsx)(n.p,{children:\"We can actually cancel the rendering schedule by implementing debouncing.\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-tsx\",children:(0,e.jsxs)(n.code,{className:\"language-tsx code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"FastSearchBar\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" defaultValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" onChange \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"FastSearchBarProps\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" setValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"useState\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"defaultValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" timeout \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token generic-function\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"useRef\"}),(0,e.jsxs)(n.span,{className:\"token generic class-name\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"<\"}),\"NodeJS\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"Timeout\",(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"})]})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"handleChange\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// cancel the schedule if `value` changed within 100ms.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"clearTimeout\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"timeout\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"current\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setValue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// schedule a new update if input value hasn't changed for 100ms.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    timeout\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"current\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setTimeout\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token function\",children:\"onChange\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"100\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"SearchBar\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"value\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"onChange\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"handleChange\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/>\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(\"video\",{controls:!0,children:[(0,e.jsx)(\"source\",{src:\"/articles/concurrent-react-18/perf-debounce-throttle-x4.mp4\",type:\"video/mp4\"}),(0,e.jsx)(\"p\",{children:\"Your browser doesn't support HTML5 video.\"})]}),`\n`,(0,e.jsx)(n.p,{children:\"The user experience looks better now. The SearchBar stays fairly responsive with 4x slowdown and the redundant update on the Scene after the last keypress event was gone.\"}),`\n`,(0,e.jsx)(n.p,{children:\"However, the shortcoming of debouncing in this case is that the Scene update will always be delayed by 100ms. With faster CPU, the delay is most likely redundant and it makes the page feel slow.\"}),`\n`,(0,e.jsx)(\"img\",{src:\"/optimized/articles/concurrent-react-18/perf-debounce.webp\",alt:\"Performance profile for rendering with debouncing\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"react-18s-concurrent-rendering-starttransition\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#react-18s-concurrent-rendering-starttransition\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"React 18's Concurrent Rendering: startTransition\"]}),`\n`,(0,e.jsx)(n.p,{children:\"The page feel more responsive with either adding setTimeout or debouncing, but they introduces different problems:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"setTimeout: results in additional UI updates with outdated states\"}),`\n`,(0,e.jsx)(n.li,{children:\"debouncing: results in artificial delay in UI updates\"}),`\n`]}),`\n`,(0,e.jsx)(n.p,{children:\"Let's take a look at how React 18 solves the problems with concurrent rendering:\"}),`\n`,(0,e.jsx)(n.pre,{className:\"language-tsx\",children:(0,e.jsxs)(n.code,{className:\"language-tsx code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"import\"}),\" \",(0,e.jsxs)(n.span,{className:\"token imports\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" startTransition \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"from\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'react'\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"type\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"FastSearchBarProps\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  defaultValue\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"onChange\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"void\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"FastSearchBar\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" defaultValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" onChange \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"FastSearchBarProps\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" setValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"useState\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"defaultValue\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"handleChange\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setValue\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"onChange\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"SearchBar\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"value\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"value\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"onChange\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"handleChange\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/>\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"Home\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"NextPage\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" setUsername\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token generic-function\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"useState\"}),(0,e.jsxs)(n.span,{className:\"token generic class-name\",children:[(0,e.jsx)(n.span,{className:\"token operator\",children:\"<\"}),(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\">\"})]})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"''\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" vertices \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"useMemo\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"computeCoordinates\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"length\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token function-variable function\",children:\"handleChange\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"username\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"string\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// defer username update in a less urgent UI transition\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token function\",children:\"startTransition\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token arrow operator\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token function\",children:\"setUsername\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Container\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"      \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"FastSearchBar\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"defaultValue\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"username\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"onChange\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"handleChange\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/>\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"      \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"<\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Scene\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token attr-name\",children:\"vertices\"}),(0,e.jsxs)(n.span,{className:\"token script language-javascript\",children:[(0,e.jsx)(n.span,{className:\"token script-punctuation punctuation\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"vertices\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"/>\"})]}),(0,e.jsx)(n.span,{className:\"token plain-text\",children:`\n`})]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token plain-text\",children:\"    \"}),(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsxs)(n.span,{className:\"token tag\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"</\"}),(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Container\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),`\n`,(0,e.jsxs)(n.p,{children:[\"We call \",(0,e.jsx)(n.code,{children:\"setUsername\"}),\" inside of \",(0,e.jsx)(n.code,{children:\"startTransition\"}),\" function. It tells React to defer \",(0,e.jsx)(n.code,{children:\"setUsername\"}),\" to the other urgent updates.\"]}),`\n`,(0,e.jsxs)(\"video\",{controls:!0,children:[(0,e.jsx)(\"source\",{src:\"/articles/concurrent-react-18/perf-transition-throttle-x4.mp4\",type:\"video/mp4\"}),(0,e.jsx)(\"p\",{children:\"Your browser doesn't support HTML5 video.\"})]}),`\n`,(0,e.jsx)(n.p,{children:\"As you can see, we are able to separate the rendering of SearchBar and Scene without any asynchronous functions. If we take a look at the performance profile, we can observe a few things:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"The keypress events are separated from the long rendering function calls.\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"The keypress events are grouped. It aligns with the \",(0,e.jsx)(n.strong,{children:\"yielding\"}),\" behavior in concurrent rendering.\"]}),`\n`,(0,e.jsxs)(n.li,{children:[\"There's only one rendering call after the last group of keypress events. It aligns with the \",(0,e.jsx)(n.strong,{children:\"skipping old results\"}),\" behavior in concurrent rendering.\"]}),`\n`]}),`\n`,(0,e.jsxs)(n.p,{children:[\"The \",(0,e.jsx)(n.strong,{children:\"interrupting\"}),\" behavior is not very straight forward to observe. If you know how to analyze it from the performance profile, please feel free to \",(0,e.jsx)(n.a,{href:\"https://twitter.com/dawchihliou\",children:\"reach out to me on Twitter\"}),\"!\"]}),`\n`,(0,e.jsx)(\"img\",{src:\"/optimized/articles/concurrent-react-18/perf-transition.webp\",alt:\"Performance profile for rendering with startTransition\",width:\"100%\",className:\"rounded centered\",loading:\"lazy\"}),`\n`,(0,e.jsx)(n.p,{children:\"Let's remove the slowdown and see the final result:\"}),`\n`,(0,e.jsxs)(\"video\",{controls:!0,children:[(0,e.jsx)(\"source\",{src:\"/articles/concurrent-react-18/perf-transition.mp4\",type:\"video/mp4\"}),(0,e.jsx)(\"p\",{children:\"Your browser doesn't support HTML5 video.\"})]}),`\n`,(0,e.jsx)(n.p,{children:\"As you can see, the SearchBar is always responsive while the Scene updates quickly. The user experience feels so much smoother.\"}),`\n`,(0,e.jsxs)(n.h2,{id:\"final-thoughts\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#final-thoughts\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Final Thoughts\"]}),`\n`,(0,e.jsx)(n.p,{children:\"In the past, adding debouncing was the go-to solution for rendering large UI updates while keeping pages responsive. Based on this experiment, concurrent rendering makes the UI more responsive without the shortcoming of debouncing. Even for the heavy computation with at least 100,000 3D objects, concurrent rendering still helped the page to be snappy.\"}),`\n`,(0,e.jsx)(n.p,{children:\"Here's the side-by-side comparisons:\"}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"UI Comparison with 4x CPU Throttling\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Basic implementation without concurrent rendering:\"}),`\n`,(0,e.jsxs)(\"video\",{controls:!0,children:[(0,e.jsx)(\"source\",{src:\"/articles/concurrent-react-18/perf-sync-throttle-x4.mp4\",type:\"video/mp4\"}),(0,e.jsx)(\"p\",{children:\"Your browser doesn't support HTML5 video.\"})]}),`\n`,(0,e.jsx)(n.p,{children:\"Optimized implementation with concurrent rendering:\"}),`\n`,(0,e.jsxs)(\"video\",{controls:!0,children:[(0,e.jsx)(\"source\",{src:\"/articles/concurrent-react-18/perf-transition-throttle-x4.mp4\",type:\"video/mp4\"}),(0,e.jsx)(\"p\",{children:\"Your browser doesn't support HTML5 video.\"})]}),`\n`,(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"UI Comparison with No CPU Throttling\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Basic implementation without concurrent rendering:\"}),`\n`,(0,e.jsxs)(\"video\",{controls:!0,children:[(0,e.jsx)(\"source\",{src:\"/articles/concurrent-react-18/perf-sync.mp4\",type:\"video/mp4\"}),(0,e.jsx)(\"p\",{children:\"Your browser doesn't support HTML5 video.\"})]}),`\n`,(0,e.jsx)(n.p,{children:\"Optimized implementation with concurrent rendering:\"}),`\n`,(0,e.jsxs)(\"video\",{controls:!0,children:[(0,e.jsx)(\"source\",{src:\"/articles/concurrent-react-18/perf-transition.mp4\",type:\"video/mp4\"}),(0,e.jsx)(\"p\",{children:\"Your browser doesn't support HTML5 video.\"})]}),`\n`,(0,e.jsxs)(n.h2,{id:\"references\",children:[(0,e.jsx)(n.a,{className:\"anchor\",href:\"#references\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"References\"]}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/DawChihLiou/concurrent-react-stress-testing\",children:\"GitHub: Demo repository\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://sweaty-concurrent-react.netlify.app\",children:\"Website: Demo Site\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://reactjs.org/blog/2022/03/29/react-v18.html\",children:\"Website: React v18.0\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/reactwg/react-18/discussions/41\",children:\"GitHub: New feature: startTransition\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/reactwg/react-18/discussions/65\",children:\"GitHub: Real world example: adding startTransition for slow renders\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/mrdoob/three.js/\",children:\"GitHub: three.js\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://github.com/pmndrs/react-three-fiber\",children:\"GitHub: react-three-fiber\"})}),`\n`,(0,e.jsx)(n.li,{children:(0,e.jsx)(n.a,{href:\"https://webgl-globe-solutions.stackblitz.io\",children:\"Website: WebGL Globe Solution\"})}),`\n`]}),`\n`,(0,e.jsx)(n.hr,{}),`\n`,(0,e.jsxs)(n.p,{children:[\"Here you have it! Thanks for reading through\",(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"raising hands\",children:\"\\u{1F64C}\"}),`\nIf you find this article useful, please share it to help more people in their engineering journey.`]}),`\n`,(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"bird\",children:\"\\u{1F426}\"}),\" Feel free to connect with me on \",(0,e.jsx)(n.a,{href:\"https://twitter.com/dawchihliou\",children:\"twitter\"}),\"!\"]}),`\n`,(0,e.jsxs)(n.p,{children:[\"\\u23ED Ready for the next article? \",(0,e.jsx)(n.span,{role:\"img\",\"aria-label\":\"backhand index pointing right\",children:\"\\u{1F449}\"}),\" \",(0,e.jsx)(n.a,{href:\"/articles/i-built-a-snappy-full-text-search-with-webassembly-rust-nextjs-and-xor-filters\",children:(0,e.jsx)(n.strong,{children:\"I Built A Snappy Static Full-text Search with WebAssembly, Rust, Next.js, and Xor Filters\"})})]}),`\n`,(0,e.jsx)(n.p,{children:\"Happy coding!\"})]});return s?(0,e.jsx)(s,Object.assign({},a,{children:c})):c}var w=f;return b;})();\n;return Component.default;"},"_id":"articles/stress-testing-concurrent-features-in-react-18.mdx","_raw":{"sourceFilePath":"articles/stress-testing-concurrent-features-in-react-18.mdx","sourceFileName":"stress-testing-concurrent-features-in-react-18.mdx","sourceFileDir":"articles","bodyType":"mdx","flattenedPath":"articles/stress-testing-concurrent-features-in-react-18"},"type":"Article","readingTime":{"text":"10 min read","minutes":9.89,"time":593400,"words":1978},"wordCount":1980,"slug":"stress-testing-concurrent-features-in-react-18"}},"__N_SSG":true}